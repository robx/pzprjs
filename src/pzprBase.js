/* 
 * pzprBase.js
 * 
 * pzprBase.js is a base script for playing nikoli puzzles on Web
 * written in JavaScript.
 * 
 * @author  dk22
 * @version v3.3.0
 * @date    2010-04-28
 * 
 * This script is licensed under the MIT license. See below,
 * http://www.opensource.org/licenses/mit-license.php
 * 
 */
var pzprversion="v3.3.0";(function(){if(!!window.Camp){return}var M=this,m=document,q=Math.sin,y=Math.cos,t=Math.round,w=2*Math.PI,A=!!(window.attachEvent&&!window.opera),b=10,e=b/2,I=[],x={debugmode:false},O=["svg","canvas","sl","flash","vml"],N=0,h=0,H=1,L=2,f=3,J=4,p="BeforeEnd";var K=(function(){var T=[];for(var i=256;i<512;i++){T[i-256]=i.toString(16).substr(1)}return T})();function z(i){return{width:(i.offsetWidth||i.clientWidth),height:(i.offsetHeight||i.clientHeight)}}function B(T){if(!I[T]){if(T.substr(0,4)==="rgb("){var i=T.match(/\d+/g);I[T]=["#",K[i[0]],K[i[1]],K[i[2]]].join("")}else{I[T]=T}}return I[T]}function u(V){if(V.match(/\#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/)){var U=parseInt(RegExp.$1,16).toString();var T=parseInt(RegExp.$2,16).toString();var i=parseInt(RegExp.$3,16).toString();return["rgb(",U,",",T,",",i,")"].join("")}return V}function E(U,T){for(var i in T){U[i]=T[i]}}var v=function(){this.canvas=false;this.vml=false;this.svg=false;this.sl=false;this.flash=false};var P="<v:shape",Q="<v:group",D="<v:textpath",c="<v:polyline",C='<v:path textpathok="t" />';V_EL_UNSELECTABLE="",V_TAGEND=">",V_TAGEND_NULL=" />",V_CLOSETAG_SHAPE="</v:shape>",V_CLOSETAG_GROUP="</v:group>",V_CLOSETAG_TEXTPATH="</v:textpath>",V_CLOSETAG_POLYLINE="</v:polyline>",V_ATT_ID=' id="',V_ATT_PATH=' path="',V_ATT_POINTS=' points="',V_ATT_STYLE=' style="',V_ATT_STRING=' string="',V_ATT_COORDSIZE=' coordsize="100,100"',V_ATT_FILLCOLOR=' fillcolor="',V_ATT_STROKECOLOR=' strokecolor="',V_ATT_STROKEWEIGHT=' strokeweight="',V_ATT_END='"',V_ATT_STYLE_TEXTBOX=' style="white-space:nowrap;cursor:default;font:10px sans-serif;"',V_DEF_ATT_POLYLINE=' stroked="f" filled="t"',V_DEF_ATT_TEXTPATH=' on="t" xscale="t"',V_STYLE_LEFT="left:",V_STYLE_TOP="top:",V_STYLE_FONT="font:",V_STYLE_ALIGN="v-text-align:",V_STYLE_END=";",V_PATH_MOVE=" m",V_PATH_LINE=" l",V_PATH_CLOSE=" x",V_PATH_NOSTROKE=" ns",V_PATH_NOFILL=" nf",V_HEIGHT={top:-0.3,hanging:-0.3,middle:0,alphabetic:0.4,bottom:0.45};var a="http://www.w3.org/2000/svg",n=" M",d=" L",l=" A",o=" z",r="id";S_ATT_FILL="fill";S_ATT_STROKE="stroke";S_ATT_STROKEWIDTH="stroke-width",S_ATT_RENDERING="shape-rendering",SVG_ANCHOR={left:"start",center:"middle",right:"end"},S_NONE="none",S_HEIGHT={top:-0.7,hanging:-0.66,middle:-0.35,alphabetic:0,bottom:0.1},SL_WIDTH={left:0,center:0.5,right:1},SL_HEIGHT={top:0.2,hanging:0.2,middle:0.5,alphabetic:0.7,bottom:0.8},EL_ID_HEADER="canvas_o_",ME=null,EMPTY="";function S(){ME=m.createElement("div");ME.style.display="inline";ME.style.position="absolute";ME.style.left="-9000px";ME.innerHTML="";m.body.appendChild(ME);F.ME=ME}var j=function(T,i){this.fillStyle="black";this.strokeStyle="black";this.lineWidth=1;this.font="14px system";this.textAlign="center";this.textBaseline="middle";this.canvas=null;this.OFFSETX=0;this.OFFSETY=0;this.vid="";this.elements=[];this.lastElement=null;this.type=T;this.target=null;this.child=null;this.idname=i;this.canvasid=EL_ID_HEADER+i;this.currentpath=[];this.lastpath="";this.currentLayerId="_empty";this.isedgearray={_empty:false};this.isedge=false;this.content=null;this.use=new v();if(this.type===H||this.type===f){this.PATH_MOVE=n;this.PATH_LINE=d;this.PATH_CLOSE=o;if(this.type===H){this.use.svg=true}if(this.type===f){this.use.sl=true}}else{if(this.type===h){this.PATH_MOVE=V_PATH_MOVE;this.PATH_LINE=V_PATH_LINE;this.PATH_CLOSE=V_PATH_CLOSE;this.use.vml=true}}this.initElement(i)};j.prototype={initElement:function(T){var V=null;if(this.type!==f){V=m.getElementById(this.canvasid)}else{if(!!this.content){V=this.content.findName(this.canvasid)}}if(!V){var i=m.getElementById(T);var U=z(i);if(this.type===H){this.appendSVG(i,U.width,U.height)}else{if(this.type===f){this.appendSL(i,U.width,U.height)}else{if(this.type===h){this.appendVML(i,U.width,U.height)}}}if(this.type!==f){this.afterInit()}}else{this.target=V}},afterInit:function(){var T=m.getElementById(this.idname);var U=z(T);var V=this.child;var i=this;T.style.display="block";T.style.position="relative";T.style.overflow="hidden";if(x.debugmode){T.style.backgroundColor="#efefef";T.style.border="solid 1px silver"}T.getContext=function(W){return i};T.toDataURL=function(W){return null};this.canvas=T;this.target=this.child;this.rect(0,0,U.width,U.height);this.addVectorElement(false,false);N--},appendSVG:function(U,T,i){var V=m.createElementNS(a,"svg");V.setAttribute("id",this.canvasid);V.setAttribute("font-size","10px");V.setAttribute("font-family","sans-serif");V.setAttribute("width",T);V.setAttribute("height",i);V.setAttribute("viewBox",[0,0,T,i].join(" "));U.appendChild(V);this.child=V},appendVML:function(V,U,i){var T=m.createElement("div");T.id=this.canvasid;T.style.position="absolute";T.style.left="-2px";T.style.top="-2px";T.style.width=U+"px";T.style.height=i+"px";V.appendChild(T);this.child=T},appendSL:function(W,V,T){var U=this,i="_function_"+this.canvasid+"_onload";M[i]=function(Y,X,Z){U.content=document.getElementById([U.canvasid,"object"].join("_")).content;U.child=U.content.findName(U.canvasid);U.afterInit.call(U)};W.innerHTML=['<object type="application/x-silverlight" width="100%" height="100%" id="',this.canvasid,'_object" />','<param name="windowless" value="true" />','<param name="background" value="#00000000" />','<param name="source" value="#',this.canvasid,'_script" />','<param name="onLoad" value="',i,'" />',"</object>",'<script type="text/xaml" id="',this.canvasid,'_script">','<Canvas xmlns="http://schemas.microsoft.com/client/2007" Name="',this.canvasid,'" />',"<\/script>"].join("")},setLayer:function(U){this.initElement(this.idname);if(!!U){var T=[this.canvasid,"layer",U].join("_");var i=(this.type!==f?m.getElementById(T):this.content.findName(T));if(!i){if(this.type===H){i=m.createElementNS(a,"g");i.setAttribute("id",T);this.target.appendChild(i)}else{if(this.type===f){i=this.content.createFromXaml(['<Canvas Name="',T,'"/>'].join(""));this.target.children.add(i)}else{i=m.createElement("div");i.id=T;i.unselectable=(!!V_EL_UNSELECTABLE?"on":"");i.style.position="absolute";i.style.left="0px";i.style.top="0px";this.target.appendChild(i)}}}this.target=i}this.currentLayerId=(!!U?U:"_empty");if(this.type!==H){if(this.isedgearray[this.currentLayerId]===void 0){this.isedgearray[this.currentLayerId]=false}this.isedge=this.isedgearray[this.currentLayerId]}},setRendering:function(i){if(this.type===H){this.target.setAttribute(S_ATT_RENDERING,i)}else{this.isedgearray[this.currentLayerId]=(i==="crispEdges");this.isedge=this.isedgearray[this.currentLayerId]}},setUnselectable:function(i){if(i===(void 0)){i=true}else{i=!!i}if(this.type===h){V_EL_UNSELECTABLE=(i?' unselectable="on"':"");this.canvas.unselectable=(i?"on":"");this.child.unselectable=(i?"on":"")}else{if(this.type===f){this.canvas.unselectable=(i?"on":"")}else{if(this.type===H){this.canvas.style.MozUserSelect=(i?"none":"text");this.canvas.style.WebkitUserSelect=(i?"none":"text");this.canvas.style.userSelect=(i?"none":"text")}}}},getContextElement:function(){return this.child},getLayerElement:function(){return this.target},changeSize:function(T,i){this.canvas.style.width=T+"px";this.canvas.style.height=i+"px";var U=this.canvas.firstChild;if(this.type===H){U.setAttribute("width",T);U.setAttribute("height",i);U.setAttribute("viewBox",[0,0,T,i].join(" "))}else{if(this.type==f){U.height=(i+1)+"px";U.width=T+"px";U.height=i+"px"}else{if(this.type==h){U.style.width=T+"px";U.style.height=i+"px"}}}},changeOrigin:function(U,T){var V=this.canvas.firstChild;if(this.type===H){var i=V.getAttribute("viewBox").split(/ /);i[0]=U,i[1]=T;V.setAttribute("viewBox",i.join(" "))}else{if(this.type===h){V.style.position="absolute";V.style.left=(-U-2)+"px";V.style.top=(-T-2)+"px"}else{if(this.type===f){this.OFFSETX=-U;this.OFFSETY=-T}}}},clear:function(){if(this.type!==f){m.getElementById(this.idname).innerHTML=""}this.vid="";this.elements=[];this.lastElement=null;this.initElement(this.idname);if(this.type===f){this.target.children.clear()}},beginPath:function(){this.currentpath=[];this.lastpath=""},closePath:function(){this.currentpath.push(this.PATH_CLOSE);this.lastpath=this.PATH_CLOSE},moveTo:function(i,T){if(this.type===h){i=(i*b-e)|0;T=(T*b-e)|0}else{if(this.type===f){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);T=(this.isedge?t(T+this.OFFSETY):T+this.OFFSETY)}}this.currentpath.push(this.PATH_MOVE,i,T);this.lastpath=this.PATH_MOVE},lineTo:function(i,T){if(this.lastpath!==this.PATH_LINE){this.currentpath.push(this.PATH_LINE)}if(this.type===h){i=(i*b-e)|0;T=(T*b-e)|0}else{if(this.type===f){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);T=(this.isedge?t(T+this.OFFSETY):T+this.OFFSETY)}}this.currentpath.push(i,T);this.lastpath=this.PATH_LINE},rect:function(i,V,T,U){if(this.type===h){i=(i*b-e)|0;V=(V*b-e)|0,T=(T*b)|0,U=(U*b)|0}else{if(this.type===f){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);V=(this.isedge?t(V+this.OFFSETY):V+this.OFFSETY);T=(this.isedge?t(T):T);U=(this.isedge?t(U):U)}}this.currentpath.push(this.PATH_MOVE,i,V,this.PATH_LINE,(i+T),V,(i+T),(V+U),i,(V+U),this.PATH_CLOSE)},arc:function(W,V,i,Y,T,ad){if(this.type===f){W=(this.isedge?t(W+this.OFFSETX):W+this.OFFSETX);V=(this.isedge?t(V+this.OFFSETY):V+this.OFFSETY)}var ac=W+i*y(Y),ab=V+i*q(Y),aa=W+i*y(T),Z=V+i*q(T);if(this.type===h){W=(W*b-e)|0,V=(V*b-e)|0,i=(i*b)|0;ac=(ac*b-e)|0,ab=(ab*b-e)|0,aa=(aa*b-e)|0,Z=(Z*b-e)|0;var U=(ad?"at":"wa");if(T-Y>=w){ac+=1}this.currentpath.push(U,(W-i),(V-i),(W+i),(V+i),ac,ab,aa,Z);this.lastpath=U}else{if(T-Y>=w){ab+=0.125}var ae=(Y>T)^(Math.abs(T-Y)>Math.PI);var X=((ad^ae)?1:0),af=((X==0^ae)?1:0);this.currentpath.push(this.PATH_MOVE,ac,ab,l,i,i,0,X,af,aa,Z);this.lastpath=l}},fill:function(){this.addVectorElement(true,false)},stroke:function(){this.addVectorElement(false,true)},fillRect:function(T,W,U,V){var i=this.currentpath;this.currentpath=[];this.rect(T,W,U,V);this.addVectorElement(true,false);this.currentpath=i},strokeRect:function(T,W,U,V){var i=this.currentpath;this.currentpath=[];this.rect(T,W,U,V);this.addVectorElement(false,true);this.currentpath=i},shapeRect:function(T,W,U,V){var i=this.currentpath;this.currentpath=[];this.rect(T,W,U,V);this.addVectorElement(true,true);this.currentpath=i},fillText:function(ab,aa,Y){switch(this.type){case H:ME.style.font=this.font;ME.innerHTML=ab;var Z=Y-(ME.offsetHeight*S_HEIGHT[this.textBaseline.toLowerCase()]);var T=m.createElementNS(a,"text");T.setAttribute("x",aa);T.setAttribute("y",Z);T.setAttribute(S_ATT_FILL,B(this.fillStyle));T.setAttribute("text-anchor",SVG_ANCHOR[this.textAlign.toLowerCase()]);T.style.font=this.font;T.appendChild(m.createTextNode(ab));this.target.appendChild(T);this.lastElement=T;break;case f:ME.style.font=this.font;var X=ME.style.fontFamily.replace(/\"/g,"'");var ac=parseInt(ME.style.fontSize);var ad=parseInt(this.canvas.offsetWidth);var U=aa+this.OFFSETX-ad*SL_WIDTH[this.textAlign.toLowerCase()];var V=['<TextBlock Canvas.Left="',U,'" Canvas.Top="',(Y+this.OFFSETY),'" Width="',ad,'" TextAlignment="',this.textAlign,'" FontFamily="',X,'" FontSize="',ac,'" Foreground="',B(this.fillStyle),'" Text="',ab,'" />'];var i=this.content.createFromXaml(V.join(""));this.lastElement=this.elements[this.vid]=i;var W=i.ActualHeight*SL_HEIGHT[this.textBaseline.toLowerCase()];i["Canvas.Top"]=Y+this.OFFSETY-(!isNaN(W)?W:0);this.target.children.add(i);break;case h:aa=(aa*b-e)|0,Y=(Y*b-e)|0;ME.style.font=this.font;ME.innerHTML=ab;var Z=Y-((ME.offsetHeight*V_HEIGHT[this.textBaseline.toLowerCase()])*b-e)|0;var ad=(ME.offsetWidth*b-e)|0;var U=aa-(ad*SL_WIDTH[this.textAlign.toLowerCase()])|0;var V=[Q,V_ATT_COORDSIZE,V_TAGEND,c,V_ATT_POINTS,[U,Z,U+ad,Z].join(","),V_ATT_END,V_DEF_ATT_POLYLINE,V_ATT_FILLCOLOR,B(this.fillStyle),V_ATT_END,V_TAGEND,C,D,V_DEF_ATT_TEXTPATH,V_ATT_STRING,ab,V_ATT_END,V_ATT_STYLE,V_STYLE_FONT,this.font,V_STYLE_END,V_STYLE_ALIGN,this.textAlign,V_STYLE_END,V_ATT_END,V_TAGEND_NULL,V_CLOSETAG_POLYLINE,V_CLOSETAG_GROUP];this.target.insertAdjacentHTML(p,V.join(""));this.lastElement=this.target.lastChild.lastChild;break}if(!!this.vid){this.elements[this.vid]=this.lastElement}},shape:function(){this.addVectorElement(true,true)},setLinePath:function(){var X=arguments,W=X.length,Y=(this.type!==h);this.currentpath=[];for(var Z=0,U=W-((W|1)?1:2);Z<U;Z+=2){if(Z==0){this.currentpath.push(this.PATH_MOVE)}else{if(Z==2){this.currentpath.push(this.PATH_LINE)}}var V=X[Z],T=X[Z+1];if(this.type===h){V=(V*b-e)|0,T=(T*b-e)|0}else{if(this.type===f){V=(this.isedge?t(V+this.OFFSETX):V+this.OFFSETX);T=(this.isedge?t(T+this.OFFSETY):T+this.OFFSETY)}}this.currentpath.push(V,T)}if(X[W-1]){this.currentpath.push(this.PATH_CLOSE)}},setOffsetLinePath:function(){var W=arguments,V=W.length,X=(this.type!==h),U=[W[0],W[1]];this.currentpath=[];for(var Y=2,T=V-((V|1)?1:2);Y<T;Y+=2){U[Y]=W[Y]+U[0];U[Y+1]=W[Y+1]+U[1];if(this.type===h){U[Y]=(U[Y]*b-e)|0,U[Y+1]=(U[Y+1]*b-e)|0}else{if(this.type===f){U[Y]=(this.isedge?t(U[Y]+this.OFFSETX):U[Y]+this.OFFSETX);U[Y+1]=(this.isedge?t(U[Y+1]+this.OFFSETY):U[Y+1]+this.OFFSETY)}}}for(var Y=2,T=V-((V|1)?1:2);Y<T;Y+=2){if(Y==2){this.currentpath.push(this.PATH_MOVE)}else{if(Y==4){this.currentpath.push(this.PATH_LINE)}}this.currentpath.push(U[Y],U[Y+1])}if(W[V-1]){this.currentpath.push(this.PATH_CLOSE)}},setDashSize:function(i){if(!this.lastElement){return}if(this.type===H){this.lastElement.setAttribute("stroke-dasharray",i)}else{if(this.type===f){this.lastElement.StrokeDashArray=""+i}else{if(this.type===h){var T=m.createElement("v:stroke");if(i<=2){T.dashstyle="ShortDash"}else{if(i<=5){T.dashstyle="Dash"}else{T.dashstyle="LongDash"}}this.lastElement.appendChild(T)}}}},strokeLine:function(U,W,T,V){if(this.type===h){U=(U*b)|0,W=(W*b)|0,T=(T*b)|0,V=(V*b)|0}else{if(this.type===f){U=(this.isedge?t(U+this.OFFSETX):U+this.OFFSETX);W=(this.isedge?t(W+this.OFFSETY):W+this.OFFSETY);T=(this.isedge?t(T+this.OFFSETX):T+this.OFFSETX);V=(this.isedge?t(V+this.OFFSETY):V+this.OFFSETY)}}var i=this.currentpath;this.currentpath=[this.PATH_MOVE,U,W,this.PATH_LINE,T,V];this.addVectorElement(false,true);this.currentpath=i},strokeCross:function(T,V,U){if(this.type===h){T=(T*b-e)|0,V=(V*b-e)|0,U=(U*b)|0}else{if(this.type===f){T=(this.isedge?t(T+this.OFFSETX):T+this.OFFSETX);V=(this.isedge?t(V+this.OFFSETY):V+this.OFFSETY);U=(this.isedge?t(U):U)}}var i=this.currentpath;this.currentpath=[this.PATH_MOVE,(T-U),(V-U),this.PATH_LINE,(T+U),(V+U),this.PATH_MOVE,(T-U),(V+U),this.PATH_LINE,(T+U),(V-U)];this.addVectorElement(false,true);this.currentpath=i},fillCircle:function(T,V,U){var i=this.currentpath;this.currentpath=[];this.arc(T,V,U,0,w,false);this.currentpath.push(this.PATH_CLOSE);this.addVectorElement(true,false);this.currentpath=i},strokeCircle:function(T,V,U){var i=this.currentpath;this.currentpath=[];this.arc(T,V,U,0,w,false);this.currentpath.push(this.PATH_CLOSE);this.addVectorElement(false,true);this.currentpath=i},shapeCircle:function(T,V,U){var i=this.currentpath;this.currentpath=[];this.arc(T,V,U,0,w,false);this.currentpath.push(this.PATH_CLOSE);this.addVectorElement(true,true);this.currentpath=i},addVectorElement:function(i,W){var V=this.currentpath.join(" ");switch(this.type){case H:var U=m.createElementNS(a,"path");U.setAttribute("d",V);U.setAttribute(S_ATT_FILL,(i?B(this.fillStyle):S_NONE));U.setAttribute(S_ATT_STROKE,(W?B(this.strokeStyle):S_NONE));if(W){U.setAttribute(S_ATT_STROKEWIDTH,this.lineWidth,"px")}this.target.appendChild(U);this.lastElement=U;break;case f:var T=['<Path Data="',V,'"'];if(i){T.push(' Fill="',B(this.fillStyle),'"')}if(W){T.push(' Stroke="',B(this.strokeStyle),'" StrokeThickness="',this.lineWidth,'"')}T.push(" />");var X=this.content.createFromXaml(T.join(""));this.lastElement=X;this.target.children.add(X);break;case h:V=[V,(!i?V_PATH_NOFILL:EMPTY),(!W?V_PATH_NOSTROKE:EMPTY)].join("");var T=[P,V_EL_UNSELECTABLE,V_ATT_COORDSIZE,V_ATT_PATH,V,V_ATT_END];if(i){T.push(V_ATT_FILLCOLOR,B(this.fillStyle),V_ATT_END)}if(W){T.push(V_ATT_STROKECOLOR,B(this.strokeStyle),V_ATT_END,V_ATT_STROKEWEIGHT,this.lineWidth,"px",V_ATT_END)}T.push(V_TAGEND_NULL);this.target.insertAdjacentHTML(p,T.join(""));this.lastElement=this.target.lastChild;break}if(!!this.vid){this.elements[this.vid]=this.lastElement}}};CanvasRenderingContext2D_wrapper=function(T,i){this.fillStyle="black";this.strokeStyle="black";this.lineWidth=1;this.font="14px system";this.textAlign="center";this.textBaseline="middle";this.canvas=null;this.OFFSETX=0;this.OFFSETY=0;this.canvasid="";this.child=null;this.context=null;this.currentLayerId="_empty";this.isedgearray={_empty:false};this.isedge=false;this.use=new v();this.use.vml=(T===h);this.use.svg=false;this.use.canvas=(T===L);this.use.sl=(T===f);this.use.flash=(T===J);this.initElement(i)};CanvasRenderingContext2D_wrapper.prototype={initElement:function(V){this.canvasid=EL_ID_HEADER+V;var U=m.getElementById(V);var T=m.getElementById(this.canvasid);if(!T){T=m.createElement("canvas");T.id=this.canvasid;U.appendChild(T)}var W=z(U);T.width=W.width;T.height=W.height;T.style.position="relative";T.style.width=W.width+"px";T.style.height=W.height+"px";this.child=T;var i=this;U.style.display="block";U.style.position="relative";U.style.overflow="hidden";if(x.debugmode){U.style.backgroundColor="#efefef";U.style.border="solid 1px silver"}U.getContext=function(X){i.context=T.getContext(X);return i};U.toDataURL=function(X){return(!!X?T.toDataURL(X):T.toDataURL())};this.canvas=U;N--},setLayer:function(i){this.currentLayerId=(!!i?i:"_empty");if(this.isedgearray[this.currentLayerId]===void 0){this.isedgearray[this.currentLayerId]=false}this.isedge=this.isedgearray[this.currentLayerId]},setRendering:function(i){this.isedgearray[this.currentLayerId]=(i==="crispEdges");this.isedge=this.isedgearray[this.currentLayerId]},setUnselectable:function(i){if(i===(void 0)){i=true}else{i=!!i}this.canvas.style.MozUserSelect=(i?"none":"text");this.canvas.style.WebkitUserSelect=(i?"none":"text");this.canvas.style.userSelect=(i?"none":"text")},getContextElement:function(){return this.child},getLayerElement:function(){return this.child},changeSize:function(U,i){this.canvas.style.width=U+"px";this.canvas.style.height=i+"px";var T=this.canvas.firstChild;var W=parseInt(T.style.left),V=parseInt(T.style.top);U+=(W<0?-W:0);i+=(V<0?-V:0);T.style.width=U+"px";T.style.height=i+"px";T.width=U;T.height=i},changeOrigin:function(T,i){this.OFFSETX=-T;this.OFFSETY=-i},clear:function(){if(!!this.canvas.style.backgroundColor){this.setProperties();this.context.fillStyle=u(this.canvas.style.backgroundColor);var i=z(this.canvas);this.context.fillRect(this.OFFSETX,this.OFFSETY,i.width,i.height)}},setProperties:function(){this.context.fillStyle=this.fillStyle;this.context.strokeStyle=this.strokeStyle;this.context.lineWidth=this.lineWidth;this.context.font=this.font;this.context.textAlign=this.textAlign;this.context.textBaseline=this.textBaseline},beginPath:function(){this.context.beginPath()},closePath:function(){this.context.closePath()},moveTo:function(i,T){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);T=(this.isedge?t(T+this.OFFSETY):T+this.OFFSETY);this.context.moveTo(i,T)},lineTo:function(i,T){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);T=(this.isedge?t(T+this.OFFSETY):T+this.OFFSETY);this.context.lineTo(i,T)},rect:function(i,V,T,U){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);V=(this.isedge?t(V+this.OFFSETY):V+this.OFFSETY);T=(this.isedge?t(T):T);U=(this.isedge?t(U):U);this.context.rect(i,V,T,U)},arc:function(i,X,W,V,U,T){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);X=(this.isedge?t(X+this.OFFSETY):X+this.OFFSETY);this.context.arc(px,py,W,V,U,T)},fill:function(){this.setProperties();this.context.fill()},stroke:function(){this.setProperties();this.context.stroke()},fillRect:function(i,V,T,U){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);V=(this.isedge?t(V+this.OFFSETY):V+this.OFFSETY);T=(this.isedge?t(T):T);U=(this.isedge?t(U):U);this.setProperties();this.context.fillRect(i,V,T,U)},strokeRect:function(i,V,T,U){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);V=(this.isedge?t(V+this.OFFSETY):V+this.OFFSETY);T=(this.isedge?t(T):T);U=(this.isedge?t(U):U);this.setProperties();this.context.strokeRect(i,V,T,U)},fillText:function(T,i,U){this.setProperties();this.context.fillText(T,i+this.OFFSETX,U+this.OFFSETY)},shape:function(){this.setProperties();this.context.fill();this.context.stroke()},shapeRect:function(i,V,T,U){i=(this.isedge?t(i):i);V=(this.isedge?t(V):V);T=(this.isedge?t(T):T);U=(this.isedge?t(U):U);this.setProperties();this.context.fillRect(i,V,T,U);this.context.strokeRect(i,V,T,U)},setLinePath:function(){var W=arguments,V=W.length;for(var X=0,T=V-((V|1)?1:2);X<T;X+=2){var U=(this.isedge?t(W[X]+this.OFFSETX):W[X]+this.OFFSETX);a2=(this.isedge?t(W[X+1]+this.OFFSETY):W[X+1]+this.OFFSETY);if(X==0){this.context.moveTo(U,a2)}else{this.context.lineTo(U,a2)}}if(W[V-1]){this.context.closePath()}},setOffsetLinePath:function(){var X=arguments,W=X.length,U=[X[0]+this.OFFSETX,X[1]+this.OFFSETY];for(var Y=2,T=W-((W|1)?1:2);Y<T;Y+=2){U[Y]=X[Y]+U[0];U[Y+1]=X[Y+1]+U[1]}for(var Y=2,T=W-((W|1)?1:2);Y<T;Y+=2){var V=(this.isedge?t(U[Y]):U[Y]);a2=(this.isedge?t(U[Y+1]):U[Y+1]);if(Y===2){this.context.moveTo(V,a2)}else{this.context.lineTo(V,a2)}}if(X[W-1]){this.context.closePath()}},setDashSize:function(i){},strokeLine:function(T,V,i,U){T=(this.isedge?t(T+this.OFFSETX):T+this.OFFSETX);V=(this.isedge?t(V+this.OFFSETY):V+this.OFFSETY);i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);U=(this.isedge?t(U+this.OFFSETY):U+this.OFFSETY);this.setProperties();this.context.beginPath();this.context.moveTo(T,V);this.context.lineTo(i,U);this.context.stroke()},strokeCross:function(i,Y,T){var V=(this.isedge?t(i-T+this.OFFSETX):i-T+this.OFFSETX),X=(this.isedge?t(Y-T+this.OFFSETY):Y-T+this.OFFSETY),U=(this.isedge?t(i+T+this.OFFSETX):i+T+this.OFFSETX),W=(this.isedge?t(Y+T+this.OFFSETY):Y+T+this.OFFSETY);this.setProperties();this.context.beginPath();this.context.moveTo(V,X);this.context.lineTo(U,W);this.context.moveTo(V,W);this.context.lineTo(U,X);this.context.stroke()},fillCircle:function(i,U,T){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);U=(this.isedge?t(U+this.OFFSETY):U+this.OFFSETY);this.setProperties();this.context.beginPath();this.context.arc(i,U,T,0,w,false);this.context.fill()},strokeCircle:function(i,U,T){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);U=(this.isedge?t(U+this.OFFSETY):U+this.OFFSETY);this.setProperties();this.context.beginPath();this.context.arc(i,U,T,0,w,false);this.context.stroke()},shapeCircle:function(i,U,T){i=(this.isedge?t(i+this.OFFSETX):i+this.OFFSETX);U=(this.isedge?t(U+this.OFFSETY):U+this.OFFSETY);this.setProperties();this.context.beginPath();this.context.arc(i,U,T,0,w,false);this.context.fill();this.context.stroke()}};var F=function(T,i){F.initElementById.apply(F,[T,i])};E(F,{color:I,parse:B,ME:null,enable:new v(),current:new v(),initAllElements:function(){var U=m.getElementsByTagName("camp");for(var T=0;T<U.length;T++){this.initElementById(U[T].id,type)}},initElementsById:function(V,U){for(var T=0;T<V.length;T++){this.initElementById(V[T],U)}},initElementById:function(U,T){if(!!m.getElementById(EL_ID_HEADER+U)){return}if(!ME){S()}var i=new v();if((T===void 0)||(this.enable[T]!==true)){i=this.current}else{i[T]=true}N++;if(i.svg){new j(H,U)}else{if(i.sl){new j(f,U)}else{if(i.vml){new j(h,U)}else{if(i.canvas){new CanvasRenderingContext2D_wrapper(L,U)}}}}},select:function(U){if(this.enable[U]!==true){return false}for(var T=0;T<O.length;T++){this.current[O[T]]=false}this.current[U]=true;return true},setflags:function(i,T){x[i]=T},isready:function(){return(N===0)}});F.enable.canvas=(!!m.createElement("canvas").getContext);F.enable.svg=(!!m.createElementNS&&!!m.createElementNS(a,"svg").suspendRedraw);F.enable.sl=(function(){try{return(new ActiveXObject("AgControl.AgControl")).IsVersionSupported("1.0")}catch(i){}return false})();F.enable.flash=false;F.enable.vml=A;for(var R=0;R<O.length;R++){F.current[O[R]]=false}if(F.enable.svg){F.current.svg=true}else{if(F.enable.canvas){F.current.canvas=true}else{if(F.enable.sl){F.current.sl=true}else{if(F.enable.flash){F.current.flash=true}else{if(F.enable.vml){F.current.vml=true}}}}}if(F.enable.vml){m.namespaces.add("v","urn:schemas-microsoft-com:vml");var G=[];G.push("v\\:shape, v\\:group, v\\:polyline { behavior: url(#default#VML); position:absolute; width:10px; height:10px; }");G.push("v\\:path, v\\:textpath, v\\:stroke { behavior: url(#default#VML); }");m.write('<style type="text/css" rel="stylesheet">');m.write(G.join(""));m.write("</style>")}var G=[];G.push("camp { display: block; }\n");m.write('<style type="text/css" rel="stylesheet">');m.write(G.join(""));m.write("</style>");if(A){m.createElement("camp")}M.Camp=F})();Pos=function(a,b){this.x=a;this.y=b};Pos.prototype={set:function(a,b){this.x=a;this.y=b},clone:function(){return new Pos(this.x,this.y)}};var k={qcols:0,qrows:0,irowake:0,iscross:0,isborder:0,isexcell:0,isLineCross:false,isCenterLine:false,isborderAsLine:false,hasroom:false,roomNumber:false,dispzero:false,isDispHatena:true,isAnsNumber:false,NumberWithMB:false,linkNumber:false,BlackCell:false,NumberIsWhite:false,RBBlackCell:false,checkBlackCell:false,checkWhiteCell:false,ispzprv3ONLY:false,isKanpenExist:false,bdmargin:0.7,bdmargin_image:0.1,puzzleid:"",EDITOR:true,PLAYER:false,editmode:true,playmode:false,cellsize:36,cwidth:36,cheight:36,bwidth:18,bheight:18,p0:new Pos(0,0),cv_oft:new Pos(0,0),br:{IE:(!!(window.attachEvent&&!window.opera)),Opera:(!!window.opera),WebKit:(navigator.userAgent.indexOf("AppleWebKit/")>-1),Gecko:(navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1),WinWebKit:(navigator.userAgent.indexOf("AppleWebKit/")>-1&&navigator.userAgent.indexOf("Win")>-1),IEmoz4:(!!(window.attachEvent&&!window.opera)&&navigator.userAgent.indexOf("Mozilla/4.0")>-1)},vml:Camp.current.vml,BOARD:"board",CELL:"cell",CROSS:"cross",BORDER:"border",EXCELL:"excell",QUES:"ques",QNUM:"qnum",DIREC:"direc",QANS:"qans",LINE:"line",QSUB:"qsub",UP:1,DN:2,LT:3,RT:4,KEYUP:"up",KEYDN:"down",KEYLT:"left",KEYRT:"right",scriptcheck:false};var g;var Puzzles=[];var _doc=document;if(typeof localStorage!="object"&&typeof globalStorage=="object"){localStorage=globalStorage[location.host]}var mf=Math.floor;function f_true(){return true}(function(){var h=document,f=this,c=k.br.IE,e=_ElementManager=f.ee=function(j){if(typeof j==="string"){if(!a[j]){var i=h.getElementById(j);if(!i){return null}a[j]=new _ELx(i)}return a[j]}var i=j;if(!!i.id){if(!a[i.id]){a[i.id]=new _ELx(i)}return a[i.id]}return((!!i)?new _ELx(i):null)},a=_ElementManager._cache={},d=_ElementManager._template=[],b=_ElementManager._tempcnt=0;_ELx=_ElementManager.ElementExt=function(i){this.el=i;this.parent=i.parentNode;this.pdisp="none"},_ELp=_ElementManager.ElementTemplate=function(m,j,i,l,n){this.parent=m;this.tagName=j;this.attr=i;this.style=l;this.func=n},_extend=function(l,j){for(var i in j){l[i]=j[i]}},_toArray=function(l){if(!l){return[]}var n=[];for(var m=0,j=l.length;m<j;m++){n[m]=l[m]}return n};_extend(_ElementManager,{clean:function(){a=null;a={};b=0;d=null;d=[]},addTemplate:function(q,r,n,p,m){if(!r){return}if(!q){q=null}else{if(typeof q=="string"){q=ee(q).el}}var o={};var j=(p||{});var l=(m||{});if(!!n){for(var i in n){if(i==="unselectable"&&n[i]==="on"){j.userSelect=j.MozUserSelect=j.KhtmlUserSelect="none";o.unselectable="on"}else{o[i]=n[i]}}}d[b++]=new _ELp(q,r,o,j,m);return(b-1)},createEL:function(m,n){if(!d[m]){return null}var i=d[m];var l=h.createElement(i.tagName);if(!!n){l.id=n}for(var j in i.attr){l[j]=i.attr[j]}for(var j in i.style){l.style[j]=i.style[j]}for(var j in i.func){l["on"+j]=i.func[j]}if(!!i.parent){i.parent.appendChild(l)}return l},getSrcElement:function(i){return i.target||i.srcElement},pageX:(((!c)?function(i){return i.pageX}:function(i){return i.clientX+(h.documentElement.scrollLeft||h.body.scrollLeft)})),pageY:(((!c)?function(i){return i.pageY}:function(i){return i.clientY+(h.documentElement.scrollTop||h.body.scrollTop)})),windowWidth:(((h.all)?function(){return h.body.clientWidth}:(h.layers||h.getElementById)?function(){return innerWidth}:function(){return 0})),windowHeight:(((h.all)?function(){return h.body.clientHeight}:(h.layers||h.getElementById)?function(){return innerHeight}:function(){return 0})),binder:function(){var j=_toArray(arguments);var l=j.shift(),i=j.shift();return function(){return i.apply(l,(j.length>0?j[0]:[]).concat(_toArray(arguments)))}},ebinder:function(){var j=_toArray(arguments);var m=j.shift(),i=j.shift(),l=(j.length>0?j[0]:[]);return function(n){return i.apply(m,[n||f.event].concat(j.length>0?j[0]:[]).concat(_toArray(arguments)))}},stopPropagation:function(i){if(!!i.stopPropagation){i.stopPropagation()}else{i.cancelBubble=true}},preventDefault:function(i){if(!!i.preventDefault){i.preventDefault()}else{i.returnValue=true}}});_ElementManager.ElementExt.prototype={getRect:(((!!document.createElement("div").getBoundingClientRect)?((!c)?function(){var j=h.documentElement,p=h.body,m=this.el.getBoundingClientRect();var o=m.left+f.scrollX;var n=m.top+f.scrollY;var l=m.right+f.scrollX;var i=m.bottom+f.scrollY;return{top:n,bottom:i,left:o,right:l}}:function(){var j=h.documentElement,p=h.body,m=this.el.getBoundingClientRect();var o=m.left+((p.scrollLeft||j.scrollLeft)-j.clientLeft);var n=m.top+((p.scrollTop||j.scrollTop)-j.clientTop);var l=m.right+((p.scrollLeft||j.scrollLeft)-j.clientLeft);var i=m.bottom+((p.scrollTop||j.scrollTop)-j.clientTop);return{top:n,bottom:i,left:o,right:l}}):function(){var n=0,m=0,l=this.el;while(!!l){n+=+(!isNaN(l.offsetLeft)?l.offsetLeft:l.clientLeft);m+=+(!isNaN(l.offsetTop)?l.offsetTop:l.clientTop);l=l.offsetParent}var j=n+(this.el.offsetWidth||this.el.clientWidth);var i=m+(this.el.offsetHeight||this.el.clientHeight);return{top:m,bottom:i,left:n,right:j}})),getWidth:function(){return this.el.offsetWidth||this.el.clientWidth},getHeight:function(){return this.el.offsetHeight||this.el.clientHeight},unselectable:function(){this.el.style.MozUserSelect="none";this.el.style.KhtmlUserSelect="none";this.el.style.userSelect="none";this.el.unselectable="on";return this},replaceChildrenClass:function(j,l){var i=this.el.firstChild;while(!!i){if(i.className===j){i.className=l}i=i.nextSibling}},remove:function(){this.parent.removeChild(this.el);return this},removeNextAll:function(i){var j=this.el.lastChild;while(!!j){if(j===i){break}if(!!j){this.el.removeChild(j)}else{break}j=this.el.lastChild}return this},appendHTML:function(i){var j=h.createElement("span");j.innerHTML=i;this.el.appendChild(j);return this},appendBR:function(){this.el.appendChild(h.createElement("br"));return this},appendEL:function(i){this.el.appendChild(i);return this},appendTo:function(i){i.el.appendChild(this.el);this.parent=i.el;return this},insertBefore:function(i){this.parent=i.parentNode;this.parent.insertBefore(this.el,i);return this},insertAfter:function(i){this.parent=i.parentNode;this.parent.insertBefore(this.el,i.nextSibling);return this}}})();Timer=function(){this.TID;this.timerInterval=100;this.st=0;this.current=0;this.bseconds=0;this.timerEL=ee("timerpanel").el;this.lastAnsCnt=0;this.worstACtime=0;this.nextACtime=0;this.start();this.TIDundo=null;this.undoInterval=25;this.undoWaitTime=300;this.undoWaitCount=0;if(k.br.IE){this.timerInterval*=2;this.undoInterval*=2}};Timer.prototype={now:function(){return(new Date()).getTime()},reset:function(){this.worstACtime=0;this.timerEL.innerHTML=this.label()+"00:00";clearInterval(this.TID);this.start()},start:function(){this.st=this.now();this.TID=setInterval(ee.binder(this,this.update),this.timerInterval)},update:function(){this.current=this.now();if(k.PLAYER){this.updatetime()}if(pp.getVal("autocheck")){this.ACcheck()}},updatetime:function(){var c=mf((this.current-this.st)/1000);if(this.bseconds==c){return}var a=mf(c/3600);var b=mf(c/60)-a*60;c=c-b*60-a*3600;if(b<10){b="0"+b}if(c<10){c="0"+c}this.timerEL.innerHTML=[this.label(),(!!a?a+":":""),b,":",c].join("");this.bseconds=c},label:function(){return menu.isLangJP()?"Œo‰ßŽžŠÔF":"Time: "},ACcheck:function(){if(this.current>this.nextACtime&&this.lastAnsCnt!=um.anscount&&!ans.inCheck){this.lastAnsCnt=um.anscount;if(!ans.autocheck()){return}this.worstACtime=Math.max(this.worstACtime,(this.now()-this.current));this.nextACtime=this.current+(this.worstACtime<250?this.worstACtime*4+120:this.worstACtime*2+620)}},startUndoTimer:function(){this.undoWaitCount=this.undoWaitTime/this.undoInterval;if(!this.TIDundo){this.TIDundo=setInterval(ee.binder(this,this.procUndo),this.undoInterval)}this.execUndo()},stopUndoTimer:function(){kc.inUNDO=false;kc.inREDO=false;clearInterval(this.TIDundo);this.TIDundo=null},procUndo:function(){if(!kc.isCTRL||(!kc.inUNDO&&!kc.inREDO)){this.stopUndoTimer()}else{if(this.undoWaitCount>0){this.undoWaitCount--}else{execUndo()}}},execUndo:function(){if(kc.inUNDO){um.undo()}else{if(kc.inREDO){um.redo()}}}};Cell=function(a){this.bx;this.by;this.px;this.py;this.cpx;this.cpy;this.ques;this.qnum;this.direc;this.qans;this.qsub;this.error;this.allclear(a)};Cell.prototype={allclear:function(a){this.ques=0;this.qans=-1;this.qsub=0;this.ques=0;this.qnum=-1;this.direc=0;this.error=0;if(k.puzzleid==="tilepaint"||k.puzzleid==="kakuro"){this.qnum=this.direc=0}if(k.puzzleid==="triplace"){this.qnum=this.direc=-1}},ansclear:function(a){this.qans=-1;this.qsub=0;this.error=0},subclear:function(a){this.qsub=0;this.error=0},isempty:function(){return((this.qans===bd.defcell.qans)&&(this.qsub===bd.defcell.qsub)&&(this.ques===bd.defcell.ques)&&(this.qnum===bd.defcell.qnum)&&(this.direc===bd.defcell.direc))}};Cross=function(a){this.bx;this.by;this.px;this.py;this.ques;this.qnum;this.error;this.allclear(a)};Cross.prototype={allclear:function(a){this.ques=0;this.qnum=-1;this.error=0},ansclear:function(a){this.error=0},subclear:function(a){this.error=0},isempty:function(){return(this.qnum===bd.defcross.qnum)}};Border=function(a){this.bx;this.by;this.px;this.py;this.ques;this.qnum;this.qans;this.qsub;this.line;this.color;this.error;this.cellcc=[-1,-1];this.crosscc=[-1,-1];this.allclear(a)};Border.prototype={allclear:function(a){this.ques=0;if(k.puzzleid==="mejilink"&&a<k.qcols*(k.qrows-1)+(k.qcols-1)*k.qrows){this.ques=1}this.qnum=-1;if(k.puzzleid==="tentaisho"){this.qnum=0}this.qans=0;this.qsub=0;if(k.puzzleid==="bosanowa"){this.qsub=-1}this.line=0;this.color="";this.error=0},ansclear:function(a){this.qans=0;this.qsub=0;if(k.puzzleid==="bosanowa"){this.qsub=-1}this.line=0;this.color="";this.error=0},subclear:function(a){this.qsub=0;if(k.puzzleid==="bosanowa"){this.qsub=-1}this.error=0},isempty:function(){return((this.qans===bd.defborder.qans)&&(this.qsub===bd.defborder.qsub)&&(this.ques===bd.defborder.ques)&&(this.qnum===bd.defborder.qnum)&&(this.line===bd.defborder.line))}};EXCell=function(a){this.bx;this.by;this.px;this.py;this.qnum;this.direc;this.allclear(a)};EXCell.prototype={allclear:function(a){this.qnum=-1;if(k.puzzleid==="box"){this.qnum=0}this.direc=0;this.error=0;if(k.puzzleid==="tilepaint"||k.puzzleid==="kakuro"){this.qnum=this.direc=0}if(k.puzzleid==="triplace"){this.qnum=this.direc=-1}},ansclear:function(a){this.error=0},subclear:function(a){this.error=0},isempty:function(){return((this.qnum===bd.defexcell.qnum)&&(this.direc===bd.defexcell.direc))}};Board=function(){this.cell=[];this.cross=[];this.border=[];this.excell=[];this.cellmax=0;this.crossmax=0;this.bdmax=0;this.excellmax=0;this._cnum={};this._xnum={};this._bnum={};this._exnum={};this.bdinside=0;this.maxnum=255;this.minbx=0;this.minby=0;this.maxbx=2*k.qcols;this.maxby=2*k.qrows;this.defcell=new Cell(0);this.defcross=new Cross(0);this.defborder=new Border(0);this.defexcell=new EXCell(0);this.enableLineNG=false;this.initBoardSize(k.qcols,k.qrows);this.setFunctions()};Board.prototype={initBoardSize:function(a,b){this.initGroup(k.CELL,a,b);if(!!k.iscross){this.initGroup(k.CROSS,a,b)}if(!!k.isborder){this.initGroup(k.BORDER,a,b)}if(!!k.isexcell){this.initGroup(k.EXCELL,a,b)}this.initSpecial(a,b);k.qcols=a;k.qrows=b;this.setminmax();this.setposAll();if(!base.initProcess){this.allclear()}},initSpecial:function(){},initGroup:function(d,c,f){var e=this.getGroup(d);var b=this.estimateSize(d,c,f),a=e.length;if(a>b){for(var h=a-1;h>=b;h--){delete e[h];e.pop()}}else{if(a<b){for(var h=a;h<b;h++){e.push(this.newObject(d,h))}}}this.setposGroup(d);return(b-a)},getGroup:function(a){if(a===k.CELL){return this.cell}else{if(a===k.CROSS){return this.cross}else{if(a===k.BORDER){return this.border}else{if(a===k.EXCELL){return this.excell}}}}return[]},estimateSize:function(b,a,c){if(b===k.CELL){return a*c}else{if(b===k.CROSS){return(a+1)*(c+1)}else{if(b===k.BORDER){if(k.isborder===1){return 2*a*c-(a+c)}else{if(k.isborder===2){return 2*a*c+(a+c)}}}else{if(b===k.EXCELL){if(k.isexcell===1){return a+c+1}else{if(k.isexcell===2){return 2*a+2*c+4}}}}}}return 0},newObject:function(a,b){if(a===k.CELL){return(new Cell(b))}else{if(a===k.CROSS){return(new Cross(b))}else{if(a===k.BORDER){return(new Border(b))}else{if(a===k.EXCELL){return(new EXCell(b))}}}}},setposAll:function(){this.setposCells();if(!!k.iscross){this.setposCrosses()}if(!!k.isborder){this.setposBorders()}if(!!k.isexcell){this.setposEXcells()}this.setcacheAll();this.setcoordAll()},setposGroup:function(a){if(a===k.CELL){this.setposCells()}else{if(a===k.CROSS){this.setposCrosses()}else{if(a===k.BORDER){this.setposBorders()}else{if(a===k.EXCELL){this.setposEXcells()}}}}},setposCells:function(){this.cellmax=this.cell.length;for(var b=0;b<this.cellmax;b++){var a=this.cell[b];a.bx=(b%k.qcols)*2+1;a.by=mf(b/k.qcols)*2+1}},setposCrosses:function(){this.crossmax=this.cross.length;for(var b=0;b<this.crossmax;b++){var a=this.cross[b];a.bx=(b%(k.qcols+1))*2;a.by=mf(b/(k.qcols+1))*2}},setposBorders:function(){this.bdinside=2*k.qcols*k.qrows-(k.qcols+k.qrows);this.bdmax=this.border.length;for(var c=0;c<this.bdmax;c++){var b=this.border[c],a=c;if(a>=0&&a<(k.qcols-1)*k.qrows){b.bx=(a%(k.qcols-1))*2+2;b.by=mf(a/(k.qcols-1))*2+1}a-=((k.qcols-1)*k.qrows);if(a>=0&&a<k.qcols*(k.qrows-1)){b.bx=(a%k.qcols)*2+1;b.by=mf(a/k.qcols)*2+2}a-=(k.qcols*(k.qrows-1));if(k.isborder===2){if(a>=0&&a<k.qcols){b.bx=a*2+1;b.by=0}a-=k.qcols;if(a>=0&&a<k.qcols){b.bx=a*2+1;b.by=2*k.qrows}a-=k.qcols;if(a>=0&&a<k.qrows){b.bx=0;b.by=a*2+1}a-=k.qrows;if(a>=0&&a<k.qrows){b.bx=2*k.qcols;b.by=a*2+1}a-=k.qrows}}},setposEXcells:function(){this.excellmax=this.excell.length;for(var c=0;c<this.excellmax;c++){var b=this.excell[c],a=c;b.bx=-1;b.by=-1;if(k.isexcell===1){if(a>=0&&a<k.qcols){b.bx=a*2+1;b.by=-1;continue}a-=k.qcols;if(a>=0&&a<k.qrows){b.bx=-1;b.by=a*2+1;continue}a-=k.qrows}else{if(k.isexcell===2){if(a>=0&&a<k.qcols){b.bx=a*2+1;b.by=-1;continue}a-=k.qcols;if(a>=0&&a<k.qcols){b.bx=a*2+1;b.by=2*k.qrows+1;continue}a-=k.qcols;if(a>=0&&a<k.qrows){b.bx=-1;b.by=a*2+1;continue}a-=k.qrows;if(a>=0&&a<k.qrows){b.bx=2*k.qcols+1;b.by=a*2+1;continue}a-=k.qrows;if(a===0){b.bx=-1;b.by=-1;continue}a--;if(a===0){b.bx=2*k.qcols+1;b.by=-1;continue}a--;if(a===0){b.bx=-1;b.by=2*k.qrows+1;continue}a--;if(a===0){b.bx=2*k.qcols+1;b.by=2*k.qrows+1;continue}a--}}}},setcacheAll:function(){this._cnum={};this._xnum={};this._bnum={};this._exnum={};for(var d=0;d<this.cellmax;d++){var b=this.cell[d];this._cnum[[b.bx,b.by].join("_")]=d}for(var d=0;d<this.crossmax;d++){var b=this.cross[d];this._xnum[[b.bx,b.by].join("_")]=d}if(k.iscross===0){for(var a=0;a<=this.maxby;a+=2){for(var c=0;c<=this.maxbx;c+=2){this._xnum[[c,a].join("_")]=(c>>1)+(a>>1)*(k.qcols+1)}}}for(var d=0;d<this.bdmax;d++){var b=this.border[d];this._bnum[[b.bx,b.by].join("_")]=d;b.cellcc[0]=this.cnum(b.bx-(b.by&1),b.by-(b.bx&1));b.cellcc[1]=this.cnum(b.bx+(b.by&1),b.by+(b.bx&1));b.crosscc[0]=this.xnum(b.bx-(b.bx&1),b.by-(b.by&1));b.crosscc[1]=this.xnum(b.bx+(b.bx&1),b.by+(b.by&1))}for(var d=0;d<this.excellmax;d++){var b=this.excell[d];this._exnum[[b.bx,b.by].join("_")]=d}},setcoordAll:function(){var a=k.p0.x,b=k.p0.y;for(var d=0;d<this.cellmax;d++){var c=this.cell[d];c.px=a+(c.bx-1)*k.bwidth;c.py=b+(c.by-1)*k.bheight;c.cpx=a+c.bx*k.bwidth;c.cpy=b+c.by*k.bheight}if(!!k.iscross){for(var d=0;d<this.crossmax;d++){var c=this.cross[d];c.px=a+c.bx*k.bwidth;c.py=b+c.by*k.bheight}}if(!!k.isborder){for(var d=0;d<this.bdmax;d++){var c=this.border[d];c.px=a+c.bx*k.bwidth;c.py=b+c.by*k.bheight}}if(!!k.isexcell){for(var d=0;d<this.excellmax;d++){var c=this.excell[d];c.px=a+(c.bx-1)*k.bwidth;c.py=b+(c.by-1)*k.bheight}}},setminmax:function(){var b=(k.isexcell===1||k.isexcell===2);var a=(k.isexcell===2);this.minbx=(!b?0:-2);this.minby=(!b?0:-2);this.maxbx=(!a?2*k.qcols:2*k.qcols+2);this.maxby=(!a?2*k.qrows:2*k.qrows+2);tc.adjust()},isinside:function(b,a){return(b>=this.minbx&&b<=this.maxbx&&a>=this.minby&&a<=this.maxby)},allclear:function(){for(var a=0;a<this.cellmax;a++){this.cell[a].allclear(a)}for(var a=0;a<this.crossmax;a++){this.cross[a].allclear(a)}for(var a=0;a<this.bdmax;a++){this.border[a].allclear(a)}for(var a=0;a<this.excellmax;a++){this.excell[a].allclear(a)}},ansclear:function(){for(var a=0;a<this.cellmax;a++){this.cell[a].ansclear(a)}for(var a=0;a<this.crossmax;a++){this.cross[a].ansclear(a)}for(var a=0;a<this.bdmax;a++){this.border[a].ansclear(a)}for(var a=0;a<this.excellmax;a++){this.excell[a].ansclear(a)}},subclear:function(){for(var a=0;a<this.cellmax;a++){this.cell[a].subclear(a)}for(var a=0;a<this.crossmax;a++){this.cross[a].subclear(a)}for(var a=0;a<this.bdmax;a++){this.border[a].subclear(a)}for(var a=0;a<this.excellmax;a++){this.excell[a].subclear(a)}},errclear:function(b){if(!ans.errDisp){return}for(var a=0;a<this.cellmax;a++){this.cell[a].error=0}for(var a=0;a<this.crossmax;a++){this.cross[a].error=0}for(var a=0;a<this.bdmax;a++){this.border[a].error=0}for(var a=0;a<this.excellmax;a++){this.excell[a].error=0}ans.errDisp=false;if(b!==false){pc.paintAll()}},idnum:function(c,e,d,b,a){if(b===(void 0)){if(c===k.CELL){return this.cnum(e,d)}else{if(c===k.CROSS){return this.xnum(e,d)}else{if(c===k.BORDER){return this.bnum(e,d)}else{if(c===k.EXCELL){return this.exnum(e,d)}}}}}else{if(c===k.CELL){return this.cnum2(e,d,b,a)}else{if(c===k.CROSS){return this.xnum2(e,d,b,a)}else{if(c===k.BORDER){return this.bnum2(e,d,b,a)}else{if(c===k.EXCELL){return this.exnum2(e,d,b,a)}}}}}return -1},cnum:function(c,b){var a=[c,b].join("_");return(this._cnum[a]!==(void 0)?this._cnum[a]:-1)},xnum:function(c,b){var a=[c,b].join("_");return(this._xnum[a]!==(void 0)?this._xnum[a]:-1)},bnum:function(c,b){var a=[c,b].join("_");return(this._bnum[a]!==(void 0)?this._bnum[a]:-1)},exnum:function(c,b){var a=[c,b].join("_");return(this._exnum[a]!==(void 0)?this._exnum[a]:-1)},cnum2:function(d,c,b,a){if((d<0||d>2*b||c<0||c>2*a)||(!(d&1))||(!(c&1))){return -1}return(d>>1)+(c>>1)*b},xnum2:function(d,c,b,a){if((d<0||d>2*b||c<0||c>2*a)||(!!(d&1))||(!!(c&1))){return -1}return(d>>1)+(c>>1)*(b+1)},bnum2:function(d,c,b,a){if(d>=1&&d<=2*b-1&&c>=1&&c<=2*a-1){if(!(d&1)&&(c&1)){return((d>>1)-1)+(c>>1)*(b-1)}else{if((d&1)&&!(c&1)){return(d>>1)+((c>>1)-1)*b+(b-1)*a}}}else{if(k.isborder==2){if(c===0&&(d&1)&&(d>=1&&d<=2*b-1)){return(b-1)*a+b*(a-1)+(d>>1)}else{if(c===2*a&&(d&1)&&(d>=1&&d<=2*b-1)){return(b-1)*a+b*(a-1)+b+(d>>1)}else{if(d===0&&(c&1)&&(c>=1&&c<=2*a-1)){return(b-1)*a+b*(a-1)+2*b+(c>>1)}else{if(d===2*b&&(c&1)&&(c>=1&&c<=2*a-1)){return(b-1)*a+b*(a-1)+2*b+a+(c>>1)}}}}}}return -1},exnum2:function(d,c,b,a){if(k.isexcell===1){if(d===-1&&c===-1){return b+a}else{if(c===-1&&d>0&&d<2*b){return(d>>1)}else{if(d===-1&&c>0&&c<2*a){return b+(c>>1)}}}}else{if(k.isexcell===2){if(c===-1&&d>0&&d<2*b){return(d>>1)}else{if(c===2*a+1&&d>0&&d<2*b){return b+(d>>1)}else{if(d===-1&&c>0&&c<2*a){return 2*b+(c>>1)}else{if(d===2*b+1&&c>0&&c<2*a){return 2*b+a+(c>>1)}else{if(d===-1&&c===-1){return 2*b+2*a}else{if(d===2*b+1&&c===-1){return 2*b+2*a+1}else{if(d===-1&&c===2*a+1){return 2*b+2*a+2}else{if(d===2*b+1&&c===2*a+1){return 2*b+2*a+3}}}}}}}}}}return -1},objectinside:function(e,b,d,a,c){if(e===k.CELL){return this.cellinside(b,d,a,c)}else{if(e===k.CROSS){return this.crossinside(b,d,a,c)}else{if(e===k.BORDER){return this.borderinside(b,d,a,c)}else{if(e===k.EXCELL){return this.excellinside(b,d,a,c)}}}}return[]},cellinside:function(b,e,a,d){var f=[];for(var h=(e|1);h<=d;h+=2){for(var i=(b|1);i<=a;i+=2){var j=this._cnum[[i,h].join("_")];if(j!==(void 0)){f.push(j)}}}return f},crossinside:function(b,e,a,d){var f=[];for(var h=e+(e&1);h<=d;h+=2){for(var i=b+(b&1);i<=a;i+=2){var j=this._xnum[[i,h].join("_")];if(j!==(void 0)){f.push(j)}}}return f},borderinside:function(b,d,a,c){var h=[];for(var e=d;e<=c;e++){for(var f=b;f<=a;f++){if(f&1===e&1){continue}var i=this._bnum[[f,e].join("_")];if(i!==(void 0)){h.push(i)}}}return h},excellinside:function(d,f,b,e){var a=[];for(var h=(f|1);h<=e;h+=2){for(var i=(d|1);i<=b;i+=2){var j=this._exnum[[i,h].join("_")];if(j!==(void 0)){a.push(j)}}}return a},up:function(a){return this.cell[a]?this.cnum(this.cell[a].bx,this.cell[a].by-2):-1},dn:function(a){return this.cell[a]?this.cnum(this.cell[a].bx,this.cell[a].by+2):-1},lt:function(a){return this.cell[a]?this.cnum(this.cell[a].bx-2,this.cell[a].by):-1},rt:function(a){return this.cell[a]?this.cnum(this.cell[a].bx+2,this.cell[a].by):-1},ub:function(a){return this.cell[a]?this.bnum(this.cell[a].bx,this.cell[a].by-1):-1},db:function(a){return this.cell[a]?this.bnum(this.cell[a].bx,this.cell[a].by+1):-1},lb:function(a){return this.cell[a]?this.bnum(this.cell[a].bx-1,this.cell[a].by):-1},rb:function(a){return this.cell[a]?this.bnum(this.cell[a].bx+1,this.cell[a].by):-1},bcntCross:function(e){var a=0,d=bd.cross[e].bx,b=bd.cross[e].by;if(this.isBlack(this.cnum(d-1,b-1))){a++}if(this.isBlack(this.cnum(d+1,b-1))){a++}if(this.isBlack(this.cnum(d-1,b+1))){a++}if(this.isBlack(this.cnum(d+1,b+1))){a++}return a},isLPup:function(a){return({101:1,102:1,104:1,105:1}[this.QuC(a)]===1)},isLPdown:function(a){return({101:1,102:1,106:1,107:1}[this.QuC(a)]===1)},isLPleft:function(a){return({101:1,103:1,105:1,106:1}[this.QuC(a)]===1)},isLPright:function(a){return({101:1,103:1,104:1,107:1}[this.QuC(a)]===1)},isnoLPup:function(a){return({1:1,4:1,5:1,21:1,103:1,106:1,107:1}[this.QuC(a)]===1)},isnoLPdown:function(a){return({1:1,2:1,3:1,21:1,103:1,104:1,105:1}[this.QuC(a)]===1)},isnoLPleft:function(a){return({1:1,2:1,5:1,22:1,102:1,104:1,107:1}[this.QuC(a)]===1)},isnoLPright:function(a){return({1:1,3:1,4:1,22:1,102:1,105:1,106:1}[this.QuC(a)]===1)},isLPMarked:function(c){var b=bd.border[c].cellcc[0],a=bd.border[c].cellcc[1];return bd.border[c].bx&1?(bd.isLPdown(b)||bd.isLPup(a)):(bd.isLPright(b)||bd.isLPleft(a))},isLPCombined:function(c){var b=bd.border[c].cellcc[0],a=bd.border[c].cellcc[1];return bd.border[c].bx&1?(bd.isLPdown(b)&&bd.isLPup(a)):(bd.isLPright(b)&&bd.isLPleft(a))},isLineNG:function(c){var b=bd.border[c].cellcc[0],a=bd.border[c].cellcc[1];return bd.border[c].bx&1?(bd.isnoLPdown(b)||bd.isnoLPup(a)):(bd.isnoLPright(b)||bd.isnoLPleft(a))},checkLPCombined:function(b){var a;a=this.ub(b);if(a!==-1&&this.border[a].line===0&&this.isLPCombined(a)){this.sLiB(a,1)}a=this.db(b);if(a!==-1&&this.border[a].line===0&&this.isLPCombined(a)){this.sLiB(a,1)}a=this.lb(b);if(a!==-1&&this.border[a].line===0&&this.isLPCombined(a)){this.sLiB(a,1)}a=this.rb(b);if(a!==-1&&this.border[a].line===0&&this.isLPCombined(a)){this.sLiB(a,1)}},nummaxfunc:function(a){return this.maxnum},sQuC:function(b,a){um.addOpe(k.CELL,k.QUES,b,this.cell[b].ques,a);this.cell[b].ques=a},sQnC:function(c,b){if(!k.dispzero&&b===0){return}var a=this.cell[c].qnum;um.addOpe(k.CELL,k.QNUM,c,a,b);this.cell[c].qnum=b;if(um.isenableInfo()&&(area.numberColony&&(b!==-1^area.bcell.id[c]!==-1))){area.setCell(c,(b!==-1?1:0))}},sQaC:function(c,b){var a=this.cell[c].qans;um.addOpe(k.CELL,k.QANS,c,a,b);this.cell[c].qans=b;if(um.isenableInfo()&&((area.bblock&&(b!==-1^area.bcell.id[c]!==-1))||(area.wblock&&(b===-1^area.wcell.id[c]!==-1)))){area.setCell(c,(b!==-1?1:0))}},sQsC:function(b,a){um.addOpe(k.CELL,k.QSUB,b,this.cell[b].qsub,a);this.cell[b].qsub=a},sDiC:function(b,a){um.addOpe(k.CELL,k.DIREC,b,this.cell[b].direc,a);this.cell[b].direc=a},QuC:function(a){return(a!==-1?this.cell[a].ques:-1)},QnC:function(a){return(a!==-1?this.cell[a].qnum:-1)},QaC:function(a){return(a!==-1?this.cell[a].qans:-1)},QsC:function(a){return(a!==-1?this.cell[a].qsub:-1)},DiC:function(a){return(a!==-1?this.cell[a].direc:-1)},sQnE:function(b,a){um.addOpe(k.EXCELL,k.QNUM,b,this.excell[b].qnum,a);this.excell[b].qnum=a},sDiE:function(b,a){um.addOpe(k.EXCELL,k.DIREC,b,this.excell[b].direc,a);this.excell[b].direc=a},QnE:function(a){return(a!==-1?this.excell[a].qnum:-1)},DiE:function(a){return(a!==-1?this.excell[a].direc:-1)},sQuX:function(b,a){um.addOpe(k.CROSS,k.QUES,b,this.cross[b].ques,a);this.cross[b].ques=a},sQnX:function(b,a){um.addOpe(k.CROSS,k.QNUM,b,this.cross[b].qnum,a);this.cross[b].qnum=a},QuX:function(a){return(a!==-1?this.cross[a].ques:-1)},QnX:function(a){return(a!==-1?this.cross[a].qnum:-1)},sQuB:function(c,b){var a=this.border[c].ques;um.addOpe(k.BORDER,k.QUES,c,a,b);this.border[c].ques=b;if(um.isenableInfo()&&(b>0^a>0)){area.setBorder(c,b)}},sQnB:function(b,a){um.addOpe(k.BORDER,k.QNUM,b,this.border[b].qnum,a);this.border[b].qnum=a},sQaB:function(c,b){if(this.border[c].ques!=0){return}var a=this.border[c].qans;um.addOpe(k.BORDER,k.QANS,c,a,b);this.border[c].qans=b;if(um.isenableInfo()&&(b>0^a>0)){if(k.isborderAsLine){line.setLine(c,b)}else{area.setBorder(c,b)}}},sQsB:function(b,a){um.addOpe(k.BORDER,k.QSUB,b,this.border[b].qsub,a);this.border[b].qsub=a},sLiB:function(c,b){if(this.enableLineNG&&(b==1?bd.isLineNG:bd.isLPCombined)(c)){return}var a=this.border[c].line;um.addOpe(k.BORDER,k.LINE,c,a,b);this.border[c].line=b;if(um.isenableInfo()&&(b>0^a>0)){line.setLine(c,b)}},QuB:function(a){return(a!==-1?this.border[a].ques:-1)},QnB:function(a){return(a!==-1?this.border[a].qnum:-1)},QaB:function(a){return(a!==-1?this.border[a].qans:-1)},QsB:function(a){return(a!==-1?this.border[a].qsub:-1)},LiB:function(a){return(a!==-1?this.border[a].line:-1)},sErC:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]!==-1){this.cell[c[b]].error=a}}},sErX:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]!==-1){this.cross[c[b]].error=a}}},sErB:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]!==-1){this.border[c[b]].error=a}}},sErE:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]!==-1){this.excell[c[b]].error=a}}},sErBAll:function(a){if(!ans.isenableSetError()){return}for(var b=0;b<bd.bdmax;b++){this.border[b].error=a}},ErC:function(a){return(a!==-1?this.cell[a].error:0)},ErX:function(a){return(a!==-1?this.cross[a].error:0)},ErB:function(a){return(a!==-1?this.border[a].error:0)},ErE:function(a){return(a!==-1?this.excell[a].error:0)},setFunctions:function(){this.isLine=((!k.isborderAsLine)?function(a){return(a!==-1&&bd.border[a].line>0)}:function(a){return(a!==-1&&bd.border[a].qans>0)});this.setLine=((!k.isborderAsLine)?function(a){this.sLiB(a,1);this.sQsB(a,0)}:function(a){this.sQaB(a,1);this.sQsB(a,0)});this.setPeke=((!k.isborderAsLine)?function(a){this.sLiB(a,0);this.sQsB(a,2)}:function(a){this.sQaB(a,0);this.sQsB(a,2)});this.removeLine=((!k.isborderAsLine)?function(a){this.sLiB(a,0);this.sQsB(a,0)}:function(a){this.sQaB(a,0);this.sQsB(a,0)});this.isNum=(k.isAnsNumber?function(a){return(a!==-1&&(bd.cell[a].qnum!==-1||bd.cell[a].qans!==-1))}:function(a){return(a!==-1&&bd.cell[a].qnum!==-1)});this.noNum=(k.isAnsNumber?function(a){return(a===-1||(bd.cell[a].qnum===-1&&bd.cell[a].qans===-1))}:function(a){return(a===-1||bd.cell[a].qnum===-1)});this.isValidNum=(k.isAnsNumber?function(a){return(a!==-1&&(bd.cell[a].qnum>=0||(bd.cell[a].qans>=0&&bd.cell[a].qnum===-1)))}:function(a){return(a!==-1&&bd.cell[a].qnum>=0)});this.sameNumber=function(b,a){return(bd.isValidNum(b)&&(bd.getNum(b)===bd.getNum(a)))};this.getNum=(k.isAnsNumber?function(a){return(a!==-1?this.cell[a].qnum!==-1?this.cell[a].qnum:this.cell[a].qans:-1)}:function(a){return(a!==-1?this.cell[a].qnum:-1)});this.setNum=((k.NumberIsWhite?function(b,a){if(!k.dispzero&&a===0){return}this.sQnC(b,a);this.sQaC(b,bd.defcell.qnum)}:k.isAnsNumber?function(b,a){if(!k.dispzero&&a===0){return}if(k.editmode){this.sQnC(b,a);this.sQaC(b,bd.defcell.qnum)}else{if(this.cell[b].qnum===bd.defcell.qnum){this.sQaC(b,a)}}this.sQsC(b,0)}:function(b,a){if(!k.dispzero&&a===0){return}this.sQnC(b,a)}))},isBlack:function(a){return(a!==-1&&bd.cell[a].qans===1)},isWhite:function(a){return(a!==-1&&bd.cell[a].qans!==1)},setBlack:function(a){this.sQaC(a,1)},setWhite:function(a){this.sQaC(a,-1)},isBorder:function(a){return(a!==-1&&(bd.border[a].ques>0||bd.border[a].qans>0))},setBorder:function(a){if(k.editmode){this.sQuB(a,1);this.sQaB(a,0)}else{if(this.QuB(a)!==1){this.sQaB(a,1)}}},removeBorder:function(a){if(k.editmode){this.sQuB(a,0);this.sQaB(a,0)}else{if(this.QuB(a)!==1){this.sQaB(a,0)}}},setBsub:function(a){this.sQsB(a,1)},removeBsub:function(a){this.sQsB(a,0)}};Graphic=function(){this.gridcolor="black";this.cellcolor="black";this.errcolor1="rgb(224, 0, 0)";this.errcolor2="rgb(64, 64, 255)";this.errcolor3="rgb(0, 191, 0)";this.circledcolor="white";this.mbcolor="rgb(255, 160, 127)";this.qsubcolor1="rgb(160,255,160)";this.qsubcolor2="rgb(255,255,127)";this.qsubcolor3="rgb(192,192,192)";this.fontcolor="black";this.fontAnscolor="rgb(0, 160, 0)";this.fontErrcolor="rgb(191, 0, 0)";this.fontBCellcolor="rgb(224, 224, 224)";this.borderfontcolor="black";this.bcolor="white";this.dotcolor="black";this.errbcolor1="rgb(255, 160, 160)";this.errbcolor2="rgb(64, 255, 64)";this.icecolor="rgb(192, 224, 255)";this.ttcolor="rgb(127,255,127)";this.borderQuescolor="black";this.borderQanscolor="rgb(0, 191, 0)";this.borderQsubcolor="rgb(255, 0, 255)";this.errborderQanscolor2="rgb(160, 160, 160)";this.bbcolor="rgb(96, 96, 96)";this.linecolor="rgb(0, 160, 0)";this.pekecolor="rgb(32, 32, 255)";this.errlinecolor1="rgb(255, 0, 0)";this.errlinecolor2="rgb(160, 160, 160)";this.targetColor1="rgb(255, 64,  64)";this.targetColor3="rgb(64,  64, 255)";this.bgcolor="";this.gridcolor_BLACK="black";this.gridcolor_LIGHT="rgb(127, 127, 127)";this.gridcolor_DLIGHT="rgb(160, 160, 160)";this.gridcolor_SLIGHT="rgb(191, 191, 191)";this.gridcolor_THIN="rgb(224, 224, 224)";this.bcolor_GREEN="rgb(160, 255, 160)";this.errbcolor1_DARK="rgb(255, 127, 127)";this.linecolor_LIGHT="rgb(0, 192, 0)";this.fontsizeratio=1;this.crosssize=0.4;this.circleratio=[0.4,0.34];this.cw=k.cwidth;this.ch=k.cheight;this.bw=k.bwidth;this.bh=k.bheight;this.lw=1;this.lm=1;this.lwratio=12;this.addlw=0;this.bdheader="b_bd";this.chassisflag=true;this.lastHdeg=0;this.lastYdeg=0;this.minYdeg=0.18;this.maxYdeg=0.7;this.zidx=1;this.zidx_array=[];this.EL_NUMOBJ=ee.addTemplate("numobj_parent","div",{className:"divnum",unselectable:"on"},null,null);this.EL_IMGOBJ=ee.addTemplate("numobj_parent","img",{className:"imgnum",unselectable:"on"},null,null);this.numobj={};this.fillTextPrecisely=false;this.isdrawBC=false;this.isdrawBD=false;this.STROKE=0;this.FILL=1;this.FILL_STROKE=2;this.NONE=3;this.vnop_FILL=[false,true,true,false];this.vnop_STROKE=[true,false,true,false]};Graphic.prototype={onresize_process:function(){this.cw=k.cwidth;this.ch=k.cheight;this.bw=k.bwidth;this.bh=k.bheight;this.lw=Math.max(k.cwidth/this.lwratio,3);this.lm=(this.lw-1)/2},paint:function(b,d,a,c){},prepaint:function(b,d,a,c){this.flushCanvas(b,d,a,c);this.paint(b,d,a,c)},paintAll:function(){this.prepaint(-1,-1,2*k.qcols+1,2*k.qrows+1)},paintRange:function(b,d,a,c){this.prepaint(b,d,a,c)},paintPos:function(a){this.prepaint(a.x-1,a.y-1,a.x+1,a.y+1)},paintCell:function(a){if(isNaN(a)||!bd.cell[a]){return}this.prepaint(bd.cell[a].bx-1,bd.cell[a].by-1,bd.cell[a].bx+1,bd.cell[a].by+1)},paintCellAround:function(a){if(isNaN(a)||!bd.cell[a]){return}this.prepaint(bd.cell[a].bx-3,bd.cell[a].by-3,bd.cell[a].bx+3,bd.cell[a].by+3)},paintCross:function(a){if(isNaN(a)||!bd.cross[a]){return}this.prepaint(bd.cross[a].bx-1,bd.cross[a].by-1,bd.cross[a].bx+1,bd.cross[a].by+1)},paintBorder:function(a){if(isNaN(a)||!bd.border[a]){return}if(bd.border[a].bx&1){this.prepaint(bd.border[a].bx-2,bd.border[a].by-1,bd.border[a].bx+2,bd.border[a].by+1)}else{this.prepaint(bd.border[a].bx-1,bd.border[a].by-2,bd.border[a].bx+1,bd.border[a].by+2)}},paintLine:function(a){if(isNaN(a)||!bd.border[a]){return}if(bd.border[a].bx&1){this.prepaint(bd.border[a].bx-1,bd.border[a].by-2,bd.border[a].bx+1,bd.border[a].by+2)}else{this.prepaint(bd.border[a].bx-2,bd.border[a].by-1,bd.border[a].bx+2,bd.border[a].by+1)}},paintEXcell:function(a){if(isNaN(a)||!bd.excell[a]){return}this.prepaint(bd.excell[a].bx-1,bd.excell[a].by-1,bd.excell[a].bx+1,bd.excell[a].by+1)},getNewLineColor:function(){var i=0;while(1){var f=mf(Math.random()*384)-64;if(f<0){f=0}if(f>255){f=255}var e=mf(Math.random()*384)-64;if(e<0){e=0}if(e>255){e=255}var j=mf(Math.random()*384)-64;if(j<0){j=0}if(j>255){j=255}var a=Math.max(f,Math.max(e,j));var l=Math.min(f,Math.min(e,j));var c=0;var b=(a+l)*0.5/255;var d=(a===l?0:(a-l)/((b<=0.5)?(a+l):(2*255-a-l)));if(a==l){c=0}else{if(f>=e&&f>=j){c=(60*(e-j)/(a-l)+360)%360}else{if(e>=f&&e>=j){c=(120+60*(j-f)/(a-l)+360)%360}else{if(j>=e&&j>=f){c=(240+60*(f-e)/(a-l)+360)%360}}}}var h=(0.29891*f+0.58661*e+0.11448*j)/255;if((this.minYdeg<h&&h<this.maxYdeg)&&(Math.abs(this.lastYdeg-h)>0.15)&&(d<0.02||0.4<d)&&(((360+this.lastHdeg-c)%360>=45)&&((360+this.lastHdeg-c)%360<=315))){this.lastHdeg=c;this.lastYdeg=h;return"rgb("+f+","+e+","+j+")"}i++;if(i>100){return"rgb("+f+","+e+","+j+")"}}},drawBlackCells:function(b,f,a,e){this.vinc("cell_front","crispEdges");var l="c_fullb_";if(g.use.canvas&&this.isdrawBC&&!this.isdrawBD){b--;f--;a++;e++}var h=bd.cellinside(b,f,a,e);for(var d=0;d<h.length;d++){var j=h[d];if(this.setCellColor(j)){if(this.vnop(l+j,this.FILL)){g.fillRect(bd.cell[j].px,bd.cell[j].py,this.cw+1,this.ch+1)}}else{this.vhide(l+j);continue}}this.isdrawBC=true},setCellColor:function(b){var a=bd.cell[b].error;if(bd.cell[b].qans!==1){return false}else{if(a===0){g.fillStyle=this.cellcolor;return true}else{if(a===1){g.fillStyle=this.errcolor1;return true}}}return false},setCellColorFunc:function(a){switch(a){case"qnum":this.setCellColor=function(d){var b=bd.cell[d].error;if(bd.cell[d].qnum===-1){return false}else{if(b===0){g.fillStyle=this.cellcolor;return true}else{if(b===1){g.fillStyle=this.errcolor1;return true}}}return false};break;default:break}},drawBGCells:function(b,f,a,e){this.vinc("cell_back","crispEdges");var l="c_full_";var h=bd.cellinside(b,f,a,e);for(var d=0;d<h.length;d++){var j=h[d];if(this.setBGCellColor(j)){if(this.vnop(l+j,this.FILL)){g.fillRect(bd.cell[j].px,bd.cell[j].py,this.cw,this.ch)}}else{this.vhide(l+j);continue}}},setBGCellColor:function(a){if(bd.cell[a].error===1){g.fillStyle=this.errbcolor1;return true}return false},setBGCellColorFunc:function(a){switch(a){case"error2":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.error===2){g.fillStyle=this.errbcolor2;return true}}return false};break;case"qans1":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.qans===1){g.fillStyle=(b.error===1?this.errcolor1:this.cellcolor);return true}if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1&&this.bcolor!=="white"){g.fillStyle=this.bcolor;return true}}return false};break;case"qans2":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.qans===1){if(b.error===0){g.fillStyle=this.cellcolor}else{if(b.error===1){g.fillStyle=this.errcolor1}else{if(b.error===2){g.fillStyle=this.errcolor2}}}return true}if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1&&this.bcolor!=="white"){g.fillStyle=this.bcolor;return true}}return false};break;case"qsub1":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1){g.fillStyle=this.bcolor;return true}}return false};break;case"qsub2":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1){g.fillStyle=this.qsubcolor1;return true}else{if(b.qsub===2){g.fillStyle=this.qsubcolor2;return true}}}return false};break;case"qsub3":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1){g.fillStyle=this.qsubcolor1;return true}else{if(b.qsub===2){g.fillStyle=this.qsubcolor2;return true}else{if(b.qsub===3){g.fillStyle=this.qsubcolor3;return true}}}}return false};break;case"icebarn":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.ques===6){g.fillStyle=this.icecolor;return true}}return false};break;default:break}},drawBGEXcells:function(d,h,b,f){this.vinc("excell_back","crispEdges");var l="ex_full_";var a=bd.excellinside(d-1,h-1,b,f);for(var e=0;e<a.length;e++){var j=a[e];if(this.setBGEXcellColor(j)){if(this.vnop(l+j,this.FILL)){g.fillRect(bd.excell[j].px+1,bd.excell[j].py+1,this.cw-1,this.ch-1)}}else{this.vhide(l+j);continue}}},setBGEXcellColor:function(a){if(bd.excell[a].error===1){g.fillStyle=this.errbcolor1;return true}return false},drawRDotCells:function(b,l,a,j){this.vinc("cell_dot","auto");var d=this.cw*0.06;d=(d>2?d:2);var f="c_rdot_";g.fillStyle=this.dotcolor;var m=bd.cellinside(b,l,a,j);for(var e=0;e<m.length;e++){var h=m[e];if(bd.cell[h].qsub===1){if(this.vnop(f+h,this.NONE)){g.fillCircle(bd.cell[h].cpx,bd.cell[h].cpy,d)}}else{this.vhide(f+h)}}},drawDotCells:function(b,l,a,j){this.vinc("cell_dot","crispEdges");var d=this.cw*0.075;var f="c_dot_";g.fillStyle=this.dotcolor;var m=bd.cellinside(b,l,a,j);for(var e=0;e<m.length;e++){var h=m[e];if(bd.cell[h].qsub===1){if(this.vnop(f+h,this.NONE)){g.fillRect(bd.cell[h].cpx-d,bd.cell[h].cpy-d,d*2,d*2)}}else{this.vhide(f+h)}}},drawNumbers:function(b,e,a,d){this.vinc("cell_number","auto");var f=bd.cellinside(b,e,a,d);for(var c=0;c<f.length;c++){this.drawNumber1(f[c])}},drawNumber1:function(i){var f=bd.cell[i],e=["cell",i].join("_"),d=bd.getNum(i);if(d>0||(k.dispzero&&d===0)||(k.isDispHatena&&d===-2)){var h=(d>=0?""+d:"?");var b=(d<10?0.8:(d<100?0.7:0.55));var a=this.getCellNumberColor(i);this.dispnum(e,1,h,b,a,f.cpx,f.cpy)}else{this.hideEL(e)}},getCellNumberColor:function(d){var b=bd.cell[d],a=this.fontcolor;if(!k.isAnsNumber&&((k.BlackCell&&b.qans===1)||(!k.BlackCell&&b.ques!==0))){a=this.fontBCellcolor}else{if(b.error===1||b.error===4){a=this.fontErrcolor}else{if(k.isAnsNumber&&b.qnum===-1){a=this.fontAnscolor}}}return a},drawArrowNumbers:function(x,d,w,b){this.vinc("cell_arrownumber","auto");var a=["c_ar1_","c_dt1_","c_dt2_","c_ar3_","c_dt3_","c_dt4_"];var p=this.cw*0.7;var h=(this.cw-p)/2;var e=Math.max(this.cw/24,1);var n=e/2;if(g.use.canvas&&this.isdrawBC&&!this.isdrawBD){x--;d--;w++;b++}var z=bd.cellinside(x,d,w,b);for(var v=0;v<z.length;v++){var y=z[v];if(bd.cell[y].qnum!==-1&&(bd.cell[y].qnum!==-2||k.isDispHatena)){var q=px=bd.cell[y].px,m=py=bd.cell[y].py,t=bd.cell[y].direc;if(bd.cell[y].qans===1){g.fillStyle=this.fontBCellcolor}else{if(bd.cell[y].error===1){g.fillStyle=this.fontErrcolor}else{g.fillStyle=this.fontcolor}}if(t===k.UP||t===k.DN){q+=(this.cw-h*1.5-n);m+=(h+1);if(this.vnop(a[0]+y,this.FILL)){g.fillRect(q,m,e,p)}q+=e/2;if(t===k.UP){if(this.vnop(a[1]+y,this.FILL)){g.setOffsetLinePath(q,m,0,0,-p/6,p/3,p/6,p/3,true);g.fill()}}else{this.vhide(a[1]+y)}if(t===k.DN){if(this.vnop(a[2]+y,this.FILL)){g.setOffsetLinePath(q,m+p,0,0,-p/6,-p/3,p/6,-p/3,true);g.fill()}}else{this.vhide(a[2]+y)}}else{this.vhide([a[0]+y,a[1]+y,a[2]+y])}if(t===k.LT||t===k.RT){q+=(h+1);m+=(h*1.5-n);if(this.vnop(a[3]+y,this.FILL)){g.fillRect(q,m,p,e)}m+=e/2;if(t===k.LT){if(this.vnop(a[4]+y,this.FILL)){g.setOffsetLinePath(q,m,0,0,p/3,-p/6,p/3,p/6,true);g.fill()}}else{this.vhide(a[4]+y)}if(t===k.RT){if(this.vnop(a[5]+y,this.FILL)){g.setOffsetLinePath(q+p,m,0,0,-p/3,-p/6,-p/3,p/6,true);g.fill()}}else{this.vhide(a[5]+y)}}else{this.vhide([a[3]+y,a[4]+y,a[5]+y])}var l=bd.getNum(y),r=(l>=0?""+l:"?");var o=(l<10?0.8:(l<100?0.7:0.55));var u=g.fillStyle;var j=bd.cell[y].cpx,f=bd.cell[y].cpy;if(t===k.UP||t===k.DN){o*=0.85;j-=this.cw*0.1}else{if(t===k.LT||t===k.RT){o*=0.85;f+=this.ch*0.1}}this.dispnum("cell_"+y,1,r,o,u,j,f)}else{this.vhide([a[0]+y,a[1]+y,a[2]+y,a[3]+y,a[4]+y,a[5]+y]);this.hideEL("cell_"+y)}}},drawQuesHatenas:function(b,h,a,f){this.vinc("cell_number","auto");var l=bd.cellinside(b,h,a,f);for(var e=0;e<l.length;e++){var d=bd.cell[l[e]],j="cell_"+l[e];if(d.ques===-2){var c=(d.error===1?this.fontErrcolor:this.fontcolor);this.dispnum(j,1,"?",0.8,c,d.cpx,d.cpy)}else{this.hideEL(j)}}},drawCrosses:function(b,m,a,l){this.vinc("cross_base","auto");var d=this.cw*this.crosssize+1;var h="x_cp_";g.lineWidth=1;var o=bd.crossinside(b,m,a,l);for(var f=0;f<o.length;f++){var j=o[f],e=bd.cross[j],n=["cross",j].join("_");if(e.qnum!==-1){g.fillStyle=(e.error===1?this.errcolor1:"white");g.strokeStyle="black";if(this.vnop(h+j,this.FILL_STROKE)){g.shapeCircle(e.px,e.py,d)}}else{this.vhide([h+j])}if(e.qnum>=0){this.dispnum(n,1,""+e.qnum,0.6,this.fontcolor,e.px,e.py)}else{this.hideEL(n)}}},drawCrossMarks:function(b,l,a,j){this.vinc("cross_mark","auto");var d=this.cw*this.crosssize;var f="x_cm_";var m=bd.crossinside(b,l,a,j);for(var e=0;e<m.length;e++){var h=m[e];if(bd.cross[h].qnum===1){g.fillStyle=(bd.cross[h].error===1?this.errcolor1:this.cellcolor);if(this.vnop(f+h,this.FILL)){g.fillCircle(bd.cross[h].px,bd.cross[h].py,d)}}else{this.vhide(f+h)}}},drawBorders:function(b,e,a,d){this.vinc("border","crispEdges");var f=bd.borderinside(b-1,e-1,a+1,d+1);for(var c=0;c<f.length;c++){this.drawBorder1(f[c])}this.isdrawBD=true},drawBorder1:function(a,c){var i=[this.bdheader,a].join("_");if(c!==false&&this.setBorderColor(a)){if(this.vnop(i,this.FILL)){var b=this.lw+this.addlw,f=this.lm;var e=bd.border[a].bx,d=bd.border[a].by;var j=bd.border[a].px,h=bd.border[a].py;if(d&1){g.fillRect(j-f,h-this.bh-f,b,this.ch+b)}else{if(e&1){g.fillRect(j-this.bw-f,h-f,this.cw+b,b)}}}}else{this.vhide(i)}},setBorderColor:function(a){if(bd.border[a].ques===1){g.fillStyle=this.borderQuescolor;return true}return false},setBorderColorFunc:function(a){switch(a){case"qans":this.setBorderColor=function(c){var b=bd.border[c].error;if(bd.isBorder(c)){if(b===1){g.fillStyle=this.errcolor1}else{if(b===2){g.fillStyle=this.errborderQanscolor2}else{g.fillStyle=this.borderQanscolor}}return true}return false};break;case"line":this.setBorderColor=this.setLineColor;break;case"ice":this.setBorderColor=function(d){var c=bd.border[d].cellcc[0],b=bd.border[d].cellcc[1];if(c!==-1&&b!==-1&&(bd.cell[c].ques===6^bd.cell[b].ques===6)){g.fillStyle=this.cellcolor;return true}return false};break}},drawBorderQsubs:function(d,l,a,j){this.vinc("border_qsub","crispEdges");var e=this.cw*0.15;var h="b_qsub1_";g.fillStyle=this.borderQsubcolor;var c=bd.borderinside(d-1,l-1,a+1,j+1);for(var f=0;f<c.length;f++){var b=c[f];if(bd.border[b].qsub===1){if(this.vnop(h+b,this.NONE)){if(bd.border[b].bx&1){g.fillRect(bd.border[b].px,bd.border[b].py-this.bh+e,1,this.ch-2*e)}else{if(bd.border[b].by&1){g.fillRect(bd.border[b].px-this.bw+e,bd.border[b].py,this.cw-2*e,1)}}}}else{this.vhide(h+b)}}},drawBoxBorders:function(M,f,K,e,u){this.vinc("boxborder","crispEdges");var l=this.lw,t=this.lm;var h=this.cw;var w=this.ch;var A=["u","d","l","r"];g.fillStyle=this.bbcolor;var O=bd.cellinside(M,f,K,e);for(var H=0;H<O.length;H++){var N=O[H],m=[];for(var C=0;C<12;C++){m[C]=["c_bb",C,N].join("_")}if(bd.cell[N].qans!==1){this.vhide(m);continue}var L=bd.cell[N].bx,J=bd.cell[N].by;var z=bd.cell[N].px,x=bd.cell[N].py;var G=z+t+1,F=z+h-t-1;var d=x+t+1,b=x+w-t-1;var o=(J>2),D=(J<2*k.qrows-2);var j=(L>2),a=(L<2*k.qcols-2);var v=(!o||bd.border[bd.bnum(L,J-1)].ques===1);var E=(!D||bd.border[bd.bnum(L,J+1)].ques===1);var p=(!j||bd.border[bd.bnum(L-1,J)].ques===1);var q=(!a||bd.border[bd.bnum(L+1,J)].ques===1);var y=(!o||!j||bd.border[bd.bnum(L-2,J-1)].ques===1||bd.border[bd.bnum(L-1,J-2)].ques===1);var r=(!o||!a||bd.border[bd.bnum(L+2,J-1)].ques===1||bd.border[bd.bnum(L+1,J-2)].ques===1);var I=(!D||!j||bd.border[bd.bnum(L-2,J+1)].ques===1||bd.border[bd.bnum(L-1,J+2)].ques===1);var B=(!D||!a||bd.border[bd.bnum(L+2,J+1)].ques===1||bd.border[bd.bnum(L+1,J+2)].ques===1);if(v){if(this.vnop(m[0],this.NONE)){g.fillRect(G,d,h-l,1)}}else{this.vhide(m[0])}if(E){if(this.vnop(m[1],this.NONE)){g.fillRect(G,b,h-l,1)}}else{this.vhide(m[1])}if(p){if(this.vnop(m[2],this.NONE)){g.fillRect(G,d,1,w-l)}}else{this.vhide(m[2])}if(q){if(this.vnop(m[3],this.NONE)){g.fillRect(F,d,1,w-l)}}else{this.vhide(m[3])}if(u){if(!v&&(y||p)){if(this.vnop(m[4],this.NONE)){g.fillRect(G,x-t,1,l+1)}}else{this.vhide(m[4])}if(!v&&(r||q)){if(this.vnop(m[5],this.NONE)){g.fillRect(F,x-t,1,l+1)}}else{this.vhide(m[5])}if(!p&&(y||v)){if(this.vnop(m[6],this.NONE)){g.fillRect(z-t,d,l+1,1)}}else{this.vhide(m[6])}if(!p&&(I||E)){if(this.vnop(m[7],this.NONE)){g.fillRect(z-t,b,l+1,1)}}else{this.vhide(m[7])}}else{if(!v&&(y||p)){if(this.vnop(m[4],this.NONE)){g.fillRect(G,x,1,t+1)}}else{this.vhide(m[4])}if(!v&&(r||q)){if(this.vnop(m[5],this.NONE)){g.fillRect(F,x,1,t+1)}}else{this.vhide(m[5])}if(!E&&(I||p)){if(this.vnop(m[6],this.NONE)){g.fillRect(G,b,1,t+1)}}else{this.vhide(m[6])}if(!E&&(B||q)){if(this.vnop(m[7],this.NONE)){g.fillRect(F,b,1,t+1)}}else{this.vhide(m[7])}if(!p&&(y||v)){if(this.vnop(m[8],this.NONE)){g.fillRect(z,d,t+1,1)}}else{this.vhide(m[8])}if(!p&&(I||E)){if(this.vnop(m[9],this.NONE)){g.fillRect(z,b,t+1,1)}}else{this.vhide(m[9])}if(!q&&(r||v)){if(this.vnop(m[10],this.NONE)){g.fillRect(F,d,t+1,1)}}else{this.vhide(m[10])}if(!q&&(B||E)){if(this.vnop(m[11],this.NONE)){g.fillRect(F,b,t+1,1)}}else{this.vhide(m[11])}}}},drawLines:function(b,e,a,d){this.vinc("line","crispEdges");var f=bd.borderinside(b-1,e-1,a+1,d+1);for(var c=0;c<f.length;c++){this.drawLine1(f[c])}this.addlw=0},drawLine1:function(e,b){var a="b_line_"+e;if(b!==false&&this.setLineColor(e)){if(this.vnop(a,this.FILL)){var d=this.lw+this.addlw,c=this.lm;if(bd.border[e].bx&1){g.fillRect(bd.border[e].px-c,bd.border[e].py-this.bh-c,d,this.ch+d)}else{if(bd.border[e].by&1){g.fillRect(bd.border[e].px-this.bw-c,bd.border[e].py-c,this.cw+d,d)}}}}else{this.vhide(a)}},setLineColor:function(a){this.addlw=0;if(bd.isLine(a)){if(bd.border[a].error===1){g.fillStyle=this.errlinecolor1;if(g.use.canvas){this.addlw=1}}else{if(bd.border[a].error===2){g.fillStyle=this.errlinecolor2}else{if(k.irowake===0||!pp.getVal("irowake")||!bd.border[a].color){g.fillStyle=this.linecolor}else{g.fillStyle=bd.border[a].color}}}return true}return false},drawPekes:function(d,l,a,j,h){if(!g.use.canvas&&h===2){return}this.vinc("border_peke","auto");var m=this.cw*0.15+1;if(m<4){m=4}var e=["b_peke0_","b_peke1_"];g.fillStyle="white";g.strokeStyle=this.pekecolor;g.lineWidth=1;var c=bd.borderinside(d-1,l-1,a+1,j+1);for(var f=0;f<c.length;f++){var b=c[f];if(bd.border[b].qsub!==2){this.vhide([e[0]+b,e[1]+b]);continue}if(g.use.canvas){if(h===0||h===2){if(this.vnop(e[0]+b,this.NONE)){g.fillRect(bd.border[b].px-m,bd.border[b].py-m,2*m+1,2*m+1)}}else{this.vhide(e[0]+b)}}if(h===0||h===1){if(this.vnop(e[1]+b,this.NONE)){g.strokeCross(bd.border[b].px,bd.border[b].py,m-1)}}else{this.vhide(e[1]+b)}}},drawTriangle:function(b,l,a,j){this.vinc("cell_triangle","auto");var d=["c_tri2_","c_tri3_","c_tri4_","c_tri5_"];if(g.use.canvas&&k.puzzleid!=="reflect"){b--;l--;a++;j++}var m=bd.cellinside(b,l,a,j);for(var e=0;e<m.length;e++){var h=m[e];var f=(bd.cell[h].ques!==0?bd.cell[h].ques:bd.cell[h].qans);this.vhide([d[0]+h,d[1]+h,d[2]+h,d[3]+h]);if(f>=2&&f<=5){switch(k.puzzleid){case"reflect":g.fillStyle=((bd.cell[h].error===1||bd.cell[h].error===4)?this.errcolor1:this.cellcolor);break;default:g.fillStyle=this.cellcolor;break}this.drawTriangle1(bd.cell[h].px,bd.cell[h].py,f,d[f-2]+h)}}},drawTriangle1:function(f,e,d,b){if(this.vnop(b,this.FILL)){var c=this.cw,h=this.ch,a=(k.puzzleid==="reflect"?1:0);switch(d){case 2:g.setOffsetLinePath(f,e,a,a,a,h+1,c+1,h+1,true);break;case 3:g.setOffsetLinePath(f,e,c+1,a,a,h+1,c+1,h+1,true);break;case 4:g.setOffsetLinePath(f,e,a,a,c+1,a,c+1,h+1,true);break;case 5:g.setOffsetLinePath(f,e,a,a,c+1,a,a,h+1,true);break}g.fill()}},drawMBs:function(d,l,b,j){this.vinc("cell_mb","auto");g.strokeStyle=this.mbcolor;g.lineWidth=1;var a=this.cw*0.35;var e=["c_MB1_","c_MB2a_"];var m=bd.cellinside(d,l,b,j);for(var f=0;f<m.length;f++){var h=m[f];if(bd.cell[h].qsub===0){this.vhide([e[0]+h,e[1]+h]);continue}switch(bd.cell[h].qsub){case 1:if(this.vnop(e[0]+h,this.NONE)){g.strokeCircle(bd.cell[h].cpx,bd.cell[h].cpy,a)}this.vhide(e[1]+h);break;case 2:if(this.vnop(e[1]+h,this.NONE)){g.strokeCross(bd.cell[h].cpx,bd.cell[h].cpy,a)}this.vhide(e[0]+h);break}}},drawCircles41_42:function(b,j,a,h){this.vinc("cell_circle","auto");g.lineWidth=Math.max(this.cw*(this.circleratio[0]-this.circleratio[1]),1);var m=this.cw*(this.circleratio[0]+this.circleratio[1])/2;var l=this.cw*this.circleratio[0];var d=["c_cir41_","c_cir42_"];var n=bd.cellinside(b,j,a,h);for(var e=0;e<n.length;e++){var f=n[e];if(bd.cell[f].ques===41){g.strokeStyle=(bd.cell[f].error===1?this.errcolor1:this.cellcolor);g.fillStyle=(bd.cell[f].error===1?this.errbcolor1:"white");if(this.vnop(d[0]+f,this.FILL_STROKE)){g.shapeCircle(bd.cell[f].cpx,bd.cell[f].cpy,m)}}else{this.vhide(d[0]+f)}if(bd.cell[f].ques===42){g.fillStyle=(bd.cell[f].error===1?this.errcolor1:this.cellcolor);if(this.vnop(d[1]+f,this.FILL)){g.fillCircle(bd.cell[f].cpx,bd.cell[f].cpy,l)}}else{this.vhide(d[1]+f)}}},drawCirclesAtNumber:function(b,e,a,d){this.vinc("cell_circle","auto");var f=bd.cellinside(b-2,e-2,a+2,d+2);for(var c=0;c<f.length;c++){this.drawCircle1AtNumber(f[c])}},drawCircle1AtNumber:function(e){if(e===-1){return}var b=this.cw*this.circleratio[0];var a=this.cw*this.circleratio[1];var d=["c_cira_","c_cirb_"];if(bd.cell[e].qnum!=-1){g.lineWidth=this.cw*0.05;g.fillStyle=(bd.cell[e].error===1?this.errbcolor1:this.circledcolor);if(this.vnop(d[1]+e,this.FILL)){g.fillCircle(bd.cell[e].cpx,bd.cell[e].cpy,a)}g.strokeStyle=(bd.cell[e].error===1?this.errcolor1:this.cellcolor);if(this.vnop(d[0]+e,this.STROKE)){g.strokeCircle(bd.cell[e].cpx,bd.cell[e].cpy,b)}}else{this.vhide([d[0]+e,d[1]+e])}},drawLineParts:function(b,e,a,d){this.vinc("cell_lineparts","crispEdges");var f=bd.cellinside(b,e,a,d);for(var c=0;c<f.length;c++){this.drawLineParts1(f[c])}},drawLineParts1:function(a){var c=["c_lp1_"+a,"c_lp2_"+a,"c_lp3_"+a,"c_lp4_"+a];var l=bd.cell[a].ques;if(l>=101&&l<=107){var b=this.lw,j=this.lm;var h=this.bh+this.lm,f=this.bw+this.lm;var n=bd.cell[a].px,m=bd.cell[a].py;var e=bd.cell[a].cpx,d=bd.cell[a].cpy;g.fillStyle=this.borderQuescolor;var i={101:15,102:3,103:12,104:9,105:5,106:6,107:10}[l];if(i&1){if(this.vnop(c[0],this.NONE)){g.fillRect(e-j,m,b,h)}}else{this.vhide(c[0])}if(i&2){if(this.vnop(c[1],this.NONE)){g.fillRect(e-j,d-j,b,h)}}else{this.vhide(c[1])}if(i&4){if(this.vnop(c[2],this.NONE)){g.fillRect(n,d-j,f,b)}}else{this.vhide(c[2])}if(i&8){if(this.vnop(c[3],this.NONE)){g.fillRect(e-j,d-j,f,b)}}else{this.vhide(c[3])}}else{this.vhide(c)}},drawQues51:function(b,d,a,c){this.drawEXCellGrid(b,d,a,c);this.drawSlash51Cells(b,d,a,c);this.drawSlash51EXcells(b,d,a,c);this.drawTargetTriangle(b,d,a,c)},drawSlash51Cells:function(b,l,a,h){this.vinc("cell_ques51","crispEdges");var e="c_slash51_";g.strokeStyle=this.cellcolor;g.lineWidth=1;var n=bd.cellinside(b,l,a,h);for(var d=0;d<n.length;d++){var f=n[d],m=bd.cell[f].px,j=bd.cell[f].py;if(bd.cell[f].ques===51){if(this.vnop(e+f,this.NONE)){g.strokeLine(m+1,j+1,m+this.cw,j+this.ch)}}else{this.vhide(e+f)}}},drawSlash51EXcells:function(b,m,a,j){this.vinc("excell_ques51","crispEdges");var f="ex_slash51_";g.strokeStyle=this.cellcolor;g.lineWidth=1;var d=bd.excellinside(b-1,m-1,a,j);for(var e=0;e<d.length;e++){var h=d[e],n=bd.excell[h].px,l=bd.excell[h].py;if(this.vnop(f+h,this.NONE)){g.strokeLine(n+1,l+1,n+this.cw,l+this.ch)}}},drawEXCellGrid:function(b,m,a,j){this.vinc("grid_excell","crispEdges");g.fillStyle=this.cellcolor;var e=["ex_bdx_","ex_bdy_"];var d=bd.excellinside(b-1,m-1,a,j);for(var f=0;f<d.length;f++){var h=d[f],n=bd.excell[h].px,l=bd.excell[h].py;if(bd.excell[h].by===-1&&bd.excell[h].bx<bd.maxbx){if(this.vnop(e[0]+h,this.NONE)){g.fillRect(n+this.cw,l,1,this.ch)}}if(bd.excell[h].bx===-1&&bd.excell[h].by<bd.maxby){if(this.vnop(e[1]+h,this.NONE)){g.fillRect(n,l+this.ch,this.cw,1)}}}},drawNumbersOn51:function(b,e,a,d){this.vinc("cell_number51","auto");for(var h=(b|1)-2;h<=a+2;h+=2){for(var f=(e|1)-2;f<=d+2;f+=2){if(h!==-1&&f!==-1){var i=bd.cnum(h,f);if(i!==-1){this.drawNumbersOn51_1("cell",i)}}else{var i=bd.exnum(h,f);if(i!==-1){this.drawNumbersOn51_1("excell",i)}}}}},drawNumbersOn51_1:function(h,m){var a,d,l,j,o,n,f=bd[h][m];var q=[[h,m,"ques51","rt"].join("_"),[h,m,"ques51","dn"].join("_")];if(h==="excell"||bd.cell[m].ques===51){for(var e=0;e<2;e++){if(e===0){a=f.qnum,l=f.by,j=bd.cnum(f.bx+2,f.by),o=4}else{if(e===1){a=f.direc,l=f.bx,j=bd.cnum(f.bx,f.by+2),o=2}}if(a!==-1&&l!==-1&&j!==-1&&bd.cell[j].ques!==51){var b=(f.error===1?this.fontErrcolor:this.fontcolor);var p=(a>=0?""+a:"");this.dispnum(q[e],o,p,0.45,b,f.px+this.bw,f.py+this.bh)}else{this.hideEL(q[e])}}}else{this.hideEL(q[0]);this.hideEL(q[1])}},drawTarget:function(b,d,a,c){this.drawCursor(b,d,a,c,true,k.editmode)},drawCursor:function(b,f,a,e,l,j){this.vinc("target_cursor","crispEdges");if(j!==false&&pp.getVal("cursor")){if(tc.cursorx<b-1||a+1<tc.cursorx){return}if(tc.cursory<f-1||e+1<tc.cursory){return}var d=k.p0.x+tc.cursorx*this.bw+0.5;var c=k.p0.y+tc.cursory*this.bh+0.5;var h,i;if(l!==false){h=mf(Math.max(this.cw/16,2));i=this.bw-0.5}else{h=mf(Math.max(this.cw/24,1));i=this.bw*0.56}this.vdel(["ti1_","ti2_","ti3_","ti4_"]);g.fillStyle=(k.editmode?this.targetColor1:this.targetColor3);if(this.vnop("ti1_",this.FILL)){g.fillRect(d-i,c-i,i*2,h)}if(this.vnop("ti2_",this.FILL)){g.fillRect(d-i,c-i,h,i*2)}if(this.vnop("ti3_",this.FILL)){g.fillRect(d-i,c+i-h,i*2,h)}if(this.vnop("ti4_",this.FILL)){g.fillRect(d+i-h,c-i,h,i*2)}}else{this.vhide(["ti1_","ti2_","ti3_","ti4_"])}},drawTargetTriangle:function(c,f,b,e){this.vinc("target_triangle","auto");var a="target_triangle";this.vdel([a]);if(k.playmode){return}if(tc.cursorx<c||b+2<tc.cursorx){return}if(tc.cursory<f||e+2<tc.cursory){return}var i=tc.getTCC(),d=-1;if(i===-1){d=tc.getTEC()}var h=kc.detectTarget(i,d);if(h===-1){return}g.fillStyle=this.ttcolor;this.drawTriangle1(k.p0.x+(tc.cursorx>>1)*this.cw,k.p0.y+(tc.cursory>>1)*this.ch,(h===2?4:2),a)},drawDashedCenterLines:function(d,p,b,n){this.vinc("centerline","crispEdges");if(d<bd.minbx+1){d=bd.minbx+1}if(b>bd.maxbx-1){b=bd.maxbx-1}if(p<bd.minby+1){p=bd.minby+1}if(n>bd.maxby-1){n=bd.maxby-1}d|=1,p|=1;if(g.use.canvas){g.fillStyle=this.gridcolor;for(var h=d;h<=b;h+=2){for(var e=(k.p0.y+p*this.bh),m=(k.p0.y+n*this.bh);e<m;e+=6){g.fillRect(k.p0.x+h*this.bw,e,1,3)}}for(var h=p;h<=n;h+=2){for(var e=(k.p0.x+d*this.bw),m=(k.p0.x+b*this.bw);e<m;e+=6){g.fillRect(e,k.p0.y+h*this.bh,3,1)}}}else{g.lineWidth=1;g.strokeStyle=this.gridcolor;for(var h=d;h<=b;h+=2){if(this.vnop("cliney_"+h,this.NONE)){var q=k.p0.x+h*this.bw,c=k.p0.y+p*this.bh,a=k.p0.y+n*this.bh;g.strokeLine(q,c,q,a);g.setDashSize(3)}}for(var h=p;h<=n;h+=2){if(this.vnop("clinex_"+h,this.NONE)){var o=k.p0.y+h*this.bh,l=k.p0.x+d*this.bw,f=k.p0.x+b*this.bw;g.strokeLine(l,o,f,o);g.setDashSize(3)}}}},drawGrid:function(c,j,b,h,n){this.vinc("grid","crispEdges");if(c<0){c=0}if(b>2*k.qcols){b=2*k.qcols}if(j<0){j=0}if(h>2*k.qrows){h=2*k.qrows}c-=(c&1),j-=(j&1);var l=((k.isborder!==2&&this.chassisflag)?2:0);var a=Math.max(c,0+l),m=Math.min(b,2*k.qcols-l);var f=Math.max(j,0+l),e=Math.min(h,2*k.qrows-l);n=(n!==false?true:false);if(n){g.fillStyle=this.gridcolor;for(var d=a;d<=m;d+=2){if(this.vnop("bdy_"+d,this.NONE)){g.fillRect(k.p0.x+d*this.bw,k.p0.y+j*this.bh,1,(h-j)*this.bh+1)}}for(var d=f;d<=e;d+=2){if(this.vnop("bdx_"+d,this.NONE)){g.fillRect(k.p0.x+c*this.bw,k.p0.y+d*this.bh,(b-c)*this.bw+1,1)}}}else{if(!g.use.canvas){for(var d=a;d<=m;d+=2){this.vhide("bdy_"+d)}for(var d=f;d<=e;d+=2){this.vhide("bdx_"+d)}}}},drawDashedGrid:function(y,l,w,f){this.vinc("grid","crispEdges");if(y<bd.minbx){y=bd.minbx}if(w>bd.maxbx){w=bd.maxbx}if(l<bd.minby){l=bd.minby}if(f>bd.maxby){f=bd.maxby}y-=(y&1),l-=(l&1);var p=this.cw/10+3;var e=Math.max(this.cw/p,1);var b=this.cw/(e*2);var z=(this.chassisflag?2:0);var x=Math.max(y,bd.minbx+z),t=Math.min(w,bd.maxbx-z);var h=Math.max(l,bd.minby+z),d=Math.min(f,bd.maxby-z);if(g.use.canvas){g.fillStyle=this.gridcolor;for(var u=x;u<=t;u+=2){var n=k.p0.x+u*this.bw;for(var q=(k.p0.y+l*this.bh),v=(k.p0.y+f*this.bh);q<v;q+=(2*b)){g.fillRect(n,q,1,b)}}for(var u=h;u<=d;u+=2){var m=k.p0.y+u*this.bh;for(var q=(k.p0.x+y*this.bw),v=(k.p0.x+w*this.bw);q<v;q+=(2*b)){g.fillRect(q,m,b,1)}}}else{g.lineWidth=1;g.strokeStyle=this.gridcolor;for(var u=x;u<=t;u+=2){if(this.vnop("bdy_"+u,this.NONE)){var n=k.p0.x+u*this.bw+0.5,c=k.p0.y+l*this.bh,a=k.p0.y+f*this.bh;g.strokeLine(n,c,n,a);g.setDashSize(b)}}for(var u=h;u<=d;u+=2){if(this.vnop("bdx_"+u,this.NONE)){var m=k.p0.y+u*this.bh+0.5,r=k.p0.x+y*this.bw,o=k.p0.x+w*this.bw;g.strokeLine(r,m,o,m);g.setDashSize(b)}}}},drawChassis:function(b,i,a,h){this.vinc("chassis","crispEdges");if(b<0){b=0}if(a>2*k.qcols){a=2*k.qcols}if(i<0){i=0}if(h>2*k.qrows){h=2*k.qrows}var d=(k.puzzleid!=="bosanowa"?this.lw:1),f=this.bw,e=this.bh;var c=k.qcols*this.cw,j=k.qrows*this.ch;g.fillStyle="black";if(g.use.canvas){if(b===0){g.fillRect(k.p0.x-d+1,k.p0.y+i*e-d+1,d,(h-i)*e+2*d-2)}if(a===2*k.qcols){g.fillRect(k.p0.x+c,k.p0.y+i*e-d+1,d,(h-i)*e+2*d-2)}if(i===0){g.fillRect(k.p0.x+b*f-d+1,k.p0.y-d+1,(a-b)*f+2*d-2,d)}if(h===2*k.qrows){g.fillRect(k.p0.x+b*f-d+1,k.p0.y+j,(a-b)*f+2*d-2,d)}}else{if(this.vnop("chs1_",this.NONE)){g.fillRect(k.p0.x-d+1,k.p0.y-d+1,d,j+2*d-2)}if(this.vnop("chs2_",this.NONE)){g.fillRect(k.p0.x+c,k.p0.y-d+1,d,j+2*d-2)}if(this.vnop("chs3_",this.NONE)){g.fillRect(k.p0.x-d+1,k.p0.y-d+1,c+2*d-2,d)}if(this.vnop("chs4_",this.NONE)){g.fillRect(k.p0.x-d+1,k.p0.y+j,c+2*d-2,d)}}},drawChassis_ex1:function(t,d,q,b,x){this.vinc("chassis_ex1","crispEdges");if(t<=0){t=bd.minbx}if(q>bd.maxbx){q=bd.maxbx}if(d<=0){d=bd.minby}if(b>bd.maxby){b=bd.maxby}var h=this.lw,j=this.lm,u=this.bw,e=this.bh;var f=k.qcols*this.cw,l=k.qrows*this.ch;g.fillStyle="black";if(g.use.canvas){if(t===bd.minbx){g.fillRect(k.p0.x-this.cw-h+1,k.p0.y+d*e-h+1,h,(b-d)*e+2*h-2)}if(q===bd.maxbx){g.fillRect(k.p0.x+f,k.p0.y+d*e-h+1,h,(b-d)*e+2*h-2)}if(d===bd.minby){g.fillRect(k.p0.x+t*u-h+1,k.p0.y-this.ch-h+1,(q-t)*u+2*h-2,h)}if(b===bd.maxby){g.fillRect(k.p0.x+t*u-h+1,k.p0.y+l,(q-t)*u+2*h-2,h)}}else{if(this.vnop("chsex1_1_",this.NONE)){g.fillRect(k.p0.x-this.cw-h+1,k.p0.y-this.ch-h+1,h,l+this.ch+2*h-2)}if(this.vnop("chsex1_2_",this.NONE)){g.fillRect(k.p0.x+f,k.p0.y-this.ch-h+1,h,l+this.ch+2*h-2)}if(this.vnop("chsex1_3_",this.NONE)){g.fillRect(k.p0.x-this.cw-h+1,k.p0.y-this.ch-h+1,f+this.cw+2*h-2,h)}if(this.vnop("chsex1_4_",this.NONE)){g.fillRect(k.p0.x-this.cw-h+1,k.p0.y+l,f+this.cw+2*h-2,h)}}if(x){if(g.use.canvas){if(t<=0){g.fillRect(k.p0.x-h+1,k.p0.y+d*e-h+1,h,(b-d)*e+h-1)}if(d<=0){g.fillRect(k.p0.x+t*u-h+1,k.p0.y-h+1,(q-t)*u+h-1,h)}}else{if(this.vnop("chs1_",this.NONE)){g.fillRect(k.p0.x-h+1,k.p0.y-h+1,h,l+h-1)}if(this.vnop("chs2_",this.NONE)){g.fillRect(k.p0.x-h+1,k.p0.y-h+1,f+h-1,h)}}}else{if(g.use.canvas){if(t<=0){g.fillRect(k.p0.x,k.p0.y+d*e,1,(b-d)*e)}if(d<=0){g.fillRect(k.p0.x+t*u,k.p0.y,(q-t)*u,1)}}else{if(this.vnop("chs1_",this.NONE)){g.fillRect(k.p0.x,k.p0.y,1,l)}if(this.vnop("chs2_",this.NONE)){g.fillRect(k.p0.x,k.p0.y,f,1)}}var a=["chs1_sub_","chs2_sub_"];var w=bd.cellinside(t-1,d-1,q+1,b+1);for(var o=0;o<w.length;o++){var v=w[o],r=bd.cell[v].bx,p=bd.cell[v].by;var n=bd.cell[v].px,m=bd.cell[v].py;if(r===1){if(bd.cell[v].ques!==51){if(this.vnop(a[0]+p,this.NONE)){g.fillRect(k.p0.x-j,m-j,h,this.ch+h)}}else{this.vhide([a[0]+p])}}if(p===1){if(bd.cell[v].ques!==51){if(this.vnop(a[1]+r,this.NONE)){g.fillRect(n-j,k.p0.x-j,this.cw+h,h)}}else{this.vhide([a[1]+r])}}}}},flushCanvasAll:f_true,flushCanvas:f_true,vnop:f_true,vhide:f_true,vdel:f_true,vinc:f_true,setVectorFunctions:function(){if(g.use.canvas){this.flushCanvasAll=function(b,d,a,c){this.numobj={};base.numparent.innerHTML=""};this.flushCanvas=function(b,d,a,c){g.fillStyle=(!this.bgcolor?"rgb(255, 255, 255)":this.bgcolor);g.fillRect(k.p0.x+b*this.bw,k.p0.y+d*this.bh,(a-b)*this.bw,(c-d)*this.bh)};this.vnop=f_true;this.vhide=f_true;this.vdel=f_true;this.vinc=function(b,a){g.setLayer(b);if(a){g.setRendering(a)}}}else{this.flushCanvasAll=function(b,d,a,c){g.clear();this.zidx=0;this.zidx_array=[];this.numobj={};base.numparent.innerHTML="";this.vinc("board_base","crispEdges");g.fillStyle=(!this.bgcolor?"rgb(255, 255, 255)":this.bgcolor);if(this.vnop("boardfull",this.NONE)){g.fillRect(k.p0.x,k.p0.y,k.qcols*this.cw,k.qrows*this.ch)}};this.flushCanvas=function(b,d,a,c){this.zidx=1};this.vnop=function(a,c){g.vid=a;if(!!g.elements[a]){var d=g.elements[a],b=this.vnop_FILL[c],e=this.vnop_STROKE[c];if(g.use.vml){d.style.display="inline";if(b){d.fillcolor=Camp.parse(g.fillStyle)}if(e){d.strokecolor=Camp.parse(g.strokeStyle)}}else{if(g.use.sl){d.Visibility="Visible";if(b){d.fill=Camp.parse(g.fillStyle)}if(e){d.stroke=Camp.parse(g.strokeStyle)}}else{if(g.use.svg){d.style.display="inline";if(b){d.setAttribute("fill",Camp.parse(g.fillStyle))}if(e){d.setAttribute("stroke",Camp.parse(g.strokeStyle))}}}}return false}return true};this.vhide=function(a){if(typeof a==="string"){a=[a]}for(var b=0;b<a.length;b++){if(g.elements[a[b]]){if(!g.use.sl){g.elements[a[b]].style.display="none"}else{g.elements[a[b]].Visibility="Collapsed"}}}};this.vdel=function(a){for(var b=0;b<a.length;b++){if(g.elements[a[b]]){if(!g.use.sl){g.target.removeChild(g.elements[a[b]])}else{g.elements[a[b]].Visibility="Collapsed"}g.elements[a[b]]=null}}};this.vinc=function(b,a){g.vid="";g.setLayer(b);if(!this.zidx_array[b]){this.zidx++;this.zidx_array[b]=this.zidx;if(a){g.setRendering(a)}if(!g.use.sl){g.getLayerElement().style.zIndex=this.zidx}else{g.getLayerElement()["Canvas.ZIndex"]=this.zidx}}}}},showEL:function(a){this.numobj[a].style.display="inline"},hideEL:function(a){if(!!this.numobj[a]){this.numobj[a].style.display="none"}},dispnum:function(j,e,l,b,c,i,h){if(!this.fillTextPrecisely){if(k.br.IEmoz4){h+=2}var a=this.numobj[j];if(!a){a=this.numobj[j]=ee.createEL(this.EL_NUMOBJ,"")}a.innerHTML=l;var d=mf(this.cw*b*this.fontsizeratio);a.style.fontSize=(""+d+"px");this.showEL(j);var m=a.offsetWidth;var f=a.offsetHeight;if(e===1){i+=2;a.style.left=k.cv_oft.x+i-m/2+"px";a.style.top=k.cv_oft.y+h-f/2+"px"}else{if(e===3||e===4){a.style.left=k.cv_oft.x+i+this.bw-m-1+"px"}else{if(e===2||e===5){a.style.left=k.cv_oft.x+i-this.bw+3+"px"}}if(e===2||e===3){a.style.top=k.cv_oft.y+h+this.bh-f-1+"px"}else{if(e===4||e===5){a.style.top=k.cv_oft.y+h-this.bh+2+"px"}}}a.style.color=c}else{g.font=""+mf(this.cw*b*this.fontsizeratio)+"px 'Serif'";g.fillStyle=c;if(e===1){g.textAlign="center";g.textBaseline="middle"}else{g.textAlign=((e===3||e===4)?"right":"left");g.textBaseline=((e===2||e===3)?"alphabetic":"top");i+=((e===3||e===4)?this.bw-1:-this.bw+2),h+=((e===2||e===3)?this.bh-2:-this.bh+1)}g.fillText(l,i,h)}}};var MouseEvent=function(){this.enableMouse=true;this.inputPos;this.mouseCell;this.inputData;this.firstPos;this.btn={};this.mousereset();this.enableInputHatena=k.isDispHatena;this.inputQuesDirectly=false;this.mouseoffset;if(k.br.IEmoz4){this.mouseoffset=new Pos(2,2)}else{if(k.br.WinWebKit){this.mouseoffset=new Pos(1,1)}else{this.mouseoffset=new Pos(0,0)}}};MouseEvent.prototype={mousereset:function(){this.inputPos=new Pos(-1,-1);this.mouseCell=-1;this.inputData=-1;this.firstPos=new Pos(-1,-1);this.btn={Left:false,Middle:false,Right:false}},e_mousedown:function(a){if(this.enableMouse){this.setButtonFlag(a);if(((kc.isSHIFT)^pp.getVal("lrcheck"))&&(this.btn.Left^this.btn.Right)){this.btn.Left=!this.btn.Left;this.btn.Right=!this.btn.Right}if(this.btn.Middle){this.modeflip()}else{if(ans.errDisp){bd.errclear()}um.newOperation(true);this.setposition(a);this.mousedown()}}ee.stopPropagation(a);ee.preventDefault(a);return false},e_mouseup:function(a){if(this.enableMouse&&!this.btn.Middle&&(this.btn.Left||this.btn.Right)){um.newOperation(false);this.setposition(a);this.mouseup();this.mousereset()}ee.stopPropagation(a);ee.preventDefault(a);return false},e_mousemove:function(a){if(!!menu.movingpop){return true}if(this.enableMouse&&!this.btn.Middle&&(this.btn.Left||this.btn.Right)){um.newOperation(false);this.setposition(a);this.mousemove()}ee.stopPropagation(a);ee.preventDefault(a);return false},e_mouseout:function(a){um.newOperation(false)},mousedown:function(){},mouseup:function(){},mousemove:function(){},setButtonFlag:(((k.br.IE)?function(a){this.btn={Left:(a.button===1),Middle:(a.button===4),Right:(a.button===2)}}:(k.br.WinWebKit)?function(a){this.btn={Left:(a.button===0),Middle:(a.button===1),Right:(a.button===2)}}:(k.br.WebKit)?function(a){this.btn={Left:(a.which===1&&!a.metaKey),Middle:false,Right:(a.which===1&&!!a.metaKey)}}:function(a){this.btn=(!!a.which?{Left:(a.which===1),Middle:(a.which===2),Right:(a.which===3)}:{Left:(a.button===0),Middle:(a.button===1),Right:(a.button===2)})})),setposition:function(a){this.inputPos.x=ee.pageX(a)-k.cv_oft.x-k.p0.x-this.mouseoffset.x;this.inputPos.y=ee.pageY(a)-k.cv_oft.y-k.p0.y-this.mouseoffset.y},notInputted:function(){return !um.changeflag},modeflip:function(){if(k.EDITOR){pp.setVal("mode",(k.playmode?1:3))}},cellid:function(){var a=this.borderpos(0);if(this.inputPos.x%k.cwidth===0||this.inputPos.y%k.cheight===0){return -1}return bd.cnum(a.x,a.y)},crossid:function(){var a=this.borderpos(0.5);return bd.xnum(a.x,a.y)},borderpos:function(d){var c=d*k.cwidth,b=(this.inputPos.x+c+2*k.cwidth),a=(this.inputPos.y+c+2*k.cheight);var f=((b/k.cwidth)|0)*2+((b%k.cwidth<2*c)?0:1)-4;var e=((a/k.cheight)|0)*2+((a%k.cheight<2*c)?0:1)-4;return new Pos(f,e)},borderid:function(e){var h=mf(this.inputPos.x/k.cwidth)*2+1,f=mf(this.inputPos.y/k.cheight)*2+1;var c=this.inputPos.x%k.cwidth,a=this.inputPos.y%k.cheight;if(k.isLineCross){if(!k.isborderAsLine){var d=e*k.cwidth,b=(1-e)*k.cwidth;if((c<d||b<c)&&(a<d||b<a)){return -1}}else{var d=(0.5-e)*k.cwidth,b=(0.5+e)*k.cwidth;if(d<c&&c<b&&d<a&&a<b){return -1}}}if(c<k.cwidth-a){if(c>a){return bd.bnum(h,f-1)}else{return bd.bnum(h-1,f)}}else{if(c>a){return bd.bnum(h+1,f)}else{return bd.bnum(h,f+1)}}return -1},inputcell:function(){var a=this.cellid();if(a==-1||a==this.mouseCell){return}if(this.inputData==-1){this.decIC(a)}this.mouseCell=a;if(k.NumberIsWhite&&bd.QnC(a)!=-1&&(this.inputData==1||(this.inputData==2&&pc.bcolor=="white"))){return}if(k.RBBlackCell&&this.inputData==1){if(this.firstPos.x==-1&&this.firstPos.y==-1){this.firstPos=new Pos(bd.cell[a].bx,bd.cell[a].by)}if((((this.firstPos.x>>1)+(this.firstPos.y>>1))&1)!=(((bd.cell[a].bx>>1)+(bd.cell[a].by>>1))&1)){return}}(this.inputData==1?bd.setBlack:bd.setWhite).apply(bd,[a]);bd.sQsC(a,(this.inputData==2?1:0));pc.paintCell(a)},decIC:function(a){if(pp.getVal("use")==1){if(this.btn.Left){this.inputData=(bd.isWhite(a)?1:0)}else{if(this.btn.Right){this.inputData=((bd.QsC(a)!=1)?2:0)}}}else{if(pp.getVal("use")==2){if(this.btn.Left){if(bd.isBlack(a)){this.inputData=2}else{if(bd.QsC(a)==1){this.inputData=0}else{this.inputData=1}}}else{if(this.btn.Right){if(bd.isBlack(a)){this.inputData=0}else{if(bd.QsC(a)==1){this.inputData=1}else{this.inputData=2}}}}}}},inputqnum:function(){var b=this.cellid();if(b===-1||b===this.mouseCell){return}if(b===tc.getTCC()){b=(k.playmode?(k.NumberWithMB?this.inputqnum3withMB(b):this.inputqnum3(b)):this.inputqnum1(b))}else{var a=tc.getTCC();tc.setTCC(b);pc.paintCell(a)}this.mouseCell=b;pc.paintCell(b)},inputqnum1:function(b){if(k.roomNumber){b=area.getTopOfRoomByCell(b)}var a=bd.nummaxfunc(b);if(this.btn.Left){if(bd.QnC(b)===a){bd.sQnC(b,-1)}else{if(bd.QnC(b)===-1){bd.sQnC(b,(this.enableInputHatena?-2:(k.dispzero?0:1)))}else{if(bd.QnC(b)===-2){bd.sQnC(b,(k.dispzero?0:1))}else{bd.sQnC(b,bd.QnC(b)+1)}}}}else{if(this.btn.Right){if(bd.QnC(b)===-1){bd.sQnC(b,a)}else{if(bd.QnC(b)===-2){bd.sQnC(b,-1)}else{if(bd.QnC(b)===(k.dispzero?0:1)){bd.sQnC(b,(this.enableInputHatena?-2:-1))}else{bd.sQnC(b,bd.QnC(b)-1)}}}}}if(bd.QnC(b)!=-1&&k.NumberIsWhite){bd.sQaC(b,-1);if(pc.bcolor=="white"){bd.sQsC(b,0)}}if(k.isAnsNumber){bd.sQaC(b,-1);bd.sQsC(b,0)}return b},inputqnum3:function(b){if(bd.QnC(b)!==bd.defcell.qnum){return b}var a=bd.nummaxfunc(b);bd.sDiC(b,0);if(this.btn.Left){if(bd.QaC(b)===a){bd.sQaC(b,-1)}else{if(bd.QaC(b)===-1){bd.sQaC(b,(k.dispzero?0:1))}else{bd.sQaC(b,bd.QaC(b)+1)}}}else{if(this.btn.Right){if(bd.QaC(b)===-1){bd.sQaC(b,a)}else{if(bd.QaC(b)===(k.dispzero?0:1)){bd.sQaC(b,-1)}else{bd.sQaC(b,bd.QaC(b)-1)}}}}return b},inputqnum3withMB:function(b){if(bd.QnC(b)!==-1){return b}var a=bd.nummaxfunc(b);if(this.btn.Left){if(bd.QaC(b)===a){bd.sQaC(b,-1);bd.sQsC(b,1)}else{if(bd.QsC(b)===1){bd.sQaC(b,-1);bd.sQsC(b,2)}else{if(bd.QsC(b)===2){bd.sQaC(b,-1);bd.sQsC(b,0)}else{if(bd.QaC(b)===-1){bd.sQaC(b,(k.dispzero?0:1))}else{bd.sQaC(b,bd.QaC(b)+1)}}}}}else{if(this.btn.Right){if(bd.QsC(b)===1){bd.sQaC(b,a);bd.sQsC(b,0)}else{if(bd.QsC(b)===2){bd.sQaC(b,-1);bd.sQsC(b,1)}else{if(bd.QaC(b)===-1){bd.sQaC(b,-1);bd.sQsC(b,2)}else{if(bd.QaC(b)===(k.dispzero?0:1)){bd.sQaC(b,-1)}else{bd.sQaC(b,bd.QaC(b)-1)}}}}}}return b},inputQues:function(e){var d=this.cellid();if(d==-1){return}var a=false;if(d!=tc.getTCC()&&!this.inputQuesDirectly){var c=tc.getTCC();tc.setTCC(d);pc.paintCell(c);a=true}else{if(this.btn.Left){for(var b=0;b<e.length-1;b++){if(!a&&bd.QuC(d)==e[b]){bd.sQuC(d,e[b+1]);a=true}}if(!a&&bd.QuC(d)==e[e.length-1]){bd.sQuC(d,e[0]);a=true}}else{if(this.btn.Right){for(var b=e.length;b>0;b--){if(!a&&bd.QuC(d)==e[b]){bd.sQuC(d,e[b-1]);a=true}}if(!a&&bd.QuC(d)==e[0]){bd.sQuC(d,e[e.length-1]);a=true}}}}if(a){pc.paintCell(d)}},inputMB:function(){var a=this.cellid();if(a==-1){return}if(this.btn.Left){if(bd.QsC(a)==0){bd.sQsC(a,1)}else{if(bd.QsC(a)==1){bd.sQsC(a,2)}else{bd.sQsC(a,0)}}}else{if(this.btn.Right){if(bd.QsC(a)==0){bd.sQsC(a,2)}else{if(bd.QsC(a)==2){bd.sQsC(a,1)}else{bd.sQsC(a,0)}}}}pc.paintCell(a)},inputdirec:function(){var c=this.borderpos(0);if(c.x==this.mouseCell.x&&c.y==this.mouseCell.y){return}var a=0;var b=bd.cnum(this.mouseCell.x,this.mouseCell.y);if(b!=-1&&bd.QnC(b)!=-1){if(c.y-this.mouseCell.y==-2){a=k.UP}else{if(c.y-this.mouseCell.y==2){a=k.DN}else{if(c.x-this.mouseCell.x==-2){a=k.LT}else{if(c.x-this.mouseCell.x==2){a=k.RT}else{return}}}}bd.sDiC(b,(bd.DiC(b)!=a?a:0));pc.paintCell(b)}this.mouseCell=c},inputtile:function(){var h=this.cellid();if(h==-1||h==this.mouseCell||bd.QuC(h)==51){return}if(this.inputData==-1){this.decIC(h)}this.mouseCell=h;var b=area.getRoomID(h);for(var a=0;a<area.room[b].clist.length;a++){var f=area.room[b].clist[a];if(this.inputData==1||bd.QsC(f)!=3){(this.inputData==1?bd.setBlack:bd.setWhite).apply(bd,[f]);bd.sQsC(f,(this.inputData==2?1:0))}}var e=ans.getSizeOfClist(area.room[b].clist,f_true);pc.paintRange(e.x1,e.y1,e.x2,e.y2)},input51:function(){var c=this.borderpos(0);var b=bd.cnum(c.x,c.y);if((c.x==-1&&c.y>bd.minby&&c.y<bd.maxby)||(c.y==-1&&c.x>bd.minbx&&c.x<bd.maxbx)){var a=tc.getTCP();tc.setTCP(new Pos(c.x,c.y));pc.paintPos(a);pc.paintPos(c);return}else{if(b!=-1&&b!=tc.getTCC()){var a=tc.getTCP();tc.setTCC(b);pc.paintPos(a)}else{if(b!=-1){if(this.btn.Left){if(bd.QuC(b)!=51){this.set51cell(b,true)}else{kc.chtarget("shift")}}else{if(this.btn.Right){this.set51cell(b,false)}}}else{return}}}pc.paintCell(b)},set51cell:function(b,a){if(a==true){bd.sQuC(b,51);bd.sQnC(b,0);bd.sDiC(b,0);bd.sQaC(b,-1)}else{bd.sQuC(b,0);bd.sQnC(b,0);bd.sDiC(b,0);bd.sQaC(b,-1)}},inputcross:function(){var b=this.crossid();if(b==-1||b==this.mouseCell){return}if(b==tc.getTXC()){if(this.btn.Left){if(bd.QnX(b)==4){bd.sQnX(b,-2)}else{bd.sQnX(b,bd.QnX(b)+1)}}else{if(this.btn.Right){if(bd.QnX(b)==-2){bd.sQnX(b,4)}else{bd.sQnX(b,bd.QnX(b)-1)}}}}else{var a=tc.getTXC();tc.setTXC(b);pc.paintCross(a)}this.mouseCell=b;pc.paintCross(b)},inputcrossMark:function(){var c=this.borderpos(0.24);if((c.x&1)||(c.y&1)){return}var a=(k.iscross===2?0:2);if(c.x<bd.minbx+a||c.x>bd.maxbx-a||c.y<bd.minby+a||c.y>bd.maxby-a){return}var b=bd.xnum(c.x,c.y);um.disCombine=1;bd.sQnX(b,(bd.QnX(b)==1)?-1:1);um.disCombine=0;pc.paintCross(b)},inputborder:function(){this.inputBD(0)},inputborderans:function(){this.inputBD(1)},inputBD:function(a){var c=this.borderpos(0.35);if(c.x==this.mouseCell.x&&c.y==this.mouseCell.y){return}var b=bd.bnum(c.x,c.y);if(b==-1&&this.mouseCell.x){b=bd.bnum(this.mouseCell.x,this.mouseCell.y)}if(this.mouseCell!=-1&&b!=-1){if((c.x%2==0&&this.mouseCell.x==c.x&&Math.abs(this.mouseCell.y-c.y)==1)||(c.y%2==0&&this.mouseCell.y==c.y&&Math.abs(this.mouseCell.x-c.x)==1)){this.mouseCell=-1;if(this.inputData==-1){this.inputData=(bd.isBorder(b)?0:1)}if(!(k.playmode&&bd.QuB(b)!==0)){if(this.inputData==1){bd.setBorder(b);if(k.isborderAsLine){bd.sQsB(b,0)}}else{if(this.inputData==0){bd.removeBorder(b)}}pc.paintBorder(b)}}}this.mouseCell=c},inputLine:function(){this.inputLine1(0)},inputQsubLine:function(){this.inputLine1(1)},inputLine1:function(a){var c=this.borderpos(0);if(c.x==this.mouseCell.x&&c.y==this.mouseCell.y){return}var b=-1;if(c.y-this.mouseCell.y==-2){b=bd.bnum(this.mouseCell.x,this.mouseCell.y-1)}else{if(c.y-this.mouseCell.y==2){b=bd.bnum(this.mouseCell.x,this.mouseCell.y+1)}else{if(c.x-this.mouseCell.x==-2){b=bd.bnum(this.mouseCell.x-1,this.mouseCell.y)}else{if(c.x-this.mouseCell.x==2){b=bd.bnum(this.mouseCell.x+1,this.mouseCell.y)}}}}this.mouseCell=c;if(this.inputData==2||this.inputData==3){this.inputpeke2(b)}else{if(this.mouseCell!=-1&&b!=-1){if(a==0){this.inputLine2(b)}else{if(a==1){this.inputqsub2(b)}}}}},inputLine2:function(a){if(this.inputData==-1){this.inputData=(bd.isLine(a)?0:1)}if(this.inputData==1){bd.setLine(a)}else{if(this.inputData==0){bd.removeLine(a)}}pc.paintLine(a)},inputqsub2:function(a){if(this.inputData==-1){this.inputData=(bd.QsB(a)==0?1:0)}if(this.inputData==1){bd.sQsB(a,1)}else{if(this.inputData==0){bd.sQsB(a,0)}}pc.paintLine(a)},inputpeke:function(){var b=this.borderpos(0.22);var a=bd.bnum(b.x,b.y);if(a==-1||(b.x==this.mouseCell.x&&b.y==this.mouseCell.y)){return}this.mouseCell=b;this.inputpeke2(a)},inputpeke2:function(a){if(this.inputData==-1){if(bd.QsB(a)==0){this.inputData=2}else{this.inputData=3}}if(this.inputData==2){bd.setPeke(a)}else{if(this.inputData==3){bd.removeLine(a)}}pc.paintLine(a)},dispRed:function(){var a=this.cellid();this.mousereset();if(!bd.isBlack(a)||a==this.mouseCell){return}if(!k.RBBlackCell){bd.sErC(area.bcell[area.bcell.id[a]].clist,1)}else{this.db0(function(b){return(bd.isBlack(b)&&bd.ErC(b)==0)},a,1)}ans.errDisp=true;pc.paintAll()},db0:function(b,e,a){if(bd.ErC(e)!=0){return}bd.sErC([e],a);var d=bd.cell[e].bx,c=bd.cell[e].by;if(b(bd.cnum(d-2,c-2))){this.db0(b,bd.cnum(d-2,c-2),a)}if(b(bd.cnum(d,c-2))){this.db0(b,bd.cnum(d,c-2),a)}if(b(bd.cnum(d+2,c-2))){this.db0(b,bd.cnum(d+2,c-2),a)}if(b(bd.cnum(d-2,c))){this.db0(b,bd.cnum(d-2,c),a)}if(b(bd.cnum(d+2,c))){this.db0(b,bd.cnum(d+2,c),a)}if(b(bd.cnum(d-2,c+2))){this.db0(b,bd.cnum(d-2,c+2),a)}if(b(bd.cnum(d,c+2))){this.db0(b,bd.cnum(d,c+2),a)}if(b(bd.cnum(d+2,c+2))){this.db0(b,bd.cnum(d+2,c+2),a)}return},dispRedLine:function(){var d=this.borderid(0.15);this.mousereset();if(d!=-1&&d==this.mouseCell){return}if(!bd.isLine(d)){var c=(!k.isborderAsLine?this.cellid():this.crossid());if(c==-1||(line.iscrossing(c)&&(line.lcntCell(c)==3||line.lcntCell(c)==4))){return}var b,a;if(k.isbordeAsLine==0){b=(c%k.qcols)*2,a=mf(c/k.qcols)*2}else{b=(c%(k.qcols+1))*2,a=mf(c/(k.qcols+1))*2}d=(function(f,e){if(bd.isLine(bd.bnum(f-1,e))){return bd.bnum(f-1,e)}else{if(bd.isLine(bd.bnum(f+1,e))){return bd.bnum(f+1,e)}else{if(bd.isLine(bd.bnum(f,e-1))){return bd.bnum(f,e-1)}else{if(bd.isLine(bd.bnum(f,e+1))){return bd.bnum(f,e+1)}}}}return -1})(b,a)}if(d==-1){return}bd.sErBAll(2);bd.sErB(line.data[line.data.id[d]].idlist,1);ans.errDisp=true;pc.paintAll()}};KeyEvent=function(){this.enableKey=true;this.isCTRL;this.isALT;this.isSHIFT;this.inUNDO;this.inREDO;this.tcMoved;this.keyPressed;this.ca;this.prev;this.keyreset()};KeyEvent.prototype={keyreset:function(){this.isCTRL=false;this.isALT=false;this.isSHIFT=false;this.inUNDO=false;this.inREDO=false;this.tcMoved=false;this.keyPressed=false;this.prev=-1;this.ca="";if(this.isZ){this.isZ=false}if(this.isX){this.isX=false}},e_keydown:function(a){if(this.enableKey){um.newOperation(true);this.ca=this.getchar(a,this.getKeyCode(a));this.tcMoved=false;if(!this.isZ){bd.errclear()}if(!this.keydown_common(a)){if(this.ca){this.keyinput(this.ca)}this.keyPressed=true}if(this.tcMoved){ee.preventDefault(a);return false}}},e_keyup:function(a){if(this.enableKey){um.newOperation(false);this.ca=this.getchar(a,this.getKeyCode(a));this.keyPressed=false;if(!this.keyup_common(a)){if(this.ca){this.keyup(this.ca)}}}},e_keypress:function(a){if(this.enableKey){um.newOperation(false);this.ca=this.getcharp(a,this.getKeyCode(a));if(this.ca){this.keyinput(this.ca)}}},keyinput:function(a){},keyup:function(a){},getchar:function(b,a){if(b.keyCode==38){return k.KEYUP}else{if(b.keyCode==40){return k.KEYDN}else{if(b.keyCode==37){return k.KEYLT}else{if(b.keyCode==39){return k.KEYRT}else{if(48<=a&&a<=57){return(a-48).toString(36)}else{if(65<=a&&a<=90){return(a-55).toString(36)}else{if(96<=a&&a<=105){return(a-96).toString(36)}else{if(112<=a&&a<=123){return"F"+(a-111).toString(10)}else{if(a==32||a==46){return" "}else{if(a==8){return"BS"}else{if(b.shiftKey){return"shift"}else{return""}}}}}}}}}}}},getcharp:function(b,a){if(a==45){return"-"}else{return""}},getKeyCode:function(a){return !!a.keyCode?a.keyCode:a.charCode},keydown_common:function(b){var a=false;if(!this.isSHIFT&&b.shiftKey){this.isSHIFT=true}if(!this.isCTRL&&b.ctrlKey){this.isCTRL=true;a=true}if(!this.isALT&&b.altKey){this.isALT=true;a=true}if(this.isCTRL&&this.ca=="z"){this.inUNDO=true;a=true;tm.startUndoTimer()}if(this.isCTRL&&this.ca=="y"){this.inREDO=true;a=true;tm.startUndoTimer()}if(this.ca=="F2"&&k.EDITOR){if(k.editmode&&!this.isSHIFT){pp.setVal("mode",3);a=true}else{if(k.playmode&&this.isSHIFT){pp.setVal("mode",1);a=true}}}a=(a||debug.keydown(this.ca));return a},keyup_common:function(b){var a=false;if(this.isSHIFT&&!b.shiftKey){this.isSHIFT=false;a=true}if((this.isCTRL||this.inUNDO||this.inREDO)&&!b.ctrlKey){this.isCTRL=false;a=true;this.inUNDO=false;this.inREDO=false}if(this.isALT&&!b.altKey){this.isALT=false;a=true}if(this.inUNDO&&this.ca=="z"){this.inUNDO=false;a=true}if(this.inREDO&&this.ca=="y"){this.inREDO=false;a=true}return a},moveTCell:function(a){return this.moveTC(a,2)},moveTCross:function(a){return this.moveTC(a,2)},moveTBorder:function(a){return this.moveTC(a,1)},moveTC:function(c,a){var d=tc.getTCP(),b=false;if(c==k.KEYUP&&d.y-a>=tc.miny){tc.decTCY(a);b=true}else{if(c==k.KEYDN&&d.y+a<=tc.maxy){tc.incTCY(a);b=true}else{if(c==k.KEYLT&&d.x-a>=tc.minx){tc.decTCX(a);b=true}else{if(c==k.KEYRT&&d.x+a<=tc.maxx){tc.incTCX(a);b=true}}}}if(b){pc.paintPos(d);pc.paintPos(tc.getTCP());this.tcMoved=true}return b},key_inputcross:function(b){var d=tc.getTXC();var a=bd.nummaxfunc(d);if("0"<=b&&b<="9"){var c=parseInt(b);if(bd.QnX(d)<=0){if(c<=a){bd.sQnX(d,c)}}else{if(bd.QnX(d)*10+c<=a){bd.sQnX(d,bd.QnX(d)*10+c)}else{if(c<=a){bd.sQnX(d,c)}}}}else{if(b=="-"){if(bd.QnX(d)!=-2){bd.sQnX(d,-2)}else{bd.sQnX(d,-1)}}else{if(b==" "){bd.sQnX(d,-1)}else{return}}}pc.paintCross(d)},key_inputqnum:function(b){var d=tc.getTCC();if(k.editmode&&k.roomNumber){d=area.getTopOfRoomByCell(d)}var a=bd.nummaxfunc(d);if("0"<=b&&b<="9"){var c=parseInt(b);if(k.playmode&&k.puzzleid!=="snakes"){bd.sDiC(d,0)}if(bd.getNum(d)<=0||this.prev!=d){if(c<=a){bd.setNum(d,c)}}else{if(bd.getNum(d)*10+c<=a){bd.setNum(d,bd.getNum(d)*10+c)}else{if(c<=a){bd.setNum(d,c)}}}if(bd.QnC(d)!=-1&&k.NumberIsWhite){bd.sQaC(d,-1);if(pc.bcolor=="white"){bd.sQsC(d,0)}}if(k.isAnsNumber){if(k.editmode){bd.sQaC(d,-1)}bd.sQsC(d,0)}}else{if(b=="-"){if(k.editmode&&bd.QnC(d)!=-2){bd.setNum(d,-2)}else{bd.setNum(d,-1)}if(bd.QnC(d)!=-1&&k.NumberIsWhite){bd.sQaC(d,-1);if(pc.bcolor=="white"){bd.sQsC(d,0)}}if(k.isAnsNumber){bd.sQsC(d,0)}}else{if(b==" "){bd.setNum(d,-1);if(bd.QnC(d)!=-1&&k.NumberIsWhite){bd.sQaC(d,-1);if(pc.bcolor=="white"){bd.sQsC(d,0)}}if(k.isAnsNumber){bd.sQsC(d,0)}}else{return}}}this.prev=d;pc.paintCell(d)},key_inputdirec:function(b){if(!this.isSHIFT){return false}var c=tc.getTCC();if(bd.QnC(c)==-1){return false}var a=false;if(b==k.KEYUP){bd.sDiC(c,(bd.DiC(c)!=k.UP?k.UP:0));a=true}else{if(b==k.KEYDN){bd.sDiC(c,(bd.DiC(c)!=k.DN?k.DN:0));a=true}else{if(b==k.KEYLT){bd.sDiC(c,(bd.DiC(c)!=k.LT?k.LT:0));a=true}else{if(b==k.KEYRT){bd.sDiC(c,(bd.DiC(c)!=k.RT?k.RT:0));a=true}}}}if(a){pc.paintPos(tc.getTCP());this.tcMoved=true}return a},inputnumber51:function(b,e){if(this.chtarget(b)){return}var h=tc.getTCC(),d=-1;if(h==-1){d=tc.getTEC()}var f=this.detectTarget(h,d);if(f==-1||(h!=-1&&bd.QuC(h)==51)){if(b=="q"&&h!=-1){mv.set51cell(h,(bd.QuC(h)!=51));pc.paintPos(tc.getTCP());return}}if(f==-1){return}var a=e[f];if("0"<=b&&b<="9"){var c=parseInt(b);if(this.getnum51(h,d,f)<=0||this.prev!=h){if(c<=a){this.setnum51(h,d,f,c)}}else{if(this.getnum51(h,d,f)*10+c<=a){this.setnum51(h,d,f,this.getnum51(h,d,f)*10+c)}else{if(c<=a){this.setnum51(h,d,f,c)}}}}else{if(b=="-"||b==" "){this.setnum51(h,d,f,-1)}else{return}}this.prev=h;if(h!=-1){pc.paintCell(tc.getTCC())}else{pc.paintPos(tc.getTCP())}},setnum51:function(d,a,b,c){if(d!=-1){(b==2?bd.sQnC(d,c):bd.sDiC(d,c))}else{(b==2?bd.sQnE(a,c):bd.sDiE(a,c))}},getnum51:function(c,a,b){if(c!=-1){return(b==2?bd.QnC(c):bd.DiC(c))}else{return(b==2?bd.QnE(a):bd.DiE(a))}},chtarget:function(a){if(a!="shift"){return false}if(tc.targetdir==2){tc.targetdir=4}else{tc.targetdir=2}pc.paintCell(tc.getTCC());return true},detectTarget:function(b,a){if((b==-1&&a==-1)||(b!=-1&&bd.QuC(b)!=51)){return -1}if(b==bd.cellmax-1||a==k.qcols+k.qrows){return -1}if(b!=-1){if((bd.rt(b)==-1||bd.QuC(bd.rt(b))==51)&&(bd.dn(b)==-1||bd.QuC(bd.dn(b))==51)){return -1}else{if(bd.rt(b)==-1||bd.QuC(bd.rt(b))==51){return 4}else{if(bd.dn(b)==-1||bd.QuC(bd.dn(b))==51){return 2}}}}else{if(a!=-1){if((bd.excell[a].by===-1&&bd.QuC(bd.cnum(bd.excell[a].bx,1))===51)||(bd.excell[a].bx===-1&&bd.QuC(bd.cnum(1,bd.excell[a].by))===51)){return -1}else{if(bd.excell[a].by===-1){return 4}else{if(bd.excell[a].bx===-1){return 2}}}}}return tc.targetdir}};KeyPopup=function(){this.ctl={1:{el:null,enable:false,target:k.CELL},3:{el:null,enable:false,target:k.CELL}};this.tdcolor="black";this.imgCR=[1,1];this.tds=[];this.imgs=[];this.defaultdisp=false;this.tbodytmp=null,this.trtmp=null;this.ORIGINAL=99;this.EL_KPNUM=ee.addTemplate("","td",{unselectable:"on",className:"kpnum"},null,null);this.EL_KPEMPTY=ee.addTemplate("","td",{unselectable:"on"},null,null);this.EL_KPIMG=ee.addTemplate("","td",{unselectable:"on",className:"kpimgcell"},null,null);this.EL_KPIMG_DIV=ee.addTemplate("","div",{unselectable:"on",className:"kpimgdiv"},null,null);this.EL_KPIMG_IMG=ee.addTemplate("","img",{unselectable:"on",className:"kpimg",src:"./src/img/"+k.puzzleid+"_kp.gif"},null,null)};KeyPopup.prototype={kpinput:function(a){},enabled:function(){return pp.getVal("keypopup")},generate:function(b,a,d,c){if(a&&k.EDITOR){this.gentable(1,b,c)}if(d){this.gentable(3,b,c)}},gentable:function(d,a,c){this.ctl[d].enable=true;this.ctl[d].el=ee("keypopup"+d).el;this.ctl[d].el.onmouseout=ee.ebinder(this,this.hide);var b=_doc.createElement("table");b.cellSpacing="2pt";this.ctl[d].el.appendChild(b);this.tbodytmp=_doc.createElement("tbody");b.appendChild(this.tbodytmp);this.trtmp=null;if(c){c.apply(kp,[d])}else{if(a==0||a==3){this.gentable10(d,a)}else{if(a==1||a==2||a==4){this.gentable4(d,a)}}}},gentable10:function(b,a){this.inputcol("num","knum0","0","0");this.inputcol("num","knum1","1","1");this.inputcol("num","knum2","2","2");this.inputcol("num","knum3","3","3");this.insertrow();this.inputcol("num","knum4","4","4");this.inputcol("num","knum5","5","5");this.inputcol("num","knum6","6","6");this.inputcol("num","knum7","7","7");this.insertrow();this.inputcol("num","knum8","8","8");this.inputcol("num","knum9","9","9");this.inputcol("num","knum_"," "," ");if(a==0){(b==1)?this.inputcol("num","knum.","-","?"):this.inputcol("empty","knum.","","")}else{if(a==3){this.inputcol("num","knum.","-"," ")}}this.insertrow()},gentable4:function(c,b,a){this.inputcol("num","knum0","0","0");this.inputcol("num","knum1","1","1");this.inputcol("num","knum2","2","2");this.inputcol("num","knum3","3","3");this.insertrow();this.inputcol("num","knum4","4","4");this.inputcol("empty","knumx","","");this.inputcol("num","knum_"," "," ");if(b==1){(c==1)?this.inputcol("num","knum.","-","?"):this.inputcol("empty","knum.","","")}else{if(b==2){this.inputcol("num","knum.","-","¡")}else{if(b==4){this.inputcol("num","knum.","-","›")}}}this.insertrow()},inputcol:function(f,h,b,c){if(!this.trtmp){this.trtmp=_doc.createElement("tr")}var e=null;if(f==="num"){e=ee.createEL(this.EL_KPNUM,h);e.style.color=this.tdcolor;e.innerHTML=c;e.onclick=ee.ebinder(this,this.inputnumber,[b])}else{if(f==="empty"){e=ee.createEL(this.EL_KPEMPTY,"")}else{if(f==="image"){var d=ee.createEL(this.EL_KPIMG_IMG,""+h+"_i");var a=ee.createEL(this.EL_KPIMG_DIV,"");a.appendChild(d);e=ee.createEL(this.EL_KPIMG,h);e.onclick=ee.ebinder(this,this.inputnumber,[b]);e.appendChild(a);this.imgs.push({el:d,x:c[0],y:c[1]})}}}if(e){this.tds.push(e);this.trtmp.appendChild(e)}},insertrow:function(){if(this.trtmp){this.tbodytmp.appendChild(this.trtmp);this.trtmp=null}},display:function(){var b=pp.getVal("mode");if(this.ctl[b].el&&this.ctl[b].enable&&pp.getVal("keypopup")&&mv.btn.Left){this.ctl[b].el.style.left=k.cv_oft.x+mv.inputPos.x-3+"px";this.ctl[b].el.style.top=k.cv_oft.y+mv.inputPos.y-3+"px";this.ctl[b].el.style.zIndex=100;if(this.ctl[b].target==k.CELL){var a=tc.getTCC();var c=mv.cellid();if(c==-1){return}tc.setTCC(c);pc.paintCell(c);pc.paintCell(a)}else{if(this.ctl[b].target==k.CROSS){var a=tc.getTXC();var c=mv.crossid();if(c==-1){return}tc.setTXC(c);pc.paintCross(c);pc.paintCross(a)}}this.ctl[b].el.style.display="block"}},inputnumber:function(b,a){this.kpinput(a);this.ctl[pp.getVal("mode")].el.style.display="none"},hide:function(a){var b=pp.getVal("mode");if(!!this.ctl[b].el&&!menu.insideOf(this.ctl[b].el,a)){this.ctl[b].el.style.display="none"}},resize:function(){var d=function(e,f){e.style.width=""+mf(f*0.9)+"px";e.style.height=""+mf(f*0.9)+"px";e.style.fontSize=""+mf(f*0.7)+"px"};var c=function(e,f){e.el.style.width=""+(f*kp.imgCR[0])+"px";e.el.style.height=""+(f*kp.imgCR[1])+"px";e.el.style.clip="rect("+(f*e.y+1)+"px,"+(f*(e.x+1))+"px,"+(f*(e.y+1))+"px,"+(f*e.x+1)+"px)";e.el.style.top="-"+(e.y*f+1)+"px";e.el.style.left="-"+(e.x*f+1)+"px"};if(k.cellsize>=24){for(var b=0,a=this.tds.length;b<a;b++){d(this.tds[b],k.cellsize)}for(var b=0,a=this.imgs.length;b<a;b++){c(this.imgs[b],mf(k.cellsize*0.9))}}else{for(var b=0,a=this.tds.length;b<a;b++){d(this.tds[b],22)}for(var b=0,a=this.imgs.length;b<a;b++){c(this.imgs[b],18)}}}};TCell=function(){this.cursorx=1;this.cursory=1;this.minx=1;this.miny=1;this.maxx=2*k.qcols-1;this.maxy=2*k.qrows-1;this.crosstype=false};TCell.prototype={adjust:function(){if(this.crosstype){this.minx=0;this.miny=0;this.maxx=2*k.qcols;this.maxy=2*k.qrows}else{var b=(k.isexcell===1||k.isexcell===2);var a=(k.isexcell===2);this.minx=(!b?1:-1);this.miny=(!b?1:-1);this.maxx=(!a?2*k.qcols-1:2*k.qcols+1);this.maxy=(!a?2*k.qrows-1:2*k.qrows+1)}if(this.cursorx<this.minx){this.cursorx=this.minx}if(this.cursory<this.miny){this.cursory=this.miny}if(this.cursorx>this.maxx){this.cursorx=this.maxx}if(this.cursory>this.maxy){this.cursory=this.maxy}},setAlign:function(){},setCrossType:function(){this.crosstype=true;this.adjust();this.setTCP(new Pos(0,0))},incTCX:function(a){this.cursorx+=a},incTCY:function(a){this.cursory+=a},decTCX:function(a){this.cursorx-=a},decTCY:function(a){this.cursory-=a},getTCP:function(){return new Pos(this.cursorx,this.cursory)},setTCP:function(a){if(a.x<this.minx||this.maxx<a.x||a.y<this.miny||this.maxy<a.y){return}this.cursorx=a.x;this.cursory=a.y},getTCC:function(){return bd.cnum(this.cursorx,this.cursory)},setTCC:function(a){if(a<0||bd.cellmax<=a){return}this.cursorx=bd.cell[a].bx;this.cursory=bd.cell[a].by},getTXC:function(){return bd.xnum(this.cursorx,this.cursory)},setTXC:function(a){if(!k.iscross||a<0||bd.crossmax<=a){return}this.cursorx=bd.cross[a].bx;this.cursory=bd.cross[a].by},getTBC:function(){return bd.bnum(this.cursorx,this.cursory)},setTBC:function(a){if(!k.isborder||a<0||bd.bdmax<=a){return}this.cursorx=bd.border[a].bx;this.cursory=bd.border[a].by},getTEC:function(){return bd.exnum(this.cursorx,this.cursory)},setTEC:function(a){if(!k.isexcell||a<0||bd.excellmax<=a){return}this.cursorx=bd.excell[a].bx;this.cursory=bd.excell[a].by}};Encode=function(){this.uri={};this.uri.type;this.uri.qdata;this.uri.pflag;this.uri.cols;this.uri.rows;this.uri.bstr;this.pidKanpen="";this.pidforURL="";this.outpflag="";this.outsize="";this.outbstr="";this.PZPRV3=0;this.PZPRV3E=3;this.PAPRAPP=1;this.KANPEN=2;this.KANPENP=5;this.HEYAAPP=4};Encode.prototype={init:function(){this.uri.type=this.PZPRV3;this.uri.qdata="";this.uri.pflag="";this.uri.cols=0;this.uri.rows=0;this.uri.bstr="";this.outpflag="";this.outsize="";this.outbstr=""},first_parseURI:function(c){if(c.length<=0){return""}this.init();var d="PLAYER";if(c=="?test"){d="TEST";c="country"}else{if(c.match(/^\?m\+/)){d="EDITOR";c=c.substr(3)}else{if(c.match(/_test/)){d="TEST";c=c.substr(1).replace(/_test/,"")}else{if(c.match(/_edit/)){d="EDITOR";c=c.substr(1).replace(/_edit/,"")}else{if(!c.match(/\//)){d="EDITER";c=c.substr(1)}else{d="PLAYER";c=c.substr(1)}}}}}switch(d){case"PLAYER":k.EDITOR=false;k.editmode=false;break;case"EDITOR":k.EDITOR=true;k.editmode=true;break;case"TEST":k.EDITOR=true;k.editmode=false;k.scriptcheck=true;break}k.PLAYER=!k.EDITOR;k.playmode=!k.editmode;var a=c.indexOf("/");if(a>=0){this.parseURI_pzpr(c.substr(a+1));if(!!this.uri.cols){k.qcols=this.uri.cols}if(!!this.uri.rows){k.qrows=this.uri.rows}c=c.substr(0,a)}var b=c;switch(b){case"yajilin":this.pidforURL="yajilin";b="yajirin";break;case"akari":this.pidforURL="akari";b="lightup";break;case"bijutsukan":this.pidforURL="akari";b="lightup";break;case"slitherlink":this.pidforURL=b="slither";break;case"numberlink":this.pidforURL=b="numlin";break;case"hakyukoka":this.pidforURL=b="ripple";break;case"masyu":this.pidforURL=b="mashu";break;default:this.pidforURL=b}k.puzzleid=b},parseURI:function(a){this.init();a=a.replace(/(\r|\n)/g,"");if(a.match(/www\.kanpen\.net/)||a.match(/www\.geocities(\.co)?\.jp\/pencil_applet/)){if(a.indexOf("?heyawake=")>=0){this.parseURI_heyaapp(a.substr(a.indexOf("?heyawake=")+10))}else{if(a.indexOf("?pzpr=")>=0){this.parseURI_pzpr(a.substr(a.indexOf("?pzpr=")+6))}else{this.parseURI_kanpen(a.substr(a.indexOf("?problem=")+9))}}}else{if(a.match(/www\.geocities(\.co)?\.jp\/heyawake/)){this.parseURI_heyaapp(a.substr(a.indexOf("?problem=")+9))}else{if(a.match(/\/(sa|sc)\/pzpr\/v3/)){this.parseURI_pzpr(a.substr(a.indexOf("?")));this.uri.type=this.PZPRAPP}else{this.parseURI_pzpr(a.substr(a.indexOf("/",a.indexOf("?"))+1))}}}},parseURI_pzpr:function(a){this.uri.type=this.PZPRV3;this.uri.qdata=a;var b=a.split("/");if(!isNaN(parseInt(b[0]))){b.unshift("")}this.uri.pflag=b.shift();this.uri.cols=parseInt(b.shift());this.uri.rows=parseInt(b.shift());this.uri.bstr=b.join("/")},parseURI_kanpen:function(a){this.uri.type=this.KANPEN;this.uri.qdata=a;var b=a.split("/");if(k.puzzleid=="sudoku"){this.uri.rows=this.uri.cols=parseInt(b.shift())}else{this.uri.rows=parseInt(b.shift());this.uri.cols=parseInt(b.shift());if(k.puzzleid=="kakuro"){this.uri.rows--;this.uri.cols--}}this.uri.bstr=b.join("/")},parseURI_heyaapp:function(a){this.uri.type=this.HEYAAPP;this.uri.qdata=a;var c=a.split("/");var b=c.shift().split("x");this.uri.cols=parseInt(b[0]);this.uri.rows=parseInt(b[1]);this.uri.bstr=c.join("/")},checkpflag:function(a){return(this.uri.pflag.indexOf(a)>=0)},pzlinput:function(){if(this.uri.cols&&this.uri.rows){bd.initBoardSize(this.uri.cols,this.uri.rows)}if(this.uri.bstr){um.disableRecord();um.disableInfo();switch(this.uri.type){case this.PZPRV3:case this.PZPRAPP:case this.PZPRV3E:this.outbstr=this.uri.bstr;this.pzlimport(this.uri.type);break;case this.KANPEN:fio.lineseek=0;fio.dataarray=this.uri.bstr.replace(/_/g," ").split("/");this.decodeKanpen();break;case this.HEYAAPP:this.decodeHeyaApp();break}um.enableRecord();um.enableInfo();bd.ansclear();base.resetInfo(true);if(!base.initProcess){base.resize_canvas()}}},pzloutput:function(b){if(b===this.KANPEN&&k.puzzleid=="lits"){b=this.KANPENP}var c="",a="",d=false;this.outpflag="";this.outsize="";this.outbstr="";switch(b){case this.PZPRV3:case this.PZPRV3E:this.pzlexport(this.PZPRV3);a=(!this.outsize?[k.qcols,k.qrows].join("/"):this.outsize);d=(!!this.outpflag);break;case this.PZPRAPP:case this.KANPENP:this.pzlexport(this.PZPRAPP);a=(!this.outsize?[k.qcols,k.qrows].join("/"):this.outsize);d=true;break;case this.KANPEN:fio.datastr="";this.encodeKanpen();this.outbstr=fio.datastr.replace(/ /g,"_");a=(!this.outsize?[k.qrows,k.qcols].join("/"):this.outsize);break;case this.HEYAAPP:this.encodeHeyaApp();a=[k.qcols,k.qrows].join("x");break;default:return""}if(d){c=[this.outpflag,a,this.outbstr].join("/")}else{c=[a,this.outbstr].join("/")}return this.getURLBase(b)+c},getURLBase:function(a){var b={};b[this.PZPRV3]="http://indi.s58.xrea.com/pzpr/v3/p.html?%PID%/";b[this.PZPRV3E]="http://indi.s58.xrea.com/pzpr/v3/p.html?%PID%_edit/";b[this.PZPRAPP]="http://indi.s58.xrea.com/%PID%/sa/q.html?";b[this.KANPEN]="http://www.kanpen.net/%KID%.html?problem=";b[this.KANPENP]="http://www.kanpen.net/%KID%.html?pzpr=";b[this.HEYAAPP]="http://www.geocities.co.jp/heyawake/?problem=";return b[a].replace("%PID%",this.pidforURL).replace("%KID%",this.pidKanpen)},pzlimport:function(b,a){},pzlexport:function(a){},decodeKanpen:function(){},encodeKanpen:function(){},decodeHeyaApp:function(a){},encodeHeyaApp:function(){},decode4Cell:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","4")){bd.sQnC(e,parseInt(a,16));e++}else{if(this.include(a,"5","9")){bd.sQnC(e,parseInt(a,16)-5);e+=2}else{if(this.include(a,"a","e")){bd.sQnC(e,parseInt(a,16)-10);e+=3}else{if(this.include(a,"g","z")){e+=(parseInt(a,36)-15)}else{if(a=="."){bd.sQnC(e,-2);e++}}}}}if(e>=bd.cellmax){break}}this.outbstr=b.substr(d+1)},encode4Cell:function(){var d=0,a="";for(var c=0;c<bd.cellmax;c++){var b="";if(bd.QnC(c)>=0){if(c<bd.cellmax-1&&(bd.QnC(c+1)>=0||bd.QnC(c+1)==-2)){b=""+bd.QnC(c).toString(16)}else{if(c<bd.cellmax-2&&(bd.QnC(c+2)>=0||bd.QnC(c+2)==-2)){b=""+(5+bd.QnC(c)).toString(16);c++}else{b=""+(10+bd.QnC(c)).toString(16);c+=2}}}else{if(bd.QnC(c)==-2){b="."}else{b=" ";d++}}if(d==0){a+=b}else{if(b!=" "){a+=((d+15).toString(36)+b);d=0}else{if(d==20){a+="z";d=0}}}}if(d>0){a+=((d+15).toString(36))}this.outbstr+=a},decode4Cross:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","4")){bd.sQnX(e,parseInt(a,16));e++}else{if(this.include(a,"5","9")){bd.sQnX(e,parseInt(a,16)-5);e+=2}else{if(this.include(a,"a","e")){bd.sQnX(e,parseInt(a,16)-10);e+=3}else{if(this.include(a,"g","z")){e+=(parseInt(a,36)-15)}else{if(a=="."){bd.sQnX(e,-2);e++}}}}}if(e>=bd.crossmax){break}}this.outbstr=b.substr(d+1)},encode4Cross:function(){var d=0,a="";for(var c=0;c<bd.crossmax;c++){var b="";if(bd.QnX(c)>=0){if(c<bd.crossmax-1&&(bd.QnX(c+1)>=0||bd.QnX(c+1)==-2)){b=""+bd.QnX(c).toString(16)}else{if(c<bd.crossmax-2&&(bd.QnX(c+2)>=0||bd.QnX(c+2)==-2)){b=""+(5+bd.QnX(c)).toString(16);c++}else{b=""+(10+bd.QnX(c)).toString(16);c+=2}}}else{if(bd.QnX(c)==-2){b="."}else{b=" ";d++}}if(d==0){a+=b}else{if(b!=" "){a+=((d+15).toString(36)+b);d=0}else{if(d==20){a+="z";d=0}}}}if(d>0){a+=((d+15).toString(36))}this.outbstr+=a},decodeNumber10:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","9")){bd.sQnC(e,parseInt(b.substr(d,1),10));e++}else{if(this.include(a,"a","z")){e+=(parseInt(a,36)-9)}else{if(a=="."){bd.sQnC(e,-2);e++}else{e++}}}if(e>bd.cellmax){break}}this.outbstr=b.substr(d)},encodeNumber10:function(){var a="",c=0;for(var b=0;b<bd.cellmax;b++){pstr="";var d=bd.QnC(b);if(d==-2){pstr="."}else{if(d>=0&&d<10){pstr=d.toString(10)}else{c++}}if(c==0){a+=pstr}else{if(pstr||c==26){a+=((9+c).toString(36)+pstr);c=0}}}if(c>0){a+=(9+c).toString(36)}this.outbstr+=a},decodeNumber16:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","9")||this.include(a,"a","f")){bd.sQnC(e,parseInt(b.substr(d,1),16));e++}else{if(a=="."){bd.sQnC(e,-2);e++}else{if(a=="-"){bd.sQnC(e,parseInt(b.substr(d+1,2),16));e++;d+=2}else{if(a=="+"){bd.sQnC(e,parseInt(b.substr(d+1,3),16));e++;d+=3}else{if(a=="="){bd.sQnC(e,parseInt(b.substr(d+1,3),16)+4096);e++;d+=3}else{if(a=="%"){bd.sQnC(e,parseInt(b.substr(d+1,3),16)+8192);e++;d+=3}else{if(a>="g"&&a<="z"){e+=(parseInt(a,36)-15)}else{e++}}}}}}}if(e>bd.cellmax){break}}this.outbstr=b.substr(d)},encodeNumber16:function(){var c=0,a="";for(var b=0;b<bd.cellmax;b++){pstr="";var d=bd.QnC(b);if(d==-2){pstr="."}else{if(d>=0&&d<16){pstr=d.toString(16)}else{if(d>=16&&d<256){pstr="-"+d.toString(16)}else{if(d>=256&&d<4096){pstr="+"+d.toString(16)}else{if(d>=4096&&d<8192){pstr="="+(d-4096).toString(16)}else{if(d>=8192){pstr="%"+(d-8192).toString(16)}else{c++}}}}}}if(c==0){a+=pstr}else{if(pstr||c==20){a+=((15+c).toString(36)+pstr);c=0}}}if(c>0){a+=(15+c).toString(36)}this.outbstr+=a},decodeRoomNumber16:function(){area.resetRarea();var d=1,c=0,b=this.outbstr;for(c=0;c<b.length;c++){var a=b.charAt(c);if(this.include(a,"0","9")||this.include(a,"a","f")){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c,1),16));d++}else{if(a=="-"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,2),16));d++;c+=2}else{if(a=="+"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16));d++;c+=3}else{if(a=="="){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16)+4096);d++;c+=3}else{if(a=="%"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16)+8192);d++;c+=3}else{if(a=="*"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16)+12240);d++;c+=4}else{if(a=="$"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16)+77776);d++;c+=5}else{if(a>="g"&&a<="z"){d+=(parseInt(a,36)-15)}else{d++}}}}}}}}if(d>area.room.max){break}}this.outbstr=b.substr(c)},encodeRoomNumber16:function(){area.resetRarea();var d=0,a="";for(var c=1;c<=area.room.max;c++){var b="";var e=bd.QnC(area.getTopOfRoom(c));if(e>=0&&e<16){b=e.toString(16)}else{if(e>=16&&e<256){b="-"+e.toString(16)}else{if(e>=256&&e<4096){b="+"+e.toString(16)}else{if(e>=4096&&e<8192){b="="+(e-4096).toString(16)}else{if(e>=8192&&e<12240){b="%"+(e-8192).toString(16)}else{if(e>=12240&&e<77776){b="*"+(e-12240).toString(16)}else{if(e>=77776){b="$"+(e-77776).toString(16)}else{d++}}}}}}}if(d==0){a+=b}else{if(b||d==20){a+=((15+d).toString(36)+b);d=0}}}if(d>0){a+=(15+d).toString(36)}this.outbstr+=a},decodeArrowNumber16:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(a=="0"){if(b.charAt(d+1)=="."){bd.sQnC(e,-2);e++;d++}else{bd.sQnC(e,parseInt(b.substr(d+1,1),16));e++;d++}}else{if(a=="5"){bd.sQnC(e,parseInt(b.substr(d+1,2),16));e++;d+=2}else{if(this.include(a,"1","4")){bd.sDiC(e,parseInt(a,16));if(b.charAt(d+1)!="."){bd.sQnC(e,parseInt(b.substr(d+1,1),16))}else{bd.sQnC(e,-2)}e++;d++}else{if(this.include(a,"6","9")){bd.sDiC(e,parseInt(a,16)-5);bd.sQnC(e,parseInt(b.substr(d+1,2),16));e++;d+=2}else{if(a>="a"&&a<="z"){e+=(parseInt(a,36)-9)}else{e++}}}}}if(e>bd.cellmax){break}}this.outbstr=b.substr(d)},encodeArrowNumber16:function(){var a="",d=0;for(var e=0;e<bd.cellmax;e++){var b="";if(bd.QnC(e)!=-1){if(bd.QnC(e)==-2){b=((bd.DiC(e)==0?0:bd.DiC(e))+".")}else{if(bd.QnC(e)<16){b=((bd.DiC(e)==0?0:bd.DiC(e))+bd.QnC(e).toString(16))}else{if(bd.QnC(e)<256){b=((bd.DiC(e)==0?5:bd.DiC(e)+5)+bd.QnC(e).toString(16))}}}}else{b=" ";d++}if(d==0){a+=b}else{if(b!=" "){a+=((d+9).toString(36)+b);d=0}else{if(d==26){a+="z";d=0}}}}if(d>0){a+=(d+9).toString(36)}this.outbstr+=a},decodeBorder:function(){var f,e,c=this.outbstr;if(c){f=Math.min(mf(((k.qcols-1)*k.qrows+4)/5),c.length);e=Math.min(mf((k.qcols*(k.qrows-1)+4)/5)+f,c.length)}else{f=0;e=0}for(var d=0;d<f;d++){var b=parseInt(c.charAt(d),32);for(var a=0;a<5;a++){if(d*5+a<(k.qcols-1)*k.qrows){bd.sQuB(d*5+a,(b&Math.pow(2,4-a)?1:0))}}}var h=(k.qcols-1)*k.qrows;for(var d=0;d<e-f;d++){var b=parseInt(c.charAt(d+f),32);for(var a=0;a<5;a++){if(d*5+a<k.qcols*(k.qrows-1)){bd.sQuB(d*5+a+h,(b&Math.pow(2,4-a)?1:0))}}}area.resetRarea();this.outbstr=c.substr(e)},encodeBorder:function(){var b,d;var a="";b=0;d=0;for(var c=0;c<(k.qcols-1)*k.qrows;c++){if(bd.QuB(c)==1){d+=Math.pow(2,4-b)}b++;if(b==5){a+=d.toString(32);b=0;d=0}}if(b>0){a+=d.toString(32)}b=0;d=0;for(var c=(k.qcols-1)*k.qrows;c<bd.bdinside;c++){if(bd.QuB(c)==1){d+=Math.pow(2,4-b)}b++;if(b==5){a+=d.toString(32);b=0;d=0}}if(b>0){a+=d.toString(32)}this.outbstr+=a},decodeCrossMark:function(){var f=-1,c=0,b=this.outbstr;for(c=0;c<b.length;c++){var a=b.charAt(c);if(this.include(a,"0","9")||this.include(a,"a","z")){f+=(parseInt(a,36)+1);var e=(k.iscross===2?f%(k.qcols+1):f%(k.qcols-1)+1)*2;var d=(k.iscross===2?mf(f/(k.qcols+1)):mf(f/(k.qcols-1))+1)*2;if(d>=bd.maxby+(k.iscross===2?2:0)){c++;break}bd.sQnX(bd.xnum(e,d),1)}else{if(a=="."){f+=36}else{f++}}if(f>=(k.iscross==2?(k.qcols+1)*(k.qrows+1):(k.qcols-1)*(k.qrows-1))-1){c++;break}}this.outbstr=b.substr(c)},encodeCrossMark:function(){var a="",d=0;for(var c=0;c<(k.iscross===2?(k.qcols+1)*(k.qrows+1):(k.qcols-1)*(k.qrows-1));c++){var b="";var f=(k.iscross===2?c%(k.qcols+1):c%(k.qcols-1)+1)*2;var e=(k.iscross===2?mf(c/(k.qcols+1)):mf(c/(k.qcols-1))+1)*2;if(bd.QnX(bd.xnum(f,e))==1){b="."}else{b=" ";d++}if(b!=" "){a+=d.toString(36);d=0}else{if(d==36){a+=".";d=0}}}if(d>0){a+=d.toString(36)}this.outbstr+=a},decodeCircle41_42:function(){var c=this.outbstr;var e=c?Math.min(mf((k.qcols*k.qrows+2)/3),c.length):0;for(var d=0;d<e;d++){var b=parseInt(c.charAt(d),27);for(var a=0;a<3;a++){if(d*3+a<k.qcols*k.qrows){if(mf(b/Math.pow(3,2-a))%3==1){bd.sQuC(d*3+a,41)}else{if(mf(b/Math.pow(3,2-a))%3==2){bd.sQuC(d*3+a,42)}}}}}this.outbstr=c.substr(e)},encodeCircle41_42:function(){var a="",b=0,d=0;for(var c=0;c<bd.cellmax;c++){if(bd.QuC(c)==41){d+=(Math.pow(3,2-b))}else{if(bd.QuC(c)==42){d+=(2*Math.pow(3,2-b))}}b++;if(b==3){a+=d.toString(27);b=0;d=0}}if(b>0){a+=d.toString(27)}this.outbstr+=a},decodecross_old:function(){var a=this.outbstr;for(var c=0;c<Math.min(a.length,bd.crossmax);c++){if(a.charAt(c)=="0"){bd.sQnX(c,0)}else{if(a.charAt(c)=="1"){bd.sQnX(c,1)}else{if(a.charAt(c)=="2"){bd.sQnX(c,2)}else{if(a.charAt(c)=="3"){bd.sQnX(c,3)}else{if(a.charAt(c)=="4"){bd.sQnX(c,4)}else{bd.sQnX(c,-1)}}}}}}for(var b=a.length;b<bd.crossmax;b++){bd.sQnX(b,-1)}this.outbstr=a.substr(c)},include:function(b,c,a){if(c<=b&&b<=a){return true}return false}};FileIO=function(){this.filever=0;this.lineseek=0;this.dataarray=[];this.datastr="";this.urlstr="";this.PZPR=1;this.PBOX=2;this.dbm=new DataBaseManager()};FileIO.prototype={filedecode:function(c){this.filever=0;this.lineseek=0;this.dataarray=c.split("/");var b=this.PZPR;if(this.readLine().match(/pzprv3\.?(\d+)?/)){if(RegExp.$1){this.filever=parseInt(RegExp.$1)}if(this.readLine()!=k.puzzleid){alert(base.getPuzzleName()+"‚Ìƒtƒ@ƒCƒ‹‚Å‚Í‚ ‚è‚Ü‚¹‚ñB");return}b=this.PZPR}else{this.lineseek=0;b=this.PBOX}var d,a;if(k.puzzleid!=="sudoku"){d=parseInt(this.readLine(),10);a=parseInt(this.readLine(),10);if(b===2&&k.puzzleid==="kakuro"){d--;a--}}else{d=a=parseInt(this.readLine(),10)}if(d<=0||a<=0){return}bd.initBoardSize(a,d);um.disableRecord();um.disableInfo();if(b===1){this.decodeData()}else{if(b===2){this.kanpenOpen()}}um.enableRecord();um.enableInfo();this.dataarray=null;base.resetInfo(true);base.resize_canvas()},fileencode:function(b){this.filever=0;this.sizestr="";this.datastr="";this.urlstr="";if(b===this.PZPR){this.encodeData()}else{if(b===this.PBOX){this.kanpenSave()}}if(!this.sizestr){this.sizestr=[k.qrows,k.qcols].join("/")}this.datastr=[this.sizestr,this.datastr].join("/");if(b===1){var c=(this.filever===0?"pzprv3":("pzprv3."+this.filever));this.datastr=[c,k.puzzleid,this.datastr].join("/")}var a=this.datastr;if(b===1){this.urlstr=enc.pzloutput((!k.isKanpenExist||k.puzzleid==="lits")?enc.PZPRV3:enc.KANPEN)}return a},readLine:function(){this.lineseek++;return this.dataarray[this.lineseek-1]},readLines:function(a){this.lineseek+=a;return this.dataarray.slice(this.lineseek-a,this.lineseek)},getItemList:function(f){var d=[];var j=this.readLines(f);for(var a=0;a<j.length;a++){var e=j[a].split(" ");var b=[];for(var h=0;h<e.length;h++){if(e[h]!=""){b.push(e[h])}}d=d.concat(b)}return d},decodeObj:function(c,a,j,h,n,l){var f=j,e=h,b=2;var m=this.getItemList((l-h)/b+1);for(var d=0;d<m.length;d++){c(a.call(bd,f,e),m[d]);f+=b;if(f>n){f=j;e+=b}if(e>l){break}}},decodeCell:function(a){this.decodeObj(a,bd.cnum,1,1,2*k.qcols-1,2*k.qrows-1)},decodeCross:function(a){this.decodeObj(a,bd.xnum,0,0,2*k.qcols,2*k.qrows)},decodeBorder:function(a){this.decodeObj(a,bd.bnum,2,1,2*k.qcols-2,2*k.qrows-1);this.decodeObj(a,bd.bnum,1,2,2*k.qcols-1,2*k.qrows-2)},decodeBorder2:function(a){this.decodeObj(a,bd.bnum,0,1,2*k.qcols,2*k.qrows-1);this.decodeObj(a,bd.bnum,1,0,2*k.qcols-1,2*k.qrows)},encodeObj:function(c,a,h,f,j,i){var b=2;for(var d=f;d<=i;d+=b){for(var e=h;e<=j;e+=b){this.datastr+=c(a.call(bd,e,d))}this.datastr+="/"}},encodeCell:function(a){this.encodeObj(a,bd.cnum,1,1,2*k.qcols-1,2*k.qrows-1)},encodeCross:function(a){this.encodeObj(a,bd.xnum,0,0,2*k.qcols,2*k.qrows)},encodeBorder:function(a){this.encodeObj(a,bd.bnum,2,1,2*k.qcols-2,2*k.qrows-1);this.encodeObj(a,bd.bnum,1,2,2*k.qcols-1,2*k.qrows-2)},encodeBorder2:function(a){this.encodeObj(a,bd.bnum,0,1,2*k.qcols,2*k.qrows-1);this.encodeObj(a,bd.bnum,1,0,2*k.qcols-1,2*k.qrows)},decodeCellQues41_42:function(){this.decodeCell(function(b,a){if(a==="-"){bd.sQnC(b,-2)}else{if(a==="1"){bd.sQuC(b,41)}else{if(a==="2"){bd.sQuC(b,42)}}}})},encodeCellQues41_42:function(){this.encodeCell(function(a){if(bd.QuC(a)===41){return"1 "}else{if(bd.QuC(a)===42){return"2 "}else{if(bd.QnC(a)===-2){return"- "}else{return". "}}}})},decodeCellQnum:function(){this.decodeCell(function(b,a){if(a==="-"){bd.sQnC(b,-2)}else{if(a!=="."){bd.sQnC(b,parseInt(a))}}})},encodeCellQnum:function(){this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.QnC(a)===-2){return"- "}else{return". "}}})},decodeCellQnumb:function(){this.decodeCell(function(b,a){if(a==="5"){bd.sQnC(b,-2)}else{if(a!=="."){bd.sQnC(b,parseInt(a))}}})},encodeCellQnumb:function(){this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.QnC(a)===-2){return"5 "}else{return". "}}})},decodeCellQnumAns:function(){this.decodeCell(function(b,a){if(a==="#"){bd.setBlack(b)}else{if(a==="+"){bd.sQsC(b,1)}else{if(a==="-"){bd.sQnC(b,-2)}else{if(a!=="."){bd.sQnC(b,parseInt(a))}}}}})},encodeCellQnumAns:function(){this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.QnC(a)===-2){return"- "}else{if(bd.isBlack(a)){return"# "}else{if(bd.QsC(a)===1){return"+ "}else{return". "}}}}})},decodeCellDirecQnum:function(){this.decodeCell(function(d,a){if(a!=="."){var b=a.split(",");bd.sDiC(d,(b[0]!=="0"?parseInt(b[0]):0));bd.sQnC(d,(b[1]!=="-"?parseInt(b[1]):-2))}})},encodeCellDirecQnum:function(){this.encodeCell(function(d){if(bd.QnC(d)!==-1){var b=(bd.DiC(d)!==0?(bd.DiC(d)).toString():"0");var a=(bd.QnC(d)!==-2?(bd.QnC(d)).toString():"-");return""+b+","+a+" "}else{return". "}})},decodeCellAns:function(){this.decodeCell(function(b,a){if(a==="#"){bd.setBlack(b)}else{if(a==="+"){bd.sQsC(b,1)}}})},encodeCellAns:function(){this.encodeCell(function(a){if(bd.isBlack(a)){return"# "}else{if(bd.QsC(a)===1){return"+ "}else{return". "}}})},decodeCellQanssub:function(){this.decodeCell(function(b,a){if(a==="+"){bd.sQsC(b,1)}else{if(a==="-"){bd.sQsC(b,2)}else{if(a==="="){bd.sQsC(b,3)}else{if(a==="%"){bd.sQsC(b,4)}else{if(a!=="."){bd.sQaC(b,parseInt(a))}}}}}})},encodeCellQanssub:function(){this.encodeCell(function(a){if(bd.QaC(a)!==-1){return(bd.QaC(a).toString()+" ")}else{if(bd.QsC(a)===1){return"+ "}else{if(bd.QsC(a)===2){return"- "}else{if(bd.QsC(a)===3){return"= "}else{if(bd.QsC(a)===4){return"% "}else{return". "}}}}}})},decodeCellQsub:function(){this.decodeCell(function(b,a){if(a!="0"){bd.sQsC(b,parseInt(a))}})},encodeCellQsub:function(){this.encodeCell(function(a){if(bd.QsC(a)>0){return(bd.QsC(a).toString()+" ")}else{return"0 "}})},decodeCrossNum:function(){this.decodeCross(function(b,a){if(a==="-"){bd.sQnX(b,-2)}else{if(a!=="."){bd.sQnX(b,parseInt(a))}}})},encodeCrossNum:function(){this.encodeCross(function(a){if(bd.QnX(a)>=0){return(bd.QnX(a).toString()+" ")}else{if(bd.QnX(a)===-2){return"- "}else{return". "}}})},decodeBorderQues:function(){this.decodeBorder(function(b,a){if(a==="1"){bd.sQuB(b,1)}})},encodeBorderQues:function(){this.encodeBorder(function(a){if(bd.QuB(a)===1){return"1 "}else{return"0 "}})},decodeBorderLine:function(){var a=bd.isLineNG;bd.isLineNG=function(b){return false};this.decodeBorder(function(d,b){if(b==="-1"){bd.sQsB(d,2)}else{if(b!=="0"){bd.sLiB(d,parseInt(b))}}});bd.isLineNG=a},encodeBorderLine:function(){this.encodeBorder(function(a){if(bd.LiB(a)>0){return""+bd.LiB(a)+" "}else{if(bd.QsB(a)===2){return"-1 "}else{return"0 "}}})},decodeBorderAns:function(){this.decodeBorder(function(b,a){if(a==="1"){bd.sQaB(b,1)}else{if(a==="2"){bd.sQaB(b,1);bd.sQsB(b,1)}else{if(a==="-1"){bd.sQsB(b,1)}}}})},encodeBorderAns:function(){this.encodeBorder(function(a){if(bd.QaB(a)===1&&bd.QsB(a)===1){return"2 "}else{if(bd.QaB(a)===1){return"1 "}else{if(bd.QsB(a)===1){return"-1 "}else{return"0 "}}}})},decodeBorderAns2:function(){this.decodeBorder2(function(b,a){if(a==="1"){bd.sQaB(b,1)}else{if(a==="2"){bd.sQsB(b,1)}else{if(a==="3"){bd.sQaB(b,1);bd.sQsB(b,1)}else{if(a==="-1"){bd.sQsB(b,2)}}}}})},encodeBorderAns2:function(){this.encodeBorder2(function(a){if(bd.QaB(a)===1&&bd.QsB(a)===1){return"3 "}else{if(bd.QsB(a)===1){return"2 "}else{if(bd.QaB(a)===1){return"1 "}else{if(bd.QsB(a)===2){return"-1 "}else{return"0 "}}}}})},decodeAreaRoom:function(){this.decodeAreaRoom_com(true)},encodeAreaRoom:function(){this.encodeAreaRoom_com(true)},decodeAnsAreaRoom:function(){this.decodeAreaRoom_com(false)},encodeAnsAreaRoom:function(){this.encodeAreaRoom_com(false)},decodeAreaRoom_com:function(a){this.readLine();this.rdata2Border(a,this.getItemList(k.qrows));area.resetRarea()},encodeAreaRoom_com:function(a){var d=area.getRoomInfo();this.datastr+=(d.max+"/");for(var b=0;b<bd.cellmax;b++){this.datastr+=(""+(d.id[b]-1)+" ");if((b+1)%k.qcols==0){this.datastr+="/"}}},rdata2Border:function(e,d){var c=(e?bd.sQuB:bd.sQaB);for(var f=0;f<bd.bdmax;f++){var b=bd.border[f].cellcc[0],a=bd.border[f].cellcc[1];c.apply(bd,[f,(b!=-1&&a!=-1&&d[b]!=d[a]?1:0)])}},decodeCellQnum51:function(){var d=this.getItemList(k.qrows+1);for(var a=0;a<d.length;a++){var f=(a%(k.qcols+1)-1)*2+1,e=(mf(a/(k.qcols+1))-1)*2+1;if(d[a]!="."){if(e===-1){bd.sDiE(bd.exnum(f,e),parseInt(d[a]))}else{if(f===-1){bd.sQnE(bd.exnum(f,e),parseInt(d[a]))}else{var b=d[a].split(",");var h=bd.cnum(f,e);mv.set51cell(h,true);bd.sQnC(h,b[0]);bd.sDiC(h,b[1])}}}}},encodeCellQnum51:function(){var d="";for(var a=bd.minby+1;a<bd.maxby;a+=2){for(var b=bd.minbx+1;b<bd.maxbx;b+=2){if(b===-1&&a==-1){d+="0 "}else{if(a===-1){d+=(""+bd.DiE(bd.exnum(b,a)).toString()+" ")}else{if(b===-1){d+=(""+bd.QnE(bd.exnum(b,a)).toString()+" ")}else{var e=bd.cnum(b,a);if(bd.QuC(e)===51){d+=(""+bd.QnC(e).toString()+","+bd.DiC(e).toString()+" ")}else{d+=". "}}}}}d+="/"}this.datastr+=d},decodeCellQnum_kanpen:function(){this.decodeCell(function(b,a){if(a!="."){bd.sQnC(b,parseInt(a))}})},encodeCellQnum_kanpen:function(){this.encodeCell(function(a){return(bd.QnC(a)>=0)?(bd.QnC(a).toString()+" "):". "})},decodeCellQans_kanpen:function(){this.decodeCell(function(b,a){if(a!="."&&a!="0"){bd.sQaC(b,parseInt(a))}})},encodeCellQans_kanpen:function(){this.encodeCell(function(a){if(bd.QnC(a)!=-1){return". "}else{if(bd.QaC(a)==-1){return"0 "}else{return""+bd.QaC(a).toString()+" "}}})},decodeCellQnumAns_kanpen:function(){this.decodeCell(function(b,a){if(a=="#"){bd.setBlack(b)}else{if(a=="+"){bd.sQsC(b,1)}else{if(a!="."){bd.sQnC(b,parseInt(a))}}}})},encodeCellQnumAns_kanpen:function(){this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.isBlack(a)){return"# "}else{if(bd.QsC(a)==1){return"+ "}else{return". "}}}})},decodeSquareRoom:function(){this.decodeSquareRoom_com(true)},encodeSquareRoom:function(){this.encodeSquareRoom_com(true)},decodeAnsSquareRoom:function(){this.decodeSquareRoom_com(false)},encodeAnsSquareRoom:function(){this.encodeSquareRoom_com(false)},decodeSquareRoom_com:function(f){var j=parseInt(this.readLine());var b=this.readLines(j);var e=[];for(var c=0;c<b.length;c++){if(b[c]==""){break}var a=b[c].split(" ");for(var h=0;h<4;h++){if(!isNaN(a[h])){a[h]=parseInt(a[h])}}var d={y1:2*a[0]+1,x1:2*a[1]+1,y2:2*a[2]+1,x2:2*a[3]+1};if(f&&a[4]!=""){bd.sQnC(bd.cnum(d.x1,d.y1),parseInt(a[4],10))}this.setRdataRect(e,c,d)}this.rdata2Border(f,e);area.resetRarea()},setRdataRect:function(e,a,b){for(var d=b.x1;d<=b.x2;d+=2){for(var c=b.y1;c<=b.y2;c+=2){e[bd.cnum(d,c)]=a}}},encodeSquareRoom_com:function(c){var f=area.getRoomInfo();this.datastr+=(f.max+"/");for(var e=1;e<=f.max;e++){var b=ans.getSizeOfClist(f.room[e].idlist,f_true);var a=(c?bd.QnC(area.getTopOfRoom(e)):-1);this.datastr+=(""+(b.y1>>1)+" "+(b.x1>>1)+" "+(b.y2>>1)+" "+(b.x2>>1)+" "+(a>=0?""+a:"")+"/")}}};DataBaseManager=function(){this.dbh=null;this.DBaccept=0;this.DBsid=-1;this.DBlist=[];this.keys=["id","col","row","hard","pdata","time","comment"];this.selectDBtype()};DataBaseManager.prototype={selectDBtype:function(){if(!!window.localStorage){if(!k.br.Gecko||!!location.hostname){this.DBaccept|=8}}if(!!window.openDatabase){try{var a=openDatabase("pzprv3_manage","1.0");if(!!a){this.DBaccept|=2}}catch(b){}}try{if((window.google&&google.gears)||(typeof GearsFactory!="undefined")||(!!window.ActiveXObject&&(!!(new ActiveXObject("Gears.Factory"))))||(!!navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"])){this.DBaccept|=1}}catch(b){}},requireGears:function(){return !!(this.DBaccept&1)},openDialog:function(){this.openHandler();this.update()},openHandler:function(){var b=0;if(this.DBaccept&8){b=4}else{if(this.DBaccept&4){b=3}else{if(this.DBaccept&2){b=2}else{if(this.DBaccept&1){b=1}}}}switch(b){case 1:case 2:this.dbh=new DataBaseHandler_SQL((b===2));break;case 4:this.dbh=new DataBaseHandler_LS();break;default:return}this.dbh.importDBlist(this);var a={idlist:"ID‡",newsave:"•Û‘¶‚ªV‚µ‚¢‡",oldsave:"•Û‘¶‚ªŒÃ‚¢‡",size:"ƒTƒCƒY/“ïˆÕ“x‡"};var c="";for(s in a){c+=('<option value="'+s+'">'+a[s]+"</option>")}document.database.sorts.innerHTML=c},closeDialog:function(){this.DBlist=[]},clickHandler:function(a){switch(ee.getSrcElement(a).name){case"sorts":this.displayDataTableList();case"datalist":this.selectDataTable();break;case"tableup":this.upDataTable_M();break;case"tabledn":this.downDataTable_M();break;case"open":this.openDataTable_M();break;case"save":this.saveDataTable_M();break;case"comedit":this.editComment_M();break;case"difedit":this.editDifficult_M();break;case"del":this.deleteDataTable_M();break}},getDataID:function(){if(document.database.datalist.value!="new"&&document.database.datalist.value!=""){for(var a=0;a<this.DBlist.length;a++){if(this.DBlist[a].id==document.database.datalist.value){return a}}}return -1},update:function(){this.dbh.updateManageData(this);this.displayDataTableList();this.selectDataTable()},displayDataTableList:function(){switch(document.database.sorts.value){case"idlist":this.DBlist=this.DBlist.sort(function(h,f){return(h.id-f.id)});break;case"newsave":this.DBlist=this.DBlist.sort(function(h,f){return(f.time-h.time||h.id-f.id)});break;case"oldsave":this.DBlist=this.DBlist.sort(function(h,f){return(h.time-f.time||h.id-f.id)});break;case"size":this.DBlist=this.DBlist.sort(function(h,f){return(h.col-f.col||h.row-f.row||h.hard-f.hard||h.id-f.id)});break}var c="";for(var b=0;b<this.DBlist.length;b++){var e=this.DBlist[b];if(!e){continue}var d=' value="'+e.id+'"';var a=(this.DBsid==e.id?" selected":"");c+=("<option"+d+a+">"+this.getRowString(e)+"</option>\n")}c+=('<option value="new"'+(this.DBsid==-1?" selected":"")+">&nbsp;&lt;V‚µ‚­•Û‘¶‚·‚é&gt;</option>\n");document.database.datalist.innerHTML=c},getRowString:function(c){var b=[{ja:"|",en:"-"},{ja:"‚ç‚­‚ç‚­",en:"Easy"},{ja:"‚¨‚Ä‚²‚ë",en:"Normal"},{ja:"‚½‚¢‚Ö‚ñ",en:"Hard"},{ja:"ƒAƒ[ƒ“",en:"Expert"}];var a="";a+=((c.id<10?"&nbsp;":"")+c.id+" :&nbsp;");a+=(this.dateString(c.time*1000)+" &nbsp;");a+=(""+c.col+"~"+c.row+" &nbsp;");if(!!c.hard||c.hard=="0"){a+=(b[c.hard][menu.language])}return a},dateString:function(c){var b=function(e){return(e<10?"0":"")+e};var d=" ";var a=new Date();a.setTime(c);d+=(b(a.getFullYear()%100)+"/"+b(a.getMonth()+1)+"/"+b(a.getDate())+" ");d+=(b(a.getHours())+":"+b(a.getMinutes()));return d},selectDataTable:function(){var a=this.getDataID();if(a>=0){document.database.comtext.value=""+this.DBlist[a].comment;this.DBsid=parseInt(this.DBlist[a].id)}else{document.database.comtext.value="";this.DBsid=-1}document.database.tableup.disabled=(document.database.sorts.value!=="idlist"||this.DBsid===-1||this.DBsid===1);document.database.tabledn.disabled=(document.database.sorts.value!=="idlist"||this.DBsid===-1||this.DBsid===this.DBlist.length);document.database.comedit.disabled=(this.DBsid===-1);document.database.difedit.disabled=(this.DBsid===-1);document.database.open.disabled=(this.DBsid===-1);document.database.del.disabled=(this.DBsid===-1)},upDataTable_M:function(){var a=this.getDataID();if(a===-1||a===0){return}this.convertDataTable_M(a,a-1)},downDataTable_M:function(){var a=this.getDataID();if(a===-1||a===this.DBlist.length-1){return}this.convertDataTable_M(a,a+1)},convertDataTable_M:function(a,b){this.DBsid=this.DBlist[b].id;var d={};for(var e=1;e<7;e++){d[this.keys[e]]=this.DBlist[a][this.keys[e]]}for(var e=1;e<7;e++){this.DBlist[a][this.keys[e]]=this.DBlist[b][this.keys[e]]}for(var e=1;e<7;e++){this.DBlist[b][this.keys[e]]=d[this.keys[e]]}this.dbh.convertDataTableID(this,a,b);this.update()},openDataTable_M:function(){var a=this.getDataID();if(a===-1){return}if(!confirm("‚±‚Ìƒf[ƒ^‚ð“Ç‚Ýž‚Ý‚Ü‚·‚©H (Œ»Ý‚Ì”Õ–Ê‚Í”jŠü‚³‚ê‚Ü‚·)")){return}this.dbh.openDataTable(this,a)},saveDataTable_M:function(){var c=this.getDataID(),a=false;if(c===-1){c=this.DBlist.length;a=true;this.DBlist[c]={};var b=prompt("ƒRƒƒ“ƒg‚ª‚ ‚éê‡‚Í“ü—Í‚µ‚Ä‚­‚¾‚³‚¢B","");this.DBlist[c].comment=(!!b?b:"");this.DBlist[c].hard=0;this.DBlist[c].id=c+1;this.DBsid=this.DBlist[c].id}else{if(!confirm("‚±‚Ìƒf[ƒ^‚Éã‘‚«‚µ‚Ü‚·‚©H")){return}}this.DBlist[c].col=k.qcols;this.DBlist[c].row=k.qrows;this.DBlist[c].time=mf(tm.now()/1000);this.dbh.saveDataTable(this,c);this.update()},editComment_M:function(){var b=this.getDataID();if(b===-1){return}var a=prompt("‚±‚Ì–â‘è‚É‘Î‚·‚éƒRƒƒ“ƒg‚ð“ü—Í‚µ‚Ä‚­‚¾‚³‚¢B",this.DBlist[b].comment);if(a==null){return}this.DBlist[b].comment=a;this.dbh.updateComment(this,b);this.update()},editDifficult_M:function(){var b=this.getDataID();if(b===-1){return}var a=prompt("‚±‚Ì–â‘è‚Ì“ïˆÕ“x‚ðÝ’è‚µ‚Ä‚­‚¾‚³‚¢B\n[0:‚È‚µ 1:‚ç‚­‚ç‚­ 2:‚¨‚Ä‚²‚ë 3:‚½‚¢‚Ö‚ñ 4:ƒAƒ[ƒ“]",this.DBlist[b].hard);if(a==null){return}this.DBlist[b].hard=((a=="1"||a=="2"||a=="3"||a=="4")?a:0);this.dbh.updateDifficult(this,b);this.update()},deleteDataTable_M:function(){var f=this.getDataID();if(f===-1){return}if(!confirm("‚±‚Ìƒf[ƒ^‚ðŠ®‘S‚Éíœ‚µ‚Ü‚·‚©H")){return}var b=this.DBlist[f].id,a=this.DBlist.length;for(var d=b-1;d<a-1;d++){for(var e=1;e<7;e++){this.DBlist[d][this.keys[e]]=this.DBlist[d+1][this.keys[e]]}}this.DBlist.pop();this.dbh.deleteDataTable(this,b,a);this.update()}};DataBaseHandler_LS=function(){this.pheader="pzprv3_"+k.puzzleid+":puzdata";this.keys=fio.dbm.keys;this.initialize()};DataBaseHandler_LS.prototype={initialize:function(){this.createManageDataTable();this.createDataBase()},importDBlist:function(a){a.DBlist=[];var b=0;while(1){b++;var d={};for(var e=0;e<7;e++){d[this.keys[e]]=localStorage[this.pheader+"!"+b+"!"+this.keys[e]]}if(d.id==null){break}d.pdata="";a.DBlist.push(d)}},createManageDataTable:function(){localStorage.pzprv3_manage="DataBase";localStorage["pzprv3_manage:manage"]="Table"},updateManageData:function(a){var b="pzprv3_manage:manage!"+k.puzzleid;localStorage[b+"!count"]=a.DBlist.length;localStorage[b+"!time"]=mf(tm.now()/1000)},createDataBase:function(){localStorage["pzprv3_"+k.puzzleid]="DataBase";localStorage["pzprv3_"+k.puzzleid+":puzdata"]="Table"},convertDataTableID:function(i,a,b){var e=i.DBlist[a].id,j=i.DBlist[b].id;var h=this.pheader+"!"+e,d=this.pheader+"!"+j,l={};for(var f=1;f<7;f++){localStorage[h+"!"+this.keys[f]]=i.DBlist[a][this.keys[f]]}for(var f=1;f<7;f++){localStorage[d+"!"+this.keys[f]]=i.DBlist[b][this.keys[f]]}},openDataTable:function(a,c){var b=localStorage[this.pheader+"!"+a.DBlist[c].id+"!pdata"];fio.filedecode(b)},saveDataTable:function(a,e){var b=a.DBlist[e];for(var d=0;d<7;d++){localStorage[this.pheader+"!"+b.id+"!"+this.keys[d]]=(d!==4?b[this.keys[d]]:fio.fileencode(1))}},updateComment:function(a,c){var b=a.DBlist[c];localStorage[this.pheader+"!"+b.id+"!comment"]=b.comment},updateDifficult:function(a,c){var b=a.DBlist[c];localStorage[this.pheader+"!"+b.id+"!hard"]=b.hard},deleteDataTable:function(e,b,a){for(var d=parseInt(b);d<a;d++){var h=[this.pheader+"!"+(d+1),this.pheader+"!"+d];for(var j=1;j<7;j++){localStorage[h[1]+"!"+this.keys[j]]=localStorage[h[0]+"!"+this.keys[j]]}}var f=this.pheader+"!"+a;for(var j=0;j<7;j++){localStorage.removeItem(f+"!"+this.keys[j])}}};DataBaseHandler_SQL=function(a){this.db=null;this.dbmgr=null;this.isSQLDB=a;this.initialize()};DataBaseHandler_SQL.prototype={initialize:function(){var b=new DataBaseObject_SQL(this.isSQLDB);var a=new DataBaseObject_SQL(this.isSQLDB);this.dbmgr=b.openDatabase("pzprv3_manage","1.0");this.db=a.openDatabase("pzprv3_"+k.puzzleid,"1.0");this.createManageDataTable();this.createDataBase()},importDBlist:function(a){a.DBlist=[];this.db.transaction(function(b){b.executeSql("SELECT * FROM pzldata",[],function(d,e){var f=0,j=a.keys;for(var h=0;h<e.rows.length;h++){a.DBlist[f]={};for(var l=0;l<7;l++){a.DBlist[f][j[l]]=e.rows.item(h)[j[l]]}a.DBlist[f].pdata="";f++}})},function(){},function(){fio.dbm.update()})},createManageDataTable:function(){this.dbmgr.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS manage (puzzleid primary key,version,count,lastupdate)",[])})},updateManageData:function(a){var b=a.DBlist.length;var c=mf(tm.now()/1000);this.dbmgr.transaction(function(d){d.executeSql("INSERT OR REPLACE INTO manage VALUES(?,?,?,?)",[k.puzzleid,"1.0",b,c])})},createDataBase:function(){this.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS pzldata (id int primary key,col,row,hard,pdata,time,comment)",[])})},convertDataTableID:function(c,a,d){var b=c.DBlist[a].id,e=c.DBlist[d].id;this.db.transaction(function(f){f.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[0,b]);f.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[b,e]);f.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[e,0])})},openDataTable:function(a,b){this.db.transaction(function(c){c.executeSql("SELECT * FROM pzldata WHERE ID==?",[a.DBlist[b].id],function(d,e){fio.filedecode(e.rows.item(0)["pdata"])})})},saveDataTable:function(a,c){var b=a.DBlist[c];this.db.transaction(function(d){d.executeSql("INSERT INTO pzldata VALUES(?,?,?,?,?,?,?)",[b.id,b.col,b.row,b.hard,fio.fileencode(1),b.time,b.comment])})},updateComment:function(a,c){var b=a.DBlist[c];this.db.transaction(function(d){d.executeSql("UPDATE pzldata SET comment=? WHERE ID==?",[b.comment,b.id])})},updateDifficult:function(a,c){var b=a.DBlist[c];this.db.transaction(function(d){d.executeSql("UPDATE pzldata SET hard=? WHERE ID==?",[b.hard,b.id])})},deleteDataTable:function(c,b,a){this.db.transaction(function(d){d.executeSql("DELETE FROM pzldata WHERE ID==?",[b]);for(var e=parseInt(b);e<a;e++){d.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[e,e+1])}})}};DataBaseObject_SQL=function(a){this.name="";this.version=0;this.isSQLDB=a;this.object=null};DataBaseObject_SQL.prototype={openDatabase:function(b,a){this.name=b;this.version=a;if(this.isSQLDB){this.object=openDatabase(this.name,this.version)}else{this.object=google.gears.factory.create("beta.database",this.version)}return this},transaction:function(c,b,a){if(typeof b=="undefined"){b=f_true}if(typeof a=="undefined"){a=f_true}if(this.isSQLDB){this.object.transaction(c,b,a)}else{this.object.open(this.name);c(this);this.object.close();a()}},executeSql:function(f,e,j){var h=this.object.execute(f,e);if(typeof j!="undefined"){var a=0,m={};m.rowarray=[];while(h.isValidRow()){var l={};for(var c=0,d=h.fieldCount();c<d;c++){l[c]=l[h.fieldName(c)]=h.field(c)}m.rowarray[a]=l;h.next();a++}h.close();m.length=a;m.item=function(i){return this.rowarray[i]};var b={rows:m};j(this,b)}}};AnsCheck=function(){this.performAsLine=false;this.errDisp=false;this.setError=true;this.inCheck=false;this.inAutoCheck=false;this.alstr={jp:"",en:""}};AnsCheck.prototype={check:function(){this.inCheck=true;this.alstr={jp:"",en:""};kc.keyreset();mv.mousereset();if(!this.checkAns()){alert((menu.isLangJP()||!this.alstr.en)?this.alstr.jp:this.alstr.en);this.errDisp=true;pc.paintAll();this.inCheck=false;return false}alert(menu.isLangJP()?"³‰ð‚Å‚·I":"Complete!");this.inCheck=false;return true},checkAns:function(){},setAlert:function(b,a){this.alstr.jp=b;this.alstr.en=a},autocheck:function(){if(!pp.getVal("autocheck")||k.editmode||this.inCheck){return}var a=false;this.inCheck=this.inAutoCheck=true;this.disableSetError();if(this.autocheck1st()&&this.checkAns()&&this.inCheck){mv.mousereset();alert(menu.isLangJP()?"³‰ð‚Å‚·I":"Complete!");a=true;pp.setVal("autocheck",false)}this.enableSetError();this.inCheck=this.inAutoCheck=false;return a},autocheck1st:function(){if(this.check1st){return this.check1st()}else{if((k.isCenterLine&&!ans.checkLcntCell(1))||(k.isborderAsLine&&!ans.checkLcntCross(1,0))){return false}}return true},disableSetError:function(){this.setError=false},enableSetError:function(){this.setError=true},isenableSetError:function(){return this.setError},checkdir4Cell:function(c,b){if(c<0||c>=bd.cellmax){return 0}var a=0;if(bd.up(c)!=-1&&b(bd.up(c))){a++}if(bd.dn(c)!=-1&&b(bd.dn(c))){a++}if(bd.lt(c)!=-1&&b(bd.lt(c))){a++}if(bd.rt(c)!=-1&&b(bd.rt(c))){a++}return a},setErrLareaByCell:function(a,d,b){this.setErrLareaById(a,a.id[d],b)},setErrLareaById:function(e,h,d){var a=[];for(var b=0;b<bd.bdmax;b++){if(!bd.isLine(b)){continue}var j=bd.border[b].cellcc[0],i=bd.border[b].cellcc[1];if(j!=-1&&i!=-1&&e.id[j]==h&&e.id[j]==e.id[i]){a.push(b)}}bd.sErB(a,d);var l=[];for(var f=0;f<bd.cellmax;f++){if(e.id[f]==h&&bd.QnC(f)!=-1){l.push(f)}}bd.sErC(l,4)},checkAllCell:function(b){var a=true;for(var d=0;d<bd.cellmax;d++){if(b(d)){if(this.inAutoCheck){return false}bd.sErC([d],1);a=false}}return a},checkOneArea:function(a){if(a.max>1){if(this.performAsLine){bd.sErBAll(2);this.setErrLareaByCell(a,1,1)}if(!this.performAsLine||k.puzzleid=="firefly"){bd.sErC(a.room[1].idlist,1)}return false}return true},check2x2Block:function(b){var a=true;for(var d=0;d<bd.cellmax;d++){if(bd.cell[d].bx<bd.maxbx-1&&bd.cell[d].by<bd.maxby-1){if(b(d)&&b(d+1)&&b(d+k.qcols)&&b(d+k.qcols+1)){if(this.inAutoCheck){return false}bd.sErC([d,d+1,d+k.qcols,d+k.qcols+1],1);a=false}}}return a},checkSideCell:function(b){var a=true;for(var d=0;d<bd.cellmax;d++){if(bd.cell[d].bx<bd.maxbx-1&&b(d,d+1)){if(this.inAutoCheck){return false}bd.sErC([d,d+1],1);a=false}if(bd.cell[d].by<bd.maxby-1&&b(d,d+k.qcols)){if(this.inAutoCheck){return false}bd.sErC([d,d+k.qcols],1);a=false}}return a},checkQnumCross:function(a){for(var b=0;b<bd.crossmax;b++){if(bd.QnX(b)<0){continue}if(!a(bd.QnX(b),bd.bcntCross(b))){bd.sErX([b],1);return false}}return true},checkOneLoop:function(){var a=line.getLineInfo();if(a.max>1){bd.sErBAll(2);bd.sErB(a.room[1].idlist,1);return false}return true},checkLcntCell:function(b){var a=true;if(line.ltotal[b]==0){return true}for(var d=0;d<bd.cellmax;d++){if(line.lcnt[d]==b){if(this.inAutoCheck){return false}if(!this.performAsLine){bd.sErC([d],1)}else{if(a){bd.sErBAll(2)}this.setCellLineError(d,true)}a=false}}return a},isLineStraight:function(a){if(bd.isLine(bd.ub(a))&&bd.isLine(bd.db(a))){return true}else{if(bd.isLine(bd.lb(a))&&bd.isLine(bd.rb(a))){return true}}return false},setCellLineError:function(d,a){if(a){bd.sErC([d],1)}var c=bd.cell[d].bx,b=bd.cell[d].by;bd.sErB(bd.borderinside(c-1,b-1,c+1,b+1),1)},checkdir4Border:function(){var a=true;for(var b=0;b<bd.cellmax;b++){if(bd.QnC(b)>=0&&this.checkdir4Border1(b)!=bd.QnC(b)){if(this.inAutoCheck){return false}bd.sErC([b],1);a=false}}return a},checkdir4Border1:function(d){if(d<0||d>=bd.cellmax){return 0}var a=0;var c=bd.cell[d].bx,b=bd.cell[d].by;if((k.isborder!==2&&b===bd.minby+1)||bd.isBorder(bd.bnum(c,b-1))){a++}if((k.isborder!==2&&b===bd.maxby-1)||bd.isBorder(bd.bnum(c,b+1))){a++}if((k.isborder!==2&&c===bd.minbx+1)||bd.isBorder(bd.bnum(c-1,b))){a++}if((k.isborder!==2&&c===bd.maxby-1)||bd.isBorder(bd.bnum(c+1,b))){a++}return a},checkenableLineParts:function(d){var a=true;var c=function(e){return((bd.ub(e)!=-1&&bd.isLine(bd.ub(e))&&bd.isnoLPup(e))||(bd.db(e)!=-1&&bd.isLine(bd.db(e))&&bd.isnoLPdown(e))||(bd.lb(e)!=-1&&bd.isLine(bd.lb(e))&&bd.isnoLPleft(e))||(bd.rb(e)!=-1&&bd.isLine(bd.rb(e))&&bd.isnoLPright(e)))};for(var b=0;b<bd.cellmax;b++){if(c(b)){if(this.inAutoCheck){return false}bd.sErC([b],1);a=false}}return a},checkAllArea:function(e,b,c){var a=true;for(var i=1;i<=e.max;i++){var f=this.getSizeOfClist(e.room[i].idlist,b);var h=bd.QnC(k.roomNumber?area.getTopOfRoomByCell(e.room[i].idlist[0]):this.getQnumCellOfClist(e.room[i].idlist));if(!c(f.cols,f.rows,f.cnt,h)){if(this.inAutoCheck){return false}if(this.performAsLine){if(a){bd.sErBAll(2)}this.setErrLareaById(e,i,1)}else{bd.sErC(e.room[i].idlist,(k.puzzleid!="tateyoko"?1:4))}a=false}}return a},checkDisconnectLine:function(a){return this.checkAllArea(a,bd.isNum,function(c,d,b,e){return(e!=-1||b>0)})},checkNumberAndSize:function(a){return this.checkAllArea(a,f_true,function(c,d,b,e){return(e<=0||e==b)})},checkNoNumber:function(a){return this.checkAllArea(a,bd.isNum,function(c,d,b,e){return(b!=0)})},checkDoubleNumber:function(a){return this.checkAllArea(a,bd.isNum,function(c,d,b,e){return(b<2)})},checkTripleNumber:function(a){return this.checkAllArea(a,bd.isNum,function(c,d,b,e){return(b<3)})},checkBlackCellCount:function(a){return this.checkAllArea(a,bd.isBlack,function(c,d,b,e){return(e<0||e==b)})},checkBlackCellInArea:function(b,a){return this.checkAllArea(b,bd.isBlack,function(d,e,c,f){return a(c)})},checkAreaRect:function(a){return this.checkAllArea(a,f_true,function(c,d,b,e){return(c*d==b)})},checkLinesInArea:function(b,a){return this.checkAllArea(b,function(d){return line.lcnt[d]>0},a)},checkNoObjectInRoom:function(b,a){return this.checkAllArea(b,function(d){return a(d)!=-1},function(d,e,c,f){return(c!=0)})},getQnumCellOfClist:function(c){for(var b=0,a=c.length;b<a;b++){if(bd.QnC(c[b])!=-1){return c[b]}}return -1},getSizeOfClist:function(c,b){var e={x1:bd.maxbx+1,x2:bd.minbx-1,y1:bd.maxby+1,y2:bd.minby-1,cols:0,rows:0,cnt:0};for(var a=0;a<c.length;a++){if(e.x1>bd.cell[c[a]].bx){e.x1=bd.cell[c[a]].bx}if(e.x2<bd.cell[c[a]].bx){e.x2=bd.cell[c[a]].bx}if(e.y1>bd.cell[c[a]].by){e.y1=bd.cell[c[a]].by}if(e.y2<bd.cell[c[a]].by){e.y2=bd.cell[c[a]].by}if(b(c[a])){e.cnt++}}e.cols=(e.x2-e.x1+2)/2;e.rows=(e.y2-e.y1+2)/2;return e},checkSideAreaSize:function(i,m){var j=[];for(var a=1;a<=i.max-1;a++){j[a]=[];for(var p=a+1;p<=i.max;p++){j[a][p]=0}}for(var d=0;d<bd.bdmax;d++){if(!bd.isBorder(d)){continue}var o=bd.border[d].cellcc[0],n=bd.border[d].cellcc[1];if(o==-1||n==-1){continue}var h=i.id[o],f=i.id[n];try{if(h<f){j[h][f]++}if(h>f){j[f][h]++}}catch(l){alert([h,f]);throw 0}}for(var a=1;a<=i.max-1;a++){for(var p=a+1;p<=i.max;p++){if(j[a][p]==0){continue}var c=m(i,a),b=m(i,p);if(c>0&&b>0&&c==b){bd.sErC(i.room[a].idlist,1);bd.sErC(i.room[p].idlist,1);return false}}}return true},checkSideAreaCell:function(f,d,a){for(var e=0;e<bd.bdmax;e++){if(!bd.isBorder(e)){continue}var c=bd.border[e].cellcc[0],b=bd.border[e].cellcc[1];if(c!=-1&&b!=-1&&d(c,b)){if(!a){bd.sErC([c,b],1)}else{bd.sErC(area.room[area.room.id[c]].clist,1);bd.sErC(area.room[area.room.id[b]].clist,1)}return false}}return true},checkSeqBlocksInRoom:function(){var a=true;for(var e=1;e<=area.room.max;e++){var b={max:0,id:[]};for(var d=0;d<bd.cellmax;d++){b.id[d]=((area.room.id[d]==e&&bd.isBlack(d))?0:-1)}for(var d=0;d<bd.cellmax;d++){if(b.id[d]!=0){continue}b.max++;b[b.max]={clist:[]};area.sc0(d,b)}if(b.max>1){if(this.inAutoCheck){return false}bd.sErC(area.room[e].clist,1);a=false}}return a},checkSameObjectInRoom:function(l,e){var a=true;var f=[];for(var b=1;b<=l.max;b++){f[b]=-1}for(var j=0;j<bd.cellmax;j++){if(l.id[j]==-1||e(j)==-1){continue}if(f[l.id[j]]==-1&&e(j)!=-1){f[l.id[j]]=e(j)}else{if(f[l.id[j]]!=e(j)){if(this.inAutoCheck){return false}if(this.performAsLine){bd.sErBAll(2);this.setErrLareaByCell(l,j,1)}else{bd.sErC(l.room[l.id[j]].idlist,1)}if(k.puzzleid=="kaero"){for(var h=0;h<bd.cellmax;h++){if(l.id[j]==l.id[h]&&this.getBeforeCell(h)!=-1&&l.id[j]!=l.id[this.getBeforeCell(h)]){bd.sErC([this.getBeforeCell(h)],4)}}}a=false}}}return a},checkObjectRoom:function(m,e){var h=[];var f=0;for(var l=0;l<bd.cellmax;l++){if(f<e(l)){f=e(l)}}for(var a=0;a<=f;a++){h[a]=-1}for(var l=0;l<bd.cellmax;l++){if(e(l)==-1){continue}if(h[e(l)]==-1){h[e(l)]=m.id[l]}else{if(h[e(l)]!=m.id[l]){var b=[];for(var j=0;j<bd.cellmax;j++){if(k.puzzleid=="kaero"){if(e(l)==bd.QnC(j)){b.push(j)}}else{if(m.id[l]==m.id[j]||h[e(l)]==m.id[j]){b.push(j)}}}bd.sErC(b,1);return false}}}return true},checkRowsCols:function(d,f){var a=true;for(var c=1;c<=bd.maxby;c+=2){var b=bd.cellinside(bd.minbx+1,c,bd.maxbx-1,c);if(!d.apply(this,[b,f])){if(this.inAutoCheck){return false}a=false}}for(var e=1;e<=bd.maxbx;e+=2){var b=bd.cellinside(e,bd.minby+1,e,bd.maxby-1);if(!d.apply(this,[b,f])){if(this.inAutoCheck){return false}a=false}}return a},checkRowsColsPartly:function(d,a,i,j){var m=true;for(var e=1;e<=bd.maxby;e+=2){var f=1;while(f<=bd.maxbx){for(var c=f;c<=bd.maxbx;c+=2){if(i.apply(this,[bd.cnum(c,e)])){break}}var l=bd.cellinside(f,e,c-2,e);var h=(k.isexcell!==1?0:(f===1?bd.QnE(bd.exnum(-1,e)):bd.QnC(bd.cnum(f-2,e))));if(!d.apply(this,[h,[f-2,e],l,a])){if(!j||this.inAutoCheck){return false}m=false}f=c+2}}for(var f=1;f<=bd.maxbx;f+=2){var e=1;while(e<=bd.maxby){for(var b=e;b<=bd.maxby;b+=2){if(i.apply(this,[bd.cnum(f,b)])){break}}var l=bd.cellinside(f,e,f,b-2);var h=(k.isexcell!==1?0:(e===1?bd.DiE(bd.exnum(f,-1)):bd.DiC(bd.cnum(f,e-2))));if(!d.apply(this,[h,[f,e-2],l,a])){if(!j||this.inAutoCheck){return false}m=false}e=b+2}}return m},checkDifferentNumberInRoom:function(d,c){var a=true;for(var b=1;b<=d.max;b++){if(!this.isDifferentNumberInClist(d.room[b].idlist,c)){if(this.inAutoCheck){return false}bd.sErC(d.room[b].idlist,1);a=false}}return a},isDifferentNumberInClist:function(l,e){var m=true,h=[],f=[],a=(k.dispzero?1:0);for(var b=a,j=bd.nummaxfunc(l[0]);b<=j;b++){h[b]=0}for(var c=0;c<l.length;c++){f[l[c]]=e.apply(bd,[l[c]])}for(var c=0;c<l.length;c++){if(f[l[c]]>=a){h[f[l[c]]]++}}for(var c=0;c<l.length;c++){if(f[l[c]]>=a&&h[f[l[c]]]>=2){bd.sErC([l[c]],1);m=false}}return m},checkLcntCross:function(f,c){var a=true;for(var d=0;d<=bd.maxby;d+=2){for(var e=0;e<=bd.maxbx;e+=2){if(k.iscross===1&&(e===bd.minbx||d===bd.minby||e===bd.maxbx||d===bd.maxby)){continue}var h=(e>>1)+(d>>1)*(k.qcols+1);var b=(!k.isborderAsLine?area.lcnt[h]:line.lcnt[h]);if(b==f&&(c==0||(c==1&&bd.QnX(bd.xnum(e,d))==1)||(c==2&&bd.QnX(bd.xnum(e,d))!=1))){if(this.inAutoCheck){return false}if(a){bd.sErBAll(2)}this.setCrossBorderError(e,d);a=false}}}return a},setCrossBorderError:function(b,a){if(k.iscross!==0){bd.sErX([bd.xnum(b,a)],1)}bd.sErB(bd.borderinside(b-1,a-1,b+1,a+1),1)}};Operation=function(d,c,e,a,b){this.obj=d;this.property=c;this.id=e;this.old=a;this.num=b;this.chain=um.chainflag};OperationManager=function(){this.ope=[];this.current=0;this.disrec=0;this.disinfo=0;this.chainflag=0;this.disCombine=0;this.anscount=0;this.changeflag=false;this.undoExec=false;this.redoExec=false;this.reqReset=false;this.range={x1:bd.maxbx+1,y1:bd.maxby+1,x2:bd.minbx-1,y2:bd.minby-1}};OperationManager.prototype={disableRecord:function(){this.disrec++},enableRecord:function(){if(this.disrec>0){this.disrec--}},isenableRecord:function(){return(this.disrec==0)},disableInfo:function(){this.disinfo++},enableInfo:function(){if(this.disinfo>0){this.disinfo--}},isenableInfo:function(){return(this.disinfo==0)},enb_btn:function(){ee("btnundo").el.disabled=((!this.ope.length||this.current==0)?"true":"");ee("btnredo").el.disabled=((!this.ope.length||this.current==this.ope.length)?"true":"")},allerase:function(){for(var a=this.ope.length-1;a>=0;a--){this.ope.pop()}this.current=0;this.anscount=0;this.enb_btn()},newOperation:function(a){this.chainflag=0;if(a){this.changeflag=false}},addOpe:function(f,e,h,a,b){if(!this.isenableRecord()){return}else{if(a==b&&f!==k.BOARD){return}}var d=this.ope.length-1;if(this.current<this.ope.length){for(var c=this.ope.length-1;c>=this.current;c--){this.ope.pop()}d=-1}if(d>=0&&this.ope[d].obj==f&&this.ope[d].property==e&&this.ope[d].id==h&&this.ope[d].num==a&&this.disCombine==0&&((f==k.CELL&&(e==k.QNUM||(e==k.QANS&&k.isAnsNumber)))||f==k.CROSS)){this.ope[d].num=b}else{this.ope.push(new Operation(f,e,h,a,b));this.current++;if(this.chainflag==0){this.chainflag=1}}if(e!=k.QSUB){this.anscount++}this.changeflag=true;this.enb_btn()},addObj:function(c,e){var a,d;if(c==k.CELL){a=new Cell();d=bd.cell[e]}else{if(c==k.CROSS){a=new Cross();d=bd.cross[e]}else{if(c==k.BORDER){a=new Border();d=bd.border[e]}else{if(c==k.EXCELL){a=new Cell();d=bd.excell[e]}}}}for(var b in d){a[b]=d[b]}this.addOpe(c,c,e,a,null)},undo:function(){if(this.current==0){return}this.undoExec=true;this.range={x1:bd.maxbx+1,y1:bd.maxby+1,x2:bd.minbx-1,y2:bd.minby-1};this.disableRecord();while(this.current>0){var a=this.ope[this.current-1];this.exec(a,a.old);if(a.property!=k.QSUB){this.anscount--}this.current--;if(!this.ope[this.current].chain){break}}this.postproc();this.undoExec=false;if(this.current==0){kc.inUNDO=false}},redo:function(){if(this.current==this.ope.length){return}this.redoExec=true;this.range={x1:bd.maxbx+1,y1:bd.maxby+1,x2:bd.minbx-1,y2:bd.minby-1};this.disableRecord();while(this.current<this.ope.length){var a=this.ope[this.current];this.exec(a,a.num);if(a.property!=k.QSUB){this.anscount++}this.current++;if(this.current<this.ope.length&&!this.ope[this.current].chain){break}}this.postproc();this.redoExec=false;if(this.ope.length==0){kc.inREDO=false}},postproc:function(){if(this.reqReset){this.reqReset=false;bd.setposAll();bd.setminmax();base.resetInfo(false);base.resize_canvas()}else{pc.paintRange(this.range.x1,this.range.y1,this.range.x2,this.range.y2)}this.enableRecord();this.enableInfo();this.enb_btn()},exec:function(c,b){var a=c.property;if(c.obj==k.CELL){if(a==k.QUES){bd.sQuC(c.id,b)}else{if(a==k.QNUM){bd.sQnC(c.id,b)}else{if(a==k.DIREC){bd.sDiC(c.id,b)}else{if(a==k.QANS){bd.sQaC(c.id,b)}else{if(a==k.QSUB){bd.sQsC(c.id,b)}else{if(a==k.CELL&&!!b){bd.cell[c.id]=b}}}}}}this.paintStack(bd.cell[c.id].bx-1,bd.cell[c.id].by-1,bd.cell[c.id].bx+1,bd.cell[c.id].by+1)}else{if(c.obj==k.EXCELL){if(a==k.QNUM){bd.sQnE(c.id,b)}else{if(a==k.DIREC){bd.sDiE(c.id,b)}else{if(a==k.EXCELL&&!!b){bd.excell[c.id]=b}}}}else{if(c.obj==k.CROSS){if(a==k.QUES){bd.sQuX(c.id,b)}else{if(a==k.QNUM){bd.sQnX(c.id,b)}else{if(a==k.CROSS&&!!b){bd.cross[c.id]=b}}}this.paintStack(bd.cross[c.id].bx-1,bd.cross[c.id].by-1,bd.cross[c.id].bx+1,bd.cross[c.id].by+1)}else{if(c.obj==k.BORDER){if(a==k.QUES){bd.sQuB(c.id,b)}else{if(a==k.QNUM){bd.sQnB(c.id,b)}else{if(a==k.QANS){bd.sQaB(c.id,b)}else{if(a==k.QSUB){bd.sQsB(c.id,b)}else{if(a==k.LINE){bd.sLiB(c.id,b)}else{if(a==k.BORDER&&!!b){bd.border[c.id]=b}}}}}}this.paintBorder(c.id)}else{if(c.obj==k.BOARD){var e={x1:0,y1:0,x2:2*k.qcols,y2:2*k.qrows};this.disableInfo();if(b&menu.ex.TURNFLIP){menu.ex.turnflip(b,e)}else{menu.ex.expandreduce(b,e)}this.range={x1:bd.minbx,y1:bd.minby,x2:bd.maxbx,y2:bd.maxby};this.reqReset=true}}}}}},paintBorder:function(a){if(isNaN(a)||!bd.border[a]){return}if(bd.border[a].bx&1){this.paintStack(bd.border[a].bx-2,bd.border[a].by-1,bd.border[a].bx+2,bd.border[a].by+1)}else{this.paintStack(bd.border[a].bx-1,bd.border[a].by-2,bd.border[a].bx+1,bd.border[a].by+2)}},paintStack:function(b,d,a,c){if(this.range.x1>b){this.range.x1=b}if(this.range.y1>d){this.range.y1=d}if(this.range.x2<a){this.range.x2=a}if(this.range.y2<c){this.range.y2=c}}};Caption=function(){this.menu="";this.label=""};MenuData=function(b,a){this.caption={ja:b,en:a};this.smenus=[]};Menu=function(){this.dispfloat=[];this.floatpanel=[];this.pop="";this.movingpop="";this.offset=new Pos(0,0);this.btnstack=[];this.labelstack=[];this.ex=new MenuExec();this.ex.init();this.language="ja";this.ispencilbox=(k.isKanpenExist&&(k.puzzleid!=="nanro"&&k.puzzleid!=="ayeheya"&&k.puzzleid!=="kurochute"));var d={mouseover:ee.ebinder(this,this.menuhover),mouseout:ee.ebinder(this,this.menuout)};this.EL_MENU=ee.addTemplate("menupanel","li",{className:"menu"},null,d);var a={mouseout:ee.ebinder(this,this.floatmenuout)};this.EL_FLOAT=ee.addTemplate("float_parent","menu",{className:"floatmenu"},{backgroundColor:base.floatbgcolor},a);var c={mouseover:ee.ebinder(this,this.submenuhover),mouseout:ee.ebinder(this,this.submenuout),click:ee.ebinder(this,this.submenuclick)};var b={mouseover:ee.ebinder(this,this.submenuhover),mouseout:ee.ebinder(this,this.submenuout)};this.EL_SMENU=ee.addTemplate("","li",{className:"smenu"},null,c);this.EL_SPARENT=ee.addTemplate("","li",{className:"smenu"},null,b);this.EL_SELECT=ee.addTemplate("","li",{className:"smenu"},{fontWeight:"900",fontSize:"10pt"},b);this.EL_SEPARATE=ee.addTemplate("","li",{className:"smenusep",innerHTML:"&nbsp;"},null,null);this.EL_CHECK=ee.addTemplate("","li",{className:"smenu"},{paddingLeft:"6pt",fontSize:"10pt"},c);this.EL_LABEL=ee.addTemplate("","li",{className:"smenulabel"},null,null);this.EL_CHILD=this.EL_CHECK;this.EL_DIVPACK=ee.addTemplate("","div",null,null,null);this.EL_SPAN=ee.addTemplate("","span",{unselectable:"on"},null,null);this.EL_CHECKBOX=ee.addTemplate("","input",{type:"checkbox",check:""},null,{click:ee.ebinder(this,this.checkclick)});this.EL_SELCHILD=ee.addTemplate("","div",{className:"flag",unselectable:"on"},null,{click:ee.ebinder(this,this.selectclick)});this.EL_BUTTON=ee.addTemplate("","input",{type:"button"},null,null);this.EL_UBUTTON=ee.addTemplate("btnarea","input",{type:"button"},null,null)};Menu.prototype={menuinit:function(){this.menuarea();this.managearea();this.poparea();this.displayAll()},menureset:function(){this.dispfloat=[];this.floatpanel=[];this.pop="";this.btnstack=[];this.labelstack=[];this.managestack=[];this.popclose();this.menuclear();this.floatmenuclose(0);ee("float_parent").el.innerHTML="";if(!!ee("btncolor2")){ee("btncolor2").remove()}ee("btnarea").el.innerHTML="";ee("urlbuttonarea").el.innerHTML="";ee("menupanel").el.innerHTML="";ee("usepanel").el.innerHTML="";ee("checkpanel").el.innerHTML="";pp.reset()},addButtons:function(b,c,d,a){if(!!c){b.onclick=c}ee(b).unselectable();this.btnstack.push({el:b,str:{ja:d,en:a}})},addLabels:function(b,c,a){this.labelstack.push({el:b,str:{ja:c,en:a}})},displayAll:function(){for(var b in pp.flags){this.setdisplay(b)}for(var b=0,a=this.btnstack.length;b<a;b++){if(!this.btnstack[b].el){continue}this.btnstack[b].el.value=this.btnstack[b].str[menu.language]}for(var b=0,a=this.labelstack.length;b<a;b++){if(!this.labelstack[b].el){continue}this.labelstack[b].el.innerHTML=this.labelstack[b].str[menu.language]}},setdisplay:function(j){switch(pp.type(j)){case pp.MENU:var c=ee("ms_"+j);if(!!c){c.el.innerHTML="["+pp.getMenuStr(j)+"]"}break;case pp.SMENU:case pp.LABEL:case pp.SPARENT:var d=ee("ms_"+j);if(!!d){d.el.innerHTML=pp.getMenuStr(j)}break;case pp.SELECT:var d=ee("ms_"+j),m=ee("cl_"+j);if(!!d){d.el.innerHTML="&nbsp;"+pp.getMenuStr(j)}if(!!m){m.el.innerHTML=pp.getLabel(j)}for(var f=0,h=pp.flags[j].child.length;f<h;f++){this.setdisplay(""+j+"_"+pp.flags[j].child[f])}break;case pp.CHILD:var d=ee("ms_"+j),e=ee("up_"+j);var a=(pp.getVal(j)==pp.getVal(pp.flags[j].parent));var n=pp.getMenuStr(j);if(!!d){d.el.innerHTML=(a?"+":"&nbsp;")+n}if(!!e){e.el.innerHTML=n;e.el.className=(a?"childsel":"child")}break;case pp.CHECK:var d=ee("ms_"+j),b=ee("ck_"+j),m=ee("cl_"+j);var l=pp.getVal(j);if(!!d){d.el.innerHTML=(l?"+":"&nbsp;")+pp.getMenuStr(j)}if(!!b){b.el.checked=l}if(!!m){m.el.innerHTML=pp.getLabel(j)}break}},menuarea:function(){var h=ee.binder(pp,pp.addMenu),c=ee.binder(pp,pp.addSParent),d=ee.binder(pp,pp.addSmenu),b=ee.binder(pp,pp.addSelect),l=ee.binder(pp,pp.addCheck),a=ee.binder(pp,pp.addCaption),i=ee.binder(pp,pp.addChild),f=ee.binder(pp,pp.addSeparator),j=ee.binder(pp,pp.addFlagOnly),e=ee.binder(pp,pp.setLabel);h("file","ƒtƒ@ƒCƒ‹","File");d("newboard","file","V‹Kì¬","New Board");d("urlinput","file","URL“ü—Í","Import from URL");d("urloutput","file","URLo—Í","Export URL");f("sep_file","file");d("fileopen","file","ƒtƒ@ƒCƒ‹‚ðŠJ‚­","Open the file");c("filesavep","file","ƒtƒ@ƒCƒ‹•Û‘¶ ->","Save the file as ... ->");if(fio.dbm.DBaccept>0){d("database","file","ˆêŽž•Û‘¶/–ß‚·","Temporary Stack")}if(base.enableSaveImage){f("sep_image","file");c("imagesavep","file","‰æ‘œ‚ð•Û‘¶ ->","Save as image file")}d("filesave","filesavep","‚Ï‚¸‚Õ‚êv3Œ`Ž®","Puz-Pre v3 format");if(this.ispencilbox){d("filesave2","filesavep","pencilboxŒ`Ž®","Pencilbox format")}if(base.enableSaveImage){d("imagedl","imagesavep","‰æ‘œ‚ðƒ_ƒEƒ“ƒ[ƒh","Download the image");d("imagesave","imagesavep","•ÊƒEƒBƒ“ƒhƒE‚ÅŠJ‚­","Open another window")}h("edit","•ÒW","Edit");d("adjust","edit","”Õ–Ê‚Ì’²®","Adjust the Board");d("turn","edit","”½“]E‰ñ“]","Filp/Turn the Board");h("disp","•\Ž¦","Display");b("size","disp",2,[0,1,2,3,4],"•\Ž¦ƒTƒCƒY","Cell Size");f("sep_disp1","disp");if(!!k.irowake){l("irowake","disp",(k.irowake==2?true:false),"ü‚ÌF•ª‚¯","Color coding");e("irowake","ü‚ÌF•ª‚¯‚ð‚·‚é","Color each lines")}l("cursor","disp",true,"ƒJ[ƒ\ƒ‹‚Ì•\Ž¦","Display cursor");f("sep_disp2","disp");d("repaint","disp","”Õ–Ê‚ÌÄ•`‰æ","Repaint whole board");d("manarea","disp","ŠÇ——Ìˆæ‚ð‰B‚·","Hide Management Area");d("dispsize","size","ƒTƒCƒYŽw’è","Cell Size");a("cap_dispmode","size","•\Ž¦ƒ‚[ƒh","Display mode");i("size_0","size","ƒTƒCƒY ‹É¬","Ex Small");i("size_1","size","ƒTƒCƒY ¬","Small");i("size_2","size","ƒTƒCƒY •W€","Normal");i("size_3","size","ƒTƒCƒY ‘å","Large");i("size_4","size","ƒTƒCƒY “Á‘å","Ex Large");f("sep_size","size");l("adjsize","size",true,"ƒTƒCƒY‚ÌŽ©“®’²ß","Auto Adjustment");h("setting","Ý’è","Setting");if(k.EDITOR){b("mode","setting",(k.editmode?1:3),[1,3],"ƒ‚[ƒh","mode");e("mode","ƒ‚[ƒh","mode")}else{j("mode",3)}puz.menufix();l("autocheck","setting",k.playmode,"³“šŽ©“®”»’è","Auto Answer Check");l("lrcheck","setting",false,"ƒ}ƒEƒX¶‰E”½“]","Mouse button inversion");e("lrcheck","ƒ}ƒEƒX‚Ì¶‰Eƒ{ƒ^ƒ“‚ð”½“]‚·‚é","Invert button of the mouse");if(kp.ctl[1].enable||kp.ctl[3].enable){l("keypopup","setting",kp.defaultdisp,"ƒpƒlƒ‹“ü—Í","Panel inputting");e("keypopup","”ŽšE‹L†‚ðƒpƒlƒ‹‚Å“ü—Í‚·‚é","Input numbers by panel")}b("language","setting",0,[0,1],"Œ¾Œê","Language");i("mode_1","mode","–â‘èì¬ƒ‚[ƒh","Edit mode");i("mode_3","mode","‰ñ“šƒ‚[ƒh","Answer mode");i("language_0","language","“ú–{Œê","“ú–{Œê");i("language_1","language","English","English");h("other","‚»‚Ì‘¼","Others");d("credit","other","‚Ï‚¸‚Õ‚êv3‚É‚Â‚¢‚Ä","About PUZ-PRE v3");f("sep_other","other");c("link","other","ƒŠƒ“ƒN","Link");d("jumpv3","link","‚Ï‚¸‚Õ‚êv3‚Ìƒy[ƒW‚Ö","Jump to PUZ-PRE v3 page");d("jumptop","link","˜A‘±”­”j•ÛŠÇŒÉTOP‚Ö","Jump to indi.s58.xrea.com");d("jumpblog","link","‚Í‚Á‚Ï“ú‹L(blog)‚Ö","Jump to my blog");this.createAllFloat()},addUseToFlags:function(){pp.addSelect("use","setting",1,[1,2],"‘€ì•û–@","Input Type");pp.setLabel("use","‘€ì•û–@","Input Type");pp.addChild("use_1","use","¶‰Eƒ{ƒ^ƒ“","LR Button");pp.addChild("use_2","use","1ƒ{ƒ^ƒ“","One Button")},addRedLineToFlags:function(){pp.addCheck("dispred","setting",false,"Œq‚ª‚èƒ`ƒFƒbƒN","Continuous Check");pp.setLabel("dispred","ü‚Ì‚Â‚È‚ª‚è‚ðƒ`ƒFƒbƒN‚·‚é","Check countinuous lines")},addRedBlockToFlags:function(){pp.addCheck("dispred","setting",false,"Œq‚ª‚èƒ`ƒFƒbƒN","Continuous Check");pp.setLabel("dispred","•ƒ}ƒX‚Ì‚Â‚È‚ª‚è‚ðƒ`ƒFƒbƒN‚·‚é","Check countinuous black cells")},addRedBlockRBToFlags:function(){pp.addCheck("dispred","setting",false,"Œq‚ª‚èƒ`ƒFƒbƒN","Continuous Check");pp.setLabel("dispred","ƒiƒiƒ•ƒ}ƒX‚Ì‚Â‚È‚ª‚è‚ðƒ`ƒFƒbƒN‚·‚é","Check countinuous black cells with its corner")},createAllFloat:function(){var n=false;if(navigator.userAgent.match(/MSIE (\d+)/)){if(parseInt(RegExp.$1)<=7){n=true}}for(var l=0;l<pp.flaglist.length;l++){var b=pp.flaglist[l];if(!pp.flags[b]){continue}var c,a="ms_"+b;switch(pp.type(b)){case pp.MENU:c=ee.createEL(this.EL_MENU,a);continue;break;case pp.SEPARATE:c=ee.createEL(this.EL_SEPARATE,a);if(n){this.csshack_forIE6(c)}break;case pp.LABEL:c=ee.createEL(this.EL_LABEL,a);break;case pp.SELECT:c=ee.createEL(this.EL_SELECT,a);break;case pp.SMENU:c=ee.createEL(this.EL_SMENU,a);break;case pp.CHECK:c=ee.createEL(this.EL_CHECK,a);break;case pp.CHILD:c=ee.createEL(this.EL_CHILD,a);break;case pp.SPARENT:var e=(pp.getMenuStr(b).indexOf("->")>=0);c=ee.createEL((e?this.EL_SPARENT:this.EL_SELECT),a);break;default:continue;break}var j=pp.flags[b].parent;if(!this.floatpanel[j]){this.floatpanel[j]=ee.createEL(this.EL_FLOAT,"float_"+j)}this.floatpanel[j].appendChild(c)}var d=ee("float_setting").el,h=d.firstChild.style.fontWeight;for(var l=1,m=d.childNodes.length;l<m;l++){var f=d.childNodes[l];if(h!=f.style.fontWeight){var c=ee.createEL(this.EL_SEPARATE,"");if(n){this.csshack_forIE6(c)}ee(c).insertBefore(f);l++;m++}h=f.style.fontWeight}if(k.PLAYER){ee("ms_newboard").el.className="smenunull";ee("ms_urloutput").el.className="smenunull";ee("ms_adjust").el.className="smenunull"}ee("ms_jumpv3").el.style.fontSize="10pt";ee("ms_jumpv3").el.style.paddingLeft="8pt";ee("ms_jumptop").el.style.fontSize="10pt";ee("ms_jumptop").el.style.paddingLeft="8pt";ee("ms_jumpblog").el.style.fontSize="10pt";ee("ms_jumpblog").el.style.paddingLeft="8pt"},csshack_forIE6:function(a){if(a.className=="smenusep"){a.style.lineHeight="2pt";a.style.display="inline"}},menuhover:function(b){if(!!this.movingpop){return true}var a=ee.getSrcElement(b).id.substr(3);this.floatmenuopen(b,a,0);ee("menupanel").replaceChildrenClass("menusel","menu");ee.getSrcElement(b).className="menusel"},menuout:function(a){if(!this.insideOfMenu(a)){this.menuclear();this.floatmenuclose(0)}},menuclear:function(){ee("menupanel").replaceChildrenClass("menusel","menu")},submenuhover:function(b){var a=ee.getSrcElement(b).id.substr(3);if(ee.getSrcElement(b).className==="smenu"){ee.getSrcElement(b).className="smenusel"}if(pp.flags[a]&&(pp.type(a)===pp.SELECT||pp.type(a)===pp.SPARENT)){if(ee.getSrcElement(b).className!=="smenunull"){this.floatmenuopen(b,a,this.dispfloat.length)}}},submenuout:function(b){var a=ee.getSrcElement(b).id.substr(3);if(ee.getSrcElement(b).className==="smenusel"){ee.getSrcElement(b).className="smenu"}if(pp.flags[a]&&(pp.type(a)===pp.SELECT||pp.type(a)===pp.SPARENT)){this.floatmenuout(b)}},submenuclick:function(b){var a=ee.getSrcElement(b).id.substr(3);if(ee.getSrcElement(b).className==="smenunull"){return}this.menuclear();this.floatmenuclose(0);switch(pp.type(a)){case pp.SMENU:this.popopen(b,a);break;case pp.CHILD:pp.setVal(pp.flags[a].parent,pp.getVal(a));break;case pp.CHECK:pp.setVal(a,!pp.getVal(a));break}},floatmenuopen:function(d,b,f){if(f===0){this.menuclear()}this.floatmenuclose(f);if(f>0&&!this.dispfloat[f-1]){return}var c=ee(ee.getSrcElement(d).id).getRect();var a=this.floatpanel[b];if(f==0){a.style.left=c.left+1+"px";a.style.top=c.bottom+1+"px"}else{if(!k.br.IEmoz4){a.style.left=c.right-3+"px";a.style.top=c.top-3+"px"}else{a.style.left=ee.pageX(d)+"px";a.style.top=c.top-3+"px"}}a.style.zIndex=101+f;a.style.display="block";this.dispfloat.push(a)},floatmenuclose:function(c){for(var b=this.dispfloat.length-1;b>=c;b--){if(b!==0){var a="ms_"+this.dispfloat[b].id.substr(6);ee(a).el.className="smenu"}this.dispfloat[b].style.display="none";this.dispfloat.pop()}},floatmenuout:function(b){for(var a=this.dispfloat.length-1;a>=0;a--){if(this.insideOf(this.dispfloat[a],b)){this.floatmenuclose(a+1);return}}this.menuclear();this.floatmenuclose(0)},insideOf:function(c,f){var b=ee.pageX(f);var a=ee.pageY(f);var d=ee(c.id).getRect();return(b>=d.left&&b<=d.right&&a>=d.top&&a<=d.bottom)},insideOfMenu:function(d){var b=ee.pageX(d);var a=ee.pageY(d);var c=ee("ms_file").getRect(),f=ee("ms_other").getRect();return(b>=c.left&&b<=f.right&&a>=c.top)},managearea:function(){for(var f=0;f<pp.flaglist.length;f++){var e=pp.flaglist[f];if(!pp.flags[e]||!pp.getLabel(e)){continue}var a=ee(ee.createEL(this.EL_DIVPACK,"div_"+e));switch(pp.type(e)){case pp.SELECT:a.appendEL(ee.createEL(this.EL_SPAN,"cl_"+e));a.appendHTML("&nbsp;|&nbsp;");for(var c=0;c<pp.flags[e].child.length;c++){var b=pp.flags[e].child[c];a.appendEL(ee.createEL(this.EL_SELCHILD,["up",e,b].join("_")));a.appendHTML("&nbsp;")}a.appendBR();ee("usepanel").appendEL(a.el);break;case pp.CHECK:a.appendEL(ee.createEL(this.EL_CHECKBOX,"ck_"+e));a.appendHTML("&nbsp;");a.appendEL(ee.createEL(this.EL_SPAN,"cl_"+e));a.appendBR();ee("checkpanel").appendEL(a.el);break}}if(k.irowake){var d=ee.createEL(this.EL_BUTTON,"ck_btn_irowake");this.addButtons(d,ee.binder(menu.ex,menu.ex.irowakeRemake),"F•ª‚¯‚µ‚È‚¨‚·","Change the color of Line");ee("ck_btn_irowake").insertAfter(ee("cl_irowake").el);var d=ee("checkpanel").el.removeChild(ee("div_irowake").el);ee("checkpanel").el.appendChild(d)}ee("translation").unselectable().el.onclick=ee.binder(this,this.translate);this.addLabels(ee("translation").el,"English","“ú–{Œê");ee("expression").el.innerHTML=base.expression.ja;if(k.EDITOR){ee("timerpanel").el.style.display="none";ee("separator2").el.style.display="none"}if(!!ee("ck_keypopup")){pp.funcs.keypopup()}ee.createEL(this.EL_UBUTTON,"btncheck");ee("btnarea").appendHTML("&nbsp;");ee.createEL(this.EL_UBUTTON,"btnundo");ee.createEL(this.EL_UBUTTON,"btnredo");ee("btnarea").appendHTML("&nbsp;");ee.createEL(this.EL_UBUTTON,"btnclear");ee.createEL(this.EL_UBUTTON,"btnclear2");this.addButtons(ee("btncheck").el,ee.binder(ans,ans.check),"ƒ`ƒFƒbƒN","Check");this.addButtons(ee("btnundo").el,ee.binder(um,um.undo),"–ß","<-");this.addButtons(ee("btnredo").el,ee.binder(um,um.redo),"i","->");this.addButtons(ee("btnclear").el,ee.binder(menu.ex,menu.ex.ACconfirm),"‰ñ“šÁ‹Ž","Erase Answer");this.addButtons(ee("btnclear2").el,ee.binder(menu.ex,menu.ex.ASconfirm),"•â•Á‹Ž","Erase Auxiliary Marks");if(k.irowake!=0){var d=ee.createEL(this.EL_BUTTON,"btncolor2");this.addButtons(d,ee.binder(menu.ex,menu.ex.irowakeRemake),"F•ª‚¯‚µ‚È‚¨‚·","Change the color of Line");ee("btncolor2").insertAfter(ee("btnclear2").el).el.style.display="none"}},checkclick:function(c){var b=ee.getSrcElement(c);var a=b.id.substr(3);pp.setVal(a,!!b.checked)},selectclick:function(b){var a=ee.getSrcElement(b).id.split("_");pp.setVal(a[1],a[2])},poparea:function(){var pop=ee("popup_parent").el.firstChild;while(!!pop){var _el=pop.firstChild;while(!!_el){if(_el.className==="titlebar"){this.titlebarfunc(_el);break}_el=_el.nextSibling}pop=pop.nextSibling}this.titlebarfunc(ee("credit3_1").el);document.onmousemove=ee.ebinder(this,this.titlebarmove);document.onmouseup=ee.ebinder(this,this.titlebarup);var btn=ee.binder(this,this.addButtons);var lab=ee.binder(this,this.addLabels);var close=ee.ebinder(this,this.popclose);var func=null;func=ee.ebinder(this.ex,this.ex.newboard);lab(ee("bar1_1").el,"”Õ–Ê‚ÌV‹Kì¬","Createing New Board");lab(ee("pop1_1_cap0").el,"”Õ–Ê‚ðV‹Kì¬‚µ‚Ü‚·B","Create New Board.");if(k.puzzleid!=="sudoku"&&k.puzzleid!=="tawa"){lab(ee("pop1_1_cap1").el,"‚æ‚±","Cols");lab(ee("pop1_1_cap2").el,"‚½‚Ä","Rows")}btn(document.newboard.newboard,func,"V‹Kì¬","Create");btn(document.newboard.cancel,close,"ƒLƒƒƒ“ƒZƒ‹","Cancel");func=ee.ebinder(this.ex,this.ex.urlinput);lab(ee("bar1_2").el,"URL“ü—Í","Import from URL");lab(ee("pop1_2_cap0").el,"URL‚©‚ç–â‘è‚ð“Ç‚Ýž‚Ý‚Ü‚·B","Import a question from URL.");btn(document.urlinput.urlinput,func,"“Ç‚Ýž‚Þ","Import");btn(document.urlinput.cancel,close,"ƒLƒƒƒ“ƒZƒ‹","Cancel");func=ee.ebinder(this.ex,this.ex.urloutput);lab(ee("bar1_3").el,"URLo—Í","Export URL");var btt=function(name,strJP,strEN,eval){if(eval===false){return}var el=ee.createEL(menu.EL_BUTTON,"");el.name=name;ee("urlbuttonarea").appendEL(el).appendBR();btn(el,func,strJP,strEN)};btt("pzprv3","‚Ï‚¸‚Õ‚êv3‚ÌURL‚ðo—Í‚·‚é","Output PUZ-PRE v3 URL",true);btt("pzprapplet","‚Ï‚¸‚Õ‚ê(ƒAƒvƒŒƒbƒg)‚ÌURL‚ðo—Í‚·‚é","Output PUZ-PRE(JavaApplet) URL",!k.ispzprv3ONLY);btt("kanpen","ƒJƒ“ƒyƒ“‚ÌURL‚ðo—Í‚·‚é","Output Kanpen URL",k.isKanpenExist);btt("heyaapp","‚Ö‚â‚í‚¯ƒAƒvƒŒƒbƒg‚ÌURL‚ðo—Í‚·‚é","Output Heyawake-Applet URL",(k.puzzleid==="heyawake"));btt("pzprv3edit","‚Ï‚¸‚Õ‚êv3‚ÌÄ•ÒW—pURL‚ðo—Í‚·‚é","Output PUZ-PRE v3 Re-Edit URL",true);ee("urlbuttonarea").appendBR();func=ee.ebinder(this.ex,this.ex.openurl);btn(document.urloutput.openurl,func,"‚±‚ÌURL‚ðŠJ‚­","Open this URL on another window/tab");btn(document.urloutput.close,close,"•Â‚¶‚é","Close");func=ee.ebinder(this.ex,this.ex.fileopen);lab(ee("bar1_4").el,"ƒtƒ@ƒCƒ‹‚ðŠJ‚­","Open file");lab(ee("pop1_4_cap0").el,"ƒtƒ@ƒCƒ‹‘I‘ð","Choose file");document.fileform.filebox.onchange=func;btn(document.fileform.close,close,"•Â‚¶‚é","Close");func=ee.ebinder(fio.dbm,fio.dbm.clickHandler);lab(ee("bar1_8").el,"ˆêŽž•Û‘¶/–ß‚·","Temporary Stack");document.database.sorts.onchange=func;document.database.datalist.onchange=func;document.database.tableup.onclick=func;document.database.tabledn.onclick=func;btn(document.database.open,func,"ƒf[ƒ^‚ð“Ç‚Ýž‚Þ","Load");btn(document.database.save,func,"”Õ–Ê‚ð•Û‘¶","Save");lab(ee("pop1_8_com").el,"ƒRƒƒ“ƒg:","Comment:");btn(document.database.comedit,func,"ƒRƒƒ“ƒg‚ð•ÒW‚·‚é","Edit Comment");btn(document.database.difedit,func,"“ïˆÕ“x‚ðÝ’è‚·‚é","Set difficulty");btn(document.database.del,func,"íœ","Delete");btn(document.database.close,close,"•Â‚¶‚é","Close");func=ee.ebinder(this.ex,this.ex.popupadjust);lab(ee("bar2_1").el,"”Õ–Ê‚Ì’²®","Adjust the board");lab(ee("pop2_1_cap0").el,"”Õ–Ê‚Ì’²®‚ðs‚¢‚Ü‚·B","Adjust the board.");lab(ee("pop2_1_cap1").el,"Šg‘å","Expand");btn(document.adjust.expandup,func,"ã","UP");btn(document.adjust.expanddn,func,"‰º","Down");btn(document.adjust.expandlt,func,"¶","Left");btn(document.adjust.expandrt,func,"‰E","Right");lab(ee("pop2_1_cap2").el,"k¬","Reduce");btn(document.adjust.reduceup,func,"ã","UP");btn(document.adjust.reducedn,func,"‰º","Down");btn(document.adjust.reducelt,func,"¶","Left");btn(document.adjust.reducert,func,"‰E","Right");btn(document.adjust.close,close,"•Â‚¶‚é","Close");lab(ee("bar2_2").el,"”½“]E‰ñ“]","Flip/Turn the board");lab(ee("pop2_2_cap0").el,"”Õ–Ê‚Ì‰ñ“]E”½“]‚ðs‚¢‚Ü‚·B","Flip/Turn the board.");btn(document.flip.turnl,func,"¶90‹‰ñ“]","Turn left by 90 degree");btn(document.flip.turnr,func,"‰E90‹‰ñ“]","Turn right by 90 degree");btn(document.flip.flipy,func,"ã‰º”½“]","Flip upside down");btn(document.flip.flipx,func,"¶‰E”½“]","Flip leftside right");btn(document.flip.close,close,"•Â‚¶‚é","Close");lab(ee("bar3_1").el,"credit","credit");lab(ee("credit3_1").el,"‚Ï‚¸‚Õ‚êv3 "+pzprversion+"<br>\n<br>\n‚Ï‚¸‚Õ‚êv3‚Í ‚Í‚Á‚Ï/˜A‘±”­”j‚ªì¬‚µ‚Ä‚¢‚Ü‚·B<br>\nƒ‰ƒCƒuƒ‰ƒŠ‚Æ‚µ‚ÄuuCanvas1.0, Google Gears‚ðŽg—p‚µ‚Ä‚¢‚Ü‚·B<br>\n<br>\n","PUZ-PRE v3 "+pzprversion+"<br>\n<br>\nPUZ-PRE v3 id made by happa.<br>\nThis script use uuCanvas1.0 and Google Gears as libraries.&nbsp;<br>\n<br>\n");btn(document.credit.close,close,"•Â‚¶‚é","OK");func=ee.ebinder(this,this.ex.dispsize);lab(ee("bar4_1").el,"•\Ž¦ƒTƒCƒY‚Ì•ÏX","Change size");lab(ee("pop4_1_cap0").el,"•\Ž¦ƒTƒCƒY‚ð•ÏX‚µ‚Ü‚·B","Change the display size.");lab(ee("pop4_1_cap1").el,"•\Ž¦ƒTƒCƒY","Display size");btn(document.dispsize.dispsize,func,"•ÏX‚·‚é","Change");btn(document.dispsize.cancel,close,"ƒLƒƒƒ“ƒZƒ‹","Cancel");debug.poptest_func()},popopen:function(c,b){this.popclose();if(pp.funcs[b]){pp.funcs[b]()}if(this.pop){var a=this.pop.el;a.style.left=ee.pageX(c)-8+"px";a.style.top=ee.pageY(c)-8+"px";a.style.display="inline"}},popclose:function(){if(this.pop){if(this.pop.el.id=="pop1_8"){fio.dbm.closeDialog()}this.pop.el.style.display="none";this.pop="";this.menuclear();this.movingpop="";kc.enableKey=true}},titlebarfunc:function(a){a.onmousedown=ee.ebinder(this,this.titlebardown);ee(a).unselectable().el},titlebardown:function(b){var a=ee.getSrcElement(b).parentNode;this.movingpop=a;this.offset.x=ee.pageX(b)-parseInt(a.style.left);this.offset.y=ee.pageY(b)-parseInt(a.style.top)},titlebarup:function(b){var a=this.movingpop;if(!!a){this.movingpop=""}},titlebarmove:function(b){var a=this.movingpop;if(!!a){a.style.left=ee.pageX(b)-this.offset.x+"px";a.style.top=ee.pageY(b)-this.offset.y+"px"}},isLangJP:function(){return this.language=="ja"},isLangEN:function(){return this.language=="en"},setLang:function(a){(a=="ja")?this.setLangJP():this.setLangEN()},translate:function(){(this.isLangJP())?this.setLangEN():this.setLangJP()},setLangJP:function(){this.setLangStr("ja")},setLangEN:function(){this.setLangStr("en")},setLangStr:function(a){this.language=a;document.title=base.gettitle();ee("title2").el.innerHTML=base.gettitle();ee("expression").el.innerHTML=base.expression[this.language];this.displayAll();this.ex.dispmanstr();base.resize_canvas()}};SSData=function(){this.id="";this.type=0;this.val=1;this.parent=1;this.child=[];this.str={ja:new Caption(),en:new Caption()}};Properties=function(){this.flags=[];this.flaglist=[];this.MENU=6;this.SPARENT=7;this.SMENU=0;this.SELECT=1;this.CHECK=2;this.LABEL=3;this.CHILD=4;this.SEPARATE=5};Properties.prototype={reset:function(){this.flags=[];this.flaglist=[]},addMenu:function(b,c,a){this.addFlags(b,"",this.MENU,0,c,a)},addSParent:function(c,b,d,a){this.addFlags(c,b,this.SPARENT,0,d,a)},addSmenu:function(c,b,d,a){this.addFlags(c,b,this.SMENU,0,d,a)},addCaption:function(c,b,d,a){this.addFlags(c,b,this.LABEL,0,d,a)},addSeparator:function(b,a){this.addFlags(b,a,this.SEPARATE,0,"","")},addCheck:function(c,b,e,d,a){this.addFlags(c,b,this.CHECK,e,d,a)},addSelect:function(c,b,e,f,d,a){this.addFlags(c,b,this.SELECT,e,d,a);this.flags[c].child=f},addChild:function(c,b,e,a){var d=c.split("_");this.addFlags(c,d[0],this.CHILD,d[1],e,a)},addFlagOnly:function(a,b){this.addFlags(a,"","",b,"","")},addFlags:function(d,c,b,f,e,a){this.flags[d]=new SSData();this.flags[d].id=d;this.flags[d].type=b;this.flags[d].val=f;this.flags[d].parent=c;this.flags[d].str.ja.menu=e;this.flags[d].str.en.menu=a;this.flaglist.push(d)},setLabel:function(b,c,a){if(!this.flags[b]){return}this.flags[b].str.ja.label=c;this.flags[b].str.en.label=a},getMenuStr:function(a){return this.flags[a].str[menu.language].menu},getLabel:function(a){return this.flags[a].str[menu.language].label},type:function(a){return this.flags[a].type},istype:function(b,a){return(this.flags[b].type===a)},getVal:function(a){return this.flags[a]?this.flags[a].val:0},setVal:function(b,c,a){if(!this.flags[b]){return}else{if(this.flags[b].type===this.CHECK||this.flags[b].type===this.SELECT){this.flags[b].val=c;menu.setdisplay(b);if(this.funcs[b]&&a!==false){this.funcs[b](c)}}}},funcs:{urlinput:function(){menu.pop=ee("pop1_2")},urloutput:function(){menu.pop=ee("pop1_3");document.urloutput.ta.value=""},fileopen:function(){menu.pop=ee("pop1_4")},filesave:function(){menu.ex.filesave(fio.PZPR)},filesave2:function(){if(!!fio.kanpenSave){menu.ex.filesave(fio.PBOX)}},imagedl:function(){menu.ex.imagesave(true)},imagesave:function(){menu.ex.imagesave(false)},database:function(){menu.pop=ee("pop1_8");fio.dbm.openDialog()},adjust:function(){menu.pop=ee("pop2_1")},turn:function(){menu.pop=ee("pop2_2")},credit:function(){menu.pop=ee("pop3_1")},jumpv3:function(){window.open("./","","")},jumptop:function(){window.open("../../","","")},jumpblog:function(){window.open("http://d.hatena.ne.jp/sunanekoroom/","","")},irowake:function(){pc.paintAll()},cursor:function(){pc.paintAll()},manarea:function(){menu.ex.dispman()},mode:function(a){menu.ex.modechange(a)},size:function(a){base.resize_canvas()},repaint:function(a){base.resize_canvas()},language:function(a){menu.setLang({0:"ja",1:"en"}[a])},newboard:function(){menu.pop=ee("pop1_1");if(k.puzzleid!="sudoku"){document.newboard.col.value=k.qcols;document.newboard.row.value=k.qrows}kc.enableKey=false},dispsize:function(){menu.pop=ee("pop4_1");document.dispsize.cs.value=k.cellsize;kc.enableKey=false},keypopup:function(){var a=kp.ctl[pp.flags.mode.val].enable;ee("ck_keypopup").el.disabled=(a?"":"true");ee("cl_keypopup").el.style.color=(a?"black":"silver")}}};var debug={extend:function(a){for(var b in a){this[b]=a[b]}},poptest_func:function(){menu.titlebarfunc(ee("bartest").el);document.testform.t1.onclick=ee.binder(this,this.perfeval);document.testform.t2.onclick=ee.binder(this,this.painteval);document.testform.t3.onclick=ee.binder(this,this.resizeeval);document.testform.perfload.onclick=ee.binder(this,this.loadperf);document.testform.filesave.onclick=ee.binder(this,this.filesave);document.testform.pbfilesave.onclick=ee.binder(this,this.filesave_pencilbox);document.testform.fileopen.onclick=ee.binder(this,this.fileopen);document.testform.database.onclick=ee.binder(this,this.dispdatabase);document.testform.erasetext.onclick=ee.binder(this,this.erasetext);document.testform.close.onclick=function(a){ee("poptest").el.style.display="none"};document.testform.testarea.style.fontSize="10pt";document.testform.starttest.style.display="none";document.testform.perfload.style.display=(k.puzzleid!=="country"?"none":"inline");document.testform.pbfilesave.style.display=(!menu.ispencilbox?"none":"inline");document.testform.database.style.display=(!fio.DBaccept<8?"none":"inline");if(k.scriptcheck){debug.testonly_func()}},disppoptest:function(){var a=ee("poptest").el.style;a.display="inline";a.left="40px";a.top="80px"},keydown:function(a){if(kc.isCTRL&&a=="F8"){this.disppoptest();kc.tcMoved=true;return true}return false},filesave:function(){this.setTA(fio.fileencode(fio.PZPR).replace(/\//g,"\n"));this.addTA("");this.addTA(fio.urlstr)},filesave_pencilbox:function(){this.setTA(fio.fileencode(fio.PBOX).replace(/\//g,"\n"))},fileopen:function(){var a=this.getTA().split("\n");fio.filedecode(a.join("/"))},erasetext:function(){this.setTA("");if(k.scriptcheck){ee("testdiv").el.innerHTML=""}},perfeval:function(){this.timeeval("³“š”»’è‘ª’è",ee.binder(ans,ans.checkAns))},painteval:function(){this.timeeval("•`‰æŽžŠÔ‘ª’è",ee.binder(pc,pc.paintAll))},resizeeval:function(){this.timeeval("resize•`‰æ‘ª’è",ee.binder(base,base.resize_canvas))},timeeval:function(e,c){this.addTA(e);var b=0,a=tm.now();while(tm.now()-a<3000){b++;c()}var d=tm.now()-a;this.addTA("‘ª’èƒf[ƒ^ "+d+"ms / "+b+"‰ñ\n•½‹ÏŽžŠÔ   "+(d/b)+"ms")},dispdatabase:function(){var c="";for(var b=0;b<localStorage.length;b++){var a=localStorage.key(b);c+=(""+a+" "+localStorage[a]+"\n")}this.setTA(c)},loadperf:function(){fio.filedecode("pzprv3/country/10/18/44/0 0 1 1 1 2 2 2 3 4 4 4 5 5 6 6 7 8 /0 9 1 10 10 10 11 2 3 4 12 4 4 5 6 13 13 8 /0 9 1 1 10 10 11 2 3 12 12 12 4 5 14 13 13 15 /0 9 9 9 10 16 16 16 16 17 12 18 4 5 14 13 15 15 /19 19 19 20 20 20 21 17 17 17 22 18 18 14 14 23 23 24 /19 25 25 26 26 21 21 17 22 22 22 18 27 27 27 24 24 24 /28 28 29 26 30 31 21 32 22 33 33 33 33 34 35 35 35 36 /28 29 29 26 30 31 32 32 32 37 38 39 34 34 40 40 35 36 /41 29 29 42 30 31 31 32 31 37 38 39 34 34 34 40 35 36 /41 43 42 42 30 30 31 31 31 37 38 38 38 40 40 40 36 36 /3 . 6 . . 4 . . 2 . . . . . . . . 1 /. . . 5 . . . . . . . . . . . . . . /. . . . . . . . . 1 . . . . . . . . /. . . . . . . . . . . . . . . . . . /3 . . 2 . . . 4 . . . . . . . . . . /. . . 3 . . . . 4 . . . 2 . . . . . /. . . . 3 6 . . . 4 . . . . . . . . /. 5 . . . . . . . 2 . . 3 . . . . . /. . . . . . . . . . . . . . . . . . /. . . . . . . . . . . . . . . . 5 . /0 0 1 1 0 0 1 0 0 1 1 0 0 0 1 1 0 /1 0 0 0 1 0 0 0 1 0 0 1 0 0 0 0 1 /0 0 1 0 1 0 0 1 0 0 0 0 0 0 0 0 0 /0 1 1 0 0 0 1 0 0 1 1 0 1 0 0 0 1 /1 1 0 0 1 0 0 1 1 0 0 0 0 1 0 1 0 /0 1 0 1 0 1 0 0 1 1 1 0 1 0 0 1 1 /1 0 1 0 0 0 0 1 0 1 1 1 0 0 1 1 0 /0 1 0 0 0 0 1 0 0 0 0 1 1 0 1 0 0 /0 1 1 0 1 1 0 0 1 0 1 0 0 0 0 0 0 /1 1 1 0 0 0 1 1 0 0 1 1 1 1 1 0 1 /0 0 1 0 1 0 1 1 0 1 0 1 0 0 1 0 1 0 /1 1 1 0 0 1 1 1 1 0 0 0 1 0 1 0 0 1 /1 1 0 1 1 0 1 0 0 0 0 0 1 0 1 0 0 1 /1 0 0 0 1 0 0 1 0 1 0 1 0 1 1 0 1 0 /0 0 1 0 0 1 0 0 0 0 0 1 0 0 0 1 0 0 /0 1 0 1 1 0 1 0 1 0 0 0 1 1 0 0 0 1 /1 0 1 0 1 0 1 1 0 1 0 0 0 1 1 0 1 1 /1 1 0 0 1 0 0 0 0 1 0 1 0 0 0 1 1 1 /1 0 0 1 0 0 1 0 1 0 1 0 0 0 0 1 1 1 /2 2 1 1 1 2 0 0 2 0 1 0 0 0 0 0 0 2 /1 1 1 2 1 1 0 0 0 1 2 1 0 0 1 2 0 0 /1 0 1 1 1 1 0 0 1 2 2 2 1 0 1 2 2 0 /1 0 0 1 1 2 1 0 2 1 1 1 1 0 1 2 1 0 /1 1 0 2 1 1 2 0 0 0 2 1 2 1 1 1 0 2 /2 1 0 1 1 1 0 2 0 0 0 0 1 1 2 1 0 0 /1 0 1 1 1 2 1 1 0 0 0 0 0 0 1 0 0 0 /0 1 1 2 1 2 1 1 2 1 2 0 1 0 1 0 0 0 /0 1 1 0 1 1 1 2 0 1 0 1 2 2 2 1 0 0 /0 0 0 1 2 2 1 1 0 2 0 0 1 0 1 0 0 0 /");pp.setVal("mode",3);pp.setVal("irowake",true)},getTA:function(){return document.testform.testarea.value},setTA:function(a){document.testform.testarea.value=a},addTA:function(a){document.testform.testarea.value+=(a+"\n")}};MenuExec=function(){this.displaymanage=true;this.qnumw;this.qnumh;this.qnums;this.reader;this.enableReadText=false;this.insex={};this.insex[k.CELL]={1:true};this.insex[k.CROSS]=(k.iscross===1?{2:true}:{0:true});this.insex[k.BORDER]={1:true,2:true};this.insex[k.EXCELL]={1:true};this.EXPAND=16;this.REDUCE=32;this.TURN=64;this.FLIP=128;this.TURNFLIP=this.TURN|this.FLIP;this.EXPANDUP=this.EXPAND|k.UP;this.EXPANDDN=this.EXPAND|k.DN;this.EXPANDLT=this.EXPAND|k.LT;this.EXPANDRT=this.EXPAND|k.RT;this.REDUCEUP=this.REDUCE|k.UP;this.REDUCEDN=this.REDUCE|k.DN;this.REDUCELT=this.REDUCE|k.LT;this.REDUCERT=this.REDUCE|k.RT;this.TURNL=this.TURN|1;this.TURNR=this.TURN|2;this.FLIPX=this.FLIP|1;this.FLIPY=this.FLIP|2;this.boardtype={expandup:[this.REDUCEUP,this.EXPANDUP],expanddn:[this.REDUCEDN,this.EXPANDDN],expandlt:[this.REDUCELT,this.EXPANDLT],expandrt:[this.REDUCERT,this.EXPANDRT],reduceup:[this.EXPANDUP,this.REDUCEUP],reducedn:[this.EXPANDDN,this.REDUCEDN],reducelt:[this.EXPANDLT,this.REDUCELT],reducert:[this.EXPANDRT,this.REDUCERT],turnl:[this.TURNR,this.TURNL],turnr:[this.TURNL,this.TURNR],flipy:[this.FLIPY,this.FLIPY],flipx:[this.FLIPX,this.FLIPX]}};MenuExec.prototype={init:function(){if(typeof FileReader=="undefined"){this.reader=null;if(typeof FileList!="undefined"&&typeof File.prototype.getAsText!="undefined"){this.enableGetText=true}}else{this.reader=new FileReader();this.reader.onload=ee.ebinder(this,function(a){this.fileonload(ee.getSrcElement(a).result)})}},modechange:function(a){k.editmode=(a==1);k.playmode=(a==3);kc.prev=-1;ans.errDisp=true;bd.errclear();if(kp.ctl[1].enable||kp.ctl[3].enable){pp.funcs.keypopup()}tc.setAlign();pc.paintAll()},newboard:function(b){if(menu.pop){var a,c;if(k.puzzleid!=="sudoku"){a=mf(parseInt(document.newboard.col.value));c=mf(parseInt(document.newboard.row.value))}else{if(document.newboard.size[0].checked){a=c=9}else{if(document.newboard.size[1].checked){a=c=16}else{if(document.newboard.size[2].checked){a=c=25}else{if(document.newboard.size[3].checked){a=c=4}}}}}if(a>0&&c>0){bd.initBoardSize(a,c)}menu.popclose();base.resetInfo(true);base.resize_canvas()}},urlinput:function(a){if(menu.pop){enc.parseURI(document.urlinput.ta.value);enc.pzlinput();tm.reset();menu.popclose()}},urloutput:function(a){if(menu.pop){switch(ee.getSrcElement(a).name){case"pzprv3":document.urloutput.ta.value=enc.pzloutput(enc.PZPRV3);break;case"pzprapplet":document.urloutput.ta.value=enc.pzloutput(enc.PAPRAPP);break;case"kanpen":document.urloutput.ta.value=enc.pzloutput(enc.KANPEN);break;case"pzprv3edit":document.urloutput.ta.value=enc.pzloutput(enc.PZPRV3E);break;case"heyaapp":document.urloutput.ta.value=enc.pzloutput(enc.HEYAAPP);break}}},openurl:function(b){if(menu.pop){if(document.urloutput.ta.value!==""){var a=window.open(document.urloutput.ta.value,"","")}}},fileopen:function(c){if(menu.pop){menu.popclose()}var b=document.fileform.filebox;if(!!this.reader||this.enableGetText){var a=b.files[0];if(!a){return}if(!!this.reader){this.reader.readAsText(a)}else{this.fileonload(a.getAsText(""))}}else{if(!b.value){return}document.fileform.submit()}document.fileform.reset();tm.reset()},fileonload:function(c){var d=c.split(/[\t\r\n]+/);var a="";for(var b=0;b<d.length;b++){if(d[b].match(/^http\:\/\//)){break}a+=(d[b]+"/")}fio.filedecode(a);document.fileform.reset();tm.reset()},filesave:function(a){var d=prompt("•Û‘¶‚·‚éƒtƒ@ƒCƒ‹–¼‚ð“ü—Í‚µ‚Ä‰º‚³‚¢B",k.puzzleid+".txt");if(!d){return}var c=["\\","/",":","*","?",'"',"<",">","|"];for(var b=0;b<c.length;b++){if(d.indexOf(c[b])!=-1){alert("ƒtƒ@ƒCƒ‹–¼‚Æ‚µ‚ÄŽg—p‚Å‚«‚È‚¢•¶Žš‚ªŠÜ‚Ü‚ê‚Ä‚¢‚Ü‚·B");return}}document.fileform2.filename.value=d;if(navigator.platform.indexOf("Win")!==-1){document.fileform2.platform.value="Win"}else{if(navigator.platform.indexOf("Mac")!==-1){document.fileform2.platform.value="Mac"}else{document.fileform2.platform.value="Others"}}document.fileform2.ques.value=fio.fileencode(a);document.fileform2.urlstr.value=fio.urlstr;document.fileform2.operation.value="save";document.fileform2.submit()},imagesave:function(e){var c=pc.fillTextPrecisely;var a=k.bdmargin;var b=pp.getVal("cursor");pc.fillTextPrecisely=true;k.bdmargin=k.bdmargin_image;pp.setVal("cursor",false,false);g=ee("divques_sub").el.getContext("2d");base.resize_canvas();var d=g.canvas.toDataURL();if(e){document.fileform2.filename.value=k.puzzleid+".gif";document.fileform2.urlstr.value=d.replace("data:image/png;base64,","");document.fileform2.operation.value="imagesave";document.fileform2.submit()}else{window.open(d,"","")}pc.fillTextPrecisely=c;k.bdmargin=a;pp.setVal("cursor",b,false);base.initCanvas();base.resize_canvas()},dispsize:function(b){if(menu.pop){var a=parseInt(document.dispsize.cs.value);if(a>0){k.cellsize=mf(a)}menu.popclose();base.resize_canvas()}},irowakeRemake:function(){line.newIrowake();if(pp.getVal("irowake")){pc.paintAll()}},dispman:function(c){var d=["expression","usepanel","checkpanel"];var a=k.EDITOR?["separator1"]:["separator1","separator2"];if(this.displaymanage){for(var b=0;b<d.length;b++){ee(d[b]).el.style.display="none"}for(var b=0;b<a.length;b++){ee(a[b]).el.style.display="none"}if(k.irowake!=0&&pp.getVal("irowake")){ee("btncolor2").el.style.display="inline"}ee("menuboard").el.style.paddingBottom="0pt"}else{for(var b=0;b<d.length;b++){ee(d[b]).el.style.display="block"}for(var b=0;b<a.length;b++){ee(a[b]).el.style.display="block"}if(k.irowake!=0&&pp.getVal("irowake")){ee("btncolor2").el.style.display="none"}ee("menuboard").el.style.paddingBottom="8pt"}this.displaymanage=!this.displaymanage;this.dispmanstr();base.resize_canvas()},dispmanstr:function(){if(!this.displaymanage){ee("ms_manarea").el.innerHTML=menu.isLangJP()?"ŠÇ——Ìˆæ‚ð•\Ž¦":"Show management area"}else{ee("ms_manarea").el.innerHTML=menu.isLangJP()?"ŠÇ——Ìˆæ‚ð‰B‚·":"Hide management area"}},popupadjust:function(b){if(menu.pop){um.newOperation(true);var a=ee.getSrcElement(b).name;if(a.indexOf("reduce")===0){if(a==="reduceup"||a==="reducedn"){if(k.qrows<=1){return}}else{if(a==="reducelt"||a==="reducert"){if(k.qcols<=1&&(k.puzzleid!=="tawa"||bd.lap!==3)){return}}}}var c={x1:0,y1:0,x2:2*k.qcols,y2:2*k.qrows};um.disableInfo();if(a.match(/(expand|reduce)/)){this.expandreduce(this.boardtype[a][1],c)}else{if(a.match(/(turn|flip)/)){this.turnflip(this.boardtype[a][1],c)}}um.enableInfo();um.addOpe(k.BOARD,a,0,this.boardtype[a][0],this.boardtype[a][1]);bd.setminmax();if(!um.undoExec){base.resetInfo(false)}base.resize_canvas()}},expandreduce:function(a,b){this.adjustBoardData(a,b);if(a&this.EXPAND){if(a===this.EXPANDUP||a===this.EXPANDDN){k.qrows++}else{if(a===this.EXPANDLT||a===this.EXPANDRT){k.qcols++}}this.expandGroup(k.CELL,a);if(!!k.iscross){this.expandGroup(k.CROSS,a)}if(!!k.isborder){this.expandGroup(k.BORDER,a)}if(!!k.isexcell){this.expandGroup(k.EXCELL,a)}}else{if(a&this.REDUCE){this.reduceGroup(k.CELL,a);if(!!k.iscross){this.reduceGroup(k.CROSS,a)}if(!!k.isborder){this.reduceGroup(k.BORDER,a)}if(!!k.isexcell){this.reduceGroup(k.EXCELL,a)}if(a===this.REDUCEUP||a===this.REDUCEDN){k.qrows--}else{if(a===this.REDUCELT||a===this.REDUCERT){k.qcols--}}}}bd.setposAll();this.adjustBoardData2(a,b)},expandGroup:function(c,b){var d=bd.initGroup(c,k.qcols,k.qrows);var e=bd.getGroup(c);for(var a=e.length-1;a>=0;a--){if(!!this.insex[c][this.distObj(c,a,b)]){e[a]=bd.newObject(c,a);d--}else{if(d>0){e[a]=e[a-d]}}}if(c===k.BORDER){this.expandborder(b)}},reduceGroup:function(c,b){if(c===k.BORDER){this.reduceborder(b)}var d=0,e=bd.getGroup(c);for(var a=0;a<e.length;a++){if(!!this.insex[c][this.distObj(c,a,b)]){if(!e[a].isempty()){um.addObj(c,a)}d++}else{if(d>0){e[a-d]=e[a]}}}for(var a=0;a<d;a++){e.pop()}},turnflip:function(b,e){this.adjustBoardData(b,e);if(b&this.TURN){var a=k.qcols;k.qcols=k.qrows;k.qrows=a;bd.setposAll();e={x1:0,y1:0,x2:2*k.qcols,y2:2*k.qrows}}this.turnflipGroup(k.CELL,b,e);if(!!k.iscross){this.turnflipGroup(k.CROSS,b,e)}if(!!k.isborder){this.turnflipGroup(k.BORDER,b,e)}if(k.isexcell===2){this.turnflipGroup(k.EXCELL,b,e)}else{if(k.isexcell===1&&(b&this.FLIP)){var c={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2};if(b===this.FLIPY){c.x1=c.x2=-1}else{if(b===this.FLIPX){c.y1=c.y2=-1}}this.turnflipGroup(k.EXCELL,b,c)}}bd.setposAll();this.adjustBoardData2(b,e)},turnflipGroup:function(n,p,m){var c=[],e=bd.objectinside(n,m.x1,m.y1,m.x2,m.y2);for(var h=0;h<e.length;h++){c[e[h]]=false}var o=bd.getGroup(n);var b=(m.x1+m.x2),l=(m.y1+m.y2);for(var a=0;a<o.length;a++){if(c[a]!==false){continue}var f=o[a],j=a;while(c[j]===false){c[j]=true;switch(p){case this.FLIPY:next=bd.idnum(n,o[j].bx,l-o[j].by);break;case this.FLIPX:next=bd.idnum(n,b-o[j].bx,o[j].by);break;case this.TURNR:next=bd.idnum(n,o[j].by,b-o[j].bx,k.qrows,k.qcols);break;case this.TURNL:next=bd.idnum(n,l-o[j].by,o[j].bx,k.qrows,k.qcols);break}if(c[next]===false){o[j]=o[next];j=next}else{o[j]=f;break}}}},distObj:function(b,d,a){var c;if(b===k.CELL){c=bd.cell[d]}else{if(b===k.CROSS){c=bd.cross[d]}else{if(b===k.BORDER){c=bd.border[d]}else{if(b===k.EXCELL){c=bd.excell[d]}else{return -1}}}}a&=15;if(a===k.UP){return c.by}else{if(a===k.DN){return 2*k.qrows-c.by}else{if(a===k.LT){return c.bx}else{if(a===k.RT){return 2*k.qcols-c.bx}}}}return -1},expandborder:function(a){if(k.isborderAsLine||!um.undoExec){bd.setposBorders();for(var c=0;c<bd.bdmax;c++){if(this.distObj(k.BORDER,c,a)!==(k.isborderAsLine?2:1)){continue}var b=(k.isborderAsLine?this.outerBorder(c,a):this.innerBorder(c,a));this.copyBorder(c,b);if(k.isborderAsLine){bd.border[b].allclear(b)}}}},reduceborder:function(a){if(k.isborderAsLine){for(var c=0;c<bd.bdmax;c++){if(this.distObj(k.BORDER,c,a)!==0){continue}var b=this.innerBorder(c,a);this.copyBorder(c,b)}}},copyBorder:function(b,a){bd.border[b].ques=bd.border[a].ques;bd.border[b].qans=bd.border[a].qans;if(k.isborderAsLine){bd.border[b].qsub=bd.border[a].qsub;bd.border[b].color=bd.border[a].color}},innerBorder:function(d,a){var c=bd.border[d].bx,b=bd.border[d].by;a&=15;if(a===k.UP){return bd.bnum2(c,b+2,k.qcols,k.qrows)}else{if(a===k.DN){return bd.bnum2(c,b-2,k.qcols,k.qrows)}else{if(a===k.LT){return bd.bnum2(c+2,b,k.qcols,k.qrows)}else{if(a===k.RT){return bd.bnum2(c-2,b,k.qcols,k.qrows)}}}}return -1},outerBorder:function(d,a){var c=bd.border[d].bx,b=bd.border[d].by;a&=15;if(a===k.UP){return bd.bnum2(c,b-2,k.qcols,k.qrows)}else{if(a===k.DN){return bd.bnum2(c,b+2,k.qcols,k.qrows)}else{if(a===k.LT){return bd.bnum2(c-2,b,k.qcols,k.qrows)}else{if(a===k.RT){return bd.bnum2(c+2,b,k.qcols,k.qrows)}}}}return -1},adjustBoardData:function(b,h){um.disableRecord();this.adjustSpecial.call(this,b,h);var e=bd.cellinside(h.x1,h.y1,h.x2,h.y2);switch(b){case this.FLIPY:for(var a=0;a<e.length;a++){var j=e[a];if(true){var f=({2:5,3:4,4:3,5:2,104:107,105:106,106:105,107:104})[bd.QuC(j)];if(!isNaN(f)){bd.sQuC(j,f)}}if(k.isexcell!==1){var f=({1:2,2:1})[bd.DiC(j)];if(!isNaN(f)){bd.sDiC(j,f)}}}break;case this.FLIPX:for(var a=0;a<e.length;a++){var j=e[a];if(true){var f=({2:3,3:2,4:5,5:4,104:105,105:104,106:107,107:106})[bd.QuC(j)];if(!isNaN(f)){bd.sQuC(j,f)}}if(k.isexcell!==1){var f=({3:4,4:3})[bd.DiC(j)];if(!isNaN(f)){bd.sDiC(j,f)}}}break;case this.TURNR:for(var a=0;a<e.length;a++){var j=e[a];if(true){var f={2:5,3:2,4:3,5:4,21:22,22:21,102:103,103:102,104:107,105:104,106:105,107:106}[bd.QuC(j)];if(!isNaN(f)){bd.sQuC(j,f)}}if(k.isexcell!==1){var f={1:4,2:3,3:1,4:2}[bd.DiC(j)];if(!isNaN(f)){bd.sDiC(j,f)}}}break;case this.TURNL:for(var a=0;a<e.length;a++){var j=e[a];if(true){var f={2:3,3:4,4:5,5:2,21:22,22:21,102:103,103:102,104:105,105:106,106:107,107:104}[bd.QuC(j)];if(!isNaN(f)){bd.sQuC(j,f)}}if(k.isexcell!==1){var f={1:3,2:4,3:2,4:1}[bd.DiC(j)];if(!isNaN(f)){bd.sDiC(j,f)}}}break}um.enableRecord();if((b&this.REDUCE)&&k.roomNumber){this.qnums=[];for(var a=0;a<bd.cell.length;a++){if(!!this.insex[k.CELL][this.distObj(k.CELL,a,b)]&&bd.cell[a].qnum!==-1){this.qnums.push({areaid:area.getRoomID(a),val:bd.cell[a].qnum})}}}},adjustBoardData2:function(b,c){if((b&this.REDUCE)&&k.roomNumber){area.resetArea();for(var a=0;a<this.qnums.length;a++){bd.sQnC(area.getTopOfRoom(this.qnums[a].areaid),this.qnums[a].val)}}um.disableRecord();this.adjustSpecial2.call(this,b,c);um.enableRecord()},adjustSpecial:function(a,b){},adjustSpecial2:function(a,b){},adjustQues51_1:function(a,e){this.qnumw=[];this.qnumh=[];for(var b=(e.y1|1);b<=e.y2;b+=2){this.qnumw[b]=[bd.QnE(bd.exnum(-1,b))];for(var c=(e.x1|1);c<=e.x2;c+=2){if(bd.QuC(bd.cnum(c,b))===51){this.qnumw[b].push(bd.QnC(bd.cnum(c,b)))}}}for(var c=(e.x1|1);c<=e.x2;c+=2){this.qnumh[c]=[bd.DiE(bd.exnum(c,-1))];for(var b=(e.y1|1);b<=e.y2;b+=2){if(bd.QuC(bd.cnum(c,b))===51){this.qnumh[c].push(bd.DiC(bd.cnum(c,b)))}}}},adjustQues51_2:function(b,h){var f=(h.x1+h.x2),i=(h.y1+h.y2),a;switch(b){case this.FLIPY:for(var e=(h.x1|1);e<=h.x2;e+=2){a=1;this.qnumh[e]=this.qnumh[e].reverse();bd.sDiE(bd.exnum(e,-1),this.qnumh[e][0]);for(var c=(h.y1|1);c<=h.y2;c+=2){if(bd.QuC(bd.cnum(e,c))===51){bd.sDiC(bd.cnum(e,c),this.qnumh[e][a]);a++}}}break;case this.FLIPX:for(var c=(h.y1|1);c<=h.y2;c+=2){a=1;this.qnumw[c]=this.qnumw[c].reverse();bd.sQnE(bd.exnum(-1,c),this.qnumw[c][0]);for(var e=(h.x1|1);e<=h.x2;e+=2){if(bd.QuC(bd.cnum(e,c))===51){bd.sQnC(bd.cnum(e,c),this.qnumw[c][a]);a++}}}break;case this.TURNR:for(var c=(h.y1|1);c<=h.y2;c+=2){a=1;this.qnumh[c]=this.qnumh[c].reverse();bd.sQnE(bd.exnum(-1,c),this.qnumh[c][0]);for(var e=(h.x1|1);e<=h.x2;e+=2){if(bd.QuC(bd.cnum(e,c))===51){bd.sQnC(bd.cnum(e,c),this.qnumh[c][a]);a++}}}for(var e=(h.x1|1);e<=h.x2;e+=2){a=1;bd.sDiE(bd.exnum(e,-1),this.qnumw[f-e][0]);for(var c=(h.y1|1);c<=h.y2;c+=2){if(bd.QuC(bd.cnum(e,c))===51){bd.sDiC(bd.cnum(e,c),this.qnumw[f-e][a]);a++}}}break;case this.TURNL:for(var c=(h.y1|1);c<=h.y2;c+=2){a=1;bd.sQnE(bd.exnum(-1,c),this.qnumh[i-c][0]);for(var e=(h.x1|1);e<=h.x2;e+=2){if(bd.QuC(bd.cnum(e,c))===51){bd.sQnC(bd.cnum(e,c),this.qnumh[i-c][a]);a++}}}for(var e=(h.x1|1);e<=h.x2;e+=2){a=1;this.qnumw[e]=this.qnumw[e].reverse();bd.sDiE(bd.exnum(e,-1),this.qnumw[e][0]);for(var c=(h.y1|1);c<=h.y2;c+=2){if(bd.QuC(bd.cnum(e,c))===51){bd.sDiC(bd.cnum(e,c),this.qnumw[e][a]);a++}}}break}},ACconfirm:function(){if(confirm(menu.isLangJP()?"‰ñ“š‚ðÁ‹Ž‚µ‚Ü‚·‚©H":"Do you want to erase the Answer?")){um.newOperation(true);for(var a=0;a<bd.cellmax;a++){if(bd.cell[a].qans!==bd.defcell.qans){um.addOpe(k.CELL,k.QANS,a,bd.cell[a].qans,bd.defcell.qans)}if(bd.cell[a].qsub!==bd.defcell.qsub){um.addOpe(k.CELL,k.QSUB,a,bd.cell[a].qsub,bd.defcell.qsub)}}if(!!k.isborder){for(var a=0;a<bd.bdmax;a++){if(bd.border[a].qans!==bd.defborder.qans){um.addOpe(k.BORDER,k.QANS,a,bd.border[a].qans,bd.defborder.qans)}if(bd.border[a].line!==bd.defborder.line){um.addOpe(k.BORDER,k.LINE,a,bd.border[a].line,bd.defborder.line)}if(bd.border[a].qsub!==bd.defborder.qsub){um.addOpe(k.BORDER,k.QSUB,a,bd.border[a].qsub,bd.defborder.qsub)}}}bd.ansclear();base.resetInfo(false);pc.paintAll()}},ASconfirm:function(){if(confirm(menu.isLangJP()?"•â•‹L†‚ðÁ‹Ž‚µ‚Ü‚·‚©H":"Do you want to erase the auxiliary marks?")){um.newOperation(true);for(var a=0;a<bd.cellmax;a++){if(bd.cell[a].qsub!==bd.defcell.qsub){um.addOpe(k.CELL,k.QSUB,a,bd.cell[a].qsub,bd.defcell.qsub)}}if(!!k.isborder){for(var a=0;a<bd.bdmax;a++){if(bd.border[a].qsub!==bd.defborder.qsub){um.addOpe(k.BORDER,k.QSUB,a,bd.border[a].qsub,bd.defborder.qsub)}}}bd.subclear();pc.paintAll()}}};AreaInfo=function(){this.max=0;this.id=[];this.room=[]};LineManager=function(){this.lcnt=[];this.ltotal=[];this.disableLine=(!k.isCenterLine&&!k.isborderAsLine);this.data={};this.typeA="A";this.typeB="B";this.typeC="C";this.init()};LineManager.prototype={init:function(){if(this.disableLine){return}if(k.isCenterLine){for(var d=0;d<bd.cellmax;d++){this.lcnt[d]=0}this.ltotal=[(k.qcols*k.qrows),0,0,0,0]}else{for(var d=0,a=(k.qcols+1)*(k.qrows+1);d<a;d++){this.lcnt[d]=0}this.ltotal=[((k.qcols+1)*(k.qrows+1)),0,0,0,0]}this.data={max:0,id:[]};for(var b=0;b<bd.bdmax;b++){this.data.id[b]=-1}},resetLcnts:function(){if(this.disableLine){return}this.init();var a=[];for(var d=0;d<bd.bdmax;d++){if(bd.isLine(d)){this.data.id[d]=0;a.push(d);var c,b;if(k.isCenterLine){c=bd.border[d].cellcc[0];b=bd.border[d].cellcc[1]}else{c=bd.border[d].crosscc[0];b=bd.border[d].crosscc[1]}if(c!=-1){this.ltotal[this.lcnt[c]]--;this.lcnt[c]++;this.ltotal[this.lcnt[c]]++}if(b!=-1){this.ltotal[this.lcnt[b]]--;this.lcnt[b]++;this.ltotal[this.lcnt[b]]++}}else{this.data.id[d]=-1}}this.lc0main(a);if(k.irowake!==0){this.newIrowake()}},newIrowake:function(){for(var b=1;b<=this.data.max;b++){var c=this.data[b].idlist;if(c.length>0){var a=pc.getNewLineColor();for(var d=0;d<c.length;d++){bd.border[c[d]].color=a}}}},lcntCell:function(a){return(a!=-1?this.lcnt[a]:0)},gettype:function(d,c,b){var a=(b>0?0:1);if(d===-1){return this.typeA}else{if(!this.iscrossing(d)){return((this.lcnt[d]===(1-a))?this.typeA:this.typeB)}else{if(this.lcnt[d]===(1-a)||(this.lcnt[d]===(3-a)&&this.isTpos(d,c))){return this.typeA}else{if(this.lcnt[d]===(2-a)||this.lcnt[d]===(4-a)){return this.typeB}}return this.typeC}}},isTpos:function(b,a){if(k.isCenterLine){return !bd.isLine(bd.bnum(2*bd.cell[b].bx-bd.border[a].bx,2*bd.cell[b].by-bd.border[a].by))}else{return !bd.isLine(bd.bnum(4*(b%(k.qcols+1))-bd.border[a].bx,4*mf(b/(k.qcols+1))-bd.border[a].by))}},iscrossing:function(a){return k.isLineCross},setLine:function(b,c){if(this.disableLine){return}c=(c>0?1:0);var m,l;if(k.isCenterLine){m=bd.border[b].cellcc[0];l=bd.border[b].cellcc[1]}else{m=bd.border[b].crosscc[0];l=bd.border[b].crosscc[1]}if(c>0){if(m!=-1){this.ltotal[this.lcnt[m]]--;this.lcnt[m]++;this.ltotal[this.lcnt[m]]++}if(l!=-1){this.ltotal[this.lcnt[l]]--;this.lcnt[l]++;this.ltotal[this.lcnt[l]]++}}else{if(m!=-1){this.ltotal[this.lcnt[m]]--;this.lcnt[m]--;this.ltotal[this.lcnt[m]]++}if(l!=-1){this.ltotal[this.lcnt[l]]--;this.lcnt[l]--;this.ltotal[this.lcnt[l]]++}}var h=this.gettype(m,b,c),e=this.gettype(l,b,c);if(c>0){if(h===this.typeA&&e===this.typeA){this.data.max++;this.data[this.data.max]={idlist:[b]};this.data.id[b]=this.data.max;bd.border[b].color=pc.getNewLineColor()}else{if((h===this.typeA&&e===this.typeB)||(h===this.typeB&&e===this.typeA)){var j=(this.getbid(b,1))[0];this.data[this.data.id[j]].idlist.push(b);this.data.id[b]=this.data.id[j];bd.border[b].color=bd.border[j].color}else{if(h===this.typeB&&e===this.typeB){this.combineLineInfo(b)}else{this.remakeLineInfo(b,1)}}}}else{if(h===this.typeA&&e===this.typeA){this.data[this.data.id[b]]={idlist:[]};this.data.id[b]=-1;bd.border[b].color=""}else{if((h===this.typeA&&e===this.typeB)||(h===this.typeB&&e===this.typeA)){var d=this.data.id[b],a=this.data[d].idlist;for(var f=0;f<a.length;f++){if(a[f]===b){a.splice(f,1);break}}this.data.id[b]=-1;bd.border[b].color=""}else{this.remakeLineInfo(b,0);bd.border[b].color=""}}}},combineLineInfo:function(a){var e=this.data.id;var j=this.getbid(a,1);var p=[e[j[0]],-1];for(var h=0;h<j.length;h++){if(p[0]!=e[j[h]]){p[1]=e[j[h]];break}}var o=bd.border[j[0]].color;if(p[1]!=-1){var f=p[0],b=p[1];if(this.data[p[0]].idlist.length<this.data[p[1]].idlist.length){f=p[1];b=p[0];o=bd.border[j[1]].color}var l=this.data[f].idlist;var c=this.data[b].idlist;for(var d=0,m=c.length;d<m;d++){l.push(c[d]);e[c[d]]=f}this.data[b].idlist=[];l.push(a);e[a]=f;for(var h=0,m=l.length;h<m;h++){bd.border[l[h]].color=o}this.repaintLine(l,a)}else{this.data[p[0]].idlist.push(a);e[a]=p[0];bd.border[a].color=o}},remakeLineInfo:function(b,d){var e=this.data.id;var f=this.data.max;var p=this.getbid(b,d);var h=e[p[0]],j=bd.border[p[0]].color;for(var o=0,q=p.length;o<q;o++){var r=e[p[o]];if(r<=0){continue}var a=this.data[r].idlist;if(this.data[h].idlist.length<a.length){h=r;j=bd.border[p[o]].color}for(var c=0,l=a.length;c<l;c++){e[a[c]]=0}this.data[r]={idlist:[]}}if(d>0){e[b]=0;p.unshift(b)}else{e[b]=-1}this.lc0main(p);var m=f+1;for(var r=f+1;r<=this.data.max;r++){var a=this.data[r].idlist;if(this.data[m].idlist.length<a.length){m=r}}for(var r=f+1;r<=this.data.max;r++){var t=(r===m?j:pc.getNewLineColor());var a=this.data[r].idlist;for(var c=0,q=a.length;c<q;c++){bd.border[a[c]].color=t}this.repaintLine(a,b)}},repaintLine:function(d,e){if(!pp.getVal("irowake")){return}var b=(k.isCenterLine?pc.drawLine1:pc.drawBorder1);for(var c=0,a=d.length;c<a;c++){if(e===d[c]){continue}b.call(pc,d[c])}if(g.use.canvas){this.repaintParts(d)}},repaintParts:function(a){},getClistFromIdlist:function(e){var d=[],b=[];for(var f=0;f<bd.cellmax;f++){d[f]=false}for(var a=0;a<e.length;a++){d[bd.border[e[a]].cellcc[0]]=true;d[bd.border[e[a]].cellcc[1]]=true}for(var f=0;f<bd.cellmax;f++){if(d[f]){b.push(f)}}return b},getXlistFromIdlist:function(f){var e=[],a=[],b=(k.qcols+1)*(k.qrows+1);for(var h=0;h<b;h++){e[h]=false}for(var d=0;d<f.length;d++){e[bd.border[f[d]].crosscc[0]]=true;e[bd.border[f[d]].crosscc[1]]=true}for(var h=0;h<b;h++){if(e[h]){a.push(h)}}return a},getbid:function(c,e){var d=(e>0?0:1),l=bd.border[c].bx,j=bd.border[c].by;var q=((k.isCenterLine^(l%2===0))?2:0),o=(2-q);var n=bd.border[c].cellcc[0],m=bd.border[c].cellcc[1];if(!k.isCenterLine){n=bd.border[c].crosscc[0];m=bd.border[c].crosscc[1]}var p=[];if(n!==-1){var b=this.iscrossing(n),a=this.lcnt[n];if(b&&a>=(4-d)){p.push(bd.bnum(l-o,j-q))}else{if(a>=(2-d)&&!(b&&a===(3-d)&&this.isTpos(n,c))){p.push(bd.bnum(l-o,j-q));p.push(bd.bnum(l-1,j-1));p.push(bd.bnum(l+q-1,j+o-1))}}}if(m!==-1){var b=this.iscrossing(m),a=this.lcnt[m];if(b&&a>=(4-d)){p.push(bd.bnum(l+o,j+q))}else{if(a>=(2-d)&&!(b&&a===(3-d)&&this.isTpos(m,c))){p.push(bd.bnum(l+o,j+q));p.push(bd.bnum(l+1,j+1));p.push(bd.bnum(l-q+1,j-o+1))}}}var h=[];for(var f=0;f<p.length;f++){if(bd.isLine(p[f])){h.push(p[f])}}return h},lc0main:function(b){for(var c=0,a=b.length;c<a;c++){if(this.data.id[b[c]]!=0){continue}var e=bd.border[b[c]].bx,d=bd.border[b[c]].by;this.data.max++;this.data[this.data.max]={idlist:[]};if(!k.isCenterLine^(e&1)){this.lc0(e,d+1,1,this.data.max);this.lc0(e,d,2,this.data.max)}else{this.lc0(e+1,d,3,this.data.max);this.lc0(e,d,4,this.data.max)}}},lc0:function(d,c,b,a){while(1){switch(b){case 1:c--;break;case 2:c++;break;case 3:d--;break;case 4:d++;break}if((d+c)%2===0){var f=(k.isCenterLine?bd.cnum:bd.xnum).call(bd,d,c);if(f===-1){break}else{if(this.lcnt[f]>=3){if(!this.iscrossing(f)){if(bd.isLine(bd.bnum(d,c-1))){this.lc0(d,c,1,a)}if(bd.isLine(bd.bnum(d,c+1))){this.lc0(d,c,2,a)}if(bd.isLine(bd.bnum(d-1,c))){this.lc0(d,c,3,a)}if(bd.isLine(bd.bnum(d+1,c))){this.lc0(d,c,4,a)}break}}else{if(b!=1&&bd.isLine(bd.bnum(d,c+1))){b=2}else{if(b!=2&&bd.isLine(bd.bnum(d,c-1))){b=1}else{if(b!=3&&bd.isLine(bd.bnum(d+1,c))){b=4}else{if(b!=4&&bd.isLine(bd.bnum(d-1,c))){b=3}}}}}}}else{var e=bd.bnum(d,c);if(this.data.id[e]!=0){break}this.data.id[e]=a;this.data[a].idlist.push(e)}}},getLineInfo:function(){var b=new AreaInfo();for(var c=0;c<bd.bdmax;c++){b.id[c]=(bd.isLine(c)?0:-1)}for(var c=0;c<bd.bdmax;c++){if(b.id[c]!=0){continue}b.max++;b.room[b.max]={idlist:this.data[this.data.id[c]].idlist};for(var a=0;a<b.room[b.max].idlist.length;a++){b.id[b.room[b.max].idlist[a]]=b.max}}return b},getLareaInfo:function(){var a=new AreaInfo();for(var b=0;b<bd.cellmax;b++){a.id[b]=(this.lcnt[b]>0?0:-1)}for(var b=0;b<bd.cellmax;b++){if(a.id[b]!=0){continue}a.max++;a.room[a.max]={idlist:[]};this.sr0(a,b,a.max)}return a},sr0:function(c,a,b){c.id[a]=b;c.room[b].idlist.push(a);if(bd.isLine(bd.ub(a))&&c.id[bd.up(a)]===0){this.sr0(c,bd.up(a),b)}if(bd.isLine(bd.db(a))&&c.id[bd.dn(a)]===0){this.sr0(c,bd.dn(a),b)}if(bd.isLine(bd.lb(a))&&c.id[bd.lt(a)]===0){this.sr0(c,bd.lt(a),b)}if(bd.isLine(bd.rb(a))&&c.id[bd.rt(a)]===0){this.sr0(c,bd.rt(a),b)}}};AreaManager=function(){this.lcnt=[];this.room={};this.bcell={};this.wcell={};this.bblock=(k.checkBlackCell||k.linkNumber);this.wblock=k.checkWhiteCell;this.numberColony=k.linkNumber;this.init()};AreaManager.prototype={init:function(){this.initRarea();this.initBarea();this.initWarea()},resetArea:function(){if(!!k.isborder&&!k.isborderAsLine){this.resetRarea()}if(this.bblock){this.resetBarea()}if(this.wblock){this.resetWarea()}},initRarea:function(){this.room={max:1,id:[],1:{top:0,clist:[]}};for(var h=0;h<bd.cellmax;h++){this.room.id[h]=1;this.room[1].clist[h]=h}this.lcnt=[];for(var h=0;h<(k.qcols+1)*(k.qrows+1);h++){this.lcnt[h]=0}if(k.isborder===1){for(var d=bd.minby;d<=bd.maxby;d+=2){for(var e=bd.minbx;e<=bd.maxbx;e+=2){if(e===bd.minbx||e===bd.maxbx||d===bd.minby||d===bd.maxby){var h=(e>>1)+(d>>1)*(k.qcols+1);this.lcnt[h]=2}}}}if(!k.hasroom){return}for(var f=0;f<bd.bdmax;f++){if(bd.isBorder(f)){var b=bd.border[f].crosscc[0],a=bd.border[f].crosscc[1];if(b!==-1){this.lcnt[b]++}if(a!==-1){this.lcnt[a]++}}}},resetRarea:function(){if(!k.hasroom){return}this.initRarea();this.room.max=0;for(var j=0;j<bd.cellmax;j++){this.room.id[j]=0}for(var j=0;j<bd.cellmax;j++){if(this.room.id[j]!=0){continue}this.room.max++;this.room[this.room.max]={top:-1,clist:[]};this.sr0(j,this.room,bd.isBorder)}if(k.roomNumber){for(var d=1;d<=this.room.max;d++){this.setTopOfRoom(d);var f=-1,e=this.room[d].clist;for(var b=0,a=e.length;b<a;b++){var h=e[b];if(this.room.id[h]===d&&bd.cell[h].qnum!==-1){if(f===-1){f=bd.cell[h].qnum}if(this.getTopOfRoom(d)!==h){bd.sQnC(h,-1)}}}if(f!==-1&&bd.QnC(this.getTopOfRoom(d))===-1){bd.sQnC(this.getTopOfRoom(d),f)}}}},lcntCross:function(a){return this.lcnt[a]},getRoomID:function(a){return this.room.id[a]},getTopOfRoomByCell:function(a){return this.room[this.room.id[a]].top},getTopOfRoom:function(a){return this.room[a].top},getCntOfRoomByCell:function(a){return this.room[this.room.id[a]].clist.length},setBorder:function(j,x){if(!k.hasroom){return}x=(x>0?1:0);var f,e,b=bd.border[j].crosscc[0],a=bd.border[j].crosscc[1];var t=this.room,w=t.id;if(x>0){this.lcnt[b]++;this.lcnt[a]++;if(this.lcnt[b]===1||this.lcnt[a]===1){return}f=bd.border[j].cellcc[0];e=bd.border[j].cellcc[1];if(f===-1||e===-1||w[f]!==w[e]){return}var h=w[f];t.max++;t[t.max]={top:-1,clist:[]};this.sr0(e,t,bd.isBorder);if(w[f]===t.max){for(var n=0,o=t[t.max].clist.length;n<o;n++){w[t[t.max].clist[n]]=h}t.max--;return}var v=t[h].clist.concat();t[h].clist=[];t[t.max].clist=[];for(var n=0,o=v.length;n<o;n++){t[w[v[n]]].clist.push(v[n])}if(k.roomNumber){if(w[t[h].top]===h){this.setTopOfRoom(t.max)}else{t[t.max].top=t[h].top;this.setTopOfRoom(h)}}}else{this.lcnt[b]--;this.lcnt[a]--;if(this.lcnt[b]===0||this.lcnt[a]===0){return}f=bd.border[j].cellcc[0];e=bd.border[j].cellcc[1];if(f===-1||e===-1||w[f]===w[e]){return}if(k.roomNumber){var u,q;var r=t[w[f]].top,p=t[w[e]].top;var d=bd.cell[r].bx,c=bd.cell[p].bx;if(d>c||(d===c&&r>p)){u=r;q=p}else{u=p;q=r}if(bd.QnC(u)!==-1){if(bd.QnC(q)===-1){bd.sQnC(q,bd.QnC(u));pc.paintCell(q)}bd.sQnC(u,-1);pc.paintCell(u)}}var m=w[f],l=w[e],v=t[l].clist;for(var n=0;n<v.length;n++){w[v[n]]=m;t[m].clist.push(v[n])}t[l]={top:-1,clist:[]}}},setTopOfRoom:function(c){var h=-1,f=bd.maxbx,e=bd.maxby;var d=this.room[c].clist;for(var b=0;b<d.length;b++){var a=bd.cell[d[b]];if(a.bx>f||(a.bx===f&&a.by>=e)){continue}h=d[b];f=a.bx;e=a.by}this.room[c].top=h},sr0:function(e,d,b){d.id[e]=d.max;d[d.max].clist.push(e);var a;a=bd.up(e);if(a!==-1&&d.id[a]!==d.max&&!b(bd.ub(e))){this.sr0(a,d,b)}a=bd.dn(e);if(a!==-1&&d.id[a]!==d.max&&!b(bd.db(e))){this.sr0(a,d,b)}a=bd.lt(e);if(a!==-1&&d.id[a]!==d.max&&!b(bd.lb(e))){this.sr0(a,d,b)}a=bd.rt(e);if(a!==-1&&d.id[a]!==d.max&&!b(bd.rb(e))){this.sr0(a,d,b)}},initBarea:function(){this.bcell={max:0,id:[]};for(var a=0;a<bd.cellmax;a++){this.bcell.id[a]=-1}},resetBarea:function(){this.initBarea();if(!this.numberColony){for(var a=0;a<bd.cellmax;a++){this.bcell.id[a]=(bd.isBlack(a)?0:-1)}}else{for(var a=0;a<bd.cellmax;a++){this.bcell.id[a]=(bd.isNum(a)?0:-1)}}for(var a=0;a<bd.cellmax;a++){if(this.bcell.id[a]!=0){continue}this.bcell.max++;this.bcell[this.bcell.max]={clist:[]};this.sc0(a,this.bcell)}},initWarea:function(){this.wcell={max:1,id:[],1:{clist:[]}};for(var a=0;a<bd.cellmax;a++){this.wcell.id[a]=1;this.wcell[1].clist[a]=a}},resetWarea:function(){this.initWarea();this.wcell.max=0;for(var a=0;a<bd.cellmax;a++){this.wcell.id[a]=(bd.isWhite(a)?0:-1)}for(var a=0;a<bd.cellmax;a++){if(this.wcell.id[a]!=0){continue}this.wcell.max++;this.wcell[this.wcell.max]={clist:[]};this.sc0(a,this.wcell)}},setCell:function(b,a){if(a>0){if(this.bblock){this.setBWCell(b,1,this.bcell)}if(this.wblock){this.setBWCell(b,0,this.wcell)}}else{if(this.bblock){this.setBWCell(b,0,this.bcell)}if(this.wblock){this.setBWCell(b,1,this.wcell)}}},setBWCell:function(d,b,h){var o=[],c=h.id,f;f=bd.up(d);if(f!==-1&&c[f]!==-1){o.push(f)}f=bd.dn(d);if(f!==-1&&c[f]!==-1){o.push(f)}f=bd.lt(d);if(f!==-1&&c[f]!==-1){o.push(f)}f=bd.rt(d);if(f!==-1&&c[f]!==-1){o.push(f)}if(b>0){if(o.length===0){h.max++;h[h.max]={clist:[d]};c[d]=h.max}else{if(o.length===1){h[c[o[0]]].clist.push(d);c[d]=c[o[0]]}else{var l=c[o[0]];for(var j=1;j<o.length;j++){if(h[l].clist.length<h[c[o[j]]].clist.length){l=c[o[j]]}}for(var j=0;j<o.length;j++){if(c[o[j]]===l){continue}var p=h[c[o[j]]].clist;for(var a=0,m=p.length;a<m;a++){c[p[a]]=l;h[l].clist.push(p[a])}p=[]}c[d]=l;h[l].clist.push(d)}}}else{if(o.length===0){h[c[d]].clist=[];c[d]=-1}else{if(o.length===1){var e=c[d],p=h[e].clist;for(var j=0;j<p.length;j++){if(p[j]===d){p.splice(j,1);break}}c[d]=-1}else{var e=c[d],p=h[e].clist;for(var j=0;j<p.length;j++){c[p[j]]=0}h[e].clist=[];c[d]=-1;for(var j=0;j<o.length;j++){if(c[o[j]]!==0){continue}h.max++;h[h.max]={clist:[]};this.sc0(o[j],h)}}}}},sc0:function(d,b){b.id[d]=b.max;b[b.max].clist.push(d);var a;a=bd.up(d);if(a!==-1&&b.id[a]===0){this.sc0(a,b)}a=bd.dn(d);if(a!==-1&&b.id[a]===0){this.sc0(a,b)}a=bd.lt(d);if(a!==-1&&b.id[a]===0){this.sc0(a,b)}a=bd.rt(d);if(a!==-1&&b.id[a]===0){this.sc0(a,b)}},getRoomInfo:function(){return this.getAreaInfo(this.room)},getBCellInfo:function(){return this.getAreaInfo(this.bcell)},getWCellInfo:function(){return this.getAreaInfo(this.wcell)},getNumberInfo:function(){return this.getAreaInfo(this.bcell)},getAreaInfo:function(f){var e=new AreaInfo();for(var h=0;h<bd.cellmax;h++){e.id[h]=(f.id[h]>0?0:-1)}for(var h=0;h<bd.cellmax;h++){if(e.id[h]!=0){continue}e.max++;var d=f[f.id[h]].clist;e.room[e.max]={idlist:d};for(var b=0,a=d.length;b<a;b++){e.id[d[b]]=e.max}}return e}};PBase=function(){this.floatbgcolor="black";this.proto=0;this.expression={ja:"",en:""};this.puzzlename={ja:"",en:""};this.numparent=null;this.resizetimer=null;this.initProcess=true;this.enableSaveImage=false};PBase.prototype={preload_func:function(){enc=new Encode();enc.first_parseURI(location.search);if(!k.puzzleid){location.href="./"}if(!k.scriptcheck){document.writeln('<script type="text/javascript" src="src/'+k.puzzleid+'.js"><\/script>')}else{document.writeln('<script type="text/javascript" src="src/for_test.js"><\/script>');document.writeln('<script type="text/javascript" src="src/puzzles.js"><\/script>')}fio=new FileIO();if(fio.dbm.requireGears()){document.writeln('<script type="text/javascript" src="src/gears_init.js"><\/script>')}window.onload=ee.ebinder(this,this.onload_func);window.onresize=ee.ebinder(this,this.onresize_func)},onload_func:function(){Camp("divques");if(Camp.enable.canvas&&!!document.createElement("canvas").toDataURL){this.enableSaveImage=true;Camp("divques_sub","canvas")}var a=this;var b=setInterval(function(){if(Camp.isready()){clearInterval(b);a.onload_func2.apply(a)}},10)},onload_func2:function(){this.initCanvas();this.initObjects();this.setEvents(true);this.translationEN();if(document.domain=="indi.s58.xrea.com"&&k.PLAYER){this.accesslog()}tm=new Timer();this.initProcess=false},initCanvas:function(){this.numparent=ee("numobj_parent").el;var a=ee("divques").unselectable().el;g=a.getContext("2d")},initObjects:function(){this.proto=0;puz=new Puzzles[k.puzzleid]();puz.setting();if(this.proto){puz.protoChange()}tc=new TCell();bd=new Board();mv=new MouseEvent();kc=new KeyEvent();kp=new KeyPopup();pc=new Graphic();ans=new AnsCheck();um=new OperationManager();area=new AreaManager();line=new LineManager();menu=new Menu();pp=new Properties();this.doc_design();enc.pzlinput();this.resize_canvas();if(!!puz.finalfix){puz.finalfix()}},setEvents:function(b){var a=ee("divques").el;a.onmousedown=ee.ebinder(mv,mv.e_mousedown);a.onmousemove=ee.ebinder(mv,mv.e_mousemove);a.onmouseup=ee.ebinder(mv,mv.e_mouseup);a.oncontextmenu=function(){return false};this.numparent.onmousedown=ee.ebinder(mv,mv.e_mousedown);this.numparent.onmousemove=ee.ebinder(mv,mv.e_mousemove);this.numparent.onmouseup=ee.ebinder(mv,mv.e_mouseup);this.numparent.oncontextmenu=function(){return false};if(b){document.onkeydown=ee.ebinder(kc,kc.e_keydown);document.onkeyup=ee.ebinder(kc,kc.e_keyup);document.onkeypress=ee.ebinder(kc,kc.e_keypress);if(g.use.sl){this.initSilverlight()}if(!!menu.ex.reader){var c=function(d){menu.ex.reader.readAsText(d.dataTransfer.files[0]);d.preventDefault();d.stopPropagation()};window.addEventListener("dragover",function(d){d.preventDefault()},true);window.addEventListener("drop",c,true)}document.onblur=ee.ebinder(this,this.onblur_func)}},translationEN:function(){var a=(navigator.browserLanguage||navigator.language||navigator.userLanguage).substr(0,2);if(a!=="ja"){pp.setVal("language",1)}},initSilverlight:function(){var a=g.content.findName(g.canvasid);a.AddEventListener("KeyDown",this.e_SLkeydown);a.AddEventListener("KeyUp",this.e_SLkeyup)},e_SLkeydown:function(b,c){var a={keyCode:c.platformKeyCode,shiftKey:c.shift,ctrlKey:c.ctrl,altKey:false,returnValue:false,preventDefault:f_true};return kc.e_keydown(a)},e_SLkeyup:function(b,c){var a={keyCode:c.platformKeyCode,shiftKey:c.shift,ctrlKey:c.ctrl,altKey:false,returnValue:false,preventDefault:f_true};return kc.e_keyup(a)},doc_design:function(){_doc.title=this.gettitle();ee("title2").el.innerHTML=this.gettitle();_doc.body.style.backgroundImage="url(./bg/"+k.puzzleid+".gif)";if(k.br.IEmoz4){ee("title2").el.style.marginTop="24px";ee("separator1").el.style.margin="0pt";ee("separator2").el.style.margin="0pt"}this.postfix();menu.menuinit();um.enb_btn();ee("btnclear").el.disabled=false;ee("btnclear2").el.disabled=false},postfix:function(){puz.input_init();puz.graphic_init();puz.encode_init();puz.answer_init()},resetInfo:function(a){if(a){um.allerase()}area.resetArea();line.resetLcnts()},gettitle:function(){if(k.EDITOR){return""+this.getPuzzleName()+(menu.isLangJP()?" ƒGƒfƒBƒ^ - ‚Ï‚¸‚Õ‚êv3":" editor - PUZ-PRE v3")}else{return""+this.getPuzzleName()+(menu.isLangJP()?" player - ‚Ï‚¸‚Õ‚êv3":" player - PUZ-PRE v3")}},getPuzzleName:function(){return(menu.isLangJP()||!this.puzzlename.en)?this.puzzlename.ja:this.puzzlename.en},setTitle:function(b,a){this.puzzlename.ja=b;this.puzzlename.en=a},setExpression:function(b,a){this.expression.ja=b;this.expression.en=a},setFloatbgcolor:function(a){this.floatbgcolor=a},onresize_func:function(){if(this.resizetimer){clearTimeout(this.resizetimer)}this.resizetimer=setTimeout(ee.binder(this,this.resize_canvas),250)},resize_canvas:function(){var d=ee.windowWidth()-6;var i=(bd.maxbx-bd.minbx)/2+2*k.bdmargin;var j=(bd.maxby-bd.minby)/2+2*k.bdmargin;if(k.puzzleid==="box"){i++;j++}var a={0:(19/36),1:0.75,2:1,3:1.5,4:3}[pp.getVal("size")];var e={base:a,limit:0.4},f={base:0.8,limit:0.96},l=[];l[0]=(d*f.base)/(k.cellsize*e.base);l[1]=(d*f.limit)/(k.cellsize*e.limit);var c=d*f.base-4;if(!pp.getVal("adjsize")||i<l[0]){c=d*f.base-4;k.cwidth=k.cheight=mf(k.cellsize*e.base)}else{if(i<l[1]){var b=f.base+(f.limit-f.base)*((k.qcols-l[0])/(l[1]-l[0]));c=d*b-4;k.cwidth=k.cheight=mf(c/i)}else{c=d*f.limit-4;k.cwidth=k.cheight=mf(k.cellsize*e.limit)}}k.bwidth=k.cwidth/2;k.bheight=k.cheight/2;ee("main").el.style.width=""+mf(c)+"px";k.p0.x=k.p0.y=mf(k.cwidth*k.bdmargin);if(!!k.isexcell){k.p0.x+=k.cwidth;k.p0.y+=k.cheight}pc.setVectorFunctions();g.changeSize(mf(i*k.cwidth),mf(j*k.cheight));var h=ee("divques").getRect();k.cv_oft.x=h.left;k.cv_oft.y=h.top;kp.resize();bd.setcoordAll();pc.onresize_process();pc.flushCanvasAll();pc.paintAll()},onblur_func:function(){kc.keyreset();mv.mousereset()},accesslog:function(){var b=document.referrer;b=b.replace(/\?/g,"%3f");b=b.replace(/\&/g,"%26");b=b.replace(/\=/g,"%3d");b=b.replace(/\//g,"%2f");var a=false;if(typeof ActiveXObject!="undefined"){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){a=false}}if(!a&&typeof XMLHttpRequest!="undefined"){a=new XMLHttpRequest()}if(a){a.open("GET",["./record.cgi","?pid=",k.puzzleid,"&pzldata=",enc.uri.qdata,"&referer=",b].join(""));a.onreadystatechange=function(){};a.send(null)}}};base=new PBase();base.preload_func();