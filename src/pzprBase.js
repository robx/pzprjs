/* 
 * pzprBase.js
 * 
 * pzprBase.js is a base script for playing nikoli puzzles on Web
 * written in JavaScript.
 * 
 * @author  happa.
 * @version v3.2.2ƒ¿1
 * @date    2009-10-30
 * 
 * This script uses following libraries.
 *  jquery.js (version 1.3.2)
 *  http://jquery.com/
 *  uuCanvas.js (version 1.0)
 *  http://code.google.com/p/uupaa-js-spinoff/	uupaa.js SpinOff Project Home(Google Code)
 * 
 * For improvement of canvas drawing time, I make some change on uuCanvas.js.
 * Please see "//happa add.[20090608]" in uuCanvas.js.
 * 
 * This script is dual licensed under the MIT and Apache 2.0 licenses.
 * http://indi.s58.xrea.com/pzpr/v3/LICENCE.HTML
 * 
 */
var pzprversion="v3.2.2ƒ¿1";Pos=function(a,b){this.x=a;this.y=b};Pos.prototype={set:function(a,b){this.x=a;this.y=b}};var k={qcols:0,qrows:0,irowake:0,iscross:0,isborder:0,isextendcell:0,isoutsidecross:1,isoutsideborder:0,isLineCross:1,isCenterLine:0,isborderAsLine:0,dispzero:0,isDispHatena:1,isAnsNumber:0,isArrowNumber:0,isOneNumber:0,isDispNumUL:0,NumberWithMB:0,BlackCell:0,NumberIsWhite:0,RBBlackCell:0,ispzprv3ONLY:0,isKanpenExist:0,fstruct:[],def_csize:36,def_psize:24,area:{bcell:0,wcell:0,number:0,disroom:0},puzzleid:"",callmode:"pmake",mode:3,use:1,irowake:0,widthmode:2,enableKey:true,enableMouse:true,autocheck:true,cwidth:this.def_csize,cheight:this.def_csize,p0:new Pos(this.def_psize,this.def_psize),cv_oft:new Pos(0,0),IEMargin:new Pos(4,4),br:{IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1},scriptcheck:false};var g;var Puzzles=[];function newEL(a){return $(document.createElement(a))}$.fn.unselectable=function(){if(k.br.Gecko){this.css("-moz-user-select","none").css("user-select","none")}else{if(k.br.WebKit){this.css("-khtml-user-select","none").css("user-select","none")}else{this.attr("unselectable","on")}}return this};function getSrcElement(a){return a.target||a.srcElement}var mf=Math.floor;function f_true(){return true}function toArray(c){var a=[];for(var b=0;b<c.length;b++){a[b]=c[b]}return a}Function.prototype.bind=function(){var b=toArray(arguments);var a=this,c=b.shift();return function(){return a.apply(c,b.concat(toArray(arguments)))}};Function.prototype.ebind=function(){var b=toArray(arguments);var a=this,c=b.shift();return function(d){return a.apply(c,[d||window.event].concat(b).concat(toArray(arguments)))}};Function.prototype.kcbind=function(){var b=toArray(arguments),a=this;return function(c){ret=a.apply(kc,[c||window.event].concat(b).concat(toArray(arguments)));if(kc.tcMoved){if(k.br.Gecko||k.br.WebKit){c.preventDefault()}else{if(k.br.IE){return false}else{c.returnValue=false}}}return ret}};Timer=function(){this.st=0;this.TID;this.lastseconds=0;this.lastOpeCnt=0;this.lastACTime=0;this.worstACCost=0;this.undoWaitCount=0;this.undoInterval=(!k.br.IE?25:50);this.TIDundo=null;this.start()};Timer.prototype={reset:function(){this.st=0;this.prev=clearInterval(this.TID);$("#timerpanel").html(this.label()+"00:00");this.worstACCost=0;this.start()},start:function(){this.st=(new Date()).getTime();this.TID=setInterval(this.update.bind(this),200)},update:function(){if(k.callmode!="pmake"){this.updatetime()}if(k.autocheck){this.ACcheck()}},updatetime:function(){var d=(new Date()).getTime();var c=mf((d-this.st)/1000);if(this.bseconds==c){return}var a=mf(c/3600);var b=mf(c/60)-a*60;c=c-b*60-a*3600;if(b<10){b="0"+b}if(c<10){c="0"+c}if(a){$("#timerpanel").html(this.label()+a+":"+b+":"+c)}else{$("#timerpanel").html(this.label()+b+":"+c)}this.bseconds=c},label:function(){return menu.isLangJP()?"Œo‰ßŽžŠÔF":"Time: "},ACcheck:function(){var c=(new Date()).getTime();var b=120+(this.worstACCost<250?this.worstACCost*4:this.worstACCost*2+500);if(c-this.lastACTime>b&&this.lastOpeCnt!=um.anscount&&!ans.inCheck){this.lastACTime=c;this.lastOpeCnt=um.anscount;var a=ans.autocheck();if(!a){this.worstACCost=Math.max(this.worstACCost,((new Date()).getTime()-c))}}},startUndoTimer:function(){this.undoWaitCount=mf(200/this.undoInterval);if(!this.TIDundo){this.TIDundo=setInterval(this.procUndo.bind(this),this.undoInterval)}if(kc.inUNDO){um.undo()}else{if(kc.inREDO){um.redo()}}},stopUndoTimer:function(){kc.inUNDO=false;kc.inREDO=false;clearInterval(this.TIDundo);this.TIDundo=null},procUndo:function(){if(!kc.isCTRL){this.stopUndoTimer();return}if(this.undoWaitCount>0){if(kc.inUNDO||kc.inREDO){this.undoWaitCount--}return}if(kc.inUNDO){um.undo()}else{if(kc.inREDO){um.redo()}else{this.undoWaitCount=mf(300/this.undoInterval)}}}};Cell=function(a){this.cx;this.cy;this.px;this.py;this.ques;this.qnum;this.direc;this.qans;this.qsub;this.error;this.numobj="";this.numobj2="";this.allclear(a)};Cell.prototype={allclear:function(a){this.ques=0;this.qans=-1;this.qsub=0;this.ques=0;this.qnum=-1;if(k.puzzleid=="tilepaint"||k.puzzleid=="kakuro"){this.qnum=0}this.direc=0;if(k.puzzleid=="triplace"){this.direc=-1}this.error=0},ansclear:function(a){this.qans=-1;this.qsub=0;this.error=0},subclear:function(a){this.qsub=0;this.error=0}};Cross=function(a){this.cx;this.cy;this.px;this.py;this.ques;this.qnum;this.error;this.numobj="";this.allclear(a)};Cross.prototype={allclear:function(a){this.ques=0;this.qnum=-1;this.error=0},ansclear:function(a){this.error=0},subclear:function(a){this.error=0}};Border=function(a){this.cx;this.cy;this.px;this.py;this.ques;this.qnum;this.qans;this.qsub;this.line;this.color;this.error;this.numobj="";this.allclear(a)};Border.prototype={allclear:function(a){this.ques=0;if(k.puzzleid=="mejilink"&&a<k.qcols*(k.qrows-1)+(k.qcols-1)*k.qrows){this.ques=1}this.qnum=-1;if(k.puzzleid=="tentaisho"){this.qnum=0}this.qans=0;this.qsub=0;if(k.puzzleid=="bosanowa"){this.qsub=-1}this.line=0;this.color="";this.error=0},ansclear:function(a){this.qans=0;this.qsub=0;if(k.puzzleid=="bosanowa"){this.qsub=-1}this.line=0;this.color="";this.error=0},subclear:function(a){this.qsub=0;if(k.puzzleid=="bosanowa"){this.qsub=-1}this.error=0}};Board=function(){this.bdinside=0;this.cellmax=0;this.crossmax=0;this.bdmax=0;this.excellmax=0;this.enableLineNG=false;this.def={};this.initialize2()};Board.prototype={initialize2:function(){this.cell=[];this.cellmax=(k.qcols*k.qrows);for(var a=0;a<this.cellmax;a++){this.cell[a]=new Cell(a)}this.def.cell=new Cell(0);if(k.iscross){this.cross=[];this.crossmax=(k.qcols+1)*(k.qrows+1);for(var a=0;a<this.crossmax;a++){this.cross[a]=new Cross(a)}this.def.cross=new Cross(0)}if(k.isborder){this.border=[];this.borders=[];this.bdinside=2*k.qcols*k.qrows-(k.qcols+k.qrows);this.bdmax=this.bdinside+(k.isoutsideborder==0?0:2*(k.qcols+k.qrows));for(var a=0;a<this.bdmax;a++){this.border[a]=new Border(a);this.borders[a]=a}this.def.border=new Border(0)}if(k.isextendcell!=0){this.excell=[];this.excellmax=(k.isextendcell==1?k.qcols+k.qrows+1:2*k.qcols+2*k.qrows+4);for(var a=0;a<this.excellmax;a++){this.excell[a]=new Cell(a)}}this.setposAll();this.override()},setposAll:function(){this.setposCells();if(k.iscross){this.setposCrosses()}if(k.isborder){this.setposBorders()}if(k.isextendcell!=0){this.setposEXcells()}this.setpicAll()},setposCells:function(){this.cellmax=this.cell.length;for(var a=0;a<this.cell.length;a++){this.cell[a].cx=a%k.qcols;this.cell[a].cy=mf(a/k.qcols)}},setposCrosses:function(){this.crossmax=this.cross.length;for(var a=0;a<this.cross.length;a++){this.cross[a].cx=a%(k.qcols+1);this.cross[a].cy=mf(a/(k.qcols+1))}},setposBorders:function(){this.bdinside=2*k.qcols*k.qrows-(k.qcols+k.qrows);this.bdmax=this.border.length;for(var a=0;a<this.border.length;a++){if(a>=0&&a<(k.qcols-1)*k.qrows){this.border[a].cx=(a%(k.qcols-1))*2+2;this.border[a].cy=mf(a/(k.qcols-1))*2+1}else{if(a>=(k.qcols-1)*k.qrows&&a<this.bdinside){this.border[a].cx=(a-(k.qcols-1)*k.qrows)%k.qcols*2+1;this.border[a].cy=mf((a-(k.qcols-1)*k.qrows)/k.qcols)*2+2}else{if(a>=this.bdinside&&a<this.bdinside+k.qcols){this.border[a].cx=(a-this.bdinside)*2+1;this.border[a].cy=0}else{if(a>=this.bdinside+k.qcols&&a<this.bdinside+2*k.qcols){this.border[a].cx=(a-this.bdinside-k.qcols)*2+1;this.border[a].cy=k.qrows*2}else{if(a>=this.bdinside+2*k.qcols&&a<this.bdinside+2*k.qcols+k.qrows){this.border[a].cx=0;this.border[a].cy=(a-this.bdinside-2*k.qcols)*2+1}else{if(a>=this.bdinside+2*k.qcols+k.qrows&&a<this.bdinside+2*(k.qcols+k.qrows)){this.border[a].cx=k.qcols*2;this.border[a].cy=(a-this.bdinside-2*k.qcols-k.qrows)*2+1}}}}}}}},setposEXcells:function(){this.excellmax=this.excell.length;for(var a=0;a<this.excell.length;a++){if(k.isextendcell==1){if(a<k.qcols){this.excell[a].cx=a;this.excell[a].cy=-1}else{if(a<k.qcols+k.qrows){this.excell[a].cx=-1;this.excell[a].cy=a-k.qcols}else{this.excell[a].cx=-1;this.excell[a].cy=-1}}}else{if(k.isextendcell==2){if(a<k.qcols){this.excell[a].cx=a;this.excell[a].cy=-1}else{if(a<2*k.qcols){this.excell[a].cx=a-k.qcols;this.excell[a].cy=k.qrows}else{if(a<2*k.qcols+k.qrows){this.excell[a].cx=-1;this.excell[a].cy=a-2*k.qcols}else{if(a<2*k.qcols+2*k.qrows){this.excell[a].cx=k.qcols;this.excell[a].cy=a-2*k.qcols-k.qrows}else{if(a<2*k.qcols+2*k.qrows+1){this.excell[a].cx=-1;this.excell[a].cy=-1}else{if(a<2*k.qcols+2*k.qrows+2){this.excell[a].cx=k.qcols;this.excell[a].cy=-1}else{if(a<2*k.qcols+2*k.qrows+3){this.excell[a].cx=-1;this.excell[a].cy=k.qrows}else{if(a<2*k.qcols+2*k.qrows+4){this.excell[a].cx=k.qcols;this.excell[a].cy=k.qrows}else{this.excell[a].cx=-1;this.excell[a].cy=-1}}}}}}}}}}}},setpicAll:function(){var d=k.p0.x,e=k.p0.y,h;h=0;for(var f=0,b=e;f<k.qrows;f++){for(var a=0,c=d;a<k.qcols;a++){this.cell[h].px=c;this.cell[h].py=b;h++;c+=k.cwidth}b+=k.cheight}if(k.iscross){h=0;for(var f=0,b=e;f<=k.qrows;f++){for(var a=0,c=d;a<=k.qcols;a++){this.cross[h].px=c;this.cross[h].py=b;h++;c+=k.cwidth}b+=k.cheight}}if(k.isborder){for(var h=0;h<this.bdmax;h++){this.border[h].px=d+mf(this.border[h].cx*k.cwidth/2);this.border[h].py=e+mf(this.border[h].cy*k.cheight/2)}}if(k.isextendcell!=0){for(var h=0;h<this.excellmax;h++){this.excell[h].px=d+this.excell[h].cx*k.cwidth;this.excell[h].py=e+this.excell[h].cy*k.cheight}}},ansclear:function(){for(var a=0;a<this.cellmax;a++){this.cell[a].ansclear(a)}if(k.iscross){for(var a=0;a<this.crossmax;a++){this.cross[a].ansclear(a)}}if(k.isborder){for(var a=0;a<this.bdmax;a++){this.border[a].ansclear(a)}}if(k.isextendcell!=0){for(var a=0;a<this.excellmax;a++){this.excell[a].ansclear(a)}}pc.paintAll();base.resetInfo()},subclear:function(){for(var a=0;a<this.cellmax;a++){this.cell[a].subclear(a)}if(k.iscross){for(var a=0;a<this.crossmax;a++){this.cross[a].subclear(a)}}if(k.isborder){for(var a=0;a<this.bdmax;a++){this.border[a].subclear(a)}}if(k.isextendcell!=0){for(var a=0;a<this.excellmax;a++){this.excell[a].subclear(a)}}pc.paintAll()},errclear:function(){if(!ans.errDisp){return}for(var a=0;a<this.cellmax;a++){this.cell[a].error=0}if(k.iscross){for(var a=0;a<this.crossmax;a++){this.cross[a].error=0}}if(k.isborder){for(var a=0;a<this.bdmax;a++){this.border[a].error=0}}if(k.isextendcell!=0){for(var a=0;a<this.excellmax;a++){this.excell[a].error=0}}ans.errDisp=false;pc.paintAll()},isNullObj:function(a,b){if(a=="cell"){return((this.cell[b].qans==this.def.cell.qans)&&(this.cell[b].qsub==this.def.cell.qsub)&&(this.cell[b].ques==this.def.cell.ques)&&(this.cell[b].qnum==this.def.cell.qnum)&&(this.cell[b].direc==this.def.cell.direc))}else{if(a=="cross"){return(this.cross[b].qnum==this.def.cross.qnum)}else{if(a=="border"){return((this.border[b].qans==this.def.border.qans)&&(this.border[b].qsub==this.def.border.qsub)&&(this.border[b].ques==this.def.border.ques)&&(this.border[b].qnum==this.def.border.qnum)&&(this.border[b].line==this.def.border.line))}else{if(a=="excell"){return((this.excell[b].qnum==this.def.cell.qnum)&&(this.excell[b].direc==this.def.cell.direc))}}}}return true},hideNumobj:function(a,b){if(a=="cell"){if(this.cell[b].numobj){this.cell[b].numobj.hide()}if(this.cell[b].numobj2){this.cell[b].numobj2.hide()}}else{if(a=="cross"){if(this.cross[b].numobj){this.cross[b].numobj.hide()}}else{if(a=="border"){if(this.border[b].numobj){this.border[b].numobj.hide()}}else{if(a=="excell"){if(this.excell[b].numobj){this.excell[b].numobj.hide()}if(this.excell[b].numobj2){this.excell[b].numobj2.hide()}}}}}},cnum:function(a,b){return(a>=0&&a<=k.qcols-1&&b>=0&&b<=k.qrows-1)?a+b*k.qcols:-1},cnum2:function(a,d,c,b){return(a>=0&&a<=c-1&&d>=0&&d<=b-1)?a+d*c:-1},xnum:function(a,b){return(a>=0&&a<=k.qcols&&b>=0&&b<=k.qrows)?a+b*(k.qcols+1):-1},xnum2:function(a,d,c,b){return(a>=0&&a<=c&&d>=0&&d<=b)?a+d*(c+1):-1},bnum:function(a,b){return this.bnum2(a,b,k.qcols,k.qrows)},bnum2:function(a,d,c,b){if(a>=1&&a<=c*2-1&&d>=1&&d<=b*2-1){if(a%2==0&&d%2==1){return mf((a-1)/2)+mf((d-1)/2)*(c-1)}else{if(a%2==1&&d%2==0){return mf((a-1)/2)+mf((d-2)/2)*c+(c-1)*b}}}else{if(k.isoutsideborder==1){if(d==0&&a%2==1&&(a>=1&&a<=2*c-1)){return(c-1)*b+c*(b-1)+mf((a-1)/2)}else{if(d==2*b&&a%2==1&&(a>=1&&a<=2*c-1)){return(c-1)*b+c*(b-1)+c+mf((a-1)/2)}else{if(a==0&&d%2==1&&(d>=1&&d<=2*b-1)){return(c-1)*b+c*(b-1)+2*c+mf((d-1)/2)}else{if(a==2*c&&d%2==1&&(d>=1&&d<=2*b-1)){return(c-1)*b+c*(b-1)+2*c+b+mf((d-1)/2)}}}}}}return -1},exnum:function(a,b){return this.exnum2(a,b,k.qcols,k.qrows)},exnum2:function(a,d,c,b){if(k.isextendcell==1){if(a==-1&&d==-1){return c+b}else{if(d==-1&&a>=0&&a<c){return a}else{if(a==-1&&d>=0&&d<b){return c+d}}}}else{if(k.isextendcell==2){if(d==-1&&a>=0&&a<c){return a}else{if(d==b&&a>=0&&a<c){return c+a}else{if(a==-1&&d>=0&&d<b){return 2*c+d}else{if(a==c&&d>=0&&d<b){return 2*c+b+d}else{if(a==-1&&d==-1){return 2*c+2*b}else{if(a==c&&d==-1){return 2*c+2*b+1}else{if(a==-1&&d==b){return 2*c+2*b+2}else{if(a==c&&d==b){return 2*c+2*b+3}}}}}}}}}}return -1},up:function(a){return this.cell[a]?this.cnum(this.cell[a].cx,this.cell[a].cy-1):-1},dn:function(a){return this.cell[a]?this.cnum(this.cell[a].cx,this.cell[a].cy+1):-1},lt:function(a){return this.cell[a]?this.cnum(this.cell[a].cx-1,this.cell[a].cy):-1},rt:function(a){return this.cell[a]?this.cnum(this.cell[a].cx+1,this.cell[a].cy):-1},ub:function(a){return this.cell[a]?this.bnum(2*this.cell[a].cx+1,2*this.cell[a].cy):-1},db:function(a){return this.cell[a]?this.bnum(2*this.cell[a].cx+1,2*this.cell[a].cy+2):-1},lb:function(a){return this.cell[a]?this.bnum(2*this.cell[a].cx,2*this.cell[a].cy+1):-1},rb:function(a){return this.cell[a]?this.bnum(2*this.cell[a].cx+2,2*this.cell[a].cy+1):-1},cc1:function(a){return this.cnum(mf((bd.border[a].cx-(bd.border[a].cy%2))/2),mf((bd.border[a].cy-(bd.border[a].cx%2))/2))},cc2:function(a){return this.cnum(mf((bd.border[a].cx+(bd.border[a].cy%2))/2),mf((bd.border[a].cy+(bd.border[a].cx%2))/2))},crosscc1:function(a){return this.xnum(mf((bd.border[a].cx-(bd.border[a].cx%2))/2),mf((bd.border[a].cy-(bd.border[a].cy%2))/2))},crosscc2:function(a){return this.xnum(mf((bd.border[a].cx+(bd.border[a].cx%2))/2),mf((bd.border[a].cy+(bd.border[a].cy%2))/2))},bcntCross:function(a,c){var b=0;if(this.isBlack(this.cnum(a-1,c-1))){b++}if(this.isBlack(this.cnum(a,c-1))){b++}if(this.isBlack(this.cnum(a-1,c))){b++}if(this.isBlack(this.cnum(a,c))){b++}return b},isLPup:function(a){return({101:1,102:1,104:1,105:1}[this.QuC(a)]==1)},isLPdown:function(a){return({101:1,102:1,106:1,107:1}[this.QuC(a)]==1)},isLPleft:function(a){return({101:1,103:1,105:1,106:1}[this.QuC(a)]==1)},isLPright:function(a){return({101:1,103:1,104:1,107:1}[this.QuC(a)]==1)},isnoLPup:function(a){return({1:1,4:1,5:1,21:1,103:1,106:1,107:1}[this.QuC(a)]==1)},isnoLPdown:function(a){return({1:1,2:1,3:1,21:1,103:1,104:1,105:1}[this.QuC(a)]==1)},isnoLPleft:function(a){return({1:1,2:1,5:1,22:1,102:1,104:1,107:1}[this.QuC(a)]==1)},isnoLPright:function(a){return({1:1,3:1,4:1,22:1,102:1,105:1,106:1}[this.QuC(a)]==1)},isLPMarked:function(a){return bd.border[a].cx%2==1?(bd.isLPdown(bd.cc1(a))||bd.isLPup(bd.cc2(a))):(bd.isLPright(bd.cc1(a))||bd.isLPleft(bd.cc2(a)))},isLPCombined:function(a){return bd.border[a].cx%2==1?(bd.isLPdown(bd.cc1(a))&&bd.isLPup(bd.cc2(a))):(bd.isLPright(bd.cc1(a))&&bd.isLPleft(bd.cc2(a)))},isLineNG:function(a){return bd.border[a].cx%2==1?(bd.isnoLPdown(bd.cc1(a))||bd.isnoLPup(bd.cc2(a))):(bd.isnoLPright(bd.cc1(a))||bd.isnoLPleft(bd.cc2(a)))},checkLPCombined:function(b){var a;a=this.ub(b);if(a!=-1&&this.LiB(a)==0&&this.isLPCombined(a)){this.sLiB(a,1)}a=this.db(b);if(a!=-1&&this.LiB(a)==0&&this.isLPCombined(a)){this.sLiB(a,1)}a=this.lb(b);if(a!=-1&&this.LiB(a)==0&&this.isLPCombined(a)){this.sLiB(a,1)}a=this.rb(b);if(a!=-1&&this.LiB(a)==0&&this.isLPCombined(a)){this.sLiB(a,1)}},sQuC:function(b,a){if(b<0||this.cell.length<=b){return}um.addOpe("cell","ques",b,this.cell[b].ques,a);this.cell[b].ques=a;if(k.puzzleid=="pipelink"||k.puzzleid=="loopsp"){this.checkLPCombined(b)}},QuC:function(a){if(a<0||this.cell.length<=a){return -1}return this.cell[a].ques},sQnC:function(c,b){if(c<0||this.cell.length<=c){return}if(k.dispzero==0&&b==0){return}var a=this.cell[c].qnum;um.addOpe("cell","qnum",c,a,b);this.cell[c].qnum=b;if(area.numberColony&&(b!=-1^area.bcell.id[c]!=-1)){area.setCell(c,(b!=-1?1:0))}if(k.puzzleid=="lightup"&&((a==-1)^(b==-1))){mv.paintAkari(c)}},QnC:function(a){if(a<0||this.cell.length<=a){return -1}return this.cell[a].qnum},sQaC:function(c,b){if(c<0||this.cell.length<=c){return}var a=this.cell[c].qans;um.addOpe("cell","qans",c,a,b);this.cell[c].qans=b;if((area.bblock&&(b!=-1^area.bcell.id[c]!=-1))||(area.wblock&&(b==-1^area.wcell.id[c]!=-1))){area.setCell(c,(b!=-1?1:0))}if(k.puzzleid=="lightup"&&((a==1)^(b==1))){mv.paintAkari(c)}},QaC:function(a){if(a<0||this.cell.length<=a){return -1}return this.cell[a].qans},sQsC:function(b,a){if(b<0||this.cell.length<=b){return}um.addOpe("cell","qsub",b,this.cell[b].qsub,a);this.cell[b].qsub=a},QsC:function(a){if(a<0||this.cell.length<=a){return -1}return this.cell[a].qsub},sDiC:function(b,a){if(b<0||this.cell.length<=b){return}um.addOpe("cell","direc",b,this.cell[b].direc,a);this.cell[b].direc=a},DiC:function(a){if(a<0||this.cell.length<=a){return -1}return this.cell[a].direc},sQnE:function(b,a){if(b<0||this.excell.length<=b){return}um.addOpe("excell","qnum",b,this.excell[b].qnum,a);this.excell[b].qnum=a},QnE:function(a){if(a<0||this.excell.length<=a){return -1}return this.excell[a].qnum},sDiE:function(b,a){if(b<0||this.excell.length<=b){return}um.addOpe("excell","direc",b,this.excell[b].direc,a);this.excell[b].direc=a},DiE:function(a){if(a<0||this.excell.length<=a){return -1}return this.excell[a].direc},sQuX:function(b,a){if(b<0||this.cross.length<=b){return}um.addOpe("cross","ques",b,this.cross[b].ques,a);this.cross[b].ques=a},QuX:function(a){if(a<0||this.cross.length<=a){return -1}return this.cross[a].ques},sQnX:function(b,a){if(b<0||this.cross.length<=b){return}um.addOpe("cross","qnum",b,this.cross[b].qnum,a);this.cross[b].qnum=a},QnX:function(a){if(a<0||this.cross.length<=a){return -1}return this.cross[a].qnum},sQuB:function(c,b){if(c<0||this.border.length<=c){return}var a=this.border[c].ques;um.addOpe("border","ques",c,a,b);this.border[c].ques=b;if(b>0^a>0){area.call_setBorder(c,b,"ques")}},QuB:function(a){if(a<0||this.border.length<=a){return -1}return this.border[a].ques},sQnB:function(b,a){if(b<0||this.border.length<=b){return}um.addOpe("border","qnum",b,this.border[b].qnum,a);this.border[b].qnum=a},QnB:function(a){if(a<0||this.border.length<=a){return -1}return this.border[a].qnum},sQaB:function(c,b){if(c<0||this.border.length<=c){return}if(this.border[c].ques!=0){return}var a=this.border[c].qans;um.addOpe("border","qans",c,a,b);this.border[c].qans=b;if(b>0^a>0){if(k.isborderAsLine){line.setLine(c,b)}else{area.call_setBorder(c,b,"qans")}}},QaB:function(a){if(a<0||this.border.length<=a){return -1}return this.border[a].qans},sQsB:function(b,a){if(b<0||this.border.length<=b){return}um.addOpe("border","qsub",b,this.border[b].qsub,a);this.border[b].qsub=a},QsB:function(a){if(a<0||this.border.length<=a){return -1}return this.border[a].qsub},sLiB:function(c,b){if(c<0||this.border.length<=c){return}if(this.enableLineNG&&(b==1?bd.isLineNG:bd.isLPCombined)(c)){return}var a=this.border[c].line;um.addOpe("border","line",c,a,b);this.border[c].line=b;if(b>0^a>0){line.setLine(c,b)}},LiB:function(a){if(a<0||this.border.length<=a){return -1}return this.border[a].line},sErC:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]>=0&&this.cell.length>c[b]){this.cell[c[b]].error=a}}},ErC:function(a){if(a<0||this.cell.length<=a){return 0}return this.cell[a].error},sErX:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]>=0&&this.cross.length>c[b]){this.cross[c[b]].error=a}}},ErX:function(a){if(a<0||this.cross.length<=a){return 0}return this.cross[a].error},sErB:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]>=0&&this.border.length>c[b]){this.border[c[b]].error=a}}},ErB:function(a){if(a<0||this.border.length<=a){return 0}return this.border[a].error},sErE:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]>=0&&this.excell.length>c[b]){this.excell[c[b]].error=a}}},ErE:function(a){if(a<0||this.excell.length<=a){return 0}return this.excell[a].error},override:function(){if(k.isborderAsLine){this.isLine=function(a){return(bd.QaB(a)>0)};this.setLine=function(a){this.sQaB(a,1);this.sQsB(a,0)};this.setPeke=function(a){this.sQaB(a,0);this.sQsB(a,2)};this.removeLine=function(a){this.sQaB(a,0);this.sQsB(a,0)}}if(!k.isAnsNumber){this.isNum=function(a){return(bd.QnC(a)!=-1)};this.noNum=function(a){return(bd.QnC(a)==-1)};this.isValidNum=function(a){return(bd.QnC(a)>=0)};this.getNum=function(a){return bd.QnC(a)};this.setNum=function(b,a){if(k.dispzero||a!=0){this.sQnC(b,a)}};if(k.NumberIsWhite){this.setNum=function(b,a){if(k.dispzero||a!=0){this.sQnC(b,a);this.sQaC(b,-1)}}}}else{if(k.NumberIsWhite){this.setNum=function(a){this.sQnC(a,val);this.sQaC(a,-1)}}}},isBlack:function(a){return(bd.QaC(a)==1)},isWhite:function(a){return(a!=-1&&bd.QaC(a)!=1)},setBlack:function(a){this.sQaC(a,1)},setWhite:function(a){this.sQaC(a,-1)},isNum:function(a){return(bd.QnC(a)!=-1||bd.QaC(a)!=-1)},noNum:function(a){return(bd.QnC(a)==-1&&bd.QaC(a)==-1)},isValidNum:function(a){return(bd.QnC(a)>=0||(bd.QnC(a)==-1&&bd.QaC(a)>=0))},sameNumber:function(b,a){return(bd.isValidNum(b)&&(bd.getNum(b)==bd.getNum(a)))},getNum:function(a){return(this.QnC(a)!=-1?this.QnC(a):this.QaC(a))},setNum:function(b,a){if(k.dispzero||a!=0){if(k.mode==1){this.sQnC(b,a);this.sQaC(b,bd.def.cell.qnum)}else{if(this.QnC(b)==bd.def.cell.qnum){this.sQaC(b,a)}}this.sQsC(b,0)}},isLine:function(b){try{return(bd.border[b].line>0)}catch(a){}return false},setLine:function(a){this.sLiB(a,1);this.sQsB(a,0)},setPeke:function(a){this.sLiB(a,0);this.sQsB(a,2)},removeLine:function(a){this.sLiB(a,0);this.sQsB(a,0)},isBorder:function(b){try{return(bd.border[b].ques>0||bd.border[b].qans>0)}catch(a){}return false},setBorder:function(a){if(k.mode==1){this.sQuB(a,1);this.sQaB(a,0)}else{if(this.QuB(a)!=1){this.sQaB(a,1)}}},removeBorder:function(a){if(k.mode==1){this.sQuB(a,0);this.sQaB(a,0)}else{if(this.QuB(a)!=1){this.sQaB(a,0)}}},setBsub:function(a){this.sQsB(a,1)},removeBsub:function(a){this.sQsB(a,0)}};Graphic=function(){this.gridcolor="black";this.Cellcolor="black";this.errcolor1="rgb(224, 0, 0)";this.errcolor2="rgb(64, 64, 255)";this.errcolor3="rgb(0, 191, 0)";this.MBcolor="rgb(255, 127, 64)";this.qsubcolor1="rgb(160,255,160)";this.qsubcolor2="rgb(255,255,127)";this.qsubcolor3="rgb(192,192,192)";this.fontcolor="black";this.fontAnscolor="rgb(0, 160, 0)";this.fontErrcolor="rgb(191, 0, 0)";this.BCell_fontcolor="rgb(224, 224, 224)";this.borderfontcolor="black";this.bcolor="white";this.dotcolor="black";this.errbcolor1="rgb(255, 160, 160)";this.errbcolor2="rgb(64, 255, 64)";this.icecolor="rgb(192, 224, 255)";this.TTcolor="rgb(127,255,127)";this.BorderQuescolor="black";this.BorderQanscolor="rgb(0, 191, 0)";this.BorderQsubcolor="rgb(255, 0, 255)";this.errBorderQanscolor2="rgb(160, 160, 160)";this.BBcolor="rgb(96, 96, 96)";this.linecolor="rgb(0, 160, 0)";this.pekecolor="rgb(32, 32, 255)";this.errlinecolor1="rgb(255, 0, 0)";this.errlinecolor2="rgb(160, 160, 160)";this.gridcolor_BLACK="black";this.gridcolor_LIGHT="rgb(127, 127, 127)";this.gridcolor_DLIGHT="rgb(160, 160, 160)";this.gridcolor_SLIGHT="rgb(191, 191, 191)";this.gridcolor_THIN="rgb(224, 224, 224)";this.bcolor_GREEN="rgb(160, 255, 160)";this.errbcolor1_DARK="rgb(127, 255, 127)";this.linecolor_LIGHT="rgb(0, 192, 0)";this.fontsizeratio=1;this.crosssize=0.4;this.lw=1;this.lm=1;this.chassisflag=true;this.zstable=false;this.textenable=false;this.lastHdeg=0;this.lastYdeg=0;this.minYdeg=0.18;this.maxYdeg=0.7};Graphic.prototype={onresize_func:function(){this.lw=(mf(k.cwidth/12)>=3?mf(k.cwidth/12):3);this.lm=mf((this.lw-1)/2)},already:function(){if(!k.br.IE){return true}return uuCanvas.already()},paint:function(b,d,a,c){},paintAll:function(){if(this.already()){this.paint(-1,-1,k.qcols,k.qrows)}},paintBorder:function(a){if(isNaN(a)||!bd.border[a]){return}if(bd.border[a].cx%2==1){this.paint(mf((bd.border[a].cx-1)/2)-1,mf(bd.border[a].cy/2)-1,mf((bd.border[a].cx-1)/2)+1,mf(bd.border[a].cy/2))}else{this.paint(mf(bd.border[a].cx/2)-1,mf((bd.border[a].cy-1)/2)-1,mf(bd.border[a].cx/2),mf((bd.border[a].cy-1)/2)+1)}},paintLine:function(a){if(isNaN(a)||!bd.border[a]){return}if(bd.border[a].cx%2==1){this.paint(mf((bd.border[a].cx-1)/2),mf(bd.border[a].cy/2)-1,mf((bd.border[a].cx-1)/2),mf(bd.border[a].cy/2))}else{this.paint(mf(bd.border[a].cx/2)-1,mf((bd.border[a].cy-1)/2),mf(bd.border[a].cx/2),mf((bd.border[a].cy-1)/2))}},paintCell:function(a){if(isNaN(a)||!bd.cell[a]){return}this.paint(bd.cell[a].cx,bd.cell[a].cy,bd.cell[a].cx,bd.cell[a].cy)},paintEXcell:function(a){if(isNaN(a)||!bd.excell[a]){return}this.paint(bd.excell[a].cx,bd.excell[a].cy,bd.excell[a].cx,bd.excell[a].cy)},cellinside:function(b,j,a,i,d){if(d==null){d=f_true}var l=[];for(var e=j;e<=i;e++){for(var f=b;f<=a;f++){var h=bd.cnum(f,e);if(h!=-1&&d(h)){l.push(h)}}}return l},crossinside:function(b,j,a,i,d){if(d==null){d=f_true}var l=[];for(var e=j;e<=i;e++){for(var f=b;f<=a;f++){var h=bd.xnum(f,e);if(h!=-1&&d(h)){l.push(h)}}}return l},borderinside:function(d,j,a,i,e){if(e==null){e=f_true}var c=[];for(var f=j;f<=i;f++){for(var h=d;h<=a;h++){if((h+f)%2==0){continue}var b=bd.bnum(h,f);if(b!=-1&&e(b)){c.push(b)}}}return c},getNewLineColor:function(){var i=0;while(1){var f=mf(Math.random()*384)-64;if(f<0){f=0}if(f>255){f=255}var e=mf(Math.random()*384)-64;if(e<0){e=0}if(e>255){e=255}var j=mf(Math.random()*384)-64;if(j<0){j=0}if(j>255){j=255}var a=Math.max(f,Math.max(e,j));var l=Math.min(f,Math.min(e,j));var c=0;var b=(a+l)*0.5/255;var d=(a==l?0:(a-l)/((b<=0.5)?(a+l):(2*255-a-l)));if(a==l){c=0}else{if(f>=e&&f>=j){c=(60*(e-j)/(a-l)+360)%360}else{if(e>=f&&e>=j){c=(120+60*(j-f)/(a-l)+360)%360}else{if(j>=e&&j>=f){c=(240+60*(f-e)/(a-l)+360)%360}}}}var h=(0.29891*f+0.58661*e+0.11448*j)/255;if((this.minYdeg<h&&h<this.maxYdeg)&&(Math.abs(this.lastYdeg-h)>0.15)&&(d<0.02||0.4<d)&&(((360+this.lastHdeg-c)%360>=45)&&((360+this.lastHdeg-c)%360<=315))){this.lastHdeg=c;this.lastYdeg=h;return"rgb("+f+","+e+","+j+")"}i++;if(i>100){return"rgb("+f+","+e+","+j+")"}}},inputPath:function(c,a){g.beginPath();g.moveTo(mf(c[0]+c[2]),mf(c[1]+c[3]));for(var b=4;b<c.length;b+=2){g.lineTo(mf(c[0]+c[b+0]),mf(c[1]+c[b+1]))}if(a==1){g.closePath()}},drawBlackCells:function(b,f,a,e){var l=k.cwidth*0.06;var h=this.cellinside(b,f,a,e,bd.isBlack);for(var d=0;d<h.length;d++){var j=h[d];if(bd.ErC(j)==0){g.fillStyle=this.Cellcolor}else{if(bd.ErC(j)==1){g.fillStyle=this.errcolor1}else{if(bd.ErC(j)==2){g.fillStyle=this.errcolor2}else{if(bd.ErC(j)==3){g.fillStyle=this.errcolor3}}}}if(this.vnop("c"+j+"_full_",1)){g.fillRect(bd.cell[j].px,bd.cell[j].py,k.cwidth+1,k.cheight+1)}this.vhide("c"+j+"_dot_")}this.vinc()},drawWhiteCells:function(b,f,a,e){var l=Math.max(mf(k.cwidth*0.06),2);var h=this.cellinside(b,f,a,e,bd.isWhite);for(var d=0;d<h.length;d++){var j=h[d];this.drawErrorCell1(j);if(bd.QsC(j)==1){if(this.bcolor=="white"){g.fillStyle=this.dotcolor;if(this.vnop("c"+j+"_dot_",1)){g.beginPath();g.arc(mf(bd.cell[j].px+k.cwidth/2),mf(bd.cell[j].py+k.cheight/2),l,0,Math.PI*2,false);g.fill()}if(bd.ErC(j)==0){this.vhide("c"+j+"_full_")}}else{if(bd.ErC(j)==0){g.fillStyle=this.bcolor;if(this.vnop("c"+j+"_full_",1)){g.fillRect(bd.cell[j].px,bd.cell[j].py,k.cwidth+1,k.cheight+1)}}}}else{if(bd.ErC(j)==0){this.vhide("c"+j+"_full_")}this.vhide("c"+j+"_dot_")}}this.vinc()},drawQSubCells:function(b,f,a,e){var h=this.cellinside(b,f,a,e,f_true);for(var d=0;d<h.length;d++){var j=h[d];if(bd.ErC(j)==1){g.fillStyle=this.errbcolor1}else{if(bd.ErC(j)==2){g.fillStyle=this.errbcolor2}else{if(bd.QsC(j)==1){g.fillStyle=this.qsubcolor1}else{if(bd.QsC(j)==2){g.fillStyle=this.qsubcolor2}else{if(bd.QsC(j)==3){g.fillStyle=this.qsubcolor3}else{this.vhide("c"+j+"_full_");continue}}}}}if(this.vnop("c"+j+"_full_",1)){g.fillRect(bd.cell[j].px,bd.cell[j].py,k.cwidth,k.cheight)}}this.vinc()},drawErrorCells:function(b,e,a,d){var f=this.cellinside(b,e,a,d,f_true);for(var c=0;c<f.length;c++){this.drawErrorCell1(f[c])}this.vinc()},drawErrorCell1:function(a){if(bd.ErC(a)==1||bd.ErC(a)==2){if(bd.ErC(a)==1){g.fillStyle=this.errbcolor1}else{if(bd.ErC(a)==2){g.fillStyle=this.errbcolor2}}if(this.vnop("c"+a+"_full_",1)){g.fillRect(bd.cell[a].px,bd.cell[a].py,k.cwidth,k.cheight)}}else{this.vhide("c"+a+"_full_")}},drawIcebarns:function(b,f,a,e){var h=this.cellinside(b,f,a,e,f_true);for(var d=0;d<h.length;d++){var j=h[d];if(bd.QuC(j)==6){g.fillStyle=(bd.ErC(j)==1?this.errbcolor1:this.icecolor);if(this.vnop("c"+j+"_full_",1)){g.fillRect(bd.cell[j].px,bd.cell[j].py,k.cwidth,k.cheight)}}else{this.vhide("c"+j+"_full_")}}this.vinc()},drawBCells:function(b,f,a,e){var h=this.cellinside(b,f,a,e,f_true);for(var d=0;d<h.length;d++){var j=h[d];if(bd.QnC(j)!=-1){if(bd.ErC(j)==1){g.fillStyle=this.errcolor1}else{g.fillStyle=this.Cellcolor}if(this.vnop("c"+j+"_full_",1)){g.fillRect(bd.cell[j].px,bd.cell[j].py,k.cwidth+1,k.cheight+1)}}else{if(bd.ErC(j)==0&&!(k.puzzleid=="lightup"&&ans.isShined&&ans.isShined(j))){this.vhide("c"+j+"_full_")}}this.dispnumCell_General(j)}this.vinc()},drawDots:function(b,f,a,e){var j=k.cwidth*0.15;var h=this.cellinside(b,f,a,e,f_true);for(var d=0;d<h.length;d++){var l=h[d];if(bd.QsC(l)==1){g.fillStyle=this.dotcolor;if(this.vnop("c"+l+"_dot_",1)){g.fillRect(bd.cell[l].px+mf(k.cwidth/2)-mf(j/2),bd.cell[l].py+mf(k.cheight/2)-mf(j/2),j,j)}}else{this.vhide("c"+l+"_dot_")}}this.vinc()},drawNumbers:function(b,e,a,d){var f=this.cellinside(b,e,a,d,f_true);for(var c=0;c<f.length;c++){this.dispnumCell_General(f[c])}this.vinc()},drawArrowNumbers:function(b,q,a,o){var t=this.cellinside(b,q,a,o,f_true);for(var h=0;h<t.length;h++){var l=t[h];if(bd.QaC(l)==1){g.fillStyle=this.BCell_fontcolor}else{if(bd.ErC(l)==1){g.fillStyle=this.fontErrcolor}else{g.fillStyle=this.fontcolor}}var e=bd.DiC(l);if(bd.QnC(l)!=-1&&(bd.QnC(l)!=-2||k.isDispHatena)&&e!=0){var m=mf(k.cwidth*0.7);var f=mf((k.cwidth-m)/2);var d=(mf(k.cwidth/24)>=1?mf(k.cwidth/24):1);var j=mf((d-1)/2);var r=bd.cell[l].px,p=bd.cell[l].py;if((e==1||e==2)&&this.vnop("c"+l+"_ar1_",1)){r=r+k.cwidth-mf(f*1.5)-j;p=p+f+1;g.fillRect(r,p+(e==1?f:0),d,m-f);r+=d/2}if((e==3||e==4)&&this.vnop("c"+l+"_ar3_",1)){r=r+f+1;p=p+mf(f*1.5)-j;g.fillRect(r+(e==3?f:0),p,m-f,d);p+=d/2}if(e==1){if(this.vnop("c"+l+"_dt1_",1)){this.inputPath([r,p,0,0,-m/6,m/3,m/6,m/3],true);g.fill()}}else{this.vhide("c"+l+"_dt1_")}if(e==2){if(this.vnop("c"+l+"_dt2_",1)){this.inputPath([r,p+m,0,0,-m/6,-m/3,m/6,-m/3],true);g.fill()}}else{this.vhide("c"+l+"_dt2_")}if(e==3){if(this.vnop("c"+l+"_dt3_",1)){this.inputPath([r,p,0,0,m*0.3,-m/6,m*0.3,m/6],true);g.fill()}}else{this.vhide("c"+l+"_dt3_")}if(e==4){if(this.vnop("c"+l+"_dt4_",1)){this.inputPath([r+m,p,0,0,-m*0.3,-m/6,-m*0.3,m/6],true);g.fill()}}else{this.vhide("c"+l+"_dt4_")}}else{this.vhide(["c"+l+"_ar1_","c"+l+"_ar3_","c"+l+"_dt1_","c"+l+"_dt2_","c"+l+"_dt3_","c"+l+"_dt4_"])}this.dispnumCell_General(l)}this.vinc()},drawCrosses:function(b,h,a,f){var e=mf(k.cwidth*this.crosssize+1);var j=this.crossinside(b,h,a,f,f_true);for(var d=0;d<j.length;d++){var l=j[d];if(bd.QnX(l)!=-1){if(bd.ErX(l)==1){g.fillStyle=this.errcolor1}else{g.fillStyle="white"}if(this.vnop("x"+l+"_cp1_",1)){g.beginPath();g.arc(bd.cross[l].px,bd.cross[l].py,e,0,Math.PI*2,false);g.fill()}g.lineWidth=1;g.strokeStyle="black";if(this.vnop("x"+l+"_cp2_",0)){if(k.br.IE){g.beginPath();g.arc(bd.cross[l].px,bd.cross[l].py,e,0,Math.PI*2,false)}g.stroke()}}else{this.vhide(["x"+l+"_cp1_","x"+l+"_cp2_"])}this.dispnumCross(l)}this.vinc()},drawCrossMarks:function(b,h,a,f){var e=k.cwidth*this.crosssize;var j=this.crossinside(b-1,h-1,a+1,f+1,f_true);for(var d=0;d<j.length;d++){var l=j[d];if(bd.QnX(l)==1){if(bd.ErX(l)==1){g.fillStyle=this.errcolor1}else{g.fillStyle=this.Cellcolor}if(this.vnop("x"+l+"_cm_",1)){g.beginPath();g.arc(bd.cross[l].px,bd.cross[l].py,e,0,Math.PI*2,false);g.fill()}}else{this.vhide("x"+l+"_cm_")}}this.vinc()},drawBorders:function(b,e,a,d){var f=this.borderinside(b*2-2,e*2-2,a*2+2,d*2+2,f_true);for(var c=0;c<f.length;c++){var h=f[c];this.drawBorder1(h,bd.isBorder(h))}this.vinc()},drawIceBorders:function(d,h,a,f){g.fillStyle=pc.Cellcolor;var c=this.borderinside(d*2-2,h*2-2,a*2+2,f*2+2,f_true);for(var e=0;e<c.length;e++){var b=c[e],l=bd.cc1(b),j=bd.cc2(b);this.drawBorder1x(bd.border[b].cx,bd.border[b].cy,(l!=-1&&j!=-1&&(bd.QuC(l)==6^bd.QuC(j)==6)))}this.vinc()},drawBorder1:function(c,b){var a=0;if(bd.QaB(c)!=1){g.fillStyle=this.BorderQuescolor}else{if(bd.QaB(c)==1){if(k.isborderAsLine==0&&bd.ErB(c)==1){g.fillStyle=this.errcolor1}else{if(k.isborderAsLine==0&&bd.ErB(c)==2){g.fillStyle=this.errBorderQanscolor2}else{if(k.isborderAsLine==1&&bd.ErB(c)==1){g.fillStyle=this.errlinecolor1;this.lw++;a++}else{if(k.isborderAsLine==1&&bd.ErB(c)==2){g.fillStyle=this.errlinecolor2}else{if(k.isborderAsLine==0||k.irowake==0||!menu.getVal("irowake")||!bd.border[c].color){g.fillStyle=this.BorderQanscolor}else{g.fillStyle=bd.border[c].color}}}}}}}this.drawBorder1x(bd.border[c].cx,bd.border[c].cy,b);this.lw-=a},drawBorder1x:function(d,c,a){var b="b"+d+"_"+c+"_bd_";if(!a){this.vhide(b)}else{if(c%2==1){if(this.vnop(b,1)){g.fillRect(k.p0.x+mf(d*k.cwidth/2)-this.lm,k.p0.x+mf((c-1)*k.cheight/2)-this.lm,this.lw,k.cheight+this.lw)}}else{if(d%2==1){if(this.vnop(b,1)){g.fillRect(k.p0.x+mf((d-1)*k.cwidth/2)-this.lm,k.p0.x+mf(c*k.cheight/2)-this.lm,k.cwidth+this.lw,this.lw)}}}}},drawBorderQsubs:function(c,f,b,e){var a=mf(k.cwidth*0.15);var h=this.borderinside(c*2-2,f*2-2,b*2+2,e*2+2,f_true);for(var d=0;d<h.length;d++){var j=h[d];if(bd.QsB(j)==1){g.fillStyle=this.BorderQsubcolor}else{this.vhide("b"+j+"_qsub1_");continue}if(bd.border[j].cx%2==1){if(this.vnop("b"+j+"_qsub1_",1)){g.fillRect(bd.border[j].px,bd.border[j].py-mf(k.cheight/2)+a,1,k.cheight-2*a)}}else{if(bd.border[j].cy%2==1){if(this.vnop("b"+j+"_qsub1_",1)){g.fillRect(bd.border[j].px-mf(k.cwidth/2)+a,bd.border[j].py,k.cwidth-2*a,1)}}}}this.vinc()},drawBoxBorders:function(C,b,A,a,m){var e=this.lw,l=this.lm+1;var d=k.cwidth;var p=k.cheight;g.fillStyle=this.BBcolor;var E=this.cellinside(C,b,A,a,f_true);for(var x=0;x<E.length;x++){var D=E[x];if(bd.QaC(D)!=1){for(var v=1;v<=12;v++){this.vhide("c"+D+"_bb"+v+"_")}continue}var B=2*bd.cell[D].cx+1,z=2*bd.cell[D].cy+1;var t=bd.cell[D].px,q=bd.cell[D].py;var o=((bd.QuB(bd.ub(D))!=1)&&!(!k.isoutsideborder&&z<=1));var f=((bd.QuB(bd.lb(D))!=1)&&!(!k.isoutsideborder&&B<=1));var h=((bd.QuB(bd.rb(D))!=1)&&!(!k.isoutsideborder&&B>=2*k.qcols-1));var w=((bd.QuB(bd.db(D))!=1)&&!(!k.isoutsideborder&&z>=2*k.qrows-1));var r=(bd.QuB(bd.bnum(B-2,z-1))!=1&&bd.QuB(bd.bnum(B-1,z-2))!=1);var j=(bd.QuB(bd.bnum(B+2,z-1))!=1&&bd.QuB(bd.bnum(B+1,z-2))!=1);var y=(bd.QuB(bd.bnum(B-2,z+1))!=1&&bd.QuB(bd.bnum(B-1,z+2))!=1);var u=(bd.QuB(bd.bnum(B+2,z+1))!=1&&bd.QuB(bd.bnum(B+1,z+2))!=1);if(!f){if(this.vnop("c"+D+"_bb1_",1)){g.fillRect(t+l,q+l,1,p-e)}}else{this.vhide("c"+D+"_bb1_")}if(!h){if(this.vnop("c"+D+"_bb2_",1)){g.fillRect(t+d-l,q+l,1,p-e)}}else{this.vhide("c"+D+"_bb2_")}if(!o){if(this.vnop("c"+D+"_bb3_",1)){g.fillRect(t+l,q+l,d-e,1)}}else{this.vhide("c"+D+"_bb3_")}if(!w){if(this.vnop("c"+D+"_bb4_",1)){g.fillRect(t+l,q+p-l,d-e,1)}}else{this.vhide("c"+D+"_bb4_")}if(m){if(f&&!(r&&o)){if(this.vnop("c"+D+"_bb5_",1)){g.fillRect(t-l,q+l,e+1,1)}}else{this.vhide("c"+D+"_bb5_")}if(f&&!(y&&w)){if(this.vnop("c"+D+"_bb6_",1)){g.fillRect(t-l,q+p-l,e+1,1)}}else{this.vhide("c"+D+"_bb6_")}if(o&&!(r&&f)){if(this.vnop("c"+D+"_bb7_",1)){g.fillRect(t+l,q-l,1,e+1)}}else{this.vhide("c"+D+"_bb7_")}if(o&&!(j&&h)){if(this.vnop("c"+D+"_bb8_",1)){g.fillRect(t+d-l,q-l,1,e+1)}}else{this.vhide("c"+D+"_bb8_")}}else{if(f&&!(r&&o)){if(this.vnop("c"+D+"_bb5_",1)){g.fillRect(t,q+l,l+1,1)}}else{this.vhide("c"+D+"_bb5_")}if(f&&!(y&&w)){if(this.vnop("c"+D+"_bb6_",1)){g.fillRect(t,q+p-l,l+1,1)}}else{this.vhide("c"+D+"_bb6_")}if(o&&!(r&&f)){if(this.vnop("c"+D+"_bb7_",1)){g.fillRect(t+l,q,1,l+1)}}else{this.vhide("c"+D+"_bb7_")}if(o&&!(j&&h)){if(this.vnop("c"+D+"_bb8_",1)){g.fillRect(t+d-l,q,1,l+1)}}else{this.vhide("c"+D+"_bb8_")}if(h&&!(j&&o)){if(this.vnop("c"+D+"_bb9_",1)){g.fillRect(t+d-l,q+l,l+1,1)}}else{this.vhide("c"+D+"_bb9_")}if(h&&!(u&&w)){if(this.vnop("c"+D+"_bb10_",1)){g.fillRect(t+d-l,q+p-l,l+1,1)}}else{this.vhide("c"+D+"_bb10_")}if(w&&!(y&&f)){if(this.vnop("c"+D+"_bb11_",1)){g.fillRect(t+l,q+p-l,1,l+1)}}else{this.vhide("c"+D+"_bb11_")}if(w&&!(u&&h)){if(this.vnop("c"+D+"_bb12_",1)){g.fillRect(t+d-l,q+p-l,1,l+1)}}else{this.vhide("c"+D+"_bb12_")}}}this.vinc()},drawLines:function(b,e,a,d){var f=this.borderinside(b*2-2,e*2-2,a*2+2,d*2+2,f_true);for(var c=0;c<f.length;c++){this.drawLine1(f[c],bd.isLine(f[c]))}this.vinc()},drawLine1:function(e,a){var d=this.lw,c=this.lm,b="b"+e+"_line_";if(bd.ErB(e)==1){g.fillStyle=this.errlinecolor1;d++}else{if(bd.ErB(e)==2){g.fillStyle=this.errlinecolor2}else{if(k.irowake==0||!menu.getVal("irowake")||!bd.border[e].color){g.fillStyle=this.linecolor}else{g.fillStyle=bd.border[e].color}}}if(!a){this.vhide(b)}else{if(bd.border[e].cx%2==1&&this.vnop(b,1)){g.fillRect(bd.border[e].px-c,bd.border[e].py-mf(k.cheight/2)-c,d,k.cheight+d)}else{if(bd.border[e].cy%2==1&&this.vnop(b,1)){g.fillRect(bd.border[e].px-mf(k.cwidth/2)-c,bd.border[e].py-c,k.cwidth+d,d)}}}},drawPekes:function(d,j,a,h,f){var l=mf(k.cwidth*0.15);if(l<3){l=3}var c=this.borderinside(d*2-2,j*2-2,a*2+2,h*2+2,f_true);for(var e=0;e<c.length;e++){var b=c[e];if(bd.QsB(b)==2){g.strokeStyle=this.pekecolor}else{this.vhide(["b"+b+"_peke0_","b"+b+"_peke1_","b"+b+"_peke2_"]);continue}g.fillStyle="white";if((f==0||f==2)){if(this.vnop("b"+b+"_peke0_",1)){g.fillRect(bd.border[b].px-l,bd.border[b].py-l,2*l+1,2*l+1)}}else{this.vhide("b"+b+"_peke0_")}if(f==0||f==1){g.lineWidth=1;if(this.vnop("b"+b+"_peke1_",0)){this.inputPath([bd.border[b].px,bd.border[b].py,-l+1,-l+1,l,l],false);g.stroke()}if(this.vnop("b"+b+"_peke2_",0)){this.inputPath([bd.border[b].px,bd.border[b].py,-l+1,l,l,-l+1],false);g.stroke()}}else{this.vhide(["b"+b+"_peke1_","b"+b+"_peke2_"])}}this.vinc()},drawTriangle:function(d,h,a,f){var j=this.cellinside(d,h,a,f,f_true);for(var e=0;e<j.length;e++){var l=j[e];var b=(bd.QuC(l)!=0?bd.QuC(l):bd.QaC(l));if(k.puzzleid=="kinkonkan"){b=bd.ErC(l)}if(k.puzzleid=="kinkonkan"){g.fillStyle=this.errbcolor2}else{if((bd.ErC(l)==1||bd.ErC(l)==4)&&k.puzzleid!="shakashaka"){g.fillStyle=this.errcolor1}else{g.fillStyle=this.Cellcolor}}this.drawTriangle1(bd.cell[l].px,bd.cell[l].py,b,bd.cell[l].cx,bd.cell[l].cy)}this.vinc()},drawTriangle1:function(e,d,c,b,h){var a=(k.puzzleid=="reflect"?1:0);var f="c"+b+"_"+h;if(c>=2&&c<=5){if(c==2){if(this.vnop(f+"_tri2_",1)){this.inputPath([e,d,a,a,a,k.cheight+1,k.cwidth+1,k.cheight+1],true);g.fill()}}else{this.vhide(f+"_tri2_")}if(c==3){if(this.vnop(f+"_tri3_",1)){this.inputPath([e,d,k.cwidth+1,a,a,k.cheight+1,k.cwidth+1,k.cheight+1],true);g.fill()}}else{this.vhide(f+"_tri3_")}if(c==4){if(this.vnop(f+"_tri4_",1)){this.inputPath([e,d,a,a,k.cwidth+1,a,k.cwidth+1,k.cheight+1],true);g.fill()}}else{this.vhide(f+"_tri4_")}if(c==5){if(this.vnop(f+"_tri5_",1)){this.inputPath([e,d,a,a,k.cwidth+1,a,a,k.cheight+1],true);g.fill()}}else{this.vhide(f+"_tri5_")}}else{this.vhide([f+"_tri2_",f+"_tri3_",f+"_tri4_",f+"_tri5_"])}},drawMBs:function(b,f,a,e){g.strokeStyle=this.MBcolor;g.lineWidth=1;var h=k.cwidth*0.35;var j=this.cellinside(b,f,a,e,f_true);for(var d=0;d<j.length;d++){var l=j[d];if(bd.QsC(l)==1){if(this.vnop("c"+l+"_MB1_",0)){g.beginPath();g.arc(bd.cell[l].px+mf(k.cwidth/2),bd.cell[l].py+mf(k.cheight/2),h,0,Math.PI*2,false);g.stroke()}}else{this.vhide("c"+l+"_MB1_")}if(bd.QsC(l)==2){if(this.vnop("c"+l+"_MB2a_",0)){this.inputPath([bd.cell[l].px+mf(k.cwidth/2),bd.cell[l].py+mf(k.cheight/2),-h,-h,h,h],true);g.stroke()}if(this.vnop("c"+l+"_MB2b_",0)){this.inputPath([bd.cell[l].px+mf(k.cwidth/2),bd.cell[l].py+mf(k.cheight/2),-h,h,h,-h],true);g.stroke()}}else{this.vhide(["c"+l+"_MB2a_","c"+l+"_MB2b_"])}}this.vinc()},drawQueses41_42:function(d,j,b,h){var a=mf(k.cwidth*0.4);var l=mf(k.cwidth*0.34);var m=this.cellinside(d,j,b,h,f_true);for(var e=0;e<m.length;e++){var f=m[e];if(bd.QuC(f)==41||bd.QuC(f)==42){g.fillStyle=this.Cellcolor;if(this.vnop("c"+f+"_cir41a_",1)){g.beginPath();g.arc(mf(bd.cell[f].px+mf(k.cwidth/2)),mf(bd.cell[f].py+mf(k.cheight/2)),a,0,Math.PI*2,false);g.fill()}}else{this.vhide("c"+f+"_cir41a_")}if(bd.QuC(f)==41){g.fillStyle="white";if(this.vnop("c"+f+"_cir41b_",1)){g.beginPath();g.arc(mf(bd.cell[f].px+mf(k.cwidth/2)),mf(bd.cell[f].py+mf(k.cheight/2)),l,0,Math.PI*2,false);g.fill()}}else{this.vhide("c"+f+"_cir41b_")}}this.vinc()},drawLineParts:function(b,e,a,d){var f=this.cellinside(b,e,a,d,f_true);for(var c=0;c<f.length;c++){this.drawLineParts1(f[c])}this.vinc()},drawLineParts1:function(c){var b=this.lw;g.fillStyle=this.BorderQuescolor;var a=bd.QuC(c);if(a==101||a==102||a==104||a==105){if(this.vnop("c"+c+"_lp1_",1)){g.fillRect(bd.cell[c].px+mf(k.cwidth/2)-1,bd.cell[c].py,b,mf((k.cheight+b)/2))}}else{this.vhide("c"+c+"_lp1_")}if(a==101||a==102||a==106||a==107){if(this.vnop("c"+c+"_lp2_",1)){g.fillRect(bd.cell[c].px+mf(k.cwidth/2)-1,bd.cell[c].py+mf(k.cheight/2)-1,b,mf((k.cheight+b)/2))}}else{this.vhide("c"+c+"_lp2_")}if(a==101||a==103||a==105||a==106){if(this.vnop("c"+c+"_lp3_",1)){g.fillRect(bd.cell[c].px,bd.cell[c].py+mf(k.cheight/2)-1,mf((k.cwidth+b)/2),b)}}else{this.vhide("c"+c+"_lp3_")}if(a==101||a==103||a==104||a==107){if(this.vnop("c"+c+"_lp4_",1)){g.fillRect(bd.cell[c].px+mf(k.cwidth/2)-1,bd.cell[c].py+mf(k.cheight/2)-1,mf((k.cwidth+b)/2),b)}}else{this.vhide("c"+c+"_lp4_")}},draw51:function(d,h,b,f,a){var j=this.cellinside(d,h,b,f,f_true);for(var e=0;e<j.length;e++){var l=j[e];if(bd.QuC(l)==51){if(a){if(bd.ErC(l)==1){g.fillStyle=this.errbcolor1;if(this.vnop("c"+l+"_full_",1)){g.fillRect(bd.cell[l].px+1,bd.cell[l].py+1,k.cwidth-1,k.cheight-1)}}else{this.vhide("c"+l+"_full_")}}this.setPath51_1(l,bd.cell[l].px,bd.cell[l].py);if(this.vnop("c"+l+"_q51_",0)){g.stroke()}}else{this.vhide("c"+l+"_q51_")}}this.vinc()},drawEXcell:function(b,j,a,i,l){var d=this.lw;for(var f=b-1;f<=a;f++){for(var e=j-1;e<=i;e++){var h=bd.exnum(f,e);if(h==-1){continue}if(l){if(bd.ErE(h)==1){g.fillStyle=this.errbcolor1;if(this.vnop("ex"+h+"_full_",1)){g.fillRect(bd.excell[h].px+1,bd.excell[h].py+1,k.cwidth-1,k.cheight-1)}}else{this.vhide("ex"+h+"_full_")}}g.fillStyle=this.Cellcolor;this.setPath51_1(h,bd.excell[h].px,bd.excell[h].py);if(this.vnop("ex"+h+"_q51_",0)){g.stroke()}g.strokeStyle=this.Cellcolor;if(bd.excell[h].cy==-1&&bd.excell[h].cx<k.qcols-1){if(this.vnop("ex"+h+"_bdx_",1)){g.fillRect(bd.excell[h].px+k.cwidth,bd.excell[h].py,1,k.cheight)}}if(bd.excell[h].cx==-1&&bd.excell[h].cy<k.qrows-1){if(this.vnop("ex"+h+"_bdy_",1)){g.fillRect(bd.excell[h].px,bd.excell[h].py+k.cheight,k.cwidth,1)}}}}this.vinc()},setPath51_1:function(d,b,a){g.strokeStyle=this.Cellcolor;g.lineWidth=1;g.beginPath();g.moveTo(b+1,a+1);g.lineTo(b+k.cwidth,a+k.cheight);g.closePath()},drawChassis_ex1:function(b,m,a,l,f){var d=this.lw,j=this.lm;if(b<0){b=0}if(a>k.qcols-1){a=k.qcols-1}if(m<0){m=0}if(l>k.qrows-1){l=k.qrows-1}g.fillStyle="black";if(f){if(b<1){if(this.vnop("chs1_",1)){g.fillRect(k.p0.x+b*k.cwidth-d+2,k.p0.y+m*k.cheight-d+2,d,(l-m+1)*k.cheight+d-2)}}if(m<1){if(this.vnop("chs2_",1)){g.fillRect(k.p0.x+b*k.cwidth-d+2,k.p0.y+m*k.cheight-d+2,(a-b+1)*k.cwidth+d-2,d)}}}else{if(b<1){if(this.vnop("chs1_",1)){g.fillRect(k.p0.x+b*k.cwidth,k.p0.y+m*k.cheight,1,(l-m+1)*k.cheight)}}if(m<1){if(this.vnop("chs2_",1)){g.fillRect(k.p0.x+b*k.cwidth,k.p0.y+m*k.cheight,(a-b+1)*k.cwidth,1)}}}if(l>=k.qrows-1){if(this.vnop("chs3_",1)){g.fillRect(k.p0.x+(b-1)*k.cwidth-d+1,k.p0.y+(l+1)*k.cheight,(a-b+2)*k.cwidth+2*d-1,d)}}if(a>=k.qcols-1){if(this.vnop("chs4_",1)){g.fillRect(k.p0.x+(a+1)*k.cwidth,k.p0.y+(m-1)*k.cheight-d+1,d,(l-m+2)*k.cheight+2*d-1)}}if(b<1){if(this.vnop("chs21_",1)){g.fillRect(k.p0.x+(b-1)*k.cwidth-d+1,k.p0.y+(m-1)*k.cheight-d+1,d,(l-m+2)*k.cheight+2*d-1)}}if(m<1){if(this.vnop("chs22_",1)){g.fillRect(k.p0.x+(b-1)*k.cwidth-d+1,k.p0.y+(m-1)*k.cheight-d+1,(a-b+2)*k.cwidth+2*d-1,d)}}this.vinc();if(!f){g.fillStyle=this.Cellcolor;var o=this.cellinside(b-1,m-1,a+1,l+1,f_true);for(var e=0;e<o.length;e++){var h=o[e];if(bd.QuC(h)==51){continue}if(bd.cell[h].cx==0){this.drawBorder1x(0,2*bd.cell[h].cy+1,true)}if(bd.cell[h].cy==0){this.drawBorder1x(2*bd.cell[h].cx+1,0,true)}}this.vinc()}},drawTCell:function(d,h,b,f){if(tc.cursolx<d*2||b*2+2<tc.cursolx){return}if(tc.cursoly<h*2||f*2+2<tc.cursoly){return}var e=k.p0.x+mf((tc.cursolx-1)*k.cwidth/2);var c=k.p0.y+mf((tc.cursoly-1)*k.cheight/2);var a=(k.cwidth<32?2:mf(k.cwidth/16));this.vdel(["tc1_","tc2_","tc3_","tc4_"]);g.fillStyle=(k.mode==1?"rgb(255,64,64)":"rgb(64,64,255)");if(this.vnop("tc1_",0)){g.fillRect(e+1,c+1,k.cwidth-2,a)}if(this.vnop("tc2_",0)){g.fillRect(e+1,c+1,a,k.cheight-2)}if(this.vnop("tc3_",0)){g.fillRect(e+1,c+k.cheight-a,k.cwidth-2,a)}if(this.vnop("tc4_",0)){g.fillRect(e+k.cwidth-a,c+1,a,k.cheight-2)}this.vinc()},drawTCross:function(d,h,b,f){if(tc.cursolx<d*2-1||b*2+3<tc.cursolx){return}if(tc.cursoly<h*2-1||f*2+3<tc.cursoly){return}var e=k.p0.x+mf((tc.cursolx-1)*k.cwidth/2);var c=k.p0.y+mf((tc.cursoly-1)*k.cheight/2);var a=(k.cwidth<32?2:mf(k.cwidth/16));this.vdel(["tx1_","tx2_","tx3_","tx4_"]);g.fillStyle=(k.mode==1?"rgb(255,64,64)":"rgb(64,64,255)");if(this.vnop("tx1_",0)){g.fillRect(e+1,c+1,k.cwidth-2,a)}if(this.vnop("tx2_",0)){g.fillRect(e+1,c+1,a,k.cheight-2)}if(this.vnop("tx3_",0)){g.fillRect(e+1,c+k.cheight-a,k.cwidth-2,a)}if(this.vnop("tx4_",0)){g.fillRect(e+k.cwidth-a,c+1,a,k.cheight-2)}this.vinc()},drawTBorder:function(d,i,b,h){if(tc.cursolx<d*2-1||b*2+3<tc.cursolx){return}if(tc.cursoly<i*2-1||h*2+3<tc.cursoly){return}var f=k.p0.x+mf(tc.cursolx*k.cwidth/2);var c=k.p0.y+mf(tc.cursoly*k.cheight/2);var a=(k.cwidth<24?1:mf(k.cwidth/24));var e=mf(k.cwidth*0.28);this.vdel(["tb1_","tb2_","tb3_","tb4_"]);g.fillStyle=(k.mode==1?"rgb(255,64,64)":"rgb(64,64,255)");if(this.vnop("tb1_",0)){g.fillRect(f-e,c-e,e*2,1)}if(this.vnop("tb2_",0)){g.fillRect(f-e,c-e,1,e*2)}if(this.vnop("tb3_",0)){g.fillRect(f-e,c+e-a,e*2,1)}if(this.vnop("tb4_",0)){g.fillRect(f+e-a,c-e,1,e*2)}this.vinc()},hideTCell:function(){this.vhide(["tc1_","tc2_","tc3_","tc4_"])},hideTCross:function(){this.vhide(["tx1_","tx2_","tx3_","tx4_"])},hideTBorder:function(){this.vhide(["tb1_","tb2_","tb3_","tb4_"])},drawTargetTriangle:function(c,f,a,e){if(k.mode==3){return}if(tc.cursolx<c*2||a*2+2<tc.cursolx){return}if(tc.cursoly<f*2||e*2+2<tc.cursoly){return}var i=tc.getTCC(),d=-1;if(i==-1){d=bd.exnum(tc.getTCX(),tc.getTCY())}var h=kc.detectTarget(i,d);if(h==-1){return}var b=h==2?4:2;g.fillStyle=this.TTcolor;this.drawTriangle1(k.p0.x+tc.getTCX()*k.cwidth,k.p0.y+tc.getTCY()*k.cheight,b,tc.getTCX(),tc.getTCY());this.vinc()},drawDashLines:function(c,f,a,e){if(k.br.IE){this.drawDashLinesvml(c,f,a,e);return}if(c<1){c=1}if(a>k.qcols-2){a=k.qcols-2}if(f<1){f=1}if(e>k.qrows-2){e=k.qrows-2}g.fillStyle=this.gridcolor;for(var d=c-1;d<=a+1;d++){for(var b=(k.p0.y+(f-0.5)*k.cheight);b<(k.p0.y+(e+1.5)*k.cheight);b+=6){g.fillRect(k.p0.x+(d+0.5)*k.cwidth,b,1,3)}}for(var d=f-1;d<=e+1;d++){for(var b=(k.p0.x+(c-0.5)*k.cwidth);b<(k.p0.x+(a+1.5)*k.cwidth);b+=6){g.fillRect(b,k.p0.y+(d+0.5)*k.cheight,3,1)}}this.vinc()},drawDashLinesvml:function(b,e,a,d){if(b<1){b=1}if(a>k.qcols-2){a=k.qcols-2}if(e<1){e=1}if(d>k.qrows-2){d=k.qrows-2}g.fillStyle="rgb(192,192,192)";for(var c=b-1;c<=a+1;c++){if(this.vnop("bdy"+c+"_1_",1)){g.fillRect(k.p0.x+(c+0.5)*k.cwidth,k.p0.y+(e-0.5)*k.cheight,1,(d-e+2)*k.cheight+1)}}for(var c=e-1;c<=d+1;c++){if(this.vnop("bdx"+c+"_1_",1)){g.fillRect(k.p0.x+(b-0.5)*k.cwidth,k.p0.y+(c+0.5)*k.cheight,(a-b+2)*k.cwidth+1,1)}}this.vinc()},drawGrid:function(c,j,b,h){if(c<0){c=0}if(b>k.qcols-1){b=k.qcols-1}if(j<0){j=0}if(h>k.qrows-1){h=k.qrows-1}var l=((k.isoutsideborder==0&&this.chassisflag)?1:0);g.fillStyle=this.gridcolor;var a=(c>l?c:l),m=(b+1<k.qcols-l?b+1:k.qcols-l);var f=(j>l?j:l),e=(h+1<k.qrows-l?h+1:k.qrows-l);for(var d=a;d<=m;d++){if(this.vnop("bdy"+d+"_",1)){g.fillRect(k.p0.x+d*k.cwidth,k.p0.y+j*k.cheight,1,(h-j+1)*k.cheight+1)}}for(var d=f;d<=e;d++){if(this.vnop("bdx"+d+"_",1)){g.fillRect(k.p0.x+c*k.cwidth,k.p0.y+d*k.cheight,(b-c+1)*k.cwidth+1,1)}}this.vinc()},drawDashedGrid:function(c,q,b,p){if(k.br.IE){this.drawDashedGridvml(c,q,b,p);return}if(c<0){c=0}if(b>k.qcols-1){b=k.qcols-1}if(q<0){q=0}if(p>k.qrows-1){p=k.qrows-1}var r=((k.isoutsideborder==0&&this.chassisflag)?1:0);var l=mf(k.cwidth/10)+3;var d=(mf(k.cwidth/l)>=1?mf(k.cwidth/l):1);var h=k.cwidth/(d*2);g.fillStyle=this.gridcolor;var a=(c>r?c:r),t=(b+1<k.qcols-r?b+1:k.qcols-r);var o=(q>r?q:r),m=(p+1<k.qrows-r?p+1:k.qrows-r);for(var f=a;f<=t;f++){for(var e=(k.p0.y+q*k.cheight);e<(k.p0.y+(p+1)*k.cheight);e+=(2*h)){g.fillRect(k.p0.x+f*k.cwidth,mf(e),1,mf(h))}}for(var f=o;f<=m;f++){for(var e=(k.p0.x+c*k.cwidth);e<(k.p0.x+(b+1)*k.cwidth);e+=(2*h)){g.fillRect(mf(e),k.p0.y+f*k.cheight,mf(h),1)}}},drawDashedGridvml:function(b,d,a,c){this.gridcolor="rgb(191, 191, 191)";this.drawGrid(b,d,a,c)},drawChassis:function(b,d,a,c){var e=this.lw;if(b<0){b=0}if(a>k.qcols-1){a=k.qcols-1}if(d<0){d=0}if(c>k.qrows-1){c=k.qrows-1}g.fillStyle="black";if(b<1){if(this.vnop("chs1_",1)){g.fillRect(k.p0.x+b*k.cwidth-e+1,k.p0.y+d*k.cheight-e+1,e,(c-d+1)*k.cheight+2*e-1)}}if(d<1){if(this.vnop("chs2_",1)){g.fillRect(k.p0.x+b*k.cwidth-e+1,k.p0.y+d*k.cheight-e+1,(a-b+1)*k.cwidth+2*e-1,e)}}if(c>=k.qrows-1){if(this.vnop("chs3_",1)){g.fillRect(k.p0.x+b*k.cwidth-e+1,k.p0.y+(c+1)*k.cheight,(a-b+1)*k.cwidth+2*e-1,e)}}if(a>=k.qcols-1){if(this.vnop("chs4_",1)){g.fillRect(k.p0.x+(a+1)*k.cwidth,k.p0.y+d*k.cheight-e+1,e,(c-d+1)*k.cheight+2*e-1)}}this.vinc()},flushCanvas:function(b,d,a,c){if(!g.vml){if(((k.isextendcell==0&&b<=0&&d<=0)||(k.isextendcell!=0&&b<=-1&&d<=-1))&&((k.isextendcell!=2&&a>=k.qcols-1&&c>=k.qrows-1)||(k.isextendcell==2&&a>=k.qcols&&c>=k.qrows))){this.flushCanvasAll()}else{g.fillStyle="rgb(255, 255, 255)";g.fillRect(k.p0.x+b*k.cwidth,k.p0.y+d*k.cheight,(a-b+1)*k.cwidth,(c-d+1)*k.cheight)}}else{g.zidx=1}},flushCanvasAll:function(){if(g.vml){g.zidx=0;g.vid="bg_";g.elements=[]}if(k.br.IE){g._clear()}g.fillStyle="rgb(255, 255, 255)";g.fillRect(0,0,base.cv_obj.width(),base.cv_obj.height());this.vinc()},vnop:function(a,b){if(g.vml){if(g.elements[a]){var c=g.elements[a].get(0);if(c){c.color=uuColor.parse((b==1?g.fillStyle:g.strokeStyle))[0]}var d=g.elements["p_"+a].get(0);if(d){if(!this.zstable){d.style.zIndex=g.zidx}d.style.display="inline"}return false}g.vid=a}return true},vhide:function(a){if(g.vml){if(!a.shift){a=[a]}for(var b=0;b<a.length;b++){if(g.elements[a[b]]){g.elements["p_"+a[b]].get(0).style.display="none"}}}},vdel:function(a){if(g.vml){if(!a.shift){a=[a]}for(var b=0;b<a.length;b++){if(g.elements[a[b]]){g.elements["p_"+a[b]].remove();g.elements["p_"+a[b]]=null;g.elements[a[b]]=null}}}},vinc:function(){if(g.vml){g.vid="";g.zidx++}},CreateDOMAndSetNop:function(){if(this.textenable){return null}return this.CreateElementAndSetNop()},CreateElementAndSetNop:function(){obj=newEL("div");obj.mousedown(mv.e_mousedown.ebind(mv)).mouseup(mv.e_mouseup.ebind(mv)).mousemove(mv.e_mousemove.ebind(mv)).appendTo("#numobj_parent").unselectable();obj.context.className="divnum";obj.context.oncontextmenu=function(){return false};return obj},isdispnumCell:function(a){return((bd.QnC(a)>0||(bd.QnC(a)==0&&k.dispzero))||((bd.QaC(a)>0||(bd.QaC(a)==0&&k.dispzero))&&k.isAnsNumber)||((bd.QnC(a)==-2||bd.QuC(a)==-2)&&k.isDispHatena))},getNumberColor:function(a){if(bd.QuC(a)==-2){return this.fontcolor}else{if((k.BlackCell==0?bd.QuC(a)!=0:bd.QaC(a)==1)){return this.BCell_fontcolor}else{if(bd.ErC(a)==1||bd.ErC(a)==4){return this.fontErrcolor}else{if(k.isAnsNumber&&bd.QnC(a)!=-1){return this.fontcolor}else{if(k.isAnsNumber&&bd.QaC(a)!=-1){return this.fontAnscolor}}}}}return this.fontcolor},dispnumCell_General:function(i){if(bd.cell[i].numobj&&!this.isdispnumCell(i)){bd.cell[i].numobj.get(0).style.display="none";return}if(this.isdispnumCell(i)){if(!bd.cell[i].numobj){bd.cell[i].numobj=this.CreateDOMAndSetNop()}var f=bd.cell[i].numobj;var e=1;if(k.isDispNumUL){e=5}else{if(bd.QuC(i)>=2&&bd.QuC(i)<=5){e=bd.QuC(i)}else{if(k.puzzleid=="reflect"){if(!this.textenable){f.get(0).style.display="none"}return}}}var d=bd.getNum(i);var h=(d>=0?""+d:"?");if(bd.QuC(i)==-2){h="?"}var c=0.45;if(e==1){c=(d<10?0.8:(d<100?0.7:0.55))}if(k.isArrowNumber==1){var b=bd.DiC(i);if(b!=0){c*=0.85}if(b==1||b==2){e=6}else{if(b==3||b==4){e=7}}}var a=this.getNumberColor(i);this.dispnumCell1(i,f,e,h,c,a)}},dispnumCross:function(a){if(bd.QnX(a)>0||(bd.QnX(a)==0&&k.dispzero==1)){if(!bd.cross[a].numobj){bd.cross[a].numobj=this.CreateDOMAndSetNop()}this.dispnumCross1(a,bd.cross[a].numobj,101,""+bd.QnX(a),0.6,this.fontcolor)}else{if(bd.cross[a].numobj){bd.cross[a].numobj.get(0).style.display="none"}}},dispnumBorder:function(a){if(bd.QnB(a)>0||(bd.QnB(a)==0&&k.dispzero==1)){if(!bd.border[a].numobj){bd.border[a].numobj=this.CreateDOMAndSetNop()}this.dispnumBorder1(a,bd.border[a].numobj,101,""+bd.QnB(a),0.45,this.borderfontcolor)}else{if(bd.border[a].numobj){bd.border[a].numobj.get(0).style.display="none"}}},dispnumCell1:function(h,e,d,f,b,a){this.dispnum1(e,d,f,b,a,bd.cell[h].px,bd.cell[h].py)},dispnumEXcell1:function(h,e,d,f,b,a){this.dispnum1(e,d,f,b,a,bd.excell[h].px,bd.excell[h].py)},dispnumCross1:function(h,e,d,f,b,a){this.dispnum1(e,d,f,b,a,bd.cross[h].px,bd.cross[h].py)},dispnumBorder1:function(h,e,d,f,b,a){this.dispnum1(e,d,f,b,a,bd.border[h].px,bd.border[h].py)},dispnum1:function(d,h,m,b,c,l,j){if(!d){return}var e=k.br.IE;var a=d.context;a.innerHTML=m;var f=mf(k.cwidth*b*this.fontsizeratio);a.style.fontSize=(""+f+"px");a.style.display="inline";var o=a.clientWidth;var i=a.clientHeight;if(h==1||h==6||h==7){a.style.left=k.cv_oft.x+l+mf((k.cwidth-o)/2)+(e?2:2)-(h==6?mf(k.cwidth*0.1):0);a.style.top=k.cv_oft.y+j+mf((k.cheight-i)/2)+(e?3:1)+(h==7?mf(k.cheight*0.1):0)}else{if(h==101){a.style.left=k.cv_oft.x+l-o/2+(e?2:2);a.style.top=k.cv_oft.y+j-i/2+(e?3:1)}else{if(h==3||h==4){a.style.left=k.cv_oft.x+l+k.cwidth-o+(e?1:0)}else{if(h==2||h==5){a.style.left=k.cv_oft.x+l+(e?5:4)}}if(h==2||h==3){a.style.top=k.cv_oft.y+j+k.cheight-i+(e?1:-1)}else{if(h==4||h==5){a.style.top=k.cv_oft.y+j+(e?4:2)}}}}a.style.color=c},drawNumbersOn51:function(b,j,a,h){var m=this.cellinside(b,j,a,h,f_true);for(var e=0;e<m.length;e++){var f=m[e];if(bd.QnC(f)==-1||bd.QuC(f)!=51||bd.rt(f)==-1||bd.QuC(bd.rt(f))==51){if(bd.cell[f].numobj){bd.cell[f].numobj.get(0).style.display="none"}}else{if(!bd.cell[f].numobj){bd.cell[f].numobj=this.CreateDOMAndSetNop()}var d=(bd.ErC(f)==1?this.fontErrcolor:this.fontcolor);var l=(bd.QnC(f)>=0?""+bd.QnC(f):"");this.dispnumCell1(f,bd.cell[f].numobj,4,l,0.45,d)}if(bd.DiC(f)==-1||bd.QuC(f)!=51||bd.dn(f)==-1||bd.QuC(bd.dn(f))==51){if(bd.cell[f].numobj2){bd.cell[f].numobj2.get(0).style.display="none"}}else{if(!bd.cell[f].numobj2){bd.cell[f].numobj2=this.CreateDOMAndSetNop()}var d=(bd.ErC(f)==1?this.fontErrcolor:this.fontcolor);var l=(bd.DiC(f)>=0?""+bd.DiC(f):"");this.dispnumCell1(f,bd.cell[f].numobj2,2,l,0.45,d)}}this.vinc()},drawNumbersOn51EX:function(b,j,a,i){for(var f=b-1;f<=a;f++){for(var d=j-1;d<=i;d++){var h=bd.exnum(f,d);if(h==-1){continue}if(bd.QnE(h)==-1||bd.excell[h].cy==-1||bd.QuC(bd.excell[h].cy*k.qcols)==51){if(bd.excell[h].numobj){bd.excell[h].numobj.get(0).style.display="none"}}else{if(!bd.excell[h].numobj){bd.excell[h].numobj=this.CreateDOMAndSetNop()}var e=(bd.ErE(h)==1?this.fontErrcolor:this.fontcolor);var l=(bd.QnE(h)>=0?""+bd.QnE(h):"");this.dispnum1(bd.excell[h].numobj,4,l,0.45,e,bd.excell[h].px-1,bd.excell[h].py+1)}if(bd.DiE(h)==-1||bd.excell[h].cx==-1||bd.QuC(bd.excell[h].cx)==51){if(bd.excell[h].numobj2){bd.excell[h].numobj2.get(0).style.display="none"}}else{if(!bd.excell[h].numobj2){bd.excell[h].numobj2=this.CreateDOMAndSetNop()}var e=(bd.ErE(h)==1?this.fontErrcolor:this.fontcolor);var l=(bd.DiE(h)>=0?""+bd.DiE(h):"");this.dispnum1(bd.excell[h].numobj2,2,l,0.45,e,bd.excell[h].px-1,bd.excell[h].py+1)}}}this.vinc()}};var MouseEvent=function(){this.mousePressed;this.mouseCell;this.inputData;this.clickBtn;this.currentOpeCount;this.firstPos;this.btn;this.isButton={};this.mousereset();this.isButton=function(){};if(k.br.IE){this.isButton=function(b,a){return b.button=={0:1,1:4,2:2}[a]}}else{if(k.br.WebKit){this.isButton=function(b,a){if(a==0){return b.which==1&&!b.metaKey}else{if(a==1){return b.which==1&&b.metaKey}}return false}}else{this.isButton=function(b,a){return b.which?(b.which===a+1):(b.button===a)}}}};MouseEvent.prototype={mousereset:function(){this.mousePressed=0;this.mouseCell=-1;this.inputData=-1;this.clickBtn=-1;this.currentOpeCount=0;this.firstPos=new Pos(-1,-1);this.btn={Left:false,Middle:false,Right:false}},e_mousedown:function(a){if(!k.enableMouse){return}this.btn={Left:this.isLeft(a),Middle:this.isMiddle(a),Right:this.isRight(a)};if(this.btn.Middle){this.modeflip();return}bd.errclear();um.newOperation(true);this.currentOpeCount=um.ope.length;this.mousePressed=1;this.mousedown(this.pointerX(a)-k.cv_oft.x-k.IEMargin.x,this.pointerY(a)-k.cv_oft.y-k.IEMargin.y);return false},e_mouseup:function(a){if(!k.enableMouse||this.btn.Middle||this.mousePressed!=1){return}um.newOperation(false);this.mouseup(this.pointerX(a)-k.cv_oft.x-k.IEMargin.x,this.pointerY(a)-k.cv_oft.y-k.IEMargin.y);this.mousereset();return false},e_mousemove:function(a){if(!k.enableMouse||this.btn.Middle||this.mousePressed!=1){return}um.newOperation(false);this.mousemove(this.pointerX(a)-k.cv_oft.x-k.IEMargin.x,this.pointerY(a)-k.cv_oft.y-k.IEMargin.y)},e_mouseout:function(a){um.newOperation(false)},modeflip:function(a){if(k.callmode!="pmake"){return}menu.setVal("mode",(k.mode==3?1:3))},mousedown:function(a,b){},mouseup:function(a,b){},mousemove:function(a,b){},cellid:function(a){var b=this.cellpos(a);if((a.x-k.p0.x)%k.cwidth==0||(a.y-k.p0.y)%k.cheight==0){return -1}if(b.x<0||b.x>k.qcols-1||b.y<0||b.y>k.qrows-1){return -1}return b.x+b.y*k.qcols},crossid:function(a){var b=this.crosspos(a,0.5);if(b.x<0||b.x>2*k.qcols||b.y<0||b.y>2*k.qrows){return -1}return mf((b.x/2)+(b.y/2)*(k.qcols+1))},cellpos:function(a){return new Pos(mf((a.x-k.p0.x)/k.cwidth),mf((a.y-k.p0.y)/k.cheight))},crosspos:function(f,e){var d=e*k.cwidth;var a=mf((f.x-k.p0.x+d)/k.cwidth),h=mf((f.y-k.p0.y+d)/k.cheight);var c=(f.x-k.p0.x+d)%k.cwidth,b=(f.y-k.p0.y+d)%k.cheight;return new Pos(a*2+(c<2*d?0:1),h*2+(b<2*d?0:1))},borderid:function(h,f){var a=mf((h.x-k.p0.x)/k.cwidth),i=mf((h.y-k.p0.y)/k.cheight);var d=(h.x-k.p0.x)%k.cwidth,b=(h.y-k.p0.y)%k.cheight;if(k.isLineCross){if(!k.isborderAsLine){var e=f*k.cwidth,c=(1-f)*k.cwidth;if((d<e||c<d)&&(b<e||c<b)){return -1}}else{var e=(0.5-f)*k.cwidth,c=(0.5+f)*k.cwidth;if(e<d&&d<c&&e<b&&b<c){return -1}}}if(d<k.cwidth-b){if(d>b){return bd.bnum(2*a+1,2*i)}else{return bd.bnum(2*a,2*i+1)}}else{if(d>b){return bd.bnum(2*a+2,2*i+1)}else{return bd.bnum(2*a+1,2*i+2)}}return -1},isLeft:function(a){if(!((kc.isSHIFT)^menu.getVal("lrcheck"))){if(!this.isWinWebKit()){return this.isLeftClick(a)}else{if(a.button==0){return true}}}else{if(!this.isWinWebKit()){return this.isRightClick(a)}else{if(a.button==2){return true}}}return false},isMiddle:function(a){if(!this.isWinWebKit()){return this.isMiddleClick(a)}else{if(a.button==1){return true}}return false},isRight:function(a){if(!((kc.isSHIFT)^menu.getVal("lrcheck"))){if(!this.isWinWebKit()){return this.isRightClick(a)}else{if(a.button==2){return true}}}else{if(!this.isWinWebKit()){return this.isLeftClick(a)}else{if(a.button==0){return true}}}return false},isWinWebKit:function(){return(navigator.userAgent.indexOf("Win")!=-1&&k.br.WebKit)},pointerX:function(a){if(this.isWinWebKit()){return a.pageX-1}return a.pageX||(a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft))},pointerY:function(a){if(this.isWinWebKit()){return a.pageY-1}return a.pageY||(a.clientY+(document.documentElement.scrollTop||document.body.scrollTop))},isLeftClick:function(a){return this.isButton(a,0)},isMiddleClick:function(a){return this.isButton(a,1)},isRightClick:function(a){return this.isButton(a,2)},notInputted:function(){return !um.changeflag},inputcell:function(a,c){var b=this.cellid(new Pos(a,c));if(b==-1||b==this.mouseCell){return}if(this.inputData==-1){this.decIC(b)}this.mouseCell=b;if(k.NumberIsWhite==1&&bd.QnC(b)!=-1&&(this.inputData==1||(this.inputData==2&&pc.bcolor=="white"))){return}if(k.RBBlackCell==1&&this.inputData==1){if(this.firstPos.x==-1&&this.firstPos.y==-1){this.firstPos=new Pos(bd.cell[b].cx,bd.cell[b].cy)}if((this.firstPos.x+this.firstPos.y)%2!=(bd.cell[b].cx+bd.cell[b].cy)%2){return}}(this.inputData==1?bd.setBlack:bd.setWhite).apply(bd,[b]);bd.sQsC(b,(this.inputData==2?1:0));pc.paintCell(b)},decIC:function(a){if(menu.getVal("use")==1){if(this.btn.Left){this.inputData=(bd.isWhite(a)?1:0)}else{if(this.btn.Right){this.inputData=((bd.QsC(a)!=1)?2:0)}}}else{if(menu.getVal("use")==2){if(this.btn.Left){if(bd.isBlack(a)){this.inputData=2}else{if(bd.QsC(a)==1){this.inputData=0}else{this.inputData=1}}}else{if(this.btn.Right){if(bd.isBlack(a)){this.inputData=0}else{if(bd.QsC(a)==1){this.inputData=1}else{this.inputData=2}}}}}}},inputqnum:function(b,e,a){var d=this.cellid(new Pos(b,e));if(d==-1||d==this.mouseCell){return}if(d==tc.getTCC()){d=(k.mode==3?this.inputqnum3(d,a):this.inputqnum1(d,a))}else{var c=tc.getTCC();tc.setTCC(d);pc.paint(bd.cell[c].cx-1,bd.cell[c].cy-1,bd.cell[c].cx,bd.cell[c].cy)}this.mouseCell=d;pc.paint(bd.cell[d].cx-1,bd.cell[d].cy-1,bd.cell[d].cx,bd.cell[d].cy)},inputqnum1:function(c,a){var b=(k.isDispHatena||k.puzzleid=="lightup"||k.puzzleid=="shakashaka"||k.puzzleid=="snakes"||k.puzzleid=="shugaku");if(k.isOneNumber){c=area.getTopOfRoomByCell(c);if(area.getCntOfRoomByCell(c)<a){a=area.getCntOfRoomByCell(c)}}if(bd.roommaxfunc){a=bd.roommaxfunc(c,1)}if(this.btn.Left){if(bd.QnC(c)==a){bd.sQnC(c,-1)}else{if(bd.QnC(c)==-1){bd.sQnC(c,(b?-2:(k.dispzero?0:1)))}else{if(bd.QnC(c)==-2){bd.sQnC(c,(k.dispzero?0:1))}else{bd.sQnC(c,bd.QnC(c)+1)}}}}else{if(this.btn.Right){if(bd.QnC(c)==-1){bd.sQnC(c,a)}else{if(bd.QnC(c)==-2){bd.sQnC(c,-1)}else{if(bd.QnC(c)==(k.dispzero?0:1)){bd.sQnC(c,(b?-2:-1))}else{bd.sQnC(c,bd.QnC(c)-1)}}}}}if(bd.QnC(c)!=-1&&k.NumberIsWhite){bd.sQaC(c,-1);if(pc.bcolor=="white"){bd.sQsC(c,0)}}if(k.isAnsNumber){bd.sQaC(c,-1);bd.sQsC(c,0)}return c},inputqnum3:function(b,a){if(bd.QnC(b)!=-1){return b}if(bd.roommaxfunc){a=bd.roommaxfunc(b,3)}bd.sDiC(b,0);if(this.btn.Left){if(k.NumberWithMB){if(bd.QaC(b)==a){bd.sQaC(b,-1);bd.sQsC(b,1);return b}else{if(bd.QsC(b)==1){bd.sQaC(b,-1);bd.sQsC(b,2);return b}else{if(bd.QsC(b)==2){bd.sQaC(b,-1);bd.sQsC(b,0);return b}}}}if(bd.QaC(b)==a){bd.sQaC(b,-1)}else{if(bd.QaC(b)==-1){bd.sQaC(b,(k.dispzero?0:1))}else{bd.sQaC(b,bd.QaC(b)+1)}}}else{if(this.btn.Right){if(k.NumberWithMB){if(bd.QsC(b)==1){bd.sQaC(b,a);bd.sQsC(b,0);return b}else{if(bd.QsC(b)==2){bd.sQaC(b,-1);bd.sQsC(b,1);return b}else{if(bd.QaC(b)==-1){bd.sQaC(b,-1);bd.sQsC(b,2);return b}}}}if(bd.QaC(b)==-1){bd.sQaC(b,a)}else{if(bd.QaC(b)==(k.dispzero?0:1)){bd.sQaC(b,-1)}else{bd.sQaC(b,bd.QaC(b)-1)}}}}return b},inputQues:function(a,h,f){var e=this.cellid(new Pos(a,h));if(e==-1){return}var b=false;if(e!=tc.getTCC()&&k.puzzleid!="kramma"&&k.puzzleid!="shwolf"&&k.puzzleid!="mashu"){var d=tc.getTCC();tc.setTCC(e);pc.paint(bd.cell[d].cx-1,bd.cell[d].cy-1,bd.cell[d].cx,bd.cell[d].cy);b=true}else{if(this.btn.Left){for(var c=0;c<f.length-1;c++){if(!b&&bd.QuC(e)==f[c]){bd.sQuC(e,f[c+1]);b=true}}if(!b&&bd.QuC(e)==f[f.length-1]){bd.sQuC(e,f[0]);b=true}}else{if(this.btn.Right){for(var c=f.length;c>0;c--){if(!b&&bd.QuC(e)==f[c]){bd.sQuC(e,f[c-1]);b=true}}if(!b&&bd.QuC(e)==f[0]){bd.sQuC(e,f[f.length-1]);b=true}}}}if(b){pc.paintCell(e)}},inputMB:function(a,c){var b=this.cellid(new Pos(a,c));if(b==-1){return}if(this.btn.Left){if(bd.QsC(b)==0){bd.sQsC(b,1)}else{if(bd.QsC(b)==1){bd.sQsC(b,2)}else{bd.sQsC(b,0)}}}else{if(this.btn.Right){if(bd.QsC(b)==0){bd.sQsC(b,2)}else{if(bd.QsC(b)==2){bd.sQsC(b,1)}else{bd.sQsC(b,0)}}}}pc.paintCell(b)},inputdirec:function(a,e){var d=this.cellpos(new Pos(a,e));if(d.x==this.mouseCell.x&&d.y==this.mouseCell.y){return}var b=0;var c=bd.cnum(this.mouseCell.x,this.mouseCell.y);if(c!=-1&&bd.QnC(c)!=-1){if(d.y-this.mouseCell.y==-1){b=1}else{if(d.y-this.mouseCell.y==1){b=2}else{if(d.x-this.mouseCell.x==-1){b=3}else{if(d.x-this.mouseCell.x==1){b=4}else{return}}}}bd.sDiC(c,(bd.DiC(c)!=b?b:0));pc.paintCell(c)}this.mouseCell=d},inputtile:function(a,l){var j=this.cellid(new Pos(a,l));if(j==-1||j==this.mouseCell||bd.QuC(j)==51){return}if(this.inputData==-1){this.decIC(j)}this.mouseCell=j;var e=area.getRoomID(j);for(var b=0;b<area.room[e].clist.length;b++){var h=area.room[e].clist[b];if(this.inputData==1||bd.QsC(h)!=3){(this.inputData==1?bd.setBlack:bd.setWhite).apply(bd,[h]);bd.sQsC(h,(this.inputData==2?1:0))}}var f=ans.getSizeOfClist(area.room[e].clist,function(c){return true});pc.paint(f.x1,f.y1,f.x2,f.y2)},input51:function(a,f){var e=this.cellpos(new Pos(a,f));var d=bd.cnum(e.x,e.y);if((e.x==-1&&e.y>=-1&&e.y<=k.qrows-1)||(e.y==-1&&e.x>=-1&&e.x<=k.qcols-1)){var c=tc.getTCX(),b=tc.getTCY();tc.setTCP(new Pos(2*e.x+1,2*e.y+1));pc.paint(c-1,b-1,c,b);pc.paint(tc.getTCX()-1,tc.getTCY()-1,tc.getTCX(),tc.getTCY());return}else{if(d!=-1&&d!=tc.getTCC()){var c=tc.getTCX(),b=tc.getTCY();tc.setTCC(d);pc.paint(c-1,b-1,c,b)}else{if(d!=-1){if(this.btn.Left){if(bd.QuC(d)!=51){this.set51cell(d,true)}else{kc.chtarget("shift")}}else{if(this.btn.Right){this.set51cell(d,false)}}}else{return}}}pc.paint(bd.cell[d].cx-1,bd.cell[d].cy-1,bd.cell[d].cx+1,bd.cell[d].cy+1)},set51cell:function(b,a){if(a==true){bd.sQuC(b,51);bd.sQnC(b,0);bd.sDiC(b,0);bd.sQaC(b,-1)}else{bd.sQuC(b,0);bd.sQnC(b,0);bd.sDiC(b,0);bd.sQaC(b,-1)}},inputcross:function(a,d){var c=this.crossid(new Pos(a,d));if(c==-1||c==this.mouseCell){return}if(c==tc.getTXC()){if(this.btn.Left){if(bd.QnX(c)==4){bd.sQnX(c,-2)}else{bd.sQnX(c,bd.QnX(c)+1)}}else{if(this.btn.Right){if(bd.QnX(c)==-2){bd.sQnX(c,4)}else{bd.sQnX(c,bd.QnX(c)-1)}}}}else{var b=tc.getTXC();tc.setTXC(c);pc.paint(bd.cross[b].cx-1,bd.cross[b].cy-1,bd.cross[b].cx,bd.cross[b].cy)}this.mouseCell=c;pc.paint(bd.cross[c].cx-1,bd.cross[c].cy-1,bd.cross[c].cx,bd.cross[c].cy)},inputcrossMark:function(a,d){var c=this.crosspos(new Pos(a,d),0.24);if(c.x%2!=0||c.y%2!=0){return}if(c.x<(k.isoutsidecross==1?0:2)||c.x>(k.isoutsidecross==1?2*k.qcols:2*k.qcols-2)){return}if(c.y<(k.isoutsidecross==1?0:2)||c.y>(k.isoutsidecross==1?2*k.qrows:2*k.qrows-2)){return}var b=bd.xnum(mf(c.x/2),mf(c.y/2));um.disCombine=1;bd.sQnX(b,(bd.QnX(b)==1)?-1:1);um.disCombine=0;pc.paint(bd.cross[b].cx-1,bd.cross[b].cy-1,bd.cross[b].cx,bd.cross[b].cy)},inputborder:function(a,b){this.inputBD(a,b,0)},inputborderans:function(a,b){this.inputBD(a,b,1)},inputBD:function(a,e,b){var d=this.crosspos(new Pos(a,e),0.35);if(d.x==this.mouseCell.x&&d.y==this.mouseCell.y){return}var c=bd.bnum(d.x,d.y);if(c==-1&&this.mouseCell.x){c=bd.bnum(this.mouseCell.x,this.mouseCell.y)}if(this.mouseCell!=-1&&c!=-1){if((d.x%2==0&&this.mouseCell.x==d.x&&Math.abs(this.mouseCell.y-d.y)==1)||(d.y%2==0&&this.mouseCell.y==d.y&&Math.abs(this.mouseCell.x-d.x)==1)){this.mouseCell=-1;if(this.inputData==-1){this.inputData=(bd.isBorder(c)?0:1)}if(k.mode==1||(k.mode==3&&bd.QuB(c)==0)){if(this.inputData==1){bd.setBorder(c);if(k.isborderAsLine){bd.sQsB(c,0)}}else{if(this.inputData==0){bd.removeBorder(c)}}}pc.paintBorder(c)}}this.mouseCell=d},inputLine:function(a,b){this.inputLine1(a,b,0)},inputQsubLine:function(a,b){this.inputLine1(a,b,1)},inputLine1:function(a,e,b){var d=this.cellpos(new Pos(a,e));if(d.x==this.mouseCell.x&&d.y==this.mouseCell.y){return}var c=-1;if(d.y-this.mouseCell.y==-1){c=bd.bnum(this.mouseCell.x*2+1,this.mouseCell.y*2)}else{if(d.y-this.mouseCell.y==1){c=bd.bnum(this.mouseCell.x*2+1,this.mouseCell.y*2+2)}else{if(d.x-this.mouseCell.x==-1){c=bd.bnum(this.mouseCell.x*2,this.mouseCell.y*2+1)}else{if(d.x-this.mouseCell.x==1){c=bd.bnum(this.mouseCell.x*2+2,this.mouseCell.y*2+1)}}}}this.mouseCell=d;if(this.inputData==2||this.inputData==3){this.inputpeke2(c)}else{if(this.mouseCell!=-1&&c!=-1){if(b==0){this.inputLine2(c)}else{if(b==1){this.inputqsub2(c)}}}}},inputLine2:function(a){if(this.inputData==-1){this.inputData=(bd.isLine(a)?0:1)}if(this.inputData==1){bd.setLine(a)}else{if(this.inputData==0){bd.removeLine(a)}}pc.paintLine(a)},inputqsub2:function(a){if(this.inputData==-1){this.inputData=(bd.QsB(a)==0?1:0)}if(this.inputData==1){bd.sQsB(a,1)}else{if(this.inputData==0){bd.sQsB(a,0)}}pc.paintLine(a)},inputpeke:function(a,d){var c=this.crosspos(new Pos(a,d),0.22);var b=bd.bnum(c.x,c.y);if(b==-1||(c.x==this.mouseCell.x&&c.y==this.mouseCell.y)){return}this.mouseCell=c;this.inputpeke2(b)},inputpeke2:function(a){if(this.inputData==-1){if(bd.QsB(a)==0){this.inputData=2}else{this.inputData=3}}if(this.inputData==2){bd.setPeke(a)}else{if(this.inputData==3){bd.removeLine(a)}}pc.paintLine(a)},dispRed:function(a,c){var b=this.cellid(new Pos(a,c));this.mousereset();if(!bd.isBlack(b)||b==this.mouseCell){return}if(!k.RBBlackCell){bd.sErC(area.bcell[area.bcell.id[b]].clist,1)}else{this.db0(function(d){return(bd.isBlack(d)&&bd.ErC(d)==0)},b,1)}ans.errDisp=true;pc.paintAll()},db0:function(c,e,b){if(bd.ErC(e)!=0){return}bd.sErC([e],b);var a=bd.cell[e].cx,d=bd.cell[e].cy;if(c(bd.cnum(a-1,d-1))){this.db0(c,bd.cnum(a-1,d-1),b)}if(c(bd.cnum(a,d-1))){this.db0(c,bd.cnum(a,d-1),b)}if(c(bd.cnum(a+1,d-1))){this.db0(c,bd.cnum(a+1,d-1),b)}if(c(bd.cnum(a-1,d))){this.db0(c,bd.cnum(a-1,d),b)}if(c(bd.cnum(a+1,d))){this.db0(c,bd.cnum(a+1,d),b)}if(c(bd.cnum(a-1,d+1))){this.db0(c,bd.cnum(a-1,d+1),b)}if(c(bd.cnum(a,d+1))){this.db0(c,bd.cnum(a,d+1),b)}if(c(bd.cnum(a+1,d+1))){this.db0(c,bd.cnum(a+1,d+1),b)}return},dispRedLine:function(a,f){var e=this.borderid(new Pos(a,f),0.15);this.mousereset();if(e!=-1&&e==this.mouseCell){return}if(!bd.isLine(e)){var d=(k.isborderAsLine==0?this.cellid(new Pos(a,f)):this.crossid(new Pos(a,f)));if(d==-1||(k.isLineCross&&(line.lcntCell(d)==3||line.lcntCell(d)==4))){return}var c,b;if(k.isbordeAsLine==0){c=(d%k.qcols)*2,b=mf(d/k.qcols)*2}else{c=(d%(k.qcols+1))*2,b=mf(d/(k.qcols+1))*2}e=(function(i,h){if(bd.isLine(bd.bnum(i-1,h))){return bd.bnum(i-1,h)}else{if(bd.isLine(bd.bnum(i+1,h))){return bd.bnum(i+1,h)}else{if(bd.isLine(bd.bnum(i,h-1))){return bd.bnum(i,h-1)}else{if(bd.isLine(bd.bnum(i,h+1))){return bd.bnum(i,h+1)}}}}return -1})(c,b)}if(e==-1){return}bd.sErB(bd.borders,2);bd.sErB(line.data[line.data.id[e]].idlist,1);ans.errDisp=true;pc.paintAll()}};KeyEvent=function(){this.isCTRL;this.isALT;this.isSHIFT;this.inUNDO;this.inREDO;this.tcMoved;this.keyPressed;this.ca;this.prev;this.keyreset()};KeyEvent.prototype={keyreset:function(){this.isCTRL=false;this.isALT=false;this.isSHIFT=false;this.inUNDO=false;this.inREDO=false;this.tcMoved=false;this.keyPressed=false;this.prev=-1;this.ca="";if(this.isZ){this.isZ=false}if(this.isX){this.isX=false}},e_keydown:function(a){if(!k.enableKey){return}um.newOperation(true);this.ca=this.getchar(a,this.getKeyCode(a));this.tcMoved=false;if(!this.isZ){bd.errclear()}if(this.keydown_common(a)){return false}if(this.ca){this.keyinput(this.ca)}this.keyPressed=true},e_keyup:function(a){if(!k.enableKey){return}um.newOperation(false);this.ca=this.getchar(a,this.getKeyCode(a));this.keyPressed=false;if(this.keyup_common(a)){return false}if(this.ca){this.keyup(this.ca)}},e_keypress:function(a){if(!k.enableKey){return}um.newOperation(false);this.ca=this.getcharp(a,this.getKeyCode(a));if(this.ca){this.keyinput(this.ca)}},e_SLkeydown:function(b,c){var a={keyCode:c.platformKeyCode,shiftKey:c.shift,ctrlKey:c.ctrl,altKey:false,returnValue:false,preventEvent:f_true};return this.e_keydown(a)},e_SLkeyup:function(b,c){var a={keyCode:c.platformKeyCode,shiftKey:c.shift,ctrlKey:c.ctrl,altKey:false};return this.e_keyup(a)},keyinput:function(a){},keyup:function(a){},getchar:function(b,a){if(b.keyCode==38){return"up"}else{if(b.keyCode==40){return"down"}else{if(b.keyCode==37){return"left"}else{if(b.keyCode==39){return"right"}else{if(48<=a&&a<=57){return(a-48).toString(36)}else{if(65<=a&&a<=90){return(a-55).toString(36)}else{if(96<=a&&a<=105){return(a-96).toString(36)}else{if(112<=a&&a<=123){return"F"+(a-111).toString(10)}else{if(a==32||a==46){return" "}else{if(a==8){return"BS"}else{if(b.shiftKey){return"shift"}else{return""}}}}}}}}}}}},getcharp:function(b,a){if(a==45){return"-"}else{return""}},getKeyCode:function(a){if(document.all){return a.keyCode}else{if(document.getElementById){return(a.keyCode)?a.keyCode:a.charCode}else{if(document.layers){return a.which}}}},keydown_common:function(b){var a=false;if(!this.isSHIFT&&b.shiftKey){this.isSHIFT=true}if(!this.isCTRL&&b.ctrlKey){this.isCTRL=true;a=true}if(!this.isALT&&b.altKey){this.isALT=true;a=true}if(this.isCTRL&&this.ca=="z"){this.inUNDO=true;a=true;tm.startUndoTimer()}if(this.isCTRL&&this.ca=="y"){this.inREDO=true;a=true;tm.startUndoTimer()}if(this.ca=="F2"&&k.callmode=="pmake"){if(k.mode==1&&!this.isSHIFT){k.mode=3;menu.setVal("mode",3);a=true}else{if(k.mode==3&&this.isSHIFT){k.mode=1;menu.setVal("mode",1);a=true}}}if(k.scriptcheck&&debug){a=(a||debug.keydown(this.ca))}return a},keyup_common:function(b){var a=false;if(this.isSHIFT&&!b.shiftKey){this.isSHIFT=false;a=true}if((this.isCTRL||this.inUNDO||this.inREDO)&&!b.ctrlKey){this.isCTRL=false;a=true;this.inUNDO=false;this.inREDO=false}if(this.isALT&&!b.altKey){this.isALT=false;a=true}if(this.inUNDO&&this.ca=="z"){this.inUNDO=false;a=true}if(this.inREDO&&this.ca=="y"){this.inREDO=false;a=true}return a},moveTCell:function(a){return this.moveTC(a,2)},moveTCross:function(a){return this.moveTC(a,2)},moveTBorder:function(a){return this.moveTC(a,1)},moveTC:function(c,a){var e=tc.cursolx,d=tc.cursoly,b=false;if(c=="up"&&d-a>=tc.miny){tc.decTCY(a);b=true}else{if(c=="down"&&d+a<=tc.maxy){tc.incTCY(a);b=true}else{if(c=="left"&&e-a>=tc.minx){tc.decTCX(a);b=true}else{if(c=="right"&&e+a<=tc.maxx){tc.incTCX(a);b=true}}}}if(b){pc.paint(mf(e/2)-1,mf(d/2)-1,mf(e/2),mf(d/2));pc.paint(mf(tc.cursolx/2)-1,mf(tc.cursoly/2)-1,mf(tc.cursolx/2),mf(tc.cursoly/2));this.tcMoved=true}return b},key_inputcross:function(b,a){var d=tc.getTXC();if("0"<=b&&b<="9"){var c=parseInt(b);if(bd.QnX(d)<=0){if(c<=a){bd.sQnX(d,c)}}else{if(bd.QnX(d)*10+c<=a){bd.sQnX(d,bd.QnX(d)*10+c)}else{if(c<=a){bd.sQnX(d,c)}}}}else{if(b=="-"){if(bd.QnX(d)!=-2){bd.sQnX(d,-2)}else{bd.sQnX(d,-1)}}else{if(b==" "){bd.sQnX(d,-1)}else{return}}}pc.paint(bd.cross[d].cx-1,bd.cross[d].cy-1,bd.cross[d].cx,bd.cross[d].cy)},key_inputqnum:function(b,a){var d=tc.getTCC();if(k.mode==1&&k.isOneNumber){d=area.getTopOfRoomByCell(d)}if(bd.roommaxfunc){a=bd.roommaxfunc(d,k.mode)}if("0"<=b&&b<="9"){var c=parseInt(b);if(k.mode==3){bd.sDiC(d,0)}if(bd.getNum(d)<=0||this.prev!=d){if(c<=a){bd.setNum(d,c)}}else{if(bd.getNum(d)*10+c<=a){bd.setNum(d,bd.getNum(d)*10+c)}else{if(c<=a){bd.setNum(d,c)}}}if(bd.QnC(d)!=-1&&k.NumberIsWhite){bd.sQaC(d,-1);if(pc.bcolor=="white"){bd.sQsC(d,0)}}if(k.isAnsNumber){if(k.mode==1){bd.sQaC(d,-1)}bd.sQsC(d,0)}}else{if(b=="-"){if(k.mode==1&&bd.QnC(d)!=-2){bd.setNum(d,-2)}else{bd.setNum(d,-1)}if(bd.QnC(d)!=-1&&k.NumberIsWhite){bd.sQaC(d,-1);if(pc.bcolor=="white"){bd.sQsC(d,0)}}if(k.isAnsNumber){bd.sQsC(d,0)}}else{if(b==" "){bd.setNum(d,-1);if(bd.QnC(d)!=-1&&k.NumberIsWhite){bd.sQaC(d,-1);if(pc.bcolor=="white"){bd.sQsC(d,0)}}if(k.isAnsNumber){bd.sQsC(d,0)}}else{return}}}this.prev=d;pc.paintCell(d)},key_inputdirec:function(b){if(!this.isSHIFT){return false}var c=tc.getTCC();if(bd.QnC(c)==-1){return false}var a=false;if(b=="up"){bd.sDiC(c,(bd.DiC(c)!=1?1:0));a=true}else{if(b=="down"){bd.sDiC(c,(bd.DiC(c)!=2?2:0));a=true}else{if(b=="left"){bd.sDiC(c,(bd.DiC(c)!=3?3:0));a=true}else{if(b=="right"){bd.sDiC(c,(bd.DiC(c)!=4?4:0));a=true}}}}if(a){pc.paint(mf(tc.cursolx/2),mf(tc.cursoly/2),mf(tc.cursolx/2),mf(tc.cursoly/2));this.tcMoved=true}return a},inputnumber51:function(b,e){if(this.chtarget(b)){return}var h=tc.getTCC(),d=-1;if(h==-1){d=bd.exnum(tc.getTCX(),tc.getTCY())}var f=this.detectTarget(h,d);if(f==-1||(h!=-1&&bd.QuC(h)==51)){if(b=="q"&&h!=-1){mv.set51cell(h,(bd.QuC(h)!=51));pc.paint(tc.getTCX()-1,tc.getTCY()-1,tc.getTCX()+1,tc.getTCY()+1);return}}if(f==-1){return}var a=e[f];if("0"<=b&&b<="9"){var c=parseInt(b);if(this.getnum51(h,d,f)<=0||this.prev!=h){if(c<=a){this.setnum51(h,d,f,c)}}else{if(this.getnum51(h,d,f)*10+c<=a){this.setnum51(h,d,f,this.getnum51(h,d,f)*10+c)}else{if(c<=a){this.setnum51(h,d,f,c)}}}}else{if(b=="-"||b==" "){this.setnum51(h,d,f,-1)}else{return}}this.prev=h;if(h!=-1){pc.paintCell(tc.getTCC())}else{pc.paint(tc.getTCX(),tc.getTCY(),tc.getTCX(),tc.getTCY())}},setnum51:function(d,a,b,c){if(d!=-1){(b==2?bd.sQnC(d,c):bd.sDiC(d,c))}else{(b==2?bd.sQnE(a,c):bd.sDiE(a,c))}},getnum51:function(c,a,b){if(c!=-1){return(b==2?bd.QnC(c):bd.DiC(c))}else{return(b==2?bd.QnE(a):bd.DiE(a))}},chtarget:function(a){if(a!="shift"){return false}if(tc.targetdir==2){tc.targetdir=4}else{tc.targetdir=2}pc.paintCell(tc.getTCC());return true},detectTarget:function(b,a){if((b==-1&&a==-1)||(b!=-1&&bd.QuC(b)!=51)){return -1}if(b==bd.cell.length-1||a==k.qcols+k.qrows){return -1}if(b!=-1){if((bd.rt(b)==-1||bd.QuC(bd.rt(b))==51)&&(bd.dn(b)==-1||bd.QuC(bd.dn(b))==51)){return -1}else{if(bd.rt(b)==-1||bd.QuC(bd.rt(b))==51){return 4}else{if(bd.dn(b)==-1||bd.QuC(bd.dn(b))==51){return 2}}}}else{if(a!=-1){if((bd.excell[a].cy==-1&&bd.QuC(bd.excell[a].cx)==51)||(bd.excell[a].cx==-1&&bd.QuC(bd.excell[a].cy*k.qcols)==51)){return -1}else{if(bd.excell[a].cy==-1){return 4}else{if(bd.excell[a].cx==-1){return 2}}}}}return tc.targetdir}};KeyPopup=function(){this.x=-1;this.y=-1;this.ctl={1:{el:"",enable:false,target:"cell"},3:{el:"",enable:false,target:"cell"}};this.tdcolor="black";this.imgCR=[1,1];this.tds=[];this.imgs=[];this.defaultdisp=false;this.tbodytmp=null,this.trtmp=null};KeyPopup.prototype={kpinput:function(a){},enabled:function(){return menu.getVal("keypopup")},generate:function(b,a,d,c){if(a&&k.callmode=="pmake"){this.gentable(1,b,c)}if(d){this.gentable(3,b,c)}},gentable:function(d,a,c){this.ctl[d].enable=true;this.ctl[d].el=newEL("div").attr("class","popup").css("padding","3pt").css("background-color","silver").mouseout(this.hide.ebind(this)).appendTo($("#popup_parent"));var b=newEL("table").attr("cellspacing","2pt").appendTo(this.ctl[d].el);this.tbodytmp=newEL("tbody").appendTo(b);this.trtmp=null;if(c){c(d)}else{if(a==0||a==3){this.gentable10(d,a)}else{if(a==1||a==2||a==4){this.gentable4(d,a)}}}},gentable10:function(b,a){this.inputcol("num","knum0","0","0");this.inputcol("num","knum1","1","1");this.inputcol("num","knum2","2","2");this.inputcol("num","knum3","3","3");this.insertrow();this.inputcol("num","knum4","4","4");this.inputcol("num","knum5","5","5");this.inputcol("num","knum6","6","6");this.inputcol("num","knum7","7","7");this.insertrow();this.inputcol("num","knum8","8","8");this.inputcol("num","knum9","9","9");this.inputcol("num","knum_"," "," ");if(a==0){(b==1)?this.inputcol("num","knum.","-","?"):this.inputcol("empty","knum.","","")}else{if(a==3){this.inputcol("num","knum.","-"," ")}}this.insertrow()},gentable4:function(c,b,a){this.inputcol("num","knum0","0","0");this.inputcol("num","knum1","1","1");this.inputcol("num","knum2","2","2");this.inputcol("num","knum3","3","3");this.insertrow();this.inputcol("num","knum4","4","4");this.inputcol("empty","knumx","","");this.inputcol("num","knum_"," "," ");if(b==1){(c==1)?this.inputcol("num","knum.","-","?"):this.inputcol("empty","knum.","","")}else{if(b==2){this.inputcol("num","knum.","-","¡")}else{if(b==4){this.inputcol("num","knum.","-","›")}}}this.insertrow()},inputcol:function(d,h,a,c){if(!this.trtmp){this.trtmp=newEL("tr")}var f=null;if(d=="num"){f=newEL("td").attr("id",h).attr("class","kpnum").html(c).css("color",this.tdcolor).click(this.inputnumber.ebind(this,a))}else{if(d=="empty"){f=newEL("td").attr("id",h)}else{if(d=="image"){var b=newEL("img").attr("id",""+h+"_i").attr("class","kp").attr("src","./src/img/"+k.puzzleid+"_kp.gif").unselectable();var e=newEL("div").css("position","relative").css("display","inline").unselectable().append(b);var f=newEL("td").attr("id",h).attr("class","kpimg").click(this.inputnumber.ebind(this,a)).append(e);this.imgs.push({el:b,cx:c[0],cy:c[1]})}}}if(f){this.tds.push(f);f.appendTo(this.trtmp).unselectable()}},insertrow:function(){if(this.trtmp){this.tbodytmp.append(this.trtmp);this.trtmp=null}},display:function(a,d){if(this.ctl[k.mode].el&&this.ctl[k.mode].enable&&menu.getVal("keypopup")&&mv.btn.Left){this.x=a;this.y=d;this.ctl[k.mode].el.css("left",k.cv_oft.x+a-3+k.IEMargin.x);this.ctl[k.mode].el.css("top",k.cv_oft.y+d-3+k.IEMargin.y);this.ctl[k.mode].el.css("z-index",100);if(this.ctl[k.mode].target=="cell"){var b=tc.getTCC();var c=mv.cellid(new Pos(this.x,this.y));if(c==-1){return}tc.setTCC(c);pc.paint(bd.cell[c].cx-1,bd.cell[c].cy-1,bd.cell[c].cx,bd.cell[c].cy);pc.paint(bd.cell[b].cx-1,bd.cell[b].cy-1,bd.cell[b].cx,bd.cell[b].cy)}else{if(this.ctl[k.mode].target=="cross"){var b=tc.getTXC();var c=mv.crossid(new Pos(this.x,this.y));if(c==-1){return}tc.setTXC(c);pc.paint(bd.cross[c].cx-1,bd.cross[c].cy-1,bd.cross[c].cx,bd.cross[c].cy);pc.paint(bd.cross[b].cx-1,bd.cross[b].cy-1,bd.cross[b].cx,bd.cross[b].cy)}}this.ctl[k.mode].el.css("visibility","visible")}},inputnumber:function(b,a){this.kpinput(a);this.ctl[k.mode].el.css("visibility","hidden")},hide:function(a){if(this.ctl[k.mode].el&&!menu.insideOf(this.ctl[k.mode].el,a)){this.ctl[k.mode].el.css("visibility","hidden")}},resize:function(){var b=function(c,d){c.css("width",""+mf(d*0.9)+"px").css("height",""+mf(d*0.9)+"px").css("font-size",""+mf(d*0.7)+"px")};var a=function(d,c,f,e){d.css("width",""+(e*kp.imgCR[0])+"px").css("height",""+(e*kp.imgCR[1])+"px").css("clip","rect("+(e*f+1)+"px,"+(e*(c+1))+"px,"+(e*(f+1))+"px,"+(e*c+1)+"px)").css("top","-"+(f*e+1)+"px").css("left","-"+(c*e+1)+"px")};if(k.def_csize>=24){$.each(this.tds,function(c,d){b(d,k.def_csize)});$.each(this.imgs,function(c,d){a(d.el,d.cx,d.cy,mf(k.def_csize*0.9))})}else{$.each(this.tds,function(c,d){b(d,22)});$.each(this.imgs,function(c,d){a(d.el,d.cx,d.cy,18)})}}};TCell=function(){this.cursolx=1;this.cursoly=1;this.minx=(k.isextendcell!=0?-1:1);this.miny=(k.isextendcell!=0?-1:1);this.maxx=(k.isextendcell==2?2*k.qcols+1:2*k.qcols-1);this.maxy=(k.isextendcell==2?2*k.qrows+1:2*k.qrows-1)};TCell.prototype={Adjust:function(){if(this.cursolx<this.minx){this.tborderx=this.minx}if(this.cursoly<this.miny){this.tbordery=this.miny}if(this.cursolx>this.maxx){this.tborderx=this.maxx}if(this.cursoly>this.maxy){this.tbordery=this.maxy}},setAlign:function(){},incTCX:function(a){this.cursolx+=a},incTCY:function(a){this.cursoly+=a},decTCX:function(a){this.cursolx-=a},decTCY:function(a){this.cursoly-=a},getTCP:function(){return new Pos(this.cursolx,this.cursoly)},setTCP:function(a){if(a.x<this.minx||this.maxx<a.x||a.y<this.miny||this.maxy<a.y){return}this.cursolx=a.x;this.cursoly=a.y},getTCC:function(){return bd.cnum(mf((this.cursolx-1)/2),mf((this.cursoly-1)/2))},setTCC:function(a){if(a<0||bd.cell.length<=a){return}this.cursolx=bd.cell[a].cx*2+1;this.cursoly=bd.cell[a].cy*2+1},getTXC:function(){return bd.xnum(mf(this.cursolx/2),mf(this.cursoly/2))},setTXC:function(a){if(!k.iscross||a<0||bd.cross.length<=a){return}this.cursolx=bd.cross[a].cx*2;this.cursoly=bd.cross[a].cy*2},getTBC:function(){return bd.bnum(this.cursolx,this.cursoly)},setTBC:function(a){if(!k.isborder||a<0||bd.border.length<=a){return}this.cursolx=bd.border[a].cx*2;this.cursoly=bd.border[a].cy}};Encode=function(){this.uri={};this.uri.type;this.uri.qdata;this.uri.pflag;this.uri.cols;this.uri.rows;this.uri.bstr};Encode.prototype={init:function(){this.uri.type=0;this.uri.qdata="";this.uri.pflag="";this.uri.cols=0;this.uri.rows=0;this.uri.bstr=""},first_parseURI:function(b){if(b.length<=0){return""}this.init();if(b.substring(0,3)=="?m+"||b.substring(0,3)=="?m/"){k.mode=1;k.callmode="pmake";b=b.substring(3,b.length)}else{k.mode=3;k.callmode=((!k.scriptcheck)?"pplay":"pmake");b=b.substring(1,b.length)}var a=b.indexOf("/");if(a>=0){this.parseURI_pzpr(b.substring(a+1,b.length));return b.substring(0,a)}return b},parseURI:function(a){this.init();if(a.match(/indi\.s58\.xrea\.com/)){if(!a.match(/\/(sa|sc)\//)){this.parseURI_pzpr(a.substring(a.indexOf("/",a.indexOf("?"))+1,a.length))}else{this.parseURI_pzpr(a.substring(a.indexOf("?"),a.length)+1);this.uri.type=1}}else{if(a.match(/www\.kanpen\.net/)||a.match(/www\.geocities(\.co)?\.jp\/pencil_applet/)){if(a.indexOf("?heyawake=")>=0){this.parseURI_heyaapp(a.substring(a.indexOf("?heyawake=")+10,a.length))}else{if(a.indexOf("?pzpr=")>=0){this.parseURI_pzpr(a.substring(a.indexOf("?pzpr=")+6,a.length))}else{this.parseURI_kanpen(a.substring(a.indexOf("?problem=")+9,a.length))}}}else{if(a.match(/www\.geocities(\.co)?\.jp\/heyawake/)){this.parseURI_heyaapp(a.substring(a.indexOf("?problem=")+9,a.length))}}}},parseURI_pzpr:function(a){this.uri.type=0;this.uri.qdata=a;var b=a.split("/");if(!isNaN(parseInt(b[0]))){b.unshift("")}this.uri.pflag=b.shift();this.uri.cols=parseInt(b.shift());this.uri.rows=parseInt(b.shift());this.uri.bstr=b.join("/")},parseURI_kanpen:function(a){this.uri.type=2;this.uri.qdata=a;var b=a.split("/");if(k.puzzleid=="sudoku"){this.uri.rows=this.uri.cols=parseInt(b.shift())}else{this.uri.rows=parseInt(b.shift());this.uri.cols=parseInt(b.shift());if(k.puzzleid=="kakuro"){this.uri.rows--;this.uri.cols--}}this.uri.bstr=b.join("/")},parseURI_heyaapp:function(a){this.uri.type=4;this.uri.qdata=a;var c=a.split("/");var b=c.shift().split("x");this.uri.cols=parseInt(b[0]);this.uri.rows=parseInt(b[1]);this.uri.bstr=c.join("/")},pzlinput:function(){if(k.puzzleid=="icebarn"&&bd.arrowin==-1&&bd.arrowout==-1){bd.inputarrowin(0+bd.bdinside,1);bd.inputarrowout(2+bd.bdinside,1)}if(this.uri.bstr){um.disableRecord();this.pzlimport(this.uri.type,this.uri.bstr);um.enableRecord();bd.ansclear();um.allerase();base.resetInfo();base.resize_canvas_onload()}},pzlimport:function(b,a){},pzlexport:function(a){},checkpflag:function(a){return(this.uri.pflag.indexOf(a)>=0)},decode4:function(d,f,b){var a=0,e=0;for(e=0;e<d.length;e++){var c=d.charAt(e);if(this.include(c,"0","4")){f(a,parseInt(c,16));a++}else{if(this.include(c,"5","9")){f(a,parseInt(c,16)-5);a+=2}else{if(this.include(c,"a","e")){f(a,parseInt(c,16)-10);a+=3}else{if(this.include(c,"g","z")){a+=(parseInt(c,36)-15)}else{if(c=="."){f(a,-2);a++}}}}}if(a>=b){break}}return d.substring(e+1,d.length)},encode4:function(f,b){var e=0,a="";for(var d=0;d<b;d++){var c="";if(f(d)>=0){if(f(d+1)>=0||f(d+1)==-2){c=""+f(d).toString(16)}else{if(f(d+2)>=0||f(d+2)==-2){c=""+(5+f(d)).toString(16);d++}else{c=""+(10+f(d)).toString(16);d+=2}}}else{if(f(d)==-2){c="."}else{c=" ";e++}}if(e==0){a+=c}else{if(c!=" "){a+=((e+15).toString(36)+c);e=0}else{if(e==20){a+="z";e=0}}}}if(e>0){a+=((e+15).toString(36))}return a},decodeNumber10:function(b){var e=0,d=0;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","9")){bd.sQnC(e,parseInt(b.substring(d,d+1),10));e++}else{if(this.include(a,"a","z")){e+=(parseInt(a,36)-9)}else{if(a=="."){bd.sQnC(e,-2);e++}else{e++}}}if(e>bd.cell.length){break}}return b.substring(d,b.length)},encodeNumber10:function(){var a="",c=0;for(var b=0;b<bd.cell.length;b++){pstr="";var d=bd.QnC(b);if(d==-2){pstr="."}else{if(d>=0&&d<10){pstr=d.toString(10)}else{c++}}if(c==0){a+=pstr}else{if(pstr||c==26){a+=((9+c).toString(36)+pstr);c=0}}}if(c>0){a+=(9+c).toString(36)}return a},decodeNumber16:function(b){var e=0,d=0;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","9")||this.include(a,"a","f")){bd.sQnC(e,parseInt(b.substring(d,d+1),16));e++}else{if(a=="."){bd.sQnC(e,-2);e++}else{if(a=="-"){bd.sQnC(e,parseInt(b.substring(d+1,d+3),16));e++;d+=2}else{if(a=="+"){bd.sQnC(e,parseInt(b.substring(d+1,d+4),16));e++;d+=3}else{if(a=="="){bd.sQnC(e,parseInt(b.substring(d+1,d+4),16)+4096);e++;d+=3}else{if(a=="%"){bd.sQnC(e,parseInt(b.substring(d+1,d+4),16)+8192);e++;d+=3}else{if(a>="g"&&a<="z"){e+=(parseInt(a,36)-15)}else{e++}}}}}}}if(e>bd.cell.length){break}}return b.substring(d,b.length)},encodeNumber16:function(){var c=0,a="";for(var b=0;b<bd.cell.length;b++){pstr="";var d=bd.QnC(b);if(d==-2){pstr="."}else{if(d>=0&&d<16){pstr=d.toString(16)}else{if(d>=16&&d<256){pstr="-"+d.toString(16)}else{if(d>=256&&d<4096){pstr="+"+d.toString(16)}else{if(d>=4096&&d<8192){pstr="="+(d-4096).toString(16)}else{if(d>=8192){pstr="%"+(d-8192).toString(16)}else{c++}}}}}}if(c==0){a+=pstr}else{if(pstr||c==20){a+=((15+c).toString(36)+pstr);c=0}}}if(c>0){a+=(15+c).toString(36)}return a},decodeRoomNumber16:function(b){area.resetRarea();var d=1,c=0;for(c=0;c<b.length;c++){var a=b.charAt(c);if(this.include(a,"0","9")||this.include(a,"a","f")){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substring(c,c+1),16));d++}else{if(a=="-"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substring(c+1,c+3),16));d++;c+=2}else{if(a=="+"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substring(c+1,c+4),16));d++;c+=3}else{if(a=="="){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substring(c+1,c+4),16)+4096);d++;c+=3}else{if(a=="%"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substring(c+1,c+4),16)+8192);d++;c+=3}else{if(a=="*"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substring(c+1,c+4),16)+12240);d++;c+=4}else{if(a=="$"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substring(c+1,c+4),16)+77776);d++;c+=5}else{if(a>="g"&&a<="z"){d+=(parseInt(a,36)-15)}else{d++}}}}}}}}if(d>area.room.max){break}}return b.substring(c,b.length)},encodeRoomNumber16:function(){area.resetRarea();var d=0,a="";for(var c=1;c<=area.room.max;c++){var b="";var e=bd.QnC(area.getTopOfRoom(c));if(e>=0&&e<16){b=e.toString(16)}else{if(e>=16&&e<256){b="-"+e.toString(16)}else{if(e>=256&&e<4096){b="+"+e.toString(16)}else{if(e>=4096&&e<8192){b="="+(e-4096).toString(16)}else{if(e>=8192&&e<12240){b="%"+(e-8192).toString(16)}else{if(e>=12240&&e<77776){b="*"+(e-12240).toString(16)}else{if(e>=77776){b="$"+(e-77776).toString(16)}else{d++}}}}}}}if(d==0){a+=b}else{if(b||d==20){a+=((15+d).toString(36)+b);d=0}}}if(d>0){a+=(15+d).toString(36)}return a},decodeArrowNumber16:function(b){var e=0,d=0;for(d=0;d<b.length;d++){var a=b.charAt(d);if(a=="0"){bd.sQnC(e,parseInt(b.substring(d+1,d+2),16));e++;d++}else{if(a=="5"){bd.sQnC(e,parseInt(b.substring(d+1,d+3),16));e++;d+=2}else{if(this.include(a,"1","4")){bd.sDiC(e,parseInt(a,16));if(b.charAt(d+1)!="."){bd.sQnC(e,parseInt(b.substring(d+1,d+2),16))}else{bd.sQnC(e,-2)}e++;d++}else{if(this.include(a,"6","9")){bd.sDiC(e,parseInt(a,16)-5);bd.sQnC(e,parseInt(b.substring(d+1,d+3),16));e++;d+=2}else{if(a>="a"&&a<="z"){e+=(parseInt(a,36)-9)}else{e++}}}}}if(e>bd.cell.length){break}}return b.substring(d,b.length)},encodeArrowNumber16:function(){var a="",d=0;for(var e=0;e<bd.cell.length;e++){var b="";if(bd.QnC(e)!=-1){if(bd.QnC(e)==-2){b=((bd.DiC(e)==0?0:bd.DiC(e))+".")}else{if(bd.QnC(e)<16){b=((bd.DiC(e)==0?0:bd.DiC(e))+bd.QnC(e).toString(16))}else{if(bd.QnC(e)<256){b=((bd.DiC(e)==0?5:bd.DiC(e)+5)+bd.QnC(e).toString(16))}}}}else{b=" ";d++}if(d==0){a+=b}else{if(b!=" "){a+=((d+9).toString(36)+b);d=0}else{if(d==26){a+="z";d=0}}}}if(d>0){a+=(d+9).toString(36)}return a},decodeBorder:function(c){var f,e;if(c){f=Math.min(mf(((k.qcols-1)*k.qrows+4)/5),c.length);e=Math.min(mf((k.qcols*(k.qrows-1)+4)/5)+f,c.length)}else{f=0;e=0}for(var d=0;d<f;d++){var b=parseInt(c.charAt(d),32);for(var a=0;a<5;a++){if(d*5+a<(k.qcols-1)*k.qrows){bd.sQuB(d*5+a,(b&Math.pow(2,4-a)?1:0))}}}var h=(k.qcols-1)*k.qrows;for(var d=0;d<e-f;d++){var b=parseInt(c.charAt(d+f),32);for(var a=0;a<5;a++){if(d*5+a<k.qcols*(k.qrows-1)){bd.sQuB(d*5+a+h,(b&Math.pow(2,4-a)?1:0))}}}area.resetRarea();return c.substring(e,c.length)},encodeBorder:function(){var b,d;var a="";b=0;d=0;for(var c=0;c<(k.qcols-1)*k.qrows;c++){if(bd.QuB(c)==1){d+=Math.pow(2,4-b)}b++;if(b==5){a+=d.toString(32);b=0;d=0}}if(b>0){a+=d.toString(32)}b=0;d=0;for(var c=(k.qcols-1)*k.qrows;c<bd.bdinside;c++){if(bd.QuB(c)==1){d+=Math.pow(2,4-b)}b++;if(b==5){a+=d.toString(32);b=0;d=0}}if(b>0){a+=d.toString(32)}return a},decodeCrossMark:function(c){var f=-1,d=0;for(d=0;d<c.length;d++){var b=c.charAt(d);if(this.include(b,"0","9")||this.include(b,"a","z")){f+=(parseInt(b,36)+1);var a=(k.isoutsidecross==1?f%(k.qcols+1):f%(k.qcols-1)+1);var e=(k.isoutsidecross==1?mf(f/(k.qcols+1)):mf(f/(k.qcols-1))+1);if(e>=k.qrows+(k.isoutsidecross==1?1:0)){d++;break}bd.sQnX(bd.xnum(a,e),1)}else{if(b=="."){f+=36}else{f++}}if(f>=(k.isoutsidecross==1?(k.qcols+1)*(k.qrows+1):(k.qcols-1)*(k.qrows-1))-1){d++;break}}return c.substring(d,c.length)},encodeCrossMark:function(){var b="",e=0;for(var d=0;d<(k.isoutsidecross==1?(k.qcols+1)*(k.qrows+1):(k.qcols-1)*(k.qrows-1));d++){var c="";var a=(k.isoutsidecross==1?d%(k.qcols+1):d%(k.qcols-1)+1);var f=(k.isoutsidecross==1?mf(d/(k.qcols+1)):mf(d/(k.qcols-1))+1);if(bd.QnX(bd.xnum(a,f))==1){c="."}else{c=" ";e++}if(c!=" "){b+=e.toString(36);e=0}else{if(e==36){b+=".";e=0}}}if(e>0){b+=e.toString(36)}return b},decodecross_old:function(a){for(var c=0;c<Math.min(a.length,bd.cross.length);c++){if(a.charAt(c)=="0"){bd.sQnX(c,0)}else{if(a.charAt(c)=="1"){bd.sQnX(c,1)}else{if(a.charAt(c)=="2"){bd.sQnX(c,2)}else{if(a.charAt(c)=="3"){bd.sQnX(c,3)}else{if(a.charAt(c)=="4"){bd.sQnX(c,4)}else{bd.sQnX(c,-1)}}}}}}for(var b=a.length;b<bd.cross.length;b++){bd.sQnX(b,-1)}return a.substring(c,a.length)},include:function(b,c,a){if(c<=b&&b<=a){return true}return false},getURLbase:function(){return"http://indi.s58.xrea.com/pzpr/v3/p.html"},getDocbase:function(){return"http://indi.s58.xrea.com/"},kanpenbase:function(){return"http://www.kanpen.net/"}};FileIO=function(){this.filever=0;this.db=null;this.dbmgr=null;this.DBtype=0;this.DBsid=-1;this.DBlist=[]};FileIO.prototype={fileopen:function(d,b){this.filever=0;if(b==1){var c=d.shift();if(!c.match(/pzprv3\.?(\d+)?/)){alert("‚Ï‚¸‚Õ‚êv3Œ`Ž®‚Ìƒtƒ@ƒCƒ‹‚Å‚Í‚ ‚è‚Ü‚¹‚ñB")}if(RegExp.$1){this.filever=parseInt(RegExp.$1)}if(d.shift()!=k.puzzleid){alert(base.getPuzzleName()+"‚Ìƒtƒ@ƒCƒ‹‚Å‚Í‚ ‚è‚Ü‚¹‚ñB")}}um.disableRecord();var a=this.filedecode(d,b);um.enableRecord();if(a){base.resetInfo();base.resize_canvas()}},filedecode:function(h,d){var f,b;if(k.puzzleid!="sudoku"){f=parseInt(h.shift(),10);b=parseInt(h.shift(),10);if(d==2&&k.puzzleid=="kakuro"){f--;b--}}else{f=b=parseInt(h.shift(),10)}if(f<=0||b<=0){return false}menu.ex.newboard2(b,f);if(d==1){var a=0;var e=0;var c=[];while(1){if(h.length<=0){break}c.push(h.shift());a++;if(k.fstruct[e]=="cellques41_42"&&a>=k.qrows){this.decodeCellQues41_42(c)}else{if(k.fstruct[e]=="cellqnum"&&a>=k.qrows){this.decodeCellQnum(c)}else{if(k.fstruct[e]=="cellqnum51"&&a>=k.qrows+1){this.decodeCellQnum51(c)}else{if(k.fstruct[e]=="cellqnumb"&&a>=k.qrows){this.decodeCellQnumb(c)}else{if(k.fstruct[e]=="cellqnumans"&&a>=k.qrows){this.decodeCellQnumAns(c)}else{if(k.fstruct[e]=="celldirecnum"&&a>=k.qrows){this.decodeCellDirecQnum(c)}else{if(k.fstruct[e]=="cellans"&&a>=k.qrows){this.decodeCellAns(c)}else{if(k.fstruct[e]=="cellqanssub"&&a>=k.qrows){this.decodeCellQanssub(c)}else{if(k.fstruct[e]=="cellqsub"&&a>=k.qrows){this.decodeCellQsub(c)}else{if(k.fstruct[e]=="crossnum"&&a>=k.qrows+1){this.decodeCrossNum(c)}else{if(k.fstruct[e]=="borderques"&&a>=2*k.qrows-1){this.decodeBorderQues(c)}else{if(k.fstruct[e]=="borderline"&&a>=2*k.qrows-1){this.decodeBorderLine(c)}else{if(k.fstruct[e]=="borderans"&&a>=2*k.qrows-1){this.decodeBorderAns(c)}else{if(k.fstruct[e]=="borderans2"&&a>=2*k.qrows+1){this.decodeBorderAns2(c)}else{if(k.fstruct[e]=="arearoom"&&a>=k.qrows+1){this.decodeAreaRoom(c)}else{if(k.fstruct[e]=="others"&&this.decodeOthers(c)){}else{continue}}}}}}}}}}}}}}}}a=0;e++;c=[]}}else{if(d==2){this.kanpenOpen(h)}}return true},filesave:function(c){var d=prompt("•Û‘¶‚·‚éƒtƒ@ƒCƒ‹–¼‚ð“ü—Í‚µ‚Ä‰º‚³‚¢B",k.puzzleid+".txt");if(!d){return}var b=["\\","/",":","*","?",'"',"<",">","|"];for(var a=0;a<b.length;a++){if(d.indexOf(b[a])!=-1){alert("ƒtƒ@ƒCƒ‹–¼‚Æ‚µ‚ÄŽg—p‚Å‚«‚È‚¢•¶Žš‚ªŠÜ‚Ü‚ê‚Ä‚¢‚Ü‚·B");return}}document.fileform2.filename.value=d;if(navigator.platform.indexOf("Win")!=-1){document.fileform2.platform.value="Win"}else{if(navigator.platform.indexOf("Mac")!=-1){document.fileform2.platform.value="Mac"}else{document.fileform2.platform.value="Others"}}this.filever=0;document.fileform2.ques.value=this.fileencode(c);if(c==1){if(!k.isKanpenExist||k.puzzleid=="lits"){document.fileform2.urlstr.value=enc.getURLbase()+"?"+k.puzzleid+enc.pzldata()}else{enc.pzlexport(2);document.fileform2.urlstr.value=document.urloutput.ta.value}}else{if(c==2){document.fileform2.urlstr.value=""}}document.fileform2.submit()},fileencode:function(c){var e="";var d=k.qrows,a=k.qcols;if(k.puzzleid!="sudoku"){if(c==2&&k.puzzleid=="kakuro"){d++;a++}e+=(""+d+"/");e+=(""+a+"/")}else{e+=(""+a+"/")}if(c==1){for(var b=0;b<k.fstruct.length;b++){if(k.fstruct[b]=="cellques41_42"){e+=this.encodeCellQues41_42()}else{if(k.fstruct[b]=="cellqnum"){e+=this.encodeCellQnum()}else{if(k.fstruct[b]=="cellqnum51"){e+=this.encodeCellQnum51()}else{if(k.fstruct[b]=="cellqnumb"){e+=this.encodeCellQnumb()}else{if(k.fstruct[b]=="cellqnumans"){e+=this.encodeCellQnumAns()}else{if(k.fstruct[b]=="celldirecnum"){e+=this.encodeCellDirecQnum()}else{if(k.fstruct[b]=="cellans"){e+=this.encodeCellAns()}else{if(k.fstruct[b]=="cellqanssub"){e+=this.encodeCellQanssub()}else{if(k.fstruct[b]=="cellqsub"){e+=this.encodeCellQsub()}else{if(k.fstruct[b]=="crossnum"){e+=this.encodeCrossNum()}else{if(k.fstruct[b]=="borderques"){e+=this.encodeBorderQues()}else{if(k.fstruct[b]=="borderline"){e+=this.encodeBorderLine()}else{if(k.fstruct[b]=="borderans"){e+=this.encodeBorderAns()}else{if(k.fstruct[b]=="borderans2"){e+=this.encodeBorderAns2()}else{if(k.fstruct[b]=="arearoom"){e+=this.encodeAreaRoom()}else{if(k.fstruct[b]=="others"){e+=this.encodeOthers()}}}}}}}}}}}}}}}}}if(this.filever==0){e="pzprv3/"+k.puzzleid+"/"+e}else{e="pzprv3."+this.filever+"/"+k.puzzleid+"/"+e}}else{if(c==2){e+=this.kanpenSave()}}return e},retarray:function(d){var c=d.split(" ");var b=[];for(var a=0;a<c.length;a++){if(c[a]!=""){b.push(c[a])}}return b},decodeObj:function(f,a,d,c){var e=[];for(var b=0;b<a.length;b++){e=e.concat(this.retarray(a[b]))}for(var b=0;b<e.length;b++){f(c(b%d,mf(b/d)),e[b])}},decodeCell:function(b,a){this.decodeObj(b,a,k.qcols,function(c,d){return bd.cnum(c,d)})},decodeCross:function(b,a){this.decodeObj(b,a,k.qcols+1,function(c,d){return bd.xnum(c,d)})},decodeBorder:function(b,a){this.decodeObj(b,a.slice(0,k.qrows),k.qcols-1,function(c,d){return bd.bnum(2*c+2,2*d+1)});this.decodeObj(b,a.slice(k.qrows,2*k.qrows-1),k.qcols,function(c,d){return bd.bnum(2*c+1,2*d+2)})},decodeBorder2:function(b,a){this.decodeObj(b,a.slice(0,k.qrows),k.qcols+1,function(c,d){return bd.bnum(2*c,2*d+1)});this.decodeObj(b,a.slice(k.qrows,2*k.qrows+1),k.qcols,function(c,d){return bd.bnum(2*c+1,2*d)})},encodeObj:function(e,d,b,c){var f="";for(var h=0;h<b;h++){for(var a=0;a<d;a++){f+=e(c(a,h))}f+="/"}return f},encodeCell:function(a){return this.encodeObj(a,k.qcols,k.qrows,function(b,c){return bd.cnum(b,c)})},encodeCross:function(a){return this.encodeObj(a,k.qcols+1,k.qrows+1,function(b,c){return bd.xnum(b,c)})},encodeBorder:function(a){return this.encodeObj(a,k.qcols-1,k.qrows,function(b,c){return bd.bnum(2*b+2,2*c+1)})+this.encodeObj(a,k.qcols,k.qrows-1,function(b,c){return bd.bnum(2*b+1,2*c+2)})},encodeBorder2:function(a){return this.encodeObj(a,k.qcols+1,k.qrows,function(b,c){return bd.bnum(2*b,2*c+1)})+this.encodeObj(a,k.qcols,k.qrows+1,function(b,c){return bd.bnum(2*b+1,2*c)})},decodeCellQues41_42:function(a){this.decodeCell(function(d,b){if(b=="-"){bd.sQnC(d,-2)}else{if(b=="1"){bd.sQuC(d,41)}else{if(b=="2"){bd.sQuC(d,42)}}}},a)},encodeCellQues41_42:function(){return this.encodeCell(function(a){if(bd.QuC(a)==41){return"1 "}else{if(bd.QuC(a)==42){return"2 "}else{if(bd.QnC(a)==-2){return"- "}else{return". "}}}})},decodeCellQnum:function(a){this.decodeCell(function(d,b){if(b=="-"){bd.sQnC(d,-2)}else{if(b!="."){bd.sQnC(d,parseInt(b))}}},a)},encodeCellQnum:function(){return this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.QnC(a)==-2){return"- "}else{return". "}}})},decodeCellQnumb:function(a){this.decodeCell(function(d,b){if(b=="5"){bd.sQnC(d,-2)}else{if(b!="."){bd.sQnC(d,parseInt(b))}}},a)},encodeCellQnumb:function(){return this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.QnC(a)==-2){return"5 "}else{return". "}}})},decodeCellQnumAns:function(a){this.decodeCell(function(d,b){if(b=="#"){bd.setBlack(d)}else{if(b=="+"){bd.sQsC(d,1)}else{if(b=="-"){bd.sQnC(d,-2)}else{if(b!="."){bd.sQnC(d,parseInt(b))}}}}},a)},encodeCellQnumAns:function(){return this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.QnC(a)==-2){return"- "}else{if(bd.isBlack(a)){return"# "}else{if(bd.QsC(a)==1){return"+ "}else{return". "}}}}})},decodeCellDirecQnum:function(a){this.decodeCell(function(e,b){if(b!="."){var d=b.split(",");bd.sDiC(e,(d[0]!="0"?parseInt(d[0]):0));bd.sQnC(e,(d[1]!="-"?parseInt(d[1]):-2))}},a)},encodeCellDirecQnum:function(){return this.encodeCell(function(d){if(bd.QnC(d)!=-1){var b=(bd.DiC(d)!=0?(bd.DiC(d)).toString():"0");var a=(bd.QnC(d)!=-2?(bd.QnC(d)).toString():"-");return""+b+","+a+" "}else{return". "}})},decodeCellAns:function(a){this.decodeCell(function(d,b){if(b=="#"){bd.setBlack(d)}else{if(b=="+"){bd.sQsC(d,1)}}},a)},encodeCellAns:function(){return this.encodeCell(function(a){if(bd.isBlack(a)){return"# "}else{if(bd.QsC(a)==1){return"+ "}else{return". "}}})},decodeCellQanssub:function(a){this.decodeCell(function(d,b){if(b=="+"){bd.sQsC(d,1)}else{if(b=="-"){bd.sQsC(d,2)}else{if(b=="="){bd.sQsC(d,3)}else{if(b=="%"){bd.sQsC(d,4)}else{if(b!="."){bd.sQaC(d,parseInt(b))}}}}}},a)},encodeCellQanssub:function(){return this.encodeCell(function(a){if(bd.QaC(a)!=-1){return(bd.QaC(a).toString()+" ")}else{if(bd.QsC(a)==1){return"+ "}else{if(bd.QsC(a)==2){return"- "}else{if(bd.QsC(a)==3){return"= "}else{if(bd.QsC(a)==4){return"% "}else{return". "}}}}}})},decodeCellQsub:function(a){this.decodeCell(function(d,b){if(b!="0"){bd.sQsC(d,parseInt(b))}},a)},encodeCellQsub:function(){return this.encodeCell(function(a){if(bd.QsC(a)>0){return(bd.QsC(a).toString()+" ")}else{return"0 "}})},decodeCrossNum:function(a){this.decodeCross(function(d,b){if(b=="-"){bd.sQnX(d,-2)}else{if(b!="."){bd.sQnX(d,parseInt(b))}}},a)},encodeCrossNum:function(){return this.encodeCross(function(a){if(bd.QnX(a)>=0){return(bd.QnX(a).toString()+" ")}else{if(bd.QnX(a)==-2){return"- "}else{return". "}}})},decodeBorderQues:function(a){this.decodeBorder(function(d,b){if(b=="1"){bd.sQuB(d,1)}},a)},encodeBorderQues:function(){return this.encodeBorder(function(a){if(bd.QuB(a)==1){return"1 "}else{return"0 "}})},decodeBorderLine:function(a){var b=bd.isLineNG;bd.isLineNG=function(c){return false};this.decodeBorder(function(e,d){if(d=="-1"){bd.sQsB(e,2)}else{if(d!="0"){bd.sLiB(e,parseInt(d))}}},a);bd.isLineNG=b},encodeBorderLine:function(){return this.encodeBorder(function(a){if(bd.LiB(a)>0){return""+bd.LiB(a)+" "}else{if(bd.QsB(a)==2){return"-1 "}else{return"0 "}}})},decodeBorderAns:function(a){this.decodeBorder(function(d,b){if(b=="1"){bd.sQaB(d,1)}else{if(b=="2"){bd.sQaB(d,1);bd.sQsB(d,1)}else{if(b=="-1"){bd.sQsB(d,1)}}}},a)},encodeBorderAns:function(){return this.encodeBorder(function(a){if(bd.QaB(a)==1&&bd.QsB(a)==1){return"2 "}else{if(bd.QaB(a)==1){return"1 "}else{if(bd.QsB(a)==1){return"-1 "}else{return"0 "}}}})},decodeBorderAns2:function(a){this.decodeBorder2(function(d,b){if(b=="1"){bd.sQaB(d,1)}else{if(b=="2"){bd.sQsB(d,1)}else{if(b=="3"){bd.sQaB(d,1);bd.sQsB(d,1)}else{if(b=="-1"){bd.sQsB(d,2)}}}}},a)},encodeBorderAns2:function(){return this.encodeBorder2(function(a){if(bd.QaB(a)==1&&bd.QsB(a)==1){return"3 "}else{if(bd.QsB(a)==1){return"2 "}else{if(bd.QaB(a)==1){return"1 "}else{if(bd.QsB(a)==2){return"-1 "}else{return"0 "}}}}})},decodeAreaRoom:function(a){a.shift();this.decodeCell(function(e,d){area.setRoomID(e,parseInt(d)+1)},a);for(var b=0;b<k.qcols*k.qrows;b++){if(bd.dn(b)!=-1&&area.getRoomID(b)!=area.getRoomID(bd.dn(b))){bd.sQuB(bd.db(b),1)}if(bd.rt(b)!=-1&&area.getRoomID(b)!=area.getRoomID(bd.rt(b))){bd.sQuB(bd.rb(b),1)}}area.resetRarea()},encodeAreaRoom:function(){area.resetRarea();var a=""+area.room.max+"/";return a+this.encodeCell(function(b){return((area.getRoomID(b)-1)+" ")})},decodeCellQnum51:function(b){var f=[];for(var d=0;d<b.length;d++){f=f.concat(fio.retarray(b[d]))}for(var d=0;d<f.length;d++){var a=d%(k.qcols+1)-1,j=mf(d/(k.qcols+1))-1;if(f[d]!="."){if(j==-1){bd.sDiE(bd.exnum(a,j),parseInt(f[d]))}else{if(a==-1){bd.sQnE(bd.exnum(a,j),parseInt(f[d]))}else{var e=f[d].split(",");var h=bd.cnum(a,j);mv.set51cell(h,true);bd.sQnC(h,e[0]);bd.sDiC(h,e[1])}}}}},encodeCellQnum51:function(){var b="";for(var e=-1;e<k.qrows;e++){for(var a=-1;a<k.qcols;a++){if(a==-1&&e==-1){b+="0 "}else{if(e==-1){b+=(""+bd.DiE(bd.exnum(a,e)).toString()+" ")}else{if(a==-1){b+=(""+bd.QnE(bd.exnum(a,e)).toString()+" ")}else{var d=bd.cnum(a,e);if(bd.QuC(d)==51){b+=(""+bd.QnC(d).toString()+","+bd.DiC(d).toString()+" ")}else{b+=". "}}}}}b+="/"}return b},choiceDataBase:function(){if(window.google&&google.gears){this.DBtype=1;return 1}var a=0;if(typeof GearsFactory!="undefined"){a=11}else{try{var c=new ActiveXObject("Gears.Factory");a=21}catch(b){if((typeof navigator.mimeTypes!="undefined")&&navigator.mimeTypes["application/x-googlegears"]){a=31}}}this.DBtype=(a>0?1:0);return a},initDataBase:function(){if(this.DBtype==0){return false}else{if(this.DBtype==1){this.dbmgr=google.gears.factory.create("beta.database","1.0");this.dbmgr.open("pzprv3_manage");this.dbmgr.execute("CREATE TABLE IF NOT EXISTS manage (puzzleid primary key,version,count,lastupdate)");this.dbmgr.close();this.db=google.gears.factory.create("beta.database","1.0");this.db.open("pzprv3_"+k.puzzleid);this.db.execute("CREATE TABLE IF NOT EXISTS pzldata (id int primary key,col,row,hard,pdata,time,comment)");this.db.close()}else{if(this.DBtype==2){this.dbmgr=openDataBase("pzprv3_manage","1.0");this.dbmgr.transaction(function(c){c.executeSql("CREATE TABLE IF NOT EXISTS manage (puzzleid primary key,version,count,lastupdate)")});this.db=openDataBase("pzprv3_"+k.puzzleid,"1.0");this.db.transaction(function(c){c.executeSql("CREATE TABLE IF NOT EXISTS pzldata (id int primary key,col,row,hard,pdata,time,comment)")})}}}this.updateManager(false);var a={idlist:"ID‡",newsave:"•Û‘¶‚ªV‚µ‚¢‡",oldsave:"•Û‘¶‚ªŒÃ‚¢‡",size:"ƒTƒCƒY/“ïˆÕ“x‡"};var b="";for(s in a){b+=('<option value="'+s+'">'+a[s]+"</option>")}document.database.sorts.innerHTML=b;return true},dropDataBase:function(){if(this.DBtype==1){this.dbmgr.open("pzprv3_manage");this.dbmgr.execute("DELETE FROM manage WHERE puzzleid=?",[k.puzzleid]);this.dbmgr.close();this.db.open("pzprv3_"+k.puzzleid);this.db.execute("DROP TABLE IF EXISTS pzldata");this.db.close()}else{if(this.DBtype==2){this.dbmgr.transaction(function(a){a.executeSql("DELETE FROM manage WHERE puzzleid=?",[k.puzzleid])});this.db.transaction(function(a){a.executeSql("DROP TABLE IF EXISTS pzldata")})}}},remakeDataBase:function(){this.DBlist=[];this.db.open("pzprv3_"+k.puzzleid);var a=this.db.execute("SELECT * FROM pzldata");while(a.isValidRow()){var e={};for(var b=0;b<a.fieldCount();b++){e[a.fieldName(b)]=a.field(b)}this.DBlist.push(e);a.next()}a.close();this.db.execute("DROP TABLE IF EXISTS pzldata");this.db.execute("CREATE TABLE IF NOT EXISTS pzldata (id int primary key,col,row,hard,pdata,time,comment)");for(var c=0;c<this.DBlist.length;c++){var d=this.DBlist[c];this.db.execute("INSERT INTO pzldata VALUES(?,?,?,?,?,?,?)",[d.id,d.col,d.row,d.hard,d.pdata,d.time,d.comment])}this.db.close()},updateManager:function(a){var c=-1;if(this.DBtype==1){if(!a){this.db.open("pzprv3_"+k.puzzleid);var b=this.db.execute("SELECT COUNT(*) FROM pzldata");c=(b.isValidRow()?b.field(0):0);this.db.close()}else{c=this.DBlist.length}this.dbmgr.open("pzprv3_manage");this.dbmgr.execute("INSERT OR REPLACE INTO manage VALUES(?,?,?,?)",[k.puzzleid,"1.0",c,mf((new Date()).getTime()/1000)]);this.dbmgr.close()}else{if(this.DBtype==2){if(!a){this.db.transaction(function(d){d.executeSql("SELECT COUNT(*) FROM pzldata",function(){},function(e,f){c=f.rows[0]})})}else{c=this.DBlist.length}this.dbmgr.transaction(function(d){d.executeSql("INSERT OR REPLACE INTO manage VALUES(?,?,?,?)",[k.puzzleid,"1.0",c,mf((new Date()).getTime()/1000)])})}}},displayDataTableList:function(){if(this.DBtype>0){switch(document.database.sorts.value){case"idlist":this.DBlist=this.DBlist.sort(function(h,f){return(h.id-f.id)});break;case"newsave":this.DBlist=this.DBlist.sort(function(h,f){return(f.time-h.time||h.id-f.id)});break;case"oldsave":this.DBlist=this.DBlist.sort(function(h,f){return(h.time-f.time||h.id-f.id)});break;case"size":this.DBlist=this.DBlist.sort(function(h,f){return(h.col-f.col||h.row-f.row||h.hard-f.hard||h.id-f.id)});break}var b="";for(var a=0;a<this.DBlist.length;a++){var e=this.DBlist[a];if(!e){alert(a)}var d=((e.id<10?"&nbsp;":"")+e.id+" :&nbsp;");var c=new Date();c.setTime(e.time*1000);d+=(" "+this.ni(c.getFullYear()%100)+"/"+this.ni(c.getMonth()+1)+"/"+this.ni(c.getDate())+" "+this.ni(c.getHours())+":"+this.ni(c.getMinutes())+"&nbsp;&nbsp;");d+=(""+e.col+"~"+e.row+"&nbsp;&nbsp;");if(menu.isLangJP()){d+=({0:"|",1:"‚ç‚­‚ç‚­",2:"‚¨‚Ä‚²‚ë",3:"‚½‚¢‚Ö‚ñ",4:"ƒAƒ[ƒ“"}[e.hard])}else{if(menu.isLangEN()){d+=({0:"-",1:"Easy",2:"Normal",3:"Hard",4:"Expert"}[e.hard])}}b+=('<option value="'+e.id+'"'+(this.DBsid==e.id?" selected":"")+">"+d+"</option>\n")}b+=('<option value="new"'+(this.DBsid==-1?" selected":"")+">&nbsp;&lt;V‚µ‚­•Û‘¶‚·‚é&gt;</option>\n");document.database.datalist.innerHTML=b;this.selectDataTable()}},ni:function(a){return(a<10?"0"+a:""+a)},getDataTableList:function(){this.DBlist=[];if(this.DBtype==1){this.db.open("pzprv3_"+k.puzzleid);var b=this.db.execute("SELECT * FROM pzldata");while(b.isValidRow()){var d={};for(var c=0;c<b.fieldCount();c++){d[b.fieldName(c)]=b.field(c)}this.DBlist.push(d);b.next()}b.close();this.db.close();this.displayDataTableList()}else{if(this.DBtype==2){var a=this;this.db.transaction(function(e){e.executeSql("SELECT * FROM pzldata",[],function(f,h){for(var i=0;i<h.rows.length;i++){a.DBlist.push(h.rows[i])}a.DBlist=h;a.displayDataTableList()})})}}},upDataTable:function(){var a=this.getDataID();if(this.DBtype==0||a==-1||a==0){return}this.convertDataTableID(a,a-1)},downDataTable:function(){var a=this.getDataID();if(this.DBtype==0||a==-1||a==this.DBlist.length-1){return}this.convertDataTableID(a,a+1)},convertDataTableID:function(c,e){var a=this.DBsid;var d=this.DBlist[e].id;this.DBsid=d;this.DBlist[c].id=d;this.DBlist[e].id=a;if(this.DBtype==1){this.db.open("pzprv3_"+k.puzzleid);this.db.execute("UPDATE pzldata SET id=? WHERE ID==?",[0,a]);this.db.execute("UPDATE pzldata SET id=? WHERE ID==?",[a,d]);this.db.execute("UPDATE pzldata SET id=? WHERE ID==?",[d,0]);this.db.close();this.displayDataTableList()}else{if(this.DBtype==2){var b=this;this.db.transaction(function(f){f.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[0,a]);f.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[a,d]);f.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[d,0])},f_true,b.displayDataTableList)}}this.updateManager(true)},getDataID:function(){if(document.database.datalist.value!="new"&&document.database.datalist.value!=""){for(var a=0;a<this.DBlist.length;a++){if(this.DBlist[a].id==document.database.datalist.value){return a}}}return -1},selectDataTable:function(){var a=this.getDataID();if(a>=0){document.database.comtext.value=""+this.DBlist[a].comment;this.DBsid=this.DBlist[a].id}else{document.database.comtext.value="";this.DBsid=-1}document.database.tableup.disabled=(document.database.sorts.value!="idlist"||this.DBsid==-1||this.DBsid==1);document.database.tabledn.disabled=(document.database.sorts.value!="idlist"||this.DBsid==-1||this.DBsid==this.DBlist.length);document.database.comedit.disabled=(this.DBsid==-1);document.database.difedit.disabled=(this.DBsid==-1);document.database.open.disabled=(this.DBsid==-1);document.database.del.disabled=(this.DBsid==-1)},openDataTable:function(){var c=this.getDataID();if(c==-1||!confirm("‚±‚Ìƒf[ƒ^‚ð“Ç‚Ýž‚Ý‚Ü‚·‚©H (Œ»Ý‚Ì”Õ–Ê‚Í”jŠü‚³‚ê‚Ü‚·)")){return}if(this.DBtype==1){this.db.open("pzprv3_"+k.puzzleid);var c=this.getDataID();var b=this.db.execute("SELECT * FROM pzldata WHERE ID==?",[this.DBlist[c].id]);this.fileopen(b.field(4).split("/"),1);b.close();this.db.close()}else{if(this.DBtype==2){var a=this;this.db.transaction(function(d){d.executeSql("SELECT * FROM pzldata WHERE ID==?",[a.DBlist[c].id],function(e,f){a.fileopen(f.rows[0].pdata.split("/"),1)})})}}},saveDataTable:function(){var e=this.getDataID();if(this.DBtype==0||(e!=-1&&!confirm("‚±‚Ìƒf[ƒ^‚Éã‘‚«‚µ‚Ü‚·‚©H"))){return}var c=mf((new Date()).getTime()/1000);var b=this.fileencode(1);var d="";if(e==-1){d=prompt("ƒRƒƒ“ƒg‚ª‚ ‚éê‡‚Í“ü—Í‚µ‚Ä‚­‚¾‚³‚¢B","");if(d==null){d=""}}else{d=this.DBlist[this.getDataID()].comment}if(this.DBtype==1){this.db.open("pzprv3_"+k.puzzleid);if(e==-1){e=this.DBlist.length+1;this.db.execute("INSERT INTO pzldata VALUES(?,?,?,?,?,?,?)",[e,k.qcols,k.qrows,0,b,c,d])}else{e=document.database.datalist.value;this.db.execute("INSERT OR REPLACE INTO pzldata VALUES(?,?,?,?,?,?,?)",[e,k.qcols,k.qrows,0,b,c,d])}this.db.close();this.getDataTableList()}else{if(this.DBtype==2){var a=this;if(e==-1){e=this.DBlist.length+1;this.db.transaction(function(f){f.executeSql("INSERT INTO pzldata VALUES(?,?,?,?,?,?,?)",[e,k.qcols,k.qrows,0,b,c,d])},f_true,a.getDataTableList)}else{e=document.database.datalist.value;this.db.transaction(function(f){f.executeSql("INSERT OR REPLACE INTO pzldata VALUES(?,?,?,?,?,?,?)",[e,k.qcols,k.qrows,0,b,c,d])},f_true,a.getDataTableList)}}}this.updateManager(true)},editComment:function(){var c=this.getDataID();if(this.DBtype==0||c==-1){return}var b=prompt("‚±‚Ì–â‘è‚É‘Î‚·‚éƒRƒƒ“ƒg‚ð“ü—Í‚µ‚Ä‚­‚¾‚³‚¢B",this.DBlist[c].comment);if(b==null){return}this.DBlist[c].comment=b;if(this.DBtype==1){this.db.open("pzprv3_"+k.puzzleid);this.db.execute("UPDATE pzldata SET comment=? WHERE ID==?",[b,this.DBlist[c].id]);this.db.close();this.displayDataTableList()}else{if(this.DBtype==2){var a=this;this.db.transaction(function(d){d.executeSql("UPDATE pzldata SET comment=? WHERE ID==?",[b,a.DBlist[c].id])},f_true,a.displayDataTableList)}}this.updateManager(true)},editDifficult:function(){var c=this.getDataID();if(this.DBtype==0||c==-1){return}var b=prompt("‚±‚Ì–â‘è‚Ì“ïˆÕ“x‚ðÝ’è‚µ‚Ä‚­‚¾‚³‚¢B\n[0:‚È‚µ 1:‚ç‚­‚ç‚­ 2:‚¨‚Ä‚²‚ë 3:‚½‚¢‚Ö‚ñ 4:ƒAƒ[ƒ“]",this.DBlist[c].hard);if(b==null){return}this.DBlist[c].hard=((b=="1"||b=="2"||b=="3"||b=="4")?b:0);if(this.DBtype==1){this.db.open("pzprv3_"+k.puzzleid);this.db.execute("UPDATE pzldata SET hard=? WHERE ID==?",[b,this.DBlist[c].id]);this.db.close();this.displayDataTableList()}else{if(this.DBtype==2){var a=this;this.db.transaction(function(d){d.executeSql("UPDATE pzldata SET hard=? WHERE ID==?",[b,a.DBlist[c].id])},f_true,a.displayDataTableList)}}this.updateManager(true)},deleteDataTable:function(){var c=this.getDataID();if(this.DBtype==0||c==-1||!confirm("‚±‚Ìƒf[ƒ^‚ðŠ®‘S‚Éíœ‚µ‚Ü‚·‚©H")){return}if(this.DBtype==1){this.db.open("pzprv3_"+k.puzzleid);this.db.execute("DELETE FROM pzldata WHERE ID==?",[this.DBlist[c].id]);this.DBlist=this.DBlist.sort(function(e,d){return(e.id-d.id)});for(var b=c+1;b<this.DBlist.length;b++){this.db.execute("UPDATE pzldata SET id=? WHERE ID==?",[this.DBlist[b].id-1,this.DBlist[b].id]);this.DBlist[b].id--;this.DBlist[b-1]=this.DBlist[b]}this.DBlist.splice(this.DBlist.length-1,1);this.db.close();this.displayDataTableList()}else{if(this.DBtype==2){var a=this;this.db.transaction(function(d){d.executeSql("DELETE FROM pzldata WHERE ID==?",[a.DBlist[c].id]);a.DBlist=a.DBlist.sort(function(h,f){return(h.id-f.id)});for(var e=c+1;e<a.DBlist.length;e++){d.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[a.DBlist[e].id-1,a.DBlist[e].id]);a.DBlist[e].id--;a.DBlist[e-1]=a.DBlist[e]}a.DBlist.splice(this.DBlist.length-1,1)},f_true,a.displayDataTableList)}}this.updateManager(true)}};AnsCheck=function(){this.performAsLine=false;this.errDisp=false;this.setError=true;this.inAutoCheck=false;this.alstr={jp:"",en:""}};AnsCheck.prototype={check:function(){this.inCheck=true;this.alstr={jp:"",en:""};kc.keyreset();if(!this.checkAns()){alert((menu.isLangJP()||!this.alstr.en)?this.alstr.jp:this.alstr.en);this.errDisp=true;pc.paintAll();this.inCheck=false;return false}alert(menu.isLangJP()?"³‰ð‚Å‚·I":"Complete!");this.inCheck=false;return true},checkAns:function(){},setAlert:function(b,a){this.alstr.jp=b;this.alstr.en=a},autocheck:function(){if(!k.autocheck||k.mode!=3||this.inCheck){return}var a=false;this.inCheck=true;this.disableSetError();if(this.autocheck1st()&&this.checkAns()&&this.inCheck){mv.mousereset();alert(menu.isLangJP()?"³‰ð‚Å‚·I":"Complete!");a=true;menu.setVal("autocheck",false)}this.enableSetError();this.inCheck=false;return a},autocheck1st:function(){if(this.check1st){return this.check1st()}else{if((k.isCenterLine&&!ans.checkLcntCell(1))||(k.isborderAsLine&&!ans.checkLcntCross(1,0))){return false}}return true},disableSetError:function(){this.setError=false},enableSetError:function(){this.setError=true},isenableSetError:function(){return this.setError},checkdir4Cell:function(c,b){if(c<0||c>=bd.cell.length){return 0}var a=0;if(bd.up(c)!=-1&&b(bd.up(c))){a++}if(bd.dn(c)!=-1&&b(bd.dn(c))){a++}if(bd.lt(c)!=-1&&b(bd.lt(c))){a++}if(bd.rt(c)!=-1&&b(bd.rt(c))){a++}return a},setErrLareaByCell:function(a,d,b){this.setErrLareaById(a,a.id[d],b)},setErrLareaById:function(e,h,d){var a=[];for(var b=0;b<bd.border.length;b++){if(!bd.isLine(b)){continue}var j=bd.cc1(b),i=bd.cc2(b);if(j!=-1&&i!=-1&&e.id[j]==h&&e.id[j]==e.id[i]){a.push(b)}}bd.sErB(a,d);var l=[];for(var f=0;f<bd.cell.length;f++){if(e.id[f]==h&&bd.QnC(f)!=-1){l.push(f)}}bd.sErC(l,4)},checkAllCell:function(a){for(var b=0;b<bd.cell.length;b++){if(a(b)){bd.sErC([b],1);return false}}return true},checkOneArea:function(a){if(a.max>1){if(this.performAsLine){bd.sErB(bd.borders,2);this.setErrLareaByCell(a,1,1)}if(!this.performAsLine||k.puzzleid=="firefly"){bd.sErC(a.room[1].idlist,1)}return false}return true},check2x2Block:function(a){for(var b=0;b<bd.cell.length;b++){if(bd.cell[b].cx<k.qcols-1&&bd.cell[b].cy<k.qrows-1){if(a(b)&&a(b+1)&&a(b+k.qcols)&&a(b+k.qcols+1)){bd.sErC([b,b+1,b+k.qcols,b+k.qcols+1],1);return false}}}return true},checkSideCell:function(a){for(var b=0;b<bd.cell.length;b++){if(bd.cell[b].cx<k.qcols-1&&a(b,b+1)){bd.sErC([b,b+1],1);return false}if(bd.cell[b].cy<k.qrows-1&&a(b,b+k.qcols)){bd.sErC([b,b+k.qcols],1);return false}}return true},checkAreaRect:function(b,a){return this.checkAllArea(b,a,function(d,e,c){return(d*e==c)})},checkAllArea:function(c,b,a){for(var f=1;f<=c.max;f++){var e=this.getSizeOfClist(c.room[f].idlist,b);if(!a(e.x2-e.x1+1,e.y2-e.y1+1,e.cnt)){bd.sErC(c.room[f].idlist,1);return false}}return true},getSizeOfClist:function(c,b){var e={x1:k.qcols,x2:-1,y1:k.qrows,y2:-1,cnt:0};for(var a=0;a<c.length;a++){if(e.x1>bd.cell[c[a]].cx){e.x1=bd.cell[c[a]].cx}if(e.x2<bd.cell[c[a]].cx){e.x2=bd.cell[c[a]].cx}if(e.y1>bd.cell[c[a]].cy){e.y1=bd.cell[c[a]].cy}if(e.y2<bd.cell[c[a]].cy){e.y2=bd.cell[c[a]].cy}if(b(c[a])){e.cnt++}}return e},checkQnumCross:function(a){for(var b=0;b<bd.cross.length;b++){if(bd.QnX(b)<0){continue}if(!a(bd.QnX(b),bd.bcntCross(bd.cross[b].cx,bd.cross[b].cy))){bd.sErX([b],1);return false}}return true},checkOneLoop:function(){var a=line.getLineInfo();if(a.max>1){bd.sErB(bd.borders,2);bd.sErB(a.room[1].idlist,1);return false}return true},checkLcntCell:function(a){if(line.ltotal[a]==0){return true}for(var b=0;b<bd.cell.length;b++){if(line.lcnt[b]==a){if(!this.performAsLine){bd.sErC([b],1)}else{bd.sErB(bd.borders,2);this.setCellLineError(b,true)}return false}}return true},isLineStraight:function(a){if(line.lcntCell(a)==3||line.lcntCell(a)==4){return true}else{if(line.lcntCell(a)==0||line.lcntCell(a)==1){return false}}if(bd.isLine(bd.ub(a))&&bd.isLine(bd.db(a))){return true}else{if(bd.isLine(bd.lb(a))&&bd.isLine(bd.rb(a))){return true}}return false},setCellLineError:function(b,a){if(a){bd.sErC([b],1)}bd.sErB([bd.ub(b),bd.db(b),bd.lb(b),bd.rb(b)],1)},checkdir4Border:function(){for(var a=0;a<bd.cell.length;a++){if(bd.QnC(a)>=0&&this.checkdir4Border1(a)!=bd.QnC(a)){bd.sErC([a],1);return false}}return true},checkdir4Border1:function(d){if(d<0||d>=bd.cell.length){return 0}var b=0;var a=bd.cell[d].cx;var c=bd.cell[d].cy;if((k.isoutsideborder==0&&c==0)||bd.isBorder(bd.bnum(a*2+1,c*2))){b++}if((k.isoutsideborder==0&&c==k.qrows-1)||bd.isBorder(bd.bnum(a*2+1,c*2+2))){b++}if((k.isoutsideborder==0&&a==0)||bd.isBorder(bd.bnum(a*2,c*2+1))){b++}if((k.isoutsideborder==0&&a==k.qcols-1)||bd.isBorder(bd.bnum(a*2+2,c*2+1))){b++}return b},checkenableLineParts:function(c){var b=function(d){return((bd.ub(d)!=-1&&bd.isLine(bd.ub(d))&&bd.isnoLPup(d))||(bd.db(d)!=-1&&bd.isLine(bd.db(d))&&bd.isnoLPdown(d))||(bd.lb(d)!=-1&&bd.isLine(bd.lb(d))&&bd.isnoLPleft(d))||(bd.rb(d)!=-1&&bd.isLine(bd.rb(d))&&bd.isnoLPright(d)))};for(var a=0;a<bd.cell.length;a++){if(b(a)){bd.sErC([a],1);return false}}return true},checkOneNumber:function(cinfo,eval,func){for(var id=1;id<=cinfo.max;id++){if(eval(bd.QnC(this.getQnumCellInArea(cinfo,id)),this.getCellsOfRoom(cinfo,id,func))){if(this.performAsLine){bd.sErB(bd.borders,2);this.setErrLareaById(cinfo,id,1)}else{bd.sErC(cinfo.room[id].idlist,(k.puzzleid!="tateyoko"?1:4))}return false}}return true},checkBlackCellCount:function(a){return this.checkOneNumber(a,function(c,b){return(c>=0&&c!=b)},bd.isBlack)},checkDisconnectLine:function(a){return this.checkOneNumber(a,function(c,b){return(c==-1&&b==0)},bd.isNum)},checkNumberAndSize:function(a){return this.checkOneNumber(a,function(c,b){return(c>0&&c!=b)},f_true)},checkQnumsInArea:function(b,a){return this.checkOneNumber(b,function(d,c){return a(c)},bd.isNum)},checkBlackCellInArea:function(b,a){return this.checkOneNumber(b,function(d,c){return a(c)},bd.isBlack)},checkNoObjectInRoom:function(b,a){return this.checkOneNumber(b,function(d,c){return(c==0)},function(d){return a(d)!=-1})},getQnumCellInArea:function(c,b){if(k.isOneNumber){return area.getTopOfRoomByCell(c.room[b].idlist[0])}for(var a=0;a<c.room[b].idlist.length;a++){if(bd.QnC(c.room[b].idlist[a])!=-1){return c.room[b].idlist[a]}}return -1},getCntOfRoom:function(b,a){return b.room[a].idlist.length},getCellsOfRoom:function(e,d,c){var b=0;for(var a=0;a<e.room[d].idlist.length;a++){if(c(e.room[d].idlist[a])){b++}}return b},checkSideAreaSize:function(i,m){var j=[];for(var a=1;a<=i.max-1;a++){j[a]=[];for(var q=a+1;q<=i.max;q++){j[a][q]=0}}for(var d=0;d<bd.border.length;d++){if(!bd.isBorder(d)){continue}var p=bd.cc1(d),o=bd.cc2(d);if(p==-1||o==-1){continue}var h=i.id[p],f=i.id[o];try{if(h<f){j[h][f]++}if(h>f){j[f][h]++}}catch(l){alert([h,f]);throw 0}}for(var a=1;a<=i.max-1;a++){for(var q=a+1;q<=i.max;q++){if(j[a][q]==0){continue}var c=m(i,a),b=m(i,q);if(c>0&&b>0&&c==b){bd.sErC(i.room[a].idlist,1);bd.sErC(i.room[q].idlist,1);return false}}}return true},checkSideAreaCell:function(f,d,a){for(var e=0;e<bd.border.length;e++){if(!bd.isBorder(e)){continue}var c=bd.cc1(e),b=bd.cc2(e);if(c!=-1&&b!=-1&&d(c,b)){if(!a){bd.sErC([c,b],1)}else{bd.sErC(area.room[area.room.id[c]].clist,1);bd.sErC(area.room[area.room.id[b]].clist,1)}return false}}return true},checkSeqBlocksInRoom:function(){for(var d=1;d<=area.room.max;d++){var a={max:0,id:[]};for(var b=0;b<bd.cell.length;b++){a.id[b]=((area.room.id[b]==d&&bd.isBlack(b))?0:-1)}for(var b=0;b<k.qcols*k.qrows;b++){if(a.id[b]!=0){continue}a.max++;a[a.max]={clist:[]};area.sc0(b,a)}if(a.max>1){bd.sErC(area.room[d].clist,1);return false}}return true},checkSameObjectInRoom:function(j,b){var e=[];for(var a=1;a<=j.max;a++){e[a]=-1}for(var h=0;h<bd.cell.length;h++){if(j.id[h]==-1||b(h)==-1){continue}if(e[j.id[h]]==-1&&b(h)!=-1){e[j.id[h]]=b(h)}else{if(e[j.id[h]]!=b(h)){if(this.performAsLine){bd.sErB(bd.borders,2);this.setErrLareaByCell(j,h,1)}else{bd.sErC(j.room[j.id[h]].idlist,1)}if(k.puzzleid=="kaero"){for(var f=0;f<bd.cell.length;f++){if(j.id[h]==j.id[f]&&this.getBeforeCell(f)!=-1&&j.id[h]!=j.id[this.getBeforeCell(f)]){bd.sErC([this.getBeforeCell(f)],4)}}}return false}}}return true},checkObjectRoom:function(m,e){var h=[];var f=0;for(var l=0;l<bd.cell.length;l++){if(f<e(l)){f=e(l)}}for(var a=0;a<=f;a++){h[a]=-1}for(var l=0;l<bd.cell.length;l++){if(e(l)==-1){continue}if(h[e(l)]==-1){h[e(l)]=m.id[l]}else{if(h[e(l)]!=m.id[l]){var b=[];for(var j=0;j<bd.cell.length;j++){if(k.puzzleid=="kaero"){if(e(l)==bd.QnC(j)){b.push(j)}}else{if(m.id[l]==m.id[j]||h[e(l)]==m.id[j]){b.push(j)}}}bd.sErC(b,1);return false}}}return true},checkLcntCross:function(e,d){for(var b=0;b<(k.qcols+1)*(k.qrows+1);b++){var a=b%(k.qcols+1),f=mf(b/(k.qcols+1));if(k.isoutsidecross==0&&k.isborderAsLine==0&&(a==0||f==0||a==k.qcols||f==k.qrows)){continue}var c=(!k.isborderAsLine?area.lcnt[b]:line.lcnt[b]);if(c==e&&(d==0||(d==1&&bd.QnX(bd.xnum(a,f))==1)||(d==2&&bd.QnX(bd.xnum(a,f))!=1))){bd.sErB(bd.borders,2);this.setCrossBorderError(a,f);return false}}return true},setCrossBorderError:function(a,b){if(k.iscross){bd.sErX([bd.xnum(a,b)],1)}bd.sErB([bd.bnum(a*2,b*2-1),bd.bnum(a*2,b*2+1),bd.bnum(a*2-1,b*2),bd.bnum(a*2+1,b*2)],1)}};Operation=function(d,c,e,a,b){this.obj=d;this.property=c;this.id=e;this.old=a;this.num=b;this.chain=um.chainflag};UndoManager=function(){this.ope=[];this.current=0;this.disrec=0;this.chainflag=0;this.disCombine=0;this.anscount=0;this.changeflag=false;this.undoExec=false;this.redoExec=false;this.reqReset=false;this.range={x1:k.qcols+1,y1:k.qrows+1,x2:-2,y2:-2}};UndoManager.prototype={disableRecord:function(){this.disrec++},enableRecord:function(){if(this.disrec>0){this.disrec--}},isenableRecord:function(){return(this.disrec==0)},enb_btn:function(){if(!this.ope.length){$("#btnundo").attr("disabled","true");$("#btnredo").attr("disabled","true")}else{if(!this.current){$("#btnundo").attr("disabled","true")}else{$("#btnundo").attr("disabled","")}if(this.current==this.ope.length){$("#btnredo").attr("disabled","true")}else{$("#btnredo").attr("disabled","")}}},allerase:function(){for(var a=this.ope.length-1;a>=0;a--){this.ope.pop()}this.current=0;this.anscount=0;this.enb_btn()},newOperation:function(a){this.chainflag=0;if(a){this.changeflag=false}},addOpe:function(f,e,h,a,b){if(!this.isenableRecord()){return}else{if(a==b){return}}var d=this.ope.length-1;if(this.current<this.ope.length){for(var c=this.ope.length-1;c>=this.current;c--){this.ope.pop()}d=-1}if(d>=0&&this.ope[d].obj==f&&this.ope[d].property==e&&this.ope[d].id==h&&this.ope[d].num==a&&this.disCombine==0&&((f=="cell"&&(e=="qnum"||(e=="qans"&&k.isAnsNumber)))||f=="cross")){this.ope[d].num=b}else{this.ope.push(new Operation(f,e,h,a,b));this.current++;if(this.chainflag==0){this.chainflag=1}}if(e!="qsub"&&e!="color"){this.anscount++}this.changeflag=true;this.enb_btn()},addObj:function(c,e){var a,d;if(c=="cell"){a=new Cell();d=bd.cell[e]}else{if(c=="cross"){a=new Cross();d=bd.cross[e]}else{if(c=="border"){a=new Border();d=bd.border[e]}else{if(c=="excell"){a=new Cell();d=bd.excell[e]}}}}for(var b in d){a[b]=d[b]}this.addOpe(c,c,e,a,null)},undo:function(){if(this.current==0){return}this.undoExec=true;this.range={x1:k.qcols+1,y1:k.qrows+1,x2:-2,y2:-2};this.disableRecord();while(this.current>0){this.exec(this.ope[this.current-1],this.ope[this.current-1].old);if(this.ope[this.current-1].property!="qsub"&&this.ope[this.current-1].property!="color"){this.anscount--}this.current--;if(!this.ope[this.current].chain){break}}this.postproc();this.undoExec=false;if(this.current==0){kc.inUNDO=false}},redo:function(){if(this.current==this.ope.length){return}this.redoExec=true;this.range={x1:k.qcols+1,y1:k.qrows+1,x2:-2,y2:-2};this.disableRecord();while(this.current<this.ope.length){this.exec(this.ope[this.current],this.ope[this.current].num);if(this.ope[this.current].property!="qsub"&&this.ope[this.current].property!="color"){this.anscount++}this.current++;if(this.current<this.ope.length&&!this.ope[this.current].chain){break}}this.postproc();this.redoExec=false;if(this.ope.length==0){kc.inREDO=false}},postproc:function(){if(this.reqReset){this.reqReset=false;base.resetInfo();base.resize_canvas()}this.enableRecord();this.enb_btn();pc.paint(this.range.x1,this.range.y1,this.range.x2,this.range.y2)},exec:function(c,b){var a=c.property;if(c.obj=="cell"){if(a=="ques"){bd.sQuC(c.id,b)}else{if(a=="qnum"){bd.sQnC(c.id,b)}else{if(a=="direc"){bd.sDiC(c.id,b)}else{if(a=="qans"){bd.sQaC(c.id,b)}else{if(a=="qsub"){bd.sQsC(c.id,b)}else{if(a=="numobj"){bd.cell[c.id].numobj=b}else{if(a=="numobj2"){bd.cell[c.id].numobj2=b}else{if(a=="cell"&&!!b){bd.cell[c.id]=b}}}}}}}}this.paintStack(bd.cell[c.id].cx,bd.cell[c.id].cy,bd.cell[c.id].cx,bd.cell[c.id].cy)}else{if(c.obj=="excell"){if(a=="qnum"){bd.sQnE(c.id,b)}else{if(a=="direc"){bd.sDiE(c.id,b)}else{if(a=="excell"&&!!b){bd.excell[c.id]=b}}}}else{if(c.obj=="cross"){if(a=="ques"){bd.sQuX(c.id,b)}else{if(a=="qnum"){bd.sQnX(c.id,b)}else{if(a=="numobj"){bd.cross[c.id].numobj=b}else{if(a=="cross"&&!!b){bd.cross[c.id]=b}}}}this.paintStack(bd.cross[c.id].cx-1,bd.cross[c.id].cy-1,bd.cross[c.id].cx,bd.cross[c.id].cy)}else{if(c.obj=="border"){if(a=="ques"){bd.sQuB(c.id,b)}else{if(a=="qnum"){bd.sQnB(c.id,b)}else{if(a=="qans"){bd.sQaB(c.id,b)}else{if(a=="qsub"){bd.sQsB(c.id,b)}else{if(a=="line"){bd.sLiB(c.id,b)}else{if(a=="border"&&!!b){bd.border[c.id]=b}}}}}}this.paintBorder(c.id)}else{if(c.obj=="board"){if(a=="expandup"){if(b==1){menu.ex.expand("up")}else{menu.ex.reduce("up")}}else{if(a=="expanddn"){if(b==1){menu.ex.expand("dn")}else{menu.ex.reduce("dn")}}else{if(a=="expandlt"){if(b==1){menu.ex.expand("lt")}else{menu.ex.reduce("lt")}}else{if(a=="expandrt"){if(b==1){menu.ex.expand("rt")}else{menu.ex.reduce("rt")}}else{if(a=="reduceup"){if(b==1){menu.ex.reduce("up")}else{menu.ex.expand("up")}}else{if(a=="reducedn"){if(b==1){menu.ex.reduce("dn")}else{menu.ex.expand("dn")}}else{if(a=="reducelt"){if(b==1){menu.ex.reduce("lt")}else{menu.ex.expand("lt")}}else{if(a=="reducert"){if(b==1){menu.ex.reduce("rt")}else{menu.ex.expand("rt")}}else{if(a=="flipy"){menu.ex.turnflip(1,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1})}else{if(a=="flipx"){menu.ex.turnflip(2,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1})}else{if(a=="turnr"){menu.ex.turnflip((b==1?3:4),{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1})}else{if(a=="turnl"){menu.ex.turnflip((b==1?4:3),{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1})}}}}}}}}}}}}this.range={x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1};this.reqReset=true}}}}}},paintBorder:function(a){if(isNaN(a)||!bd.border[a]){return}if(bd.border[a].cx%2==1){this.paintStack(mf((bd.border[a].cx-1)/2)-1,mf(bd.border[a].cy/2)-1,mf((bd.border[a].cx-1)/2)+1,mf(bd.border[a].cy/2))}else{this.paintStack(mf(bd.border[a].cx/2)-1,mf((bd.border[a].cy-1)/2)-1,mf(bd.border[a].cx/2),mf((bd.border[a].cy-1)/2)+1)}},paintStack:function(b,d,a,c){if(this.range.x1>b){this.range.x1=b}if(this.range.y1>d){this.range.y1=d}if(this.range.x2<a){this.range.x2=a}if(this.range.y2<c){this.range.y2=c}}};Caption=function(){this.menu="";this.label=""};MenuData=function(b,a){this.caption={ja:b,en:a};this.smenus=[]};Menu=function(){this.dispfloat=[];this.floatpanel=[];this.pop="";this.isptitle=0;this.offset=new Pos(0,0);this.btnstack=[];this.labelstack=[];this.ex=new MenuExec();this.language="ja"};Menu.prototype={menuinit:function(){this.buttonarea();this.menuarea();this.poparea();this.displayAll()},menureset:function(){this.dispfloat=[];this.floatpanel=[];this.pop="";this.btnstack=[];this.labelstack=[];this.popclose();this.menuclear();$("#popup_parent > .floatmenu").remove();$("#menupanel,#usepanel,#checkpanel").html("");if($("#btncolor2").length>0){$("#btncolor2").remove()}$("#btnclear2").nextAll().remove();$("#outbtnarea").remove();pp.reset()},menuarea:function(){this.addMenu("file","ƒtƒ@ƒCƒ‹","File");this.addMenu("edit","•ÒW","Edit");this.addMenu("disp","•\Ž¦","Display");this.addMenu("setting","Ý’è","Setting");this.addMenu("other","‚»‚Ì‘¼","Others");pp.setDefaultFlags();this.createFloats();$("#expression").html(base.expression.ja);if(k.callmode=="pplay"){$("#ms_newboard,#ms_urloutput").attr("class","smenunull")}if(k.callmode=="pplay"){$("#ms_adjust").attr("class","smenunull")}$("#ms_jumpv3,#ms_jumptop,#ms_jumpblog").css("font-size","10pt").css("padding-left","8pt");this.managearea()},addMenu:function(c,d,a){var b=newEL("div").attr("class","menu").attr("id","menu_"+c).appendTo($("#menupanel")).html("["+d+"]").css("margin-right","4pt").hover(this.menuhover.ebind(this,c),this.menuout.ebind(this));this.addLabels(b,"["+d+"]","["+a+"]")},menuhover:function(b,a){this.floatmenuopen(b,a,0);$("div.menusel").attr("class","menu");$(getSrcElement(b)).attr("class","menusel")},menuout:function(a){if(!this.insideOfMenu(a)){this.menuclear()}},menuclear:function(){$("div.menusel").attr("class","menu");$("div.smenusel").attr("class","smenu");$("#popup_parent > .floatmenu").hide();this.dispfloat=[]},submenuhover:function(b,a){if($(getSrcElement(b)).attr("class")=="smenu"){$(getSrcElement(b)).attr("class","smenusel")}if(pp.flags[a]&&pp.type(a)==1){this.floatmenuopen(b,a,this.dispfloat.length)}},submenuout:function(b,a){if($(getSrcElement(b)).attr("class")=="smenusel"){$(getSrcElement(b)).attr("class","smenu")}if(pp.flags[a]&&pp.type(a)==1){this.floatmenuout(b)}},submenuclick:function(b,a){if($(getSrcElement(b)).attr("class")=="smenunull"){return}this.menuclear();if(pp.type(a)==0){this.popclose();if(pp.funcs[a]){pp.funcs[a]()}if(this.pop){this.pop.css("left",mv.pointerX(b)-8+k.IEMargin.x).css("top",mv.pointerY(b)-8+k.IEMargin.y).css("visibility","visible")}}else{if(pp.type(a)==4){this.setVal(pp.flags[a].parent,pp.getVal(a))}else{if(pp.type(a)==2){this.setVal(a,!pp.getVal(a))}}}},checkclick:function(a){this.setVal(a,$("#ck_"+a).attr("checked"))},floatmenuopen:function(b,a,d){this.floatmenuclose(d);var c=$(getSrcElement(b));if(d==0||this.dispfloat[d-1]){if(d==0){this.floatpanel[a].css("left",c.offset().left-3+k.IEMargin.x).css("top",c.offset().top+c.height())}else{this.floatpanel[a].css("left",c.offset().left+c.width()).css("top",c.offset().top-3)}this.floatpanel[a].css("z-index",101+d).css("visibility","visible").show();this.dispfloat.push(a)}},floatmenuclose:function(b){if(b==0){this.menuclear();return}for(var a=this.dispfloat.length-1;a>=b;a--){if(this.dispfloat[a]){$("#ms_"+this.dispfloat[a]).attr("class","smenu");this.floatpanel[this.dispfloat[a]].hide();this.dispfloat.pop()}}},floatmenuout:function(b){for(var a=this.dispfloat.length-1;a>=0;a--){if(this.insideOf(this.floatpanel[this.dispfloat[a]],b)){this.floatmenuclose(a+1);return}}this.menuclear()},insideOf:function(d,c){var a=new Pos(d.offset().left,d.offset().top);var b=new Pos(mv.pointerX(c),mv.pointerY(c));return !(b.x<=a.x||b.x>=a.x+d.width()||b.y<=a.y||b.y>=a.y+d.height())},insideOfMenu:function(h){var d=$("#menu_file").offset().top;var b=$("#menu_file").offset().left;var f=$("#menu_other").offset().left+$("#menu_other").width();var c=mv.pointerX(h),a=mv.pointerY(h);return(c>b&&c<f&&a>d)},addUseToFlags:function(){pp.addUseToFlags("use","setting",1,[1,2]);pp.setMenuStr("use","‘€ì•û–@","Input Type");pp.setLabel("use","‘€ì•û–@","Input Type");pp.addUseChildrenToFlags("use","use");pp.setMenuStr("use_1","¶‰Eƒ{ƒ^ƒ“","LR Button");pp.setMenuStr("use_2","1ƒ{ƒ^ƒ“","One Button")},addRedLineToFlags:function(){pp.addCheckToFlags("dispred","setting",false);pp.setMenuStr("dispred","Œq‚ª‚èƒ`ƒFƒbƒN","Continuous Check");pp.setLabel("dispred","ü‚Ì‚Â‚È‚ª‚è‚ðƒ`ƒFƒbƒN‚·‚é","Check countinuous lines")},addRedBlockToFlags:function(){pp.addCheckToFlags("dispred","setting",false);pp.setMenuStr("dispred","Œq‚ª‚èƒ`ƒFƒbƒN","Continuous Check");pp.setLabel("dispred","•ƒ}ƒX‚Ì‚Â‚È‚ª‚è‚ðƒ`ƒFƒbƒN‚·‚é","Check countinuous black cells")},addRedBlockRBToFlags:function(){pp.addCheckToFlags("dispred","setting",false);pp.setMenuStr("dispred","Œq‚ª‚èƒ`ƒFƒbƒN","Continuous Check");pp.setLabel("dispred","ƒiƒiƒ•ƒ}ƒX‚Ì‚Â‚È‚ª‚è‚ðƒ`ƒFƒbƒN‚·‚é","Check countinuous black cells with its corner")},getVal:function(a){return pp.getVal(a)},setVal:function(a,b){pp.setVal(a,b)},setdisplay:function(d){if(pp.type(d)==0||pp.type(d)==3){if($("#ms_"+d)){$("#ms_"+d).html(pp.getMenuStr(d))}}else{if(pp.type(d)==1){if($("#ms_"+d)){$("#ms_"+d).html("&nbsp;"+pp.getMenuStr(d))}$("#cl_"+d).html(pp.getLabel(d));for(var c=0;c<pp.flags[d].child.length;c++){this.setdisplay(""+d+"_"+pp.flags[d].child[c])}}else{if(pp.type(d)==4){var e=(pp.getVal(d)==pp.getVal(pp.flags[d].parent));var b=pp.getMenuStr(d);$("#ms_"+d).html((e?"+":"&nbsp;")+b);$("#up_"+d).html(b).attr("class",e?"flagsel":"flag")}else{if(pp.type(d)==2){var a=pp.getVal(d);if($("#ms_"+d)){$("#ms_"+d).html((a?"+":"&nbsp;")+pp.getMenuStr(d))}$("#ck_"+d).attr("checked",a);$("#cl_"+d).html(pp.getLabel(d))}}}}},displayAll:function(){for(var a in pp.flags){this.setdisplay(a)}$.each(this.btnstack,function(b,c){c.el.attr("value",c.str[menu.language])});$.each(this.labelstack,function(b,c){c.el.html(c.str[menu.language])})},createFloats:function(){var d=0;for(var a=0;a<pp.flaglist.length;a++){var b=pp.flaglist[a];if(!pp.flags[b]){continue}var e=pp.flags[b].parent;var f=this.getFloatpanel(e);if(e=="setting"){if(d>0&&d!=pp.type(b)){$('<div class="smenusep">&nbsp;</div>').appendTo(f)}d=pp.type(b)}var c;if(pp.type(b)==5){c=$('<div class="smenusep">&nbsp;</div>')}else{if(pp.type(b)==3){c=newEL("span").css("color","white")}else{if(pp.type(b)==1){c=newEL("div").attr("class","smenu").css("font-weight","900").css("font-size","10pt").hover(this.submenuhover.ebind(this,b),this.submenuout.ebind(this,b));this.getFloatpanel(b)}else{c=newEL("div").attr("class","smenu").hover(this.submenuhover.ebind(this,b),this.submenuout.ebind(this,b)).click(this.submenuclick.ebind(this,b));if(pp.type(b)!=0){c.css("font-size","10pt").css("padding-left","6pt")}}}}c.attr("id","ms_"+b).appendTo(f);this.setdisplay(b)}this.floatpanel[e]=f},getFloatpanel:function(a){if(!this.floatpanel[a]){this.floatpanel[a]=newEL("div").attr("class","floatmenu").attr("id","float_"+a).appendTo($("#popup_parent")).css("background-color",base.floatbgcolor).css("z-index",101).mouseout(this.floatmenuout.ebind(this)).hide()}return this.floatpanel[a]},managearea:function(){for(var e=0;e<pp.flaglist.length;e++){var d=pp.flaglist[e];if(!pp.flags[d]||!pp.getLabel(d)){continue}if(pp.type(d)==1){$("#usepanel").append('<span id="cl_'+d+'">'+pp.getLabel(d)+"</span> |&nbsp;");for(var b=0;b<pp.flags[d].child.length;b++){var a=pp.flags[d].child[b];var c=newEL("div").attr("class",((a==pp.getVal(d))?"flagsel":"flag")).attr("id","up_"+d+"_"+a).html(pp.getMenuStr(""+d+"_"+a)).appendTo($("#usepanel")).click(pp.setVal.bind(pp,d,a)).unselectable();$("#usepanel").append(" ")}$("#usepanel").append("<br>\n")}else{if(pp.type(d)==2){$("#checkpanel").append('<input type="checkbox" id="ck_'+d+'"'+(pp.getVal(d)?" checked":"")+"> ").append('<span id="cl_'+d+'"> '+pp.getLabel(d)+"</span>");if(d=="irowake"){$("#checkpanel").append('<input type=button id="ck_irowake2" value="F•ª‚¯‚µ‚È‚¨‚·" onClick="javascript:menu.ex.irowakeRemake();">');this.addButtons($("#ck_irowake2"),"F•ª‚¯‚µ‚È‚¨‚·","Change the color of Line")}$("#checkpanel").append("<br>\n");$("#ck_"+d).click(this.checkclick.bind(this,d))}}}$("#translation").css("position","absolute").css("cursor","pointer").css("font-size","10pt").css("color","green").css("background-color","#dfdfdf").click(this.translate.bind(this)).unselectable();if(k.callmode=="pmake"){$("#timerpanel,#separator2").hide()}if(k.irowake!=0){$("#btnarea").append('<input type="button" id="btncolor2" value="F•ª‚¯‚µ‚È‚¨‚·">');$("#btncolor2").click(menu.ex.irowakeRemake).hide();menu.addButtons($("#btncolor2"),"F•ª‚¯‚µ‚È‚¨‚·","Change the color of Line")}},poparea:function(){var self=this;var popupfunc=function(){$(this).mousedown(self.titlebardown.ebind(self)).mouseup(self.titlebarup.ebind(self)).mouseout(self.titlebarout.ebind(self)).mousemove(self.titlebarmove.ebind(self)).unselectable()};$("div.titlebar,#credir3_1").each(popupfunc);var px=this.popclose.ebind(this);$(document.newboard.newboard).click(this.ex.newboard.ebind(this.ex));$(document.newboard.cancel).click(px);$(document.urlinput.urlinput).click(this.ex.urlinput.ebind(this.ex));$(document.urlinput.cancel).click(px);$(document.urloutput.ta).before(newEL("div").attr("id","outbtnarea"));var ib=function(name,strJP,strEN,eval){if(!eval){return}var btn=newEL("input").attr("type","button").attr("name",name).click(this.ex.urloutput.ebind(this.ex));$("#outbtnarea").append(btn).append("<br>");this.addButtons(btn,strJP,strEN)}.bind(this);ib("pzprv3","‚Ï‚¸‚Õ‚êv3‚ÌURL‚ðo—Í‚·‚é","Output PUZ-PRE v3 URL",true);ib("pzprapplet","‚Ï‚¸‚Õ‚ê(ƒAƒvƒŒƒbƒg)‚ÌURL‚ðo—Í‚·‚é","Output PUZ-PRE(JavaApplet) URL",!k.ispzprv3ONLY);ib("kanpen","ƒJƒ“ƒyƒ“‚ÌURL‚ðo—Í‚·‚é","Output Kanpen URL",k.isKanpenExist);ib("heyaapp","‚Ö‚â‚í‚¯ƒAƒvƒŒƒbƒg‚ÌURL‚ðo—Í‚·‚é","Output Heyawake-Applet URL",(k.puzzleid=="heyawake"));ib("pzprv3edit","‚Ï‚¸‚Õ‚êv3‚ÌÄ•ÒW—pURL‚ðo—Í‚·‚é","Output PUZ-PRE v3 Re-Edit URL",true);$("#outbtnarea").append("<br>\n");$(document.urloutput.openurl).click(this.ex.openurl.ebind(this.ex));$(document.urloutput.close).click(px);this.addButtons($(document.urloutput.openurl),"‚±‚ÌURL‚ðŠJ‚­","Open this URL on another window/tab");this.addButtons($(document.urloutput.close),"•Â‚¶‚é","Close");$(document.fileform.filebox).change(this.ex.fileopen.ebind(this.ex));$(document.fileform.close).click(px);$(document.database.sorts).change(fio.displayDataTableList.ebind(fio));$(document.database.datalist).change(fio.selectDataTable.ebind(fio));$(document.database.tableup).click(fio.upDataTable.ebind(fio));$(document.database.tabledn).click(fio.downDataTable.ebind(fio));$(document.database.open).click(fio.openDataTable.ebind(fio));$(document.database.save).click(fio.saveDataTable.ebind(fio));$(document.database.comedit).click(fio.editComment.ebind(fio));$(document.database.difedit).click(fio.editDifficult.ebind(fio));$(document.database.del).click(fio.deleteDataTable.ebind(fio));$(document.database.close).click(px);var pa=this.ex.popupadjust.ebind(this.ex);$(document.adjust.expandup).click(pa);$(document.adjust.expanddn).click(pa);$(document.adjust.expandlt).click(pa);$(document.adjust.expandrt).click(pa);$(document.adjust.reduceup).click(pa);$(document.adjust.reducedn).click(pa);$(document.adjust.reducelt).click(pa);$(document.adjust.reducert).click(pa);$(document.adjust.close).click(px);$(document.flip.turnl).click(pa);$(document.flip.turnr).click(pa);$(document.flip.flipy).click(pa);$(document.flip.flipx).click(pa);$(document.flip.close).click(px);$(document.credit.close).click(px);$(document.dispsize.dispsize).click(this.ex.dispsize.ebind(this));$(document.dispsize.cancel).click(px)},popclose:function(){if(this.pop){this.pop.css("visibility","hidden");this.pop="";this.menuclear();this.isptitle=0;k.enableKey=true}},titlebardown:function(a){this.isptitle=1;this.offset.x=mv.pointerX(a)-parseInt(this.pop.css("left"));this.offset.y=mv.pointerY(a)-parseInt(this.pop.css("top"))},titlebarup:function(a){this.isptitle=0},titlebarout:function(a){if(this.pop&&!this.insideOf(this.pop,a)){this.isptitle=0}},titlebarmove:function(a){if(this.pop&&this.isptitle){this.pop.css("left",(mv.pointerX(a)-this.offset.x));this.pop.css("top",(mv.pointerY(a)-this.offset.y))}},buttonarea:function(){this.addButtons($("#btncheck").click(ans.check.bind(ans)),"ƒ`ƒFƒbƒN","Check");this.addButtons($("#btnundo").click(um.undo.bind(um)),"–ß","<-");this.addButtons($("#btnredo").click(um.redo.bind(um)),"i","->");this.addButtons($("#btnclear").click(menu.ex.ACconfirm.bind(menu.ex)),"‰ñ“šÁ‹Ž","Erase Answer");this.addButtons($("#btnclear2").click(menu.ex.ASconfirm.bind(menu.ex)),"•â•Á‹Ž","Erase Auxiliary Marks");$("#btnarea,#btnundo,#btnredo,#btnclear,#btnclear2").unselectable();this.setDefaultButtons();this.setDefaultLabels()},addButtons:function(b,c,a){this.btnstack.push({el:b,str:{ja:c,en:a}})},addLabels:function(b,c,a){this.labelstack.push({el:b,str:{ja:c,en:a}})},setDefaultButtons:function(){var a=this.addButtons.bind(this);a($(document.newboard.newboard),"V‹Kì¬","Create");a($(document.newboard.cancel),"ƒLƒƒƒ“ƒZƒ‹","Cancel");a($(document.urlinput.urlinput),"“Ç‚Ýž‚Þ","Import");a($(document.urlinput.cancel),"ƒLƒƒƒ“ƒZƒ‹","Cancel");a($(document.fileform.button),"•Â‚¶‚é","Close");a($(document.database.save),"”Õ–Ê‚ð•Û‘¶","Save");a($(document.database.comedit),"ƒRƒƒ“ƒg‚ð•ÒW‚·‚é","Edit Comment");a($(document.database.difedit),"“ïˆÕ“x‚ðÝ’è‚·‚é","Set difficulty");a($(document.database.open),"ƒf[ƒ^‚ð“Ç‚Ýž‚Þ","Load");a($(document.database.del),"íœ","Delete");a($(document.database.close),"•Â‚¶‚é","Close");a($(document.adjust.expandup),"ã","UP");a($(document.adjust.expanddn),"‰º","Down");a($(document.adjust.expandlt),"¶","Left");a($(document.adjust.expandrt),"‰E","Right");a($(document.adjust.reduceup),"ã","UP");a($(document.adjust.reducedn),"‰º","Down");a($(document.adjust.reducelt),"¶","Left");a($(document.adjust.reducert),"‰E","Right");a($(document.adjust.close),"•Â‚¶‚é","Close");a($(document.flip.turnl),"¶90‹‰ñ“]","Turn left by 90 degree");a($(document.flip.turnr),"‰E90‹‰ñ“]","Turn right by 90 degree");a($(document.flip.flipy),"ã‰º”½“]","Flip upside down");a($(document.flip.flipx),"¶‰E”½“]","Flip leftside right");a($(document.flip.close),"•Â‚¶‚é","Close");a($(document.dispsize.dispsize),"•ÏX‚·‚é","Change");a($(document.dispsize.cancel),"ƒLƒƒƒ“ƒZƒ‹","Cancel");a($(document.credit.close),"•Â‚¶‚é","OK")},setDefaultLabels:function(){var a=this.addLabels.bind(this);a($("#translation"),"English","“ú–{Œê");a($("#bar1_1"),"&nbsp;”Õ–Ê‚ÌV‹Kì¬","&nbsp;Createing New Board");a($("#pop1_1_cap0"),"”Õ–Ê‚ðV‹Kì¬‚µ‚Ü‚·B","Create New Board.");a($("#pop1_1_cap1"),"‚æ‚±","Cols");a($("#pop1_1_cap2"),"‚½‚Ä","Rows");a($("#bar1_2"),"&nbsp;URL“ü—Í","&nbsp;Import from URL");a($("#pop1_2_cap0"),"URL‚©‚ç–â‘è‚ð“Ç‚Ýž‚Ý‚Ü‚·B","Import a question from URL.");a($("#bar1_3"),"&nbsp;URLo—Í","&nbsp;Export URL");a($("#bar1_4"),"&nbsp;ƒtƒ@ƒCƒ‹‚ðŠJ‚­","&nbsp;Open file");a($("#pop1_4_cap0"),"ƒtƒ@ƒCƒ‹‘I‘ð","Choose file");a($("#bar1_8"),"&nbsp;ƒf[ƒ^ƒx[ƒX‚ÌŠÇ—","&nbsp;Database Management");a($("#pop1_8_com"),"ƒRƒƒ“ƒg:","Comment:");a($("#bar2_1"),"&nbsp;”Õ–Ê‚Ì’²®","&nbsp;Adjust the board");a($("#pop2_1_cap0"),"”Õ–Ê‚Ì’²®‚ðs‚¢‚Ü‚·B","Adjust the board.");a($("#pop2_1_cap1"),"Šg‘å","Expand");a($("#pop2_1_cap2"),"k¬","Reduce");a($("#bar2_2"),"&nbsp;”½“]E‰ñ“]","&nbsp;Flip/Turn the board");a($("#pop2_2_cap0"),"”Õ–Ê‚Ì‰ñ“]E”½“]‚ðs‚¢‚Ü‚·B","Flip/Turn the board.");a($("#bar4_1"),"&nbsp;•\Ž¦ƒTƒCƒY‚Ì•ÏX","&nbsp;Change size");a($("#pop4_1_cap0"),"•\Ž¦ƒTƒCƒY‚ð•ÏX‚µ‚Ü‚·B","Change the display size.");a($("#pop4_1_cap1"),"•\Ž¦ƒTƒCƒY","Display size");a($("#bar3_1"),"&nbsp;credit","&nbsp;credit");a($("#credit3_1"),"‚Ï‚¸‚Õ‚êv3 "+pzprversion+"<br>\n<br>\n‚Ï‚¸‚Õ‚êv3‚Í ‚Í‚Á‚Ï/˜A‘±”­”j‚ªì¬‚µ‚Ä‚¢‚Ü‚·B<br>\nƒ‰ƒCƒuƒ‰ƒŠ‚Æ‚µ‚ÄjQuery1.3.2, uuCanvas1.0, <br>Google Gears‚ð\nŽg—p‚µ‚Ä‚¢‚Ü‚·B<br>\n<br>\n","PUZ-PRE v3 "+pzprversion+"<br>\n<br>\nPUZ-PRE v3 id made by happa.<br>\nThis script use jQuery1.3.2, uuCanvas1.0, <br>Google Gears as libraries.<br>\n<br>\n")},isLangJP:function(){return this.language=="ja"},isLangEN:function(){return this.language=="en"},setLang:function(a){(a=="ja")?this.setLangJP():this.setLangEN()},translate:function(){(this.isLangJP())?this.setLangEN():this.setLangJP()},setLangJP:function(){this.setLangStr("ja")},setLangEN:function(){this.setLangStr("en")},setLangStr:function(a){this.language=a;document.title=base.gettitle();$("#title2").html(base.gettitle());$("#expression").html(base.expression[this.language]);this.displayAll();this.ex.dispmanstr();base.resize_canvas()}};SSData=function(){this.id="";this.type=0;this.val=1;this.parent=1;this.child=[];this.str={ja:new Caption(),en:new Caption()}};Properties=function(){this.flags=[];this.flaglist=[]};Properties.prototype={reset:function(){this.flags=[];this.flaglist=[]},addSmenuToFlags:function(b,a){this.addToFlags(b,a,0,0)},addCheckToFlags:function(b,a,c){this.addToFlags(b,a,2,c)},addCaptionToFlags:function(b,a){this.addToFlags(b,a,3,0)},addSeparatorToFlags:function(b,a){this.addToFlags(b,a,5,0)},addUseToFlags:function(b,a,c,d){this.addToFlags(b,a,1,c);this.flags[b].child=d},addUseChildrenToFlags:function(d,c){if(!this.flags[d]){return}for(var b=0;b<this.flags[d].child.length;b++){var a=this.flags[d].child[b];this.addToFlags(""+d+"_"+a,c,4,a)}},addToFlags:function(c,b,a,d){this.flags[c]=new SSData();this.flags[c].id=c;this.flags[c].type=a;this.flags[c].val=d;this.flags[c].parent=b;this.flaglist.push(c)},setMenuStr:function(b,c,a){if(!this.flags[b]){return}this.flags[b].str.ja.menu=c;this.flags[b].str.en.menu=a},setLabel:function(b,c,a){if(!this.flags[b]){return}this.flags[b].str.ja.label=c;this.flags[b].str.en.label=a},getMenuStr:function(a){return this.flags[a].str[menu.language].menu},getLabel:function(a){return this.flags[a].str[menu.language].label},type:function(a){return this.flags[a].type},getVal:function(a){return this.flags[a]?this.flags[a].val:0},setVal:function(a,b){if(!this.flags[a]){return}else{if(this.type(a)==1||this.type(a)==2){this.flags[a].val=b;menu.setdisplay(a);if(this.funcs[a]){this.funcs[a](b)}}}},setDefaultFlags:function(){var b=this.addSmenuToFlags.bind(this),f=this.addUseToFlags.bind(this),d=this.addCheckToFlags.bind(this),e=this.addCaptionToFlags.bind(this),a=this.addUseChildrenToFlags.bind(this),c=this.addSeparatorToFlags.bind(this);f("mode","setting",k.mode,[1,3]);puz.menufix();d("autocheck","setting",k.autocheck);d("lrcheck","setting",false);d("keypopup","setting",kp.defaultdisp);f("language","setting",0,[0,1]);if(k.callmode=="pplay"){delete this.flags.mode}if(!kp.ctl[1].enable&&!kp.ctl[3].enable){delete this.flags.keypopup}b("newboard","file");b("urlinput","file");b("urloutput","file");c("sep_2","file");b("fileopen","file");b("filesave","file");b("database","file");c("sep_3","file");b("fileopen2","file");b("filesave2","file");if(fio.DBtype==0){delete this.flags.database}if(!k.isKanpenExist||(k.puzzleid=="nanro"||k.puzzleid=="ayeheya"||k.puzzleid=="kurochute")){delete this.flags.fileopen2;delete this.flags.filesave2;delete this.flags.sep_3}b("adjust","edit");b("turn","edit");f("size","disp",k.widthmode,[0,1,2,3,4]);c("sep_4","disp");d("irowake","disp",(k.irowake==2?true:false));c("sep_5","disp");b("manarea","disp");if(k.irowake==0){delete this.flags.irowake;delete this.flags.sep_4}b("dispsize","size");e("cap_dispmode","size");a("size","size");a("mode","mode");a("language","language");b("credit","other");e("cap_others1","other");b("jumpv3","other");b("jumptop","other");b("jumpblog","other");this.setStringToFlags()},setStringToFlags:function(){var b=this.setMenuStr.bind(this),a=this.setLabel.bind(this);b("size","•\Ž¦ƒTƒCƒY","Cell Size");b("size_0","ƒTƒCƒY ‹É¬","Ex Small");b("size_1","ƒTƒCƒY ¬","Small");b("size_2","ƒTƒCƒY •W€","Normal");b("size_3","ƒTƒCƒY ‘å","Large");b("size_4","ƒTƒCƒY “Á‘å","Ex Large");b("irowake","ü‚ÌF•ª‚¯","Color coding");a("irowake","ü‚ÌF•ª‚¯‚ð‚·‚é","Color each lines");b("mode","ƒ‚[ƒh","mode");a("mode","ƒ‚[ƒh","mode");b("mode_1","–â‘èì¬ƒ‚[ƒh","Edit mode");b("mode_3","‰ñ“šƒ‚[ƒh","Answer mode");b("autocheck","³“šŽ©“®”»’è","Auto Answer Check");b("lrcheck","ƒ}ƒEƒX¶‰E”½“]","Mouse button inversion");a("lrcheck","ƒ}ƒEƒX‚Ì¶‰Eƒ{ƒ^ƒ“‚ð”½“]‚·‚é","Invert button of the mouse");b("keypopup","ƒpƒlƒ‹“ü—Í","Panel inputting");a("keypopup","”ŽšE‹L†‚ðƒpƒlƒ‹‚Å“ü—Í‚·‚é","Input numbers by panel");b("language","Œ¾Œê","Language");b("language_0","“ú–{Œê","“ú–{Œê");b("language_1","English","English");b("newboard","V‹Kì¬","New Board");b("urlinput","URL“ü—Í","Import from URL");b("urloutput","URLo—Í","Export URL");b("fileopen","ƒtƒ@ƒCƒ‹‚ðŠJ‚­","Open the file");b("filesave","ƒtƒ@ƒCƒ‹•Û‘¶","Save the file as ...");b("database","ƒf[ƒ^ƒx[ƒX‚ÌŠÇ—","Database Management");b("fileopen2","pencilbox‚Ìƒtƒ@ƒCƒ‹‚ðŠJ‚­","Open the pencilbox file");b("filesave2","pencilbox‚Ìƒtƒ@ƒCƒ‹‚ð•Û‘¶","Save the pencilbox file as ...");b("adjust","”Õ–Ê‚Ì’²®","Adjust the Board");b("turn","”½“]E‰ñ“]","Filp/Turn the Board");b("dispsize","ƒTƒCƒYŽw’è","Cell Size");b("cap_dispmode","&nbsp;•\Ž¦ƒ‚[ƒh","&nbsp;Display mode");b("manarea","ŠÇ——Ìˆæ‚ð‰B‚·","Hide Management Area");b("credit","‚Ï‚¸‚Õ‚êv3‚É‚Â‚¢‚Ä","About PUZ-PRE v3");b("cap_others1","&nbsp;ƒŠƒ“ƒN","&nbsp;Link");b("jumpv3","‚Ï‚¸‚Õ‚êv3‚Ìƒy[ƒW‚Ö","Jump to PUZ-PRE v3 page");b("jumptop","˜A‘±”­”j•ÛŠÇŒÉTOP‚Ö","Jump to indi.s58.xrea.com");b("jumpblog","‚Í‚Á‚Ï“ú‹L(blog)‚Ö","Jump to my blog");b("eval","ƒeƒXƒg—p","for Evaluation")},funcs:{urlinput:function(){menu.pop=$("#pop1_2")},urloutput:function(){menu.pop=$("#pop1_3");document.urloutput.ta.value=""},filesave:function(){menu.ex.filesave()},database:function(){menu.pop=$("#pop1_8");fio.getDataTableList()},filesave2:function(){if(fio.kanpenSave){menu.ex.filesave2()}},adjust:function(){menu.pop=$("#pop2_1")},turn:function(){menu.pop=$("#pop2_2")},credit:function(){menu.pop=$("#pop3_1")},jumpv3:function(){window.open("./","","")},jumptop:function(){window.open("../../","","")},jumpblog:function(){window.open("http://d.hatena.ne.jp/sunanekoroom/","","")},irowake:function(){menu.ex.irowakeRemake()},manarea:function(){menu.ex.dispman()},autocheck:function(a){k.autocheck=!k.autocheck},mode:function(a){menu.ex.modechange(a)},size:function(a){k.widthmode=a;base.resize_canvas()},use:function(a){k.use=a},language:function(a){menu.setLang({0:"ja",1:"en"}[a])},newboard:function(){menu.pop=$("#pop1_1");if(k.puzzleid!="sudoku"){document.newboard.col.value=k.qcols;document.newboard.row.value=k.qrows}k.enableKey=false},fileopen:function(){document.fileform.pencilbox.value="0";if(k.br.IE||k.br.Gecko||k.br.Opera){if(!menu.pop){menu.pop=$("#pop1_4")}}else{if(!menu.pop){document.fileform.filebox.click()}}},fileopen2:function(){if(!fio.kanpenOpen){return}document.fileform.pencilbox.value="1";if(k.br.IE||k.br.Gecko||k.br.Opera){if(!menu.pop){menu.pop=$("#pop1_4")}}else{if(!menu.pop){document.fileform.filebox.click()}}},dispsize:function(){menu.pop=$("#pop4_1");document.dispsize.cs.value=k.def_csize;k.enableKey=false},keypopup:function(){var a=kp.ctl[k.mode].enable;$("#ck_keypopup").attr("disabled",a?"":"true");$("#cl_keypopup").css("color",a?"black":"silver")}}};MenuExec=function(){this.displaymanage=true;this.qnumw;this.qnumh;this.qnums};MenuExec.prototype={modechange:function(a){k.mode=a;kc.prev=-1;ans.errDisp=true;bd.errclear();if(kp.ctl[1].enable||kp.ctl[3].enable){pp.funcs.keypopup()}tc.setAlign();pc.paintAll()},newboard:function(b){if(menu.pop){var a,c;if(k.puzzleid!="sudoku"){a=mf(parseInt(document.newboard.col.value));c=mf(parseInt(document.newboard.row.value))}else{if(document.newboard.size[0].checked){a=c=9}else{if(document.newboard.size[1].checked){a=c=16}else{if(document.newboard.size[2].checked){a=c=25}else{if(document.newboard.size[3].checked){a=c=4}}}}}if(a>0&&c>0){this.newboard2(a,c)}menu.popclose();base.resize_canvas()}},newboard2:function(a,c){for(var d=k.qcols*k.qrows-1;d>=a*c;d--){if(bd.cell[d].numobj){bd.cell[d].numobj.remove()}if(bd.cell[d].numobj2){bd.cell[d].numobj2.remove()}delete bd.cell[d];bd.cell.pop()}if(k.iscross){for(var d=(k.qcols+1)*(k.qrows+1)-1;d>=(a+1)*(c+1);d--){if(bd.cross[d].numobj){bd.cross[d].numobj.remove()}delete bd.cross[d];bd.cross.pop()}}if(k.isborder){for(var d=this.bdcnt(k.qcols,k.qrows)-1;d>=this.bdcnt(a,c);d--){if(bd.border[d].numobj){bd.border[d].numobj.remove()}delete bd.border[d];bd.border.pop();bd.borders.pop()}}if(k.isextendcell==1){for(var d=k.qcols+k.qrows;d>=a+c+1;d--){if(bd.excell[d].numobj){bd.excell[d].numobj.remove()}if(bd.excell[d].numobj2){bd.excell[d].numobj2.remove()}delete bd.excell[d];bd.excell.pop()}}else{if(k.isextendcell==2){for(var d=2*k.qcols+2*k.qrows+3;d>=2*a+2*c+4;d--){if(bd.excell[d].numobj){bd.excell[d].numobj.remove()}if(bd.excell[d].numobj2){bd.excell[d].numobj2.remove()}delete bd.excell[d];bd.excell.pop()}}}for(var b=k.qcols*k.qrows;b<a*c;b++){bd.cell.push(new Cell())}if(k.iscross){for(var b=(k.qcols+1)*(k.qrows+1);b<(a+1)*(c+1);b++){bd.cross.push(new Cross())}}if(k.isborder){for(var b=this.bdcnt(k.qcols,k.qrows);b<this.bdcnt(a,c);b++){bd.border.push(new Border());bd.borders[b]=b}}if(k.isextendcell==1){for(var b=k.qcols+k.qrows+1;b<a+c+1;b++){bd.excell.push(new Cell())}}if(k.isextendcell==2){for(var b=2*k.qcols+2*k.qrows+4;b<2*a+2*c+4;b++){bd.excell.push(new Cell())}}if(k.puzzleid=="icebarn"){if(bd.arrowin<k.qcols+bd.bdinside){if(bd.arrowin>a+bd.bdinside){bd.arrowin=a+bd.bdinside-1}}else{if(bd.arrowin>a+c+bd.bdinside){bd.arrowin=a+c+bd.bdinside-1}}if(bd.arrowout<k.qcols+bd.bdinside){if(bd.arrowout>a+bd.bdinside){bd.arrowout=a+bd.bdinside-1}}else{if(bd.arrowout>a+c+bd.bdinside){bd.arrowout=a+c+bd.bdinside-1}}if(bd.arrowin==bd.arrowout){bd.arrowin--}}if(k.puzzleid=="slalom"){bd.startid=0;bd.hinfo.init()}tc.maxx+=(a-k.qcols)*2;tc.maxy+=(c-k.qrows)*2;k.qcols=a;k.qrows=c;for(var b=0;b<bd.cell.length;b++){bd.cell[b].allclear(b)}if(k.iscross){for(var b=0;b<bd.cross.length;b++){bd.cross[b].allclear(b)}}if(k.isborder){for(var b=0;b<bd.border.length;b++){bd.border[b].allclear(b)}}if(k.isextendcell!=0){for(var b=0;b<bd.excell.length;b++){bd.excell[b].allclear()}}um.allerase();bd.setposAll();base.resetInfo()},bdcnt:function(a,b){return 2*a*b+(k.isoutsideborder==0?-(a+b):(a+b))},urlinput:function(a){if(menu.pop){enc.parseURI(document.urlinput.ta.value);if(enc.uri.cols&&enc.uri.rows){this.newboard2(enc.uri.cols,enc.uri.rows)}enc.pzlinput();tm.reset();menu.popclose()}},urloutput:function(a){if(menu.pop){switch(getSrcElement(a).name){case"pzprv3":enc.pzlexport(0);break;case"pzprapplet":enc.pzlexport(1);break;case"kanpen":enc.pzlexport(2);break;case"pzprv3edit":enc.pzlexport(3);break;case"heyaapp":enc.pzlexport(4);break}}},openurl:function(b){if(menu.pop){if(document.urloutput.ta.value!=""){var a=window.open(document.urloutput.ta.value,"","")}}},fileopen:function(a){if(menu.pop){menu.popclose()}if(document.fileform.filebox.value){document.fileform.submit();document.fileform.filebox.value="";tm.reset()}},filesave:function(a){fio.filesave(1)},filesave2:function(a){fio.filesave(2)},dispsize:function(b){if(menu.pop){var a=parseInt(document.dispsize.cs.value);if(a>0){k.def_psize=mf(a*(k.def_psize/k.def_csize));if(k.def_psize==0){k.def_psize=1}k.def_csize=mf(a)}menu.popclose();base.resize_canvas()}},irowakeRemake:function(){if(!menu.getVal("irowake")){return}for(var b=1;b<=line.data.max;b++){var c=line.data[b].idlist;if(c.length>0){var a=pc.getNewLineColor();for(n=0;n<c.length;n++){bd.border[c[n]].color=a}}}pc.paint(0,0,k.qcols-1,k.qrows-1)},dispman:function(c){var d=["expression","usepanel","checkpanel"];var b=(k.callmode=="pmake")?["separator1"]:["separator1","separator2"];if(this.displaymanage){for(var a=0;a<d.length;a++){$("#"+d[a]).hide(800,base.resize_canvas.bind(base))}for(var a=0;a<b.length;a++){$("#"+b[a]).hide()}if(k.irowake!=0&&menu.getVal("irowake")){$("#btncolor2").show()}$("#menuboard").css("padding-bottom","0pt")}else{for(var a=0;a<d.length;a++){$("#"+d[a]).show(800,base.resize_canvas.bind(base))}for(var a=0;a<b.length;a++){$("#"+b[a]).show()}if(k.irowake!=0&&menu.getVal("irowake")){$("#btncolor2").hide()}$("#menuboard").css("padding-bottom","8pt")}this.displaymanage=!this.displaymanage;this.dispmanstr()},dispmanstr:function(){if(!this.displaymanage){$("#ms_manarea").html(menu.isLangJP()?"ŠÇ——Ìˆæ‚ð•\Ž¦":"Show management area")}else{$("#ms_manarea").html(menu.isLangJP()?"ŠÇ——Ìˆæ‚ð‰B‚·":"Hide management area")}},popupadjust:function(b){if(menu.pop){um.newOperation(true);var a=getSrcElement(b).name;if(a.indexOf("reduce")==0){if(a=="reduceup"||a=="reducedn"){if(k.qrows<=1){return}}else{if(a=="reducelt"||a=="reducedn"){if(k.qcols<=1&&k.puzzleid!="tawa"){return}else{if(k.qcols<=1&&k.puzzleid=="tawa"&&bd.lap!=3){return}}}}}switch(a){case"expandup":this.expand("up");break;case"expanddn":this.expand("dn");break;case"expandlt":this.expand("lt");break;case"expandrt":this.expand("rt");break;case"reduceup":this.reduce("up");break;case"reducedn":this.reduce("dn");break;case"reducelt":this.reduce("lt");break;case"reducert":this.reduce("rt");break;case"turnl":this.turnflip(4,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});break;case"turnr":this.turnflip(3,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});break;case"flipy":this.turnflip(1,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});break;case"flipx":this.turnflip(2,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});break}um.addOpe("board",a,0,0,1);base.resetInfo();base.resize_canvas()}},expand:function(d){this.adjustSpecial(5,d);this.adjustGeneral(5,"",{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});var f;if(d=="up"||d=="dn"){f=k.qcols;k.qrows++;tc.maxy+=2}else{if(d=="lt"||d=="rt"){f=k.qrows;k.qcols++;tc.maxx+=2}}var e;e=function(h){return(menu.ex.distObj(d,"cell",h)==0)};this.expandGroup("cell",bd.cell,f,e);if(k.iscross){var b=k.isoutsidecross?0:1;e=function(h){return(menu.ex.distObj(d,"cross",h)==b)};this.expandGroup("cross",bd.cross,f+1,e)}if(k.isborder){bd.bdinside=2*k.qcols*k.qrows-(k.qcols+k.qrows);e=function(i){var h=menu.ex.distObj(d,"border",i);return(h==1||h==2)};this.expandGroup("border",bd.border,2*f+(k.isoutsideborder==0?-1:1),e);for(var a=bd.border.length,c=a-(2*f+(k.isoutsideborder==0?-1:1));c<a;c++){bd.borders[c]=c}if(k.isborderAsLine==0){this.expandborder(d)}else{this.expandborderAsLine(d)}}if(k.isextendcell!=0){e=function(h){return(menu.ex.distObj(d,"excell",h)==0)};this.expandGroup("excell",bd.excell,k.isextendcell,e)}bd.setposAll();this.adjustSpecial2(5,d)},expandGroup:function(d,f,e,c){for(var a=f.length,b=a;b<a+e;b++){f.push(this.getnewObj(d,b))}this.setposObj(d);for(var b=f.length-1;b>=0;b--){if(c(b)){f[b]=this.getnewObj(d,b);e--}else{if(e>0){f[b]=f[b-e]}}}},reduce:function(c){this.adjustSpecial(6,c);this.adjustGeneral(6,"",{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});var d,e;this.qnums=[];d=function(f){return(menu.ex.distObj(c,"cell",f)==0)};e=this.reduceGroup("cell",bd.cell,d);if(k.iscross){var a=k.isoutsidecross?0:1;d=function(f){return(menu.ex.distObj(c,"cross",f)==a)};e=this.reduceGroup("cross",bd.cross,d)}if(k.isborder){if(k.isborderAsLine==1){this.reduceborderAsLine(c)}if(c=="up"||c=="dn"){bd.bdinside=2*k.qcols*(k.qrows-1)-(k.qcols+k.qrows-1)}else{if(c=="lt"||c=="rt"){bd.bdinside=2*(k.qcols-1)*k.qrows-(k.qcols+k.qrows-1)}}d=function(h){var f=menu.ex.distObj(c,"border",h);return(f==1||f==2)};e=this.reduceGroup("border",bd.border,d);for(var b=0;b<e;b++){bd.borders.pop()}}if(k.isextendcell!=0){d=function(f){return(menu.ex.distObj(c,"excell",f)==0)};e=this.reduceGroup("excell",bd.excell,d)}if(c=="up"||c=="dn"){k.qrows--;tc.maxy-=2}else{if(c=="lt"||c=="rt"){k.qcols--;tc.maxx-=2}}bd.setposAll();if(k.isOneNumber){area.resetArea();for(var b=0;b<this.qnums.length;b++){bd.cell[area.getTopOfRoom(this.qnums[b].areaid)].qnum=this.qnums[b].val}}this.adjustSpecial2(6,c)},reduceGroup:function(c,e,a){var d=0;for(var b=0;b<e.length;b++){if(a(b)){bd.hideNumobj(c,b);if(!bd.isNullObj(c,b)){um.addObj(c,b)}d++;if(c=="cell"&&k.isOneNumber){if(bd.QnC(b)!=-1){this.qnums.push({areaid:area.getRoomID(b),val:bd.QnC(b)})}area.setRoomID(b,-1)}}else{if(d>0){e[b-d]=e[b]}}}for(var b=0;b<d;b++){e.pop()}return d},turnflip:function(e,h){h.xx=(h.x1+h.x2);h.yy=(h.y1+h.y2);this.adjustSpecial(e,"");this.adjustGeneral(e,"",h);if(e==3||e==4){var b=k.qcols;k.qcols=k.qrows;k.qrows=b;b=tc.maxx;tc.maxx=tc.maxy;tc.maxy=b;bd.setposAll()}var f;if(e==1){f=function(c,l){return bd.cnum(bd.cell[l].cx,c.yy-bd.cell[l].cy)}}else{if(e==2){f=function(c,l){return bd.cnum(c.xx-bd.cell[l].cx,bd.cell[l].cy)}}else{if(e==3){f=function(c,l){return bd.cnum2(bd.cell[l].cy,c.yy-bd.cell[l].cx,k.qrows,k.qcols)}}else{if(e==4){f=function(c,l){return bd.cnum2(c.xx-bd.cell[l].cy,bd.cell[l].cx,k.qrows,k.qcols)}}}}}this.turnflipGroup(h,bd.cell,k.qcols*k.qrows,f);if(k.iscross){if(e==1){f=function(c,l){return bd.xnum(bd.cross[l].cx,(c.yy+1)-bd.cross[l].cy)}}else{if(e==2){f=function(c,l){return bd.xnum((c.xx+1)-bd.cross[l].cx,bd.cross[l].cy)}}else{if(e==3){f=function(c,l){return bd.xnum2(bd.cross[l].cy,(c.yy+1)-bd.cross[l].cx,k.qrows,k.qcols)}}else{if(e==4){f=function(c,l){return bd.xnum2((c.xx+1)-bd.cross[l].cy,bd.cross[l].cx,k.qrows,k.qcols)}}}}}this.turnflipGroup(h,bd.cross,(k.qcols+1)*(k.qrows+1),f)}if(k.isborder){if(e==1){f=function(c,l){return bd.bnum(bd.border[l].cx,(c.yy+1)*2-bd.border[l].cy)}}else{if(e==2){f=function(c,l){return bd.bnum((c.xx+1)*2-bd.border[l].cx,bd.border[l].cy)}}else{if(e==3){f=function(c,l){return bd.bnum2(bd.border[l].cy,(c.yy+1)*2-bd.border[l].cx,k.qrows,k.qcols)}}else{if(e==4){f=function(c,l){return bd.bnum2((c.xx+1)*2-bd.border[l].cy,bd.border[l].cx,k.qrows,k.qcols)}}}}}this.turnflipGroup(h,bd.border,bd.bdinside+(k.isoutsideborder==0?0:2*(k.qcols+k.qrows)),f)}if(k.isextendcell==2){if(e==1){f=function(c,l){return bd.exnum(bd.excell[l].cx,c.yy-bd.excell[l].cy)}}else{if(e==2){f=function(c,l){return bd.exnum(c.xx-bd.excell[l].cx,bd.excell[l].cy)}}else{if(e==3){f=function(c,l){return bd.exnum2(bd.excell[l].cy,c.yy-bd.excell[l].cx,k.qrows,k.qcols)}}else{if(e==4){f=function(c,l){return bd.exnum2(c.xx-bd.excell[l].cy,bd.excell[l].cx,k.qrows,k.qcols)}}}}}this.turnflipGroup(h,bd.excell,2*(k.qcols+k.qrows)+4,f)}else{if(k.isextendcell==1&&(e==1||e==2)){if(e==1){for(var j=h.y1;j<h.yy/2;j++){var i=bd.excell[bd.exnum(-1,j)];bd.excell[bd.exnum(-1,j)]=bd.excell[bd.exnum(-1,h.yy-j)];bd.excell[bd.exnum(-1,h.yy-j)]=i}}else{if(e==2){for(var a=h.x1;a<h.xx/2;a++){var i=bd.excell[bd.exnum(a,-1)];bd.excell[bd.exnum(a,-1)]=bd.excell[bd.exnum(h.xx-a,-1)];bd.excell[bd.exnum(h.xx-a,-1)]=i}}}}}bd.setposAll();this.adjustSpecial2(e,"")},turnflipGroup:function(l,m,o,c){var b=[];for(var e=0;e<o;e++){b[e]=1}for(var a=0;a<o;a++){if(b[a]==0){continue}var f=m[a],j=a;while(b[j]!=0){b[j]=0;var h=c(l,j);if(b[h]!=0){m[j]=m[h];j=h}else{m[j]=f}}}},expandborder:function(b){if(um.undoExec){return}bd.setposBorders();for(var a=0;a<bd.border.length;a++){if(this.distObj(b,"border",a)!=1){continue}var c=this.innerBorder(b,a);bd.border[a].ques=bd.border[c].ques;bd.border[a].qans=bd.border[c].qans}},expandborderAsLine:function(b){bd.setposBorders();for(var a=0;a<bd.border.length;a++){if(this.distObj(b,"border",a)!=2){continue}var c=this.outerBorder(b,a);this.copyData(a,c);bd.border[c].allclear(c)}},reduceborderAsLine:function(b){for(var a=0;a<bd.border.length;a++){if(this.distObj(b,"border",a)!=0){continue}var c=this.innerBorder(b,a);this.copyData(a,c)}},copyData:function(b,a){bd.border[b].qans=bd.border[a].qans;bd.border[b].qsub=bd.border[a].qsub;bd.border[b].ques=bd.border[a].ques;bd.border[b].color=bd.border[a].color},innerBorder:function(a,d){var c=bd.border[d].cx,b=bd.border[d].cy;if(a=="up"){return bd.bnum(c,b+2)}else{if(a=="dn"){return bd.bnum(c,b-2)}else{if(a=="lt"){return bd.bnum(c+2,b)}else{if(a=="rt"){return bd.bnum(c-2,b)}}}}return -1},outerBorder:function(a,d){var c=bd.border[d].cx,b=bd.border[d].cy;if(a=="up"){return bd.bnum(c,b-2)}else{if(a=="dn"){return bd.bnum(c,b+2)}else{if(a=="lt"){return bd.bnum(c-2,b)}else{if(a=="rt"){return bd.bnum(c+2,b)}}}}return -1},setposObj:function(a){if(a=="cell"){bd.setposCells()}else{if(a=="cross"){bd.setposCrosses()}else{if(a=="border"){bd.setposBorders()}else{if(a=="excell"){bd.setposEXcells()}}}}},getnewObj:function(a,b){if(a=="cell"||a=="excell"){return(new Cell(b))}else{if(a=="cross"){return(new Cross(b))}else{if(a=="border"){return(new Border(b))}}}},distObj:function(a,b,c){if(b=="cell"){if(a=="up"){return bd.cell[c].cy}else{if(a=="dn"){return(k.qrows-1)-bd.cell[c].cy}else{if(a=="lt"){return bd.cell[c].cx}else{if(a=="rt"){return(k.qcols-1)-bd.cell[c].cx}}}}}else{if(b=="cross"){if(a=="up"){return bd.cross[c].cy}else{if(a=="dn"){return k.qrows-bd.cross[c].cy}else{if(a=="lt"){return bd.cross[c].cx}else{if(a=="rt"){return k.qcols-bd.cross[c].cx}}}}}else{if(b=="border"){if(a=="up"){return bd.border[c].cy}else{if(a=="dn"){return 2*k.qrows-bd.border[c].cy}else{if(a=="lt"){return bd.border[c].cx}else{if(a=="rt"){return 2*k.qcols-bd.border[c].cx}}}}}else{if(b=="excell"){if(a=="up"){return bd.excell[c].cy}else{if(a=="dn"){return(k.qrows-1)-bd.excell[c].cy}else{if(a=="lt"){return bd.excell[c].cx}else{if(a=="rt"){return(k.qcols-1)-bd.excell[c].cx}}}}}}}}return -1},adjustGeneral:function(e,b,h){um.disableRecord();for(var j=h.y1;j<=h.y2;j++){for(var a=h.x1;a<=h.x2;a++){var i=bd.cnum(a,j);switch(e){case 1:if(true){var f=({2:5,3:4,4:3,5:2,104:107,105:106,106:105,107:104})[bd.QuC(i)];if(!isNaN(f)){bd.sQuC(i,f)}}if(k.isextendcell!=1){var f=({1:2,2:1})[bd.DiC(i)];if(!isNaN(f)){bd.sDiC(i,f)}}break;case 2:if(true){var f=({2:3,3:2,4:5,5:4,104:105,105:104,106:107,107:106})[bd.QuC(i)];if(!isNaN(f)){bd.sQuC(i,f)}}if(k.isextendcell!=1){var f=({3:4,4:3})[bd.DiC(i)];if(!isNaN(f)){bd.sDiC(i,f)}}break;case 3:if(true){var f={2:5,3:2,4:3,5:4,21:22,22:21,102:103,103:102,104:107,105:104,106:105,107:106}[bd.QuC(i)];if(!isNaN(f)){bd.sQuC(i,f)}}if(k.isextendcell!=1){var f={1:4,2:3,3:1,4:2}[bd.DiC(i)];if(!isNaN(f)){bd.sDiC(i,f)}}break;case 4:if(true){var f={2:3,3:4,4:5,5:2,21:22,22:21,102:103,103:102,104:105,105:106,106:107,107:104}[bd.QuC(i)];if(!isNaN(f)){bd.sQuC(i,f)}}if(k.isextendcell!=1){var f={1:3,2:4,3:2,4:1}[bd.DiC(i)];if(!isNaN(f)){bd.sDiC(i,f)}}break;case 5:break;case 6:break}}}um.enableRecord()},adjustQues51_1:function(c,b){this.qnumw=[];this.qnumh=[];for(var d=0;d<=k.qrows-1;d++){this.qnumw[d]=[bd.QnE(bd.exnum(-1,d))];for(var a=0;a<=k.qcols-1;a++){if(bd.QuC(bd.cnum(a,d))==51){this.qnumw[d].push(bd.QnC(bd.cnum(a,d)))}}}for(var a=0;a<=k.qcols-1;a++){this.qnumh[a]=[bd.DiE(bd.exnum(a,-1))];for(var d=0;d<=k.qrows-1;d++){if(bd.QuC(bd.cnum(a,d))==51){this.qnumh[a].push(bd.DiC(bd.cnum(a,d)))}}}},adjustQues51_2:function(d,c){um.disableRecord();var b;switch(d){case 1:for(var a=0;a<=k.qcols-1;a++){b=1;this.qnumh[a]=this.qnumh[a].reverse();bd.sDiE(bd.exnum(a,-1),this.qnumh[a][0]);for(var e=0;e<=k.qrows-1;e++){if(bd.QuC(bd.cnum(a,e))==51){bd.sDiC(bd.cnum(a,e),this.qnumh[a][b]);b++}}}break;case 2:for(var e=0;e<=k.qrows-1;e++){b=1;this.qnumw[e]=this.qnumw[e].reverse();bd.sQnE(bd.exnum(-1,e),this.qnumw[e][0]);for(var a=0;a<=k.qcols-1;a++){if(bd.QuC(bd.cnum(a,e))==51){bd.sQnC(bd.cnum(a,e),this.qnumw[e][b]);b++}}}break;case 3:for(var e=0;e<=k.qrows-1;e++){b=1;this.qnumh[e]=this.qnumh[e].reverse();bd.sQnE(bd.exnum(-1,e),this.qnumh[e][0]);for(var a=0;a<=k.qcols-1;a++){if(bd.QuC(bd.cnum(a,e))==51){bd.sQnC(bd.cnum(a,e),this.qnumh[e][b]);b++}}}for(var a=0;a<=k.qcols-1;a++){b=1;bd.sDiE(bd.exnum(a,-1),this.qnumw[k.qcols-1-a][0]);for(var e=0;e<=k.qrows-1;e++){if(bd.QuC(bd.cnum(a,e))==51){bd.sDiC(bd.cnum(a,e),this.qnumw[k.qcols-1-a][b]);b++}}}break;case 4:for(var e=0;e<=k.qrows-1;e++){b=1;bd.sQnE(bd.exnum(-1,e),this.qnumh[k.qrows-1-e][0]);for(var a=0;a<=k.qcols-1;a++){if(bd.QuC(bd.cnum(a,e))==51){bd.sQnC(bd.cnum(a,e),this.qnumh[k.qrows-1-e][b]);b++}}}for(var a=0;a<=k.qcols-1;a++){b=1;this.qnumw[a]=this.qnumw[a].reverse();bd.sDiE(bd.exnum(a,-1),this.qnumw[a][0]);for(var e=0;e<=k.qrows-1;e++){if(bd.QuC(bd.cnum(a,e))==51){bd.sDiC(bd.cnum(a,e),this.qnumw[a][b]);b++}}}break}um.enableRecord()},adjustSpecial:function(b,a){},adjustSpecial2:function(b,a){},ACconfirm:function(){if(confirm(menu.isLangJP()?"‰ñ“š‚ðÁ‹Ž‚µ‚Ü‚·‚©H":"Do you want to erase the Answer?")){um.newOperation(true);for(var a=0;a<bd.cell.length;a++){if(bd.QaC(a)!=bd.def.cell.qans){um.addOpe("cell","qans",a,bd.QaC(a),bd.def.cell.qans)}if(bd.QsC(a)!=bd.def.cell.qsub){um.addOpe("cell","qsub",a,bd.QsC(a),bd.def.cell.qsub)}}if(k.isborder){for(var a=0;a<bd.border.length;a++){if(bd.QaB(a)!=bd.def.border.qans){um.addOpe("border","qans",a,bd.QaB(a),bd.def.border.qans)}if(bd.LiB(a)!=bd.def.border.line){um.addOpe("border","line",a,bd.LiB(a),bd.def.border.line)}if(bd.QsB(a)!=bd.def.border.qsub){um.addOpe("border","qsub",a,bd.QsB(a),bd.def.border.qsub)}}}if(!g.vml){pc.flushCanvasAll()}bd.ansclear()}},ASconfirm:function(){if(confirm(menu.isLangJP()?"•â•‹L†‚ðÁ‹Ž‚µ‚Ü‚·‚©H":"Do you want to erase the auxiliary marks?")){um.newOperation(true);for(var a=0;a<bd.cell.length;a++){if(bd.QsC(a)!=bd.def.cell.qsub){um.addOpe("cell","qsub",a,bd.QsC(a),bd.def.cell.qsub)}}if(k.isborder){for(var a=0;a<bd.border.length;a++){if(bd.QsB(a)!=bd.def.border.qsub){um.addOpe("border","qsub",a,bd.QsB(a),bd.def.border.qsub)}}}if(!g.vml){pc.flushCanvasAll()}bd.subclear()}}};AreaInfo=function(){this.max=0;this.id=[];this.room=[]};LineManager=function(){this.lcnt=[];this.ltotal=[];this.disable=(!k.isCenterLine&&!k.isborderAsLine);this.data={};this.typeA="A";this.typeB="B";this.typeC="C";this.saved=0;this.init()};LineManager.prototype={init:function(){if(this.disable){return}if(k.isCenterLine){for(var d=0;d<bd.cell.length;d++){this.lcnt[d]=0}this.ltotal=[(k.qcols*k.qrows),0,0,0,0]}else{for(var d=0,a=(k.qcols+1)*(k.qrows+1);d<a;d++){this.lcnt[d]=0}this.ltotal=[((k.qcols+1)*(k.qrows+1)),0,0,0,0]}this.data={max:0,id:[]};for(var b=0;b<bd.border.length;b++){this.data.id[b]=-1}},resetLcnts:function(){if(this.disable){return}this.init();for(var e=0;e<bd.border.length;e++){this.data.id[e]=(bd.isLine(e)?0:-1);if(bd.isLine(e)){this.data.id[e]=0;var b,a;if(k.isCenterLine){b=bd.cc1(e),a=bd.cc2(e)}else{b=bd.crosscc1(e),a=bd.crosscc2(e)}if(b!=-1){this.ltotal[this.lcnt[b]]--;this.lcnt[b]++;this.ltotal[this.lcnt[b]]++}if(a!=-1){this.ltotal[this.lcnt[a]]--;this.lcnt[a]++;this.ltotal[this.lcnt[a]]++}}}for(var e=0;e<bd.border.length;e++){if(this.data.id[e]!=0){continue}var d=bd.border[e].cx,c=bd.border[e].cy;this.data.max++;this.data[this.data.max]={idlist:[]};if(k.isCenterLine^(d%2==0)){this.lc0(d,c+1,1,this.data.max);this.lc0(d,c,2,this.data.max)}else{this.lc0(d+1,c,3,this.data.max);this.lc0(d,c,4,this.data.max)}}},lcntCell:function(a){return(a!=-1?this.lcnt[a]:0)},gettype:function(c,b,a){if(!k.isLineCross){return((this.lcnt[c]==(0+a))?this.typeA:this.typeB)}else{if(c===-1||this.lcnt[c]==(0+a)||(this.lcnt[c]==(2+a)&&this.isTpos(c,b))){return this.typeA}else{if(this.lcnt[c]==(1+a)||this.lcnt[c]==(3+a)){return this.typeB}}return this.typeC}},isTpos:function(b,a){if(k.isCenterLine){return !bd.isLine(bd.bnum(4*bd.cell[b].cx+2-bd.border[a].cx,4*bd.cell[b].cy+2-bd.border[a].cy))}else{return !bd.isLine(bd.bnum(4*(b%(k.qcols+1))-bd.border[a].cx,4*mf(b/(k.qcols+1))-bd.border[a].cy))}},branch:function(b,a){if(!k.isLineCross){return(this.lcntCell((k.isCenterLine?bd.cnum:bd.xnum)(mf(b/2),mf(a/2)))>=3)}return false},terminate:function(b,a){return false},setLine:function(b,c){if(this.disable||!um.isenableRecord()){return}c=(c>0?1:0);var m,l;if(k.isCenterLine){m=bd.cc1(b),l=bd.cc2(b)}else{m=bd.crosscc1(b),l=bd.crosscc2(b)}if(c>0){if(m!=-1){this.ltotal[this.lcnt[m]]--;this.lcnt[m]++;this.ltotal[this.lcnt[m]]++}if(l!=-1){this.ltotal[this.lcnt[l]]--;this.lcnt[l]++;this.ltotal[this.lcnt[l]]++}}else{if(m!=-1){this.ltotal[this.lcnt[m]]--;this.lcnt[m]--;this.ltotal[this.lcnt[m]]++}if(l!=-1){this.ltotal[this.lcnt[l]]--;this.lcnt[l]--;this.ltotal[this.lcnt[l]]++}}var h=this.gettype(m,b,c),e=this.gettype(l,b,c);if(c>0){if(h==this.typeA&&e==this.typeA){this.data.max++;this.data[this.data.max]={idlist:[b]};this.data.id[b]=this.data.max;bd.border[b].color=pc.getNewLineColor()}else{if((h==this.typeA&&e==this.typeB)||(h==this.typeB&&e==this.typeA)){var j=(this.getbid(b,1))[0];this.data[this.data.id[j]].idlist.push(b);this.data.id[b]=this.data.id[j];bd.border[b].color=bd.border[j].color}else{if(!k.isLineCross||(h==this.typeB&&e==this.typeB)){this.addLineInfo(b)}else{this.remakeLineInfo(b,1)}}}}else{if(h==this.typeA&&e==this.typeA){this.data[this.data.id[b]]={idlist:[]};this.data.id[b]=-1;bd.border[b].color=""}else{if((h==this.typeA&&e==this.typeB)||(h==this.typeB&&e==this.typeA)){var d=this.data.id[b],a=this.data[d].idlist;for(var f=0;f<a.length;f++){if(a[f]==b){a.splice(f,1);break}}this.data.id[b]=-1;bd.border[b].color=""}else{this.remakeLineInfo(b,0);bd.border[b].color=""}}}},addLineInfo:function(a){var e=this.data.id;var j=this.getbid(a,1);var o=[e[j[0]],e[j[1]]];var m=bd.border[j[0]].color;if(o[0]!=o[1]){var f=o[0],b=o[1];if(this.data[o[0]].idlist.length<this.data[o[1]].idlist.length){f=o[1];b=o[0];m=bd.border[j[1]].color}var l=this.data[f].idlist;var c=this.data[b].idlist;for(var d=0;d<c.length;d++){l.push(c[d]);e[c[d]]=f}c=[];l.push(a);e[a]=f;for(var h=0;h<l.length;h++){bd.border[l[h]].color=m}this.repaintLine(f)}else{this.data[o[0]].idlist.push(a);e[a]=o[0];bd.border[a].color=m}},remakeLineInfo:function(b,d){var e=this.data.id;var m=this.getbid(b,d);var h=e[m[0]];var j=bd.border[m[0]].color;for(var l=0;l<m.length;l++){var p=e[m[l]];if(p<=0){continue}var a=this.data[p].idlist;if(this.data[h].idlist.length<a.length){h=p;j=bd.border[m[l]].color}for(var c=0;c<a.length;c++){e[a[c]]=0}this.data[p]={idlist:[]}}e[b]=(d>0?0:-1);if(d==1){m.unshift(b)}var f=this.data.max;for(var l=0;l<m.length;l++){if(e[m[l]]!=0){continue}var t=bd.border[m[l]].cx,r=bd.border[m[l]].cy;this.data.max++;this.data[this.data.max]={idlist:[]};if(k.isCenterLine^(t%2==0)){this.lc0(t,r+1,1,this.data.max);this.lc0(t,r,2,this.data.max)}else{this.lc0(t+1,r,3,this.data.max);this.lc0(t,r,4,this.data.max)}}h=f+1;if(this.data.max>h||k.isLineCross){for(var l=f+2;l<=this.data.max;l++){if(this.data[h].idlist.length<this.data[l].idlist.length){h=l}}for(var l=f+1;l<=this.data.max;l++){var q=(l==h?j:pc.getNewLineColor());var a=this.data[l].idlist;for(var c=0,o=a.length;c<o;c++){bd.border[a[c]].color=q;this.repaintLine(l)}}}else{bd.border[b].color=(d==0?j:"")}},repaintLine:function(b){if(!menu.getVal("irowake")){return}for(var a=0;a<this.data[b].idlist.length;a++){var c=this.data[b].idlist[a];if(k.isCenterLine){pc.drawLine1(c,true)}else{pc.drawBorder1(c,true)}if(!g.vml){this.repaintParts(c)}}},repaintParts:function(a){},getbid:function(a,b){var d=[];var f=bd.border[a].cx,e=bd.border[a].cy;var m=((k.isCenterLine^(f%2==0))?2:0),l=(2-m);var c;if(!k.isLineCross){c=bd.bnum(f-l,e-m);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f-1,e-1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+m-1,e+l-1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+l,e+m);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+1,e+1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f-m+1,e-l+1);if(bd.isLine(c)){d.push(c)}}else{var j=bd.cc1(a),h=bd.cc2(a);if(!k.isCenterLine){j=bd.crosscc1(a);h=bd.crosscc2(a)}if(j!=-1){if(this.lcnt[j]==(1+b)||(this.lcnt[j]==(2+b)&&!this.isTpos(j,a))){c=bd.bnum(f-l,e-m);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f-1,e-1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+m-1,e+l-1);if(bd.isLine(c)){d.push(c)}}else{if(this.lcnt[j]>=(3+b)){c=bd.bnum(f-l,e-m);if(bd.isLine(c)){d.push(c)}}}}if(h!=-1){if(this.lcnt[h]==(1+b)||(this.lcnt[h]==(2+b)&&!this.isTpos(h,a))){c=bd.bnum(f+l,e+m);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+1,e+1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f-m+1,e-l+1);if(bd.isLine(c)){d.push(c)}}else{if(this.lcnt[h]>=(3+b)){c=bd.bnum(f+l,e+m);if(bd.isLine(c)){d.push(c)}}}}}return d},lc0:function(d,c,b,a){while(1){switch(b){case 1:c--;break;case 2:c++;break;case 3:d--;break;case 4:d++;break}if((d+c)%2==0){if(this.branch(d,c)){if(bd.isLine(bd.bnum(d,c-1))){this.lc0(d,c,1,a)}if(bd.isLine(bd.bnum(d,c+1))){this.lc0(d,c,2,a)}if(bd.isLine(bd.bnum(d-1,c))){this.lc0(d,c,3,a)}if(bd.isLine(bd.bnum(d+1,c))){this.lc0(d,c,4,a)}break}else{if(this.lcntCell((k.isCenterLine?bd.cnum:bd.xnum)(mf(d/2),mf(c/2)))<=2){if(b!=1&&bd.isLine(bd.bnum(d,c+1))){b=2}else{if(b!=2&&bd.isLine(bd.bnum(d,c-1))){b=1}else{if(b!=3&&bd.isLine(bd.bnum(d+1,c))){b=4}else{if(b!=4&&bd.isLine(bd.bnum(d-1,c))){b=3}}}}}else{if(this.terminate(d,c)){break}}}}else{var e=bd.bnum(d,c);if(this.data.id[e]!=0){break}this.data.id[e]=a;this.data[a].idlist.push(e)}}},getLineInfo:function(){var b=new AreaInfo();for(var c=0;c<bd.border.length;c++){b.id[c]=(bd.isLine(c)?0:-1)}for(var c=0;c<bd.border.length;c++){if(b.id[c]!=0){continue}b.max++;b.room[b.max]={idlist:this.data[this.data.id[c]].idlist};for(var a=0;a<b.room[b.max].idlist.length;a++){b.id[b.room[b.max].idlist[a]]=b.max}}return b},getLareaInfo:function(){var a=new AreaInfo();for(var b=0;b<bd.cell.length;b++){a.id[b]=(this.lcnt[b]>0?0:-1)}for(var b=0;b<bd.cell.length;b++){if(a.id[b]!=0){continue}a.max++;a.room[a.max]={idlist:[]};this.sr0(a,b,a.max)}return a},sr0:function(c,a,b){c.id[a]=b;c.room[b].idlist.push(a);if(bd.isLine(bd.ub(a))&&c.id[bd.up(a)]==0){this.sr0(c,bd.up(a),b)}if(bd.isLine(bd.db(a))&&c.id[bd.dn(a)]==0){this.sr0(c,bd.dn(a),b)}if(bd.isLine(bd.lb(a))&&c.id[bd.lt(a)]==0){this.sr0(c,bd.lt(a),b)}if(bd.isLine(bd.rb(a))&&c.id[bd.rt(a)]==0){this.sr0(c,bd.rt(a),b)}},LineList2Clist:function(e){var d=[];d.include=function(h){for(var f=0;f<this.length;f++){if(this[f]==h){return true}}return false};for(var b=0;b<e.length;b++){var c=bd.cc1(e[b]),a=bd.cc2(e[b]);if(c!=-1&&!d.include(c)){d.push(c)}if(a!=-1&&!d.include(a)){d.push(a)}}return d}};AreaManager=function(){this.lcnt=[];this.room={};this.bcell={};this.wcell={};this.disroom=(!k.isborder||!!k.area.disroom);this.bblock=(!!k.area.bcell||!!k.area.number);this.wblock=!!k.area.wcell;this.numberColony=!!k.area.number;this.init()};AreaManager.prototype={init:function(){this.initRarea();this.initBarea();this.initWarea()},resetArea:function(){if(k.isborder&&!k.isborderAsLine){this.resetRarea()}if(this.bblock){this.resetBarea()}if(this.wblock){this.resetWarea()}},initRarea:function(){this.room={max:1,id:[],1:{top:0,clist:[]}};for(var h=0;h<bd.cell.length;h++){this.room.id[h]=1;this.room[1].clist[h]=h}this.lcnt=[];for(var h=0;h<(k.qcols+1)*(k.qrows+1);h++){this.lcnt[h]=0;if(k.isoutsideborder==0){var e=h%(k.qcols+1),d=mf(h/(k.qcols+1));if(e==0||e==k.qcols||d==0||d==k.qrows){this.lcnt[h]=2}}}if(this.disroom){return}for(var f=0;f<bd.border.length;f++){if(bd.isBorder(f)){var b=bd.crosscc1(f),a=bd.crosscc2(f);if(b!=-1){this.lcnt[b]++}if(a!=-1){this.lcnt[a]++}}}},resetRarea:function(){if(this.disroom){return}this.initRarea();this.room.max=0;for(var h=0;h<bd.cell.length;h++){this.room.id[h]=0}for(var h=0;h<bd.cell.length;h++){if(this.room.id[h]!=0){continue}this.room.max++;this.room[this.room.max]={top:-1,clist:[]};this.sr0(h,this.room,bd.isBorder)}if(k.isOneNumber){for(var d=1;d<=this.room.max;d++){this.setTopOfRoom(d);var e=-1;for(var b=0,a=this.room[d].clist.length;b<a;b++){var f=this.room[d].clist[b];if(this.room.id[f]==d&&bd.QnC(f)!=-1){if(e==-1){e=bd.QnC(f)}if(this.getTopOfRoom(d)!=f){bd.sQnC(f,-1)}}}if(e!=-1&&bd.QnC(this.getTopOfRoom(d))==-1){bd.sQnC(this.getTopOfRoom(d),e)}}}},lcntCross:function(a){return this.lcnt[a]},getRoomID:function(a){return this.room.id[a]},setRoomID:function(b,a){this.room.id[b]=a},getTopOfRoomByCell:function(a){return this.room[this.room.id[a]].top},getTopOfRoom:function(a){return this.room[a].top},getCntOfRoomByCell:function(a){return this.room[this.room.id[a]].clist.length},getCntOfRoom:function(a){return this.room[a].clist.length},call_setBorder:function(c,b,a){this.setBorder(c,b)},setBorder:function(f,y){if(this.disroom||!um.isenableRecord()){return}y=(y>0?1:0);var d,c,b=bd.crosscc1(f),a=bd.crosscc2(f);var u=this.room,x=u.id;if(y>0){this.lcnt[b]++;this.lcnt[a]++;if(this.lcnt[b]==1||this.lcnt[a]==1){return}d=bd.cc1(f);c=bd.cc2(f);if(d==-1||c==-1||x[d]!=x[c]){return}var e=x[d];u.max++;u[u.max]={top:-1,clist:[]};this.sr0(c,u,bd.isBorder);if(x[d]==u.max){for(var l=0,m=u[u.max].clist.length;l<m;l++){x[u[u.max].clist[l]]=e}u.max--;return}var w=u[e].clist.concat();u[e].clist=[];u[u.max].clist=[];for(var l=0,m=w.length;l<m;l++){u[x[w[l]]].clist.push(w[l])}if(k.isOneNumber){if(x[u[e].top]==e){this.setTopOfRoom(u.max)}else{u[u.max].top=u[e].top;this.setTopOfRoom(e)}}}else{this.lcnt[b]--;this.lcnt[a]--;if(this.lcnt[b]==0||this.lcnt[a]==0){return}d=bd.cc1(f);c=bd.cc2(f);if(d==-1||c==-1||x[d]==x[c]){return}if(k.isOneNumber){var v,p;var r=u[x[d]].top,o=u[x[c]].top;var t=bd.cell[r].cx,q=bd.cell[o].cx;if(t>q||(t==q&&r>o)){v=r;p=o}else{v=o;p=r}if(bd.QnC(v)!=-1){if(bd.QnC(p)==-1){bd.sQnC(p,bd.QnC(v));pc.paintCell(p)}bd.sQnC(v,-1);pc.paintCell(v)}}var j=x[d],h=x[c],w=u[h].clist;for(var l=0;l<w.length;l++){x[w[l]]=j;u[j].clist.push(w[l])}u[h]={top:-1,clist:[]}}},setTopOfRoom:function(c){var e=-1,a=k.qcols;var d=this.room[c].clist;for(var b=0;b<d.length;b++){if(bd.cell[d[b]].cx<a){e=d[b];a=bd.cell[d[b]].cx}}this.room[c].top=e},sr0:function(e,d,b){d.id[e]=d.max;d[d.max].clist.push(e);var a;a=bd.up(e);if(a!=-1&&d.id[a]!=d.max&&!b(bd.ub(e))){this.sr0(a,d,b)}a=bd.dn(e);if(a!=-1&&d.id[a]!=d.max&&!b(bd.db(e))){this.sr0(a,d,b)}a=bd.lt(e);if(a!=-1&&d.id[a]!=d.max&&!b(bd.lb(e))){this.sr0(a,d,b)}a=bd.rt(e);if(a!=-1&&d.id[a]!=d.max&&!b(bd.rb(e))){this.sr0(a,d,b)}},initBarea:function(){this.bcell={max:0,id:[]};for(var a=0;a<bd.cell.length;a++){this.bcell.id[a]=-1}},resetBarea:function(){this.initBarea();if(!this.numberColony){for(var a=0;a<bd.cell.length;a++){this.bcell.id[a]=(bd.isBlack(a)?0:-1)}}else{for(var a=0;a<bd.cell.length;a++){this.bcell.id[a]=(bd.isNum(a)?0:-1)}}for(var a=0;a<bd.cell.length;a++){if(this.bcell.id[a]!=0){continue}this.bcell.max++;this.bcell[this.bcell.max]={clist:[]};this.sc0(a,this.bcell)}},initWarea:function(){this.wcell={max:1,id:[],1:{clist:[]}};for(var a=0;a<bd.cell.length;a++){this.wcell.id[a]=1;this.wcell[1].clist[a]=a}},resetWarea:function(){this.initWarea();this.wcell.max=0;for(var a=0;a<bd.cell.length;a++){this.wcell.id[a]=(bd.isWhite(a)?0:-1)}for(var a=0;a<bd.cell.length;a++){if(this.wcell.id[a]!=0){continue}this.wcell.max++;this.wcell[this.wcell.max]={clist:[]};this.sc0(a,this.wcell)}},setCell:function(b,a){if(!um.isenableRecord()){return}if(a>0){if(this.bblock){this.setBWCell(b,1,this.bcell)}if(this.wblock){this.setBWCell(b,0,this.wcell)}}else{if(this.bblock){this.setBWCell(b,0,this.bcell)}if(this.wblock){this.setBWCell(b,1,this.wcell)}}},setBWCell:function(d,b,h){var o=[],c=h.id,f;f=bd.up(d);if(f!=-1&&c[f]!=-1){o.push(f)}f=bd.dn(d);if(f!=-1&&c[f]!=-1){o.push(f)}f=bd.lt(d);if(f!=-1&&c[f]!=-1){o.push(f)}f=bd.rt(d);if(f!=-1&&c[f]!=-1){o.push(f)}if(b>0){if(o.length==0){h.max++;h[h.max]={clist:[d]};c[d]=h.max}else{if(o.length==1){h[c[o[0]]].clist.push(d);c[d]=c[o[0]]}else{var l=c[o[0]];for(var j=1;j<o.length;j++){if(h[l].clist.length<h[c[o[j]]].clist.length){l=c[o[j]]}}for(var j=0;j<o.length;j++){if(c[o[j]]==l){continue}var p=h[c[o[j]]].clist;for(var a=0,m=p.length;a<m;a++){c[p[a]]=l;h[l].clist.push(p[a])}p=[]}c[d]=l;h[l].clist.push(d)}}}else{if(o.length==0){h[c[d]].clist=[];c[d]=-1}else{if(o.length==1){var e=c[d],p=h[e].clist;for(var j=0;j<p.length;j++){if(p[j]==d){p.splice(j,1);break}}c[d]=-1}else{var e=c[d],p=h[e].clist;for(var j=0;j<p.length;j++){c[p[j]]=0}h[e].clist=[];c[d]=-1;for(var j=0;j<o.length;j++){if(c[o[j]]!=0){continue}h.max++;h[h.max]={clist:[]};this.sc0(o[j],h)}}}}},sc0:function(d,b){b.id[d]=b.max;b[b.max].clist.push(d);var a;a=bd.up(d);if(a!=-1&&b.id[a]==0){this.sc0(a,b)}a=bd.dn(d);if(a!=-1&&b.id[a]==0){this.sc0(a,b)}a=bd.lt(d);if(a!=-1&&b.id[a]==0){this.sc0(a,b)}a=bd.rt(d);if(a!=-1&&b.id[a]==0){this.sc0(a,b)}},getRoomInfo:function(){return this.getAreaInfo(this.room)},getBCellInfo:function(){return this.getAreaInfo(this.bcell)},getWCellInfo:function(){return this.getAreaInfo(this.wcell)},getNumberInfo:function(){return this.getAreaInfo(this.bcell)},getAreaInfo:function(f){var e=new AreaInfo();for(var h=0;h<bd.cell.length;h++){e.id[h]=(f.id[h]>0?0:-1)}for(var h=0;h<bd.cell.length;h++){if(e.id[h]!=0){continue}e.max++;var d=f[f.id[h]].clist;e.room[e.max]={idlist:d};for(var b=0,a=d.length;b<a;b++){e.id[d[b]]=e.max}}return e}};PBase=function(){this.floatbgcolor="black";this.proto=0;this.expression={ja:"",en:""};this.puzzlename={ja:"",en:""};this.cv_obj=null;this.onresizenow=false};PBase.prototype={preload_func:function(){enc=new Encode();k.puzzleid=enc.first_parseURI(location.search);if(!k.puzzleid&&location.href.indexOf("for_test.html")>=0){k.puzzleid="country"}if(!k.puzzleid){location.href="./"}if(enc.uri.cols){k.qcols=enc.uri.cols}if(enc.uri.rows){k.qrows=enc.uri.rows}fio=new FileIO();if(fio.choiceDataBase()>0){document.writeln('<script type="text/javascript" src="src/gears_init.js"><\/script>')}if(location.href.indexOf("for_test.html")==-1){document.writeln('<script type="text/javascript" src="src/'+k.puzzleid+'.js"><\/script>')}else{document.writeln('<script type="text/javascript" src="src/puzzles.js"><\/script>')}$(document).ready(this.onload_func.ebind(this));$(window).resize(this.onresize_func.ebind(this))},onload_func:function(){this.initCanvas();this.initObjects();this.setEvents(true);if(document.domain=="indi.s58.xrea.com"&&k.callmode=="pplay"){this.accesslog()}tm=new Timer()},initObjects:function(){this.proto=0;puz=new Puzzles[k.puzzleid]();puz.setting();if(this.proto){puz.protoChange()}bd=new Board();mv=new MouseEvent();kc=new KeyEvent();kp=new KeyPopup();pc=new Graphic();tc=new TCell();ans=new AnsCheck();um=new UndoManager();area=new AreaManager();line=new LineManager();fio.initDataBase();menu=new Menu();pp=new Properties();this.doc_design();enc.pzlinput();if(!enc.uri.bstr){this.resize_canvas_onload()}if(k.scriptcheck&&debug){debug.testonly_func()}},setEvents:function(a){this.cv_obj.mousedown(mv.e_mousedown.ebind(mv)).mouseup(mv.e_mouseup.ebind(mv)).mousemove(mv.e_mousemove.ebind(mv));this.cv_obj.context.oncontextmenu=function(){return false};if(a){$(document).keydown(kc.e_keydown.kcbind()).keyup(kc.e_keyup.kcbind()).keypress(kc.e_keypress.kcbind())}},initSilverlight:function(a){a.AddEventListener("KeyDown",kc.e_SLkeydown.bind(kc));a.AddEventListener("KeyUp",kc.e_SLkeyup.bind(kc))},reload_func:function(a){if(this.proto){puz.protoOriginal()}$("*").unbind();menu.menureset();$("#numobj_parent").html("");if(kp.ctl[1].enable){kp.ctl[1].el.remove()}if(kp.ctl[3].enable){kp.ctl[3].el.remove()}k.puzzleid=a;if(!Puzzles[k.puzzleid]){newEL("script").attr("type","text/javascript").attr("src","src/"+k.puzzleid+".js").appendTo($("head"))}enc=new Encode();fio=new FileIO();this.initObjects();this.setEvents(false)},postfix:function(){puz.input_init();puz.graphic_init();puz.encode_init();puz.answer_init()},doc_design:function(){this.resize_canvas_only();document.title=this.gettitle();$("#title2").html(this.gettitle());$("body").css("background-image","url(../../"+k.puzzleid+"/bg.gif)");if(k.br.IE){$("#title2").css("margin-top","24px");$("hr").each(function(){$(this).css("margin","0pt")})}k.autocheck=(k.callmode!="pmake");this.postfix();menu.menuinit();um.enb_btn()},gettitle:function(){if(k.callmode=="pmake"){return""+this.getPuzzleName()+(menu.isLangJP()?" ƒGƒfƒBƒ^ - ‚Ï‚¸‚Õ‚êv3":" editor - PUZ-PRE v3")}else{return""+this.getPuzzleName()+(menu.isLangJP()?" player - ‚Ï‚¸‚Õ‚êv3":" player - PUZ-PRE v3")}},getPuzzleName:function(){return(menu.isLangJP()||!this.puzzlename.en)?this.puzzlename.ja:this.puzzlename.en},setTitle:function(b,a){this.puzzlename.ja=b;this.puzzlename.en=a},setExpression:function(b,a){this.expression.ja=b;this.expression.en=a},setFloatbgcolor:function(a){this.floatbgcolor=a},initCanvas:function(){k.IEMargin=(k.br.IE)?(new Pos(4,4)):(new Pos(0,0));var a=document.getElementById("puzzle_canvas");if(k.br.IE){a=uuCanvas.init(a,!uuMeta.slver)}g=a.getContext("2d");this.cv_obj=$(a).unselectable()},resize_canvas_only:function(){var a=this.getWindowSize();k.p0=new Pos(k.def_psize,k.def_psize);var f={0:(19/36),1:0.75,2:1,3:1.5,4:3}[k.widthmode];var e=Math.round((a.x-k.p0.x*2)/(k.def_csize*f)*0.75);var d=Math.round((a.x-k.p0.x*2)/(k.def_csize*f));var c=Math.round((a.x-k.p0.x*2)/(k.def_csize)*2.25);if(k.qcols<e){k.cwidth=k.cheight=mf(k.def_csize*f);$("#main").css("width","80%")}else{if(k.qcols<d){k.cwidth=k.cheight=mf(k.def_csize*f*(1-0.25*((k.qcols-e)/(d-e))));k.p0.x=k.p0.y=mf(k.def_psize*(k.cwidth/k.def_csize));$("#main").css("width","80%")}else{if(k.qcols<c){k.cwidth=k.cheight=mf(k.def_csize*f*(0.75-0.35*((k.qcols-d)/(c-d))));k.p0.x=k.p0.y=mf(k.def_psize*(k.cwidth/k.def_csize));$("#main").css("width",""+(k.p0.x*2+k.qcols*k.cwidth+12)+"px")}else{k.cwidth=k.cheight=mf(k.def_csize*0.4);k.p0=new Pos(k.def_psize*0.4,k.def_psize*0.4);$("#main").css("width","96%")}}}this.cv_obj.attr("width",k.p0.x*2+k.qcols*k.cwidth);this.cv_obj.attr("height",k.p0.y*2+k.qrows*k.cheight);if(k.isextendcell==1){k.p0.x+=mf(k.cwidth*0.45);k.p0.y+=mf(k.cheight*0.45)}k.cv_oft.x=this.cv_obj.offset().left;k.cv_oft.y=this.cv_obj.offset().top;kp.resize();bd.setpicAll();pc.onresize_func();if(g.vml){var b=this.cv_obj.children(":first");b.css("width",""+this.cv_obj.attr("clientWidth")+"px");b.css("height",""+this.cv_obj.attr("clientHeight")+"px")}},resize_canvas:function(){this.resize_canvas_only();pc.flushCanvasAll();pc.paintAll()},resize_canvas_onload:function(){if(!k.br.IE||pc.already()){this.resize_canvas()}else{uuCanvas.ready(this.resize_canvas.bind(this))}},onresize_func:function(){if(this.onresizenow){return}this.onresizenow=true;this.resize_canvas();this.onresizenow=false},getWindowSize:function(){if(document.all){return new Pos(document.body.clientWidth,document.body.clientHeight)}else{if(document.layers||document.getElementById){return new Pos(innerWidth,innerHeight)}}return new Pos(0,0)},resetInfo:function(){tc.Adjust();area.resetArea();line.resetLcnts()},accesslog:function(){var a=document.referrer;a=a.replace(/\?/g,"%3f");a=a.replace(/\&/g,"%26");a=a.replace(/\=/g,"%3d");a=a.replace(/\//g,"%2f");$.post("./record.cgi","pid="+k.puzzleid+"&pzldata="+enc.uri.qdata+"&referer="+a)}};base=new PBase();base.preload_func();