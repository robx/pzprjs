/* 
 * pzprBase.js
 * 
 * pzprBase.js is a base script for playing nikoli puzzles on Web
 * written in JavaScript.
 * 
 * @author  happa.
 * @version v3.2.5
 * @date    2010-03-09
 * 
 * This script uses following library.
 *  uuCanvas.js (version 1.0)
 *  http://code.google.com/p/uupaa-js-spinoff/	uupaa.js SpinOff Project Home(Google Code)
 * 
 * For improvement of canvas drawing time, I make some change on uuCanvas.js.
 * Please see "//happa add.[20090608]" in uuCanvas.js.
 * 
 * This script is dual licensed under the MIT and Apache 2.0 licenses.
 * http://indi.s58.xrea.com/pzpr/v3/LICENCE.HTML
 * 
 */
var pzprversion="v3.2.5";Pos=function(a,b){this.x=a;this.y=b};Pos.prototype={set:function(a,b){this.x=a;this.y=b},clone:function(){return new Pos(this.x,this.y)}};var k={qcols:0,qrows:0,irowake:0,iscross:0,isborder:0,isextendcell:0,isoutsidecross:1,isoutsideborder:0,isLineCross:1,isCenterLine:0,isborderAsLine:0,dispzero:0,isDispHatena:1,isAnsNumber:0,isArrowNumber:0,isOneNumber:0,isDispNumUL:0,NumberWithMB:0,BlackCell:0,NumberIsWhite:0,RBBlackCell:0,ispzprv3ONLY:0,isKanpenExist:0,def_csize:36,def_psize:24,area:{bcell:0,wcell:0,number:0,disroom:0},puzzleid:"",use:1,widthmode:2,EDITOR:true,PLAYER:false,editmode:true,playmode:false,enableKey:true,enableMouse:true,autocheck:true,cwidth:this.def_csize,cheight:this.def_csize,p0:new Pos(this.def_psize,this.def_psize),cv_oft:new Pos(0,0),IEMargin:new Pos(2,2),br:{IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,WinWebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1&&navigator.userAgent.indexOf("Win")>-1},vml:!!(window.attachEvent&&!window.opera)&&!uuMeta.slver,BOARD:"board",CELL:"cell",CROSS:"cross",BORDER:"border",EXCELL:"excell",QUES:"ques",QNUM:"qnum",DIREC:"direc",QANS:"qans",LINE:"line",QSUB:"qsub",UP:1,DN:2,LT:3,RT:4,KEYUP:"up",KEYDN:"down",KEYLT:"left",KEYRT:"right",scriptcheck:false};k.IEMargin=(k.br.IE?k.IEMargin:new Pos(0,0));var g;var Puzzles=[];var _doc=document;if(typeof localStorage!="object"&&typeof globalStorage=="object"){localStorage=globalStorage[location.host]}var mf=Math.floor;function f_true(){return true}(function(){var a=document,j=this,e=k.br.IE,d=k.br.Gecko,h=k.br.WebKit,b=_ElementManager=j.ee=function(m){if(typeof m==="string"){if(!f[m]){var l=a.getElementById(m);if(!l){return null}f[m]=new _ELx(l)}return f[m]}var l=m;if(!!l.id){if(!f[l.id]){f[l.id]=new _ELx(l)}return f[l.id]}return((!!l)?new _ELx(l):null)},f=_ElementManager._cache={},i=_ElementManager._template=[],c=_ElementManager._tempcnt=0;_ELx=_ElementManager.ElementExt=function(l){this.el=l;this.parent=l.parentNode;this.pdisp="none"},_ELp=_ElementManager.ElementTemplate=function(p,m,l,o,q){this.parent=p;this.tagName=m;this.attr=l;this.style=o;this.func=q},_extend=function(o,m){for(var l in m){o[l]=m[l]}},_toArray=function(m){if(!m){return[]}var p=[];for(var o=0,l=m.length;o<l;o++){p[o]=m[o]}return p};_extend(_ElementManager,{clean:function(){f=null;f={};c=0;i=null;i=[]},addTemplate:function(u,v,q,t,p){if(!v){return}if(!u){u=null}else{if(typeof u=="string"){u=ee(u).el}}var r={};var m=(t||{});var o=(p||{});if(!!q){for(var l in q){if(l==="unselectable"&&q[l]==="on"){if(d){m.UserSelect=m.MozUserSelect="none"}else{if(h){m.UserSelect=m.KhtmlUserSelect="none"}else{r.unselectable="on"}}}else{r[l]=q[l]}}}i[c++]=new _ELp(u,v,r,m,p);return(c-1)},createEL:function(p,q){if(!i[p]){return null}var l=i[p];var o=a.createElement(l.tagName);if(!!q){o.id=q}for(var m in l.attr){o[m]=l.attr[m]}for(var m in l.style){o.style[m]=l.style[m]}for(var m in l.func){o["on"+m]=l.func[m]}if(!!l.parent){l.parent.appendChild(o)}return o},getSrcElement:function(l){return l.target||l.srcElement},pageX:(((!k.br.IE)?function(l){return l.pageX}:function(l){return l.clientX+(a.documentElement.scrollLeft||a.body.scrollLeft)})),pageY:(((!k.br.IE)?function(l){return l.pageY}:function(l){return l.clientY+(a.documentElement.scrollTop||a.body.scrollTop)})),windowWidth:(((a.all)?function(){return a.body.clientWidth}:(a.layers||a.getElementById)?function(){return innerWidth}:function(){return 0})),windowHeight:(((a.all)?function(){return a.body.clientHeight}:(a.layers||a.getElementById)?function(){return innerHeight}:function(){return 0})),binder:function(){var m=_toArray(arguments);var o=m.shift(),l=m.shift();return function(){return l.apply(o,(m.length>0?m[0]:[]).concat(_toArray(arguments)))}},ebinder:function(){var m=_toArray(arguments);var p=m.shift(),l=m.shift(),o=(m.length>0?m[0]:[]);return function(q){return l.apply(p,[q||j.event].concat(m.length>0?m[0]:[]).concat(_toArray(arguments)))}},stopPropagation:((!e)?function(l){l.stopPropagation()}:function(l){l.cancelBubble=true}),preventDefault:((d||h)?function(l){l.preventDefault()}:function(l){l.returnValue=false})});_ElementManager.ElementExt.prototype={getRect:(((!!document.getBoundingClientRect)?((!e)?function(){var m=a.documentElement,t=a.body,p=this.el.getBoundingClientRect();var r=p.left+j.scrollX;var q=p.top+j.scrollY;var o=p.right+j.scrollX;var l=p.bottom+j.scrollY;return{top:q,bottom:l,left:r,right:o}}:function(){var m=a.documentElement,t=a.body,p=this.el.getBoundingClientRect();var r=p.left+((t.scrollLeft||m.scrollLeft)-m.clientLeft);var q=p.top+((t.scrollTop||m.scrollTop)-m.clientTop);var o=p.right+((t.scrollLeft||m.scrollLeft)-m.clientLeft);var l=p.bottom+((t.scrollTop||m.scrollTop)-m.clientTop);return{top:q,bottom:l,left:r,right:o}}):function(){var q=0,p=0,o=this.el;while(!!o){q+=+(!isNaN(o.offsetLeft)?o.offsetLeft:o.clientLeft);p+=+(!isNaN(o.offsetTop)?o.offsetTop:o.clientTop);o=o.offsetParent}var m=q+(this.el.offsetWidth||this.el.clientWidth);var l=p+(this.el.offsetHeight||this.el.clientHeight);return{top:p,bottom:l,left:q,right:m}})),getWidth:function(){return this.el.offsetWidth||this.el.clientWidth},getHeight:function(){return this.el.offsetHeight||this.el.clientHeight},unselectable:(((d)?function(){this.el.style.MozUserSelect="none";this.el.style.UserSelect="none";return this}:(h)?function(){this.el.style.KhtmlUserSelect="none";this.el.style.UserSelect="none";return this}:function(){this.el.unselectable="on";return this})),replaceChildrenClass:function(m,o){var l=this.el.firstChild;while(!!l){if(l.className===m){l.className=o}l=l.nextSibling}},remove:function(){this.parent.removeChild(this.el);return this},removeNextAll:function(l){var m=this.el.lastChild;while(!!m){if(m===l){break}if(!!m){this.el.removeChild(m)}else{break}m=this.el.lastChild}return this},appendHTML:function(l){var m=a.createElement("span");m.innerHTML=l;this.el.appendChild(m);return this},appendBR:function(){this.el.appendChild(a.createElement("br"));return this},appendEL:function(l){this.el.appendChild(l);return this},appendTo:function(l){l.el.appendChild(this.el);this.parent=l.el;return this},insertBefore:function(l){this.parent=l.parentNode;this.parent.insertBefore(this.el,l);return this},insertAfter:function(l){this.parent=l.parentNode;this.parent.insertBefore(this.el,l.nextSibling);return this}}})();Timer=function(){this.TID;this.timerInterval=(!k.br.IE?100:200);this.st=0;this.current=0;this.bseconds=0;this.timerEL=ee("timerpanel").el;this.lastAnsCnt=0;this.worstACCost=0;this.nextACtime=0;this.start();this.TIDundo=null;this.undoInterval=(!k.br.IE?25:50);this.undoStartCount=mf(300/this.undoInterval);this.undoWaitCount=this.undoStartCount};Timer.prototype={reset:function(){this.worstACCost=0;this.timerEL.innerHTML=this.label()+"00:00";clearInterval(this.TID);this.start()},start:function(){this.st=(new Date()).getTime();this.TID=setInterval(ee.binder(this,this.update),this.timerInterval)},update:function(){this.current=(new Date()).getTime();if(k.PLAYER){this.updatetime()}if(k.autocheck){this.ACcheck()}},updatetime:function(){var c=mf((this.current-this.st)/1000);if(this.bseconds==c){return}var a=mf(c/3600);var b=mf(c/60)-a*60;c=c-b*60-a*3600;if(b<10){b="0"+b}if(c<10){c="0"+c}this.timerEL.innerHTML=[this.label(),(!!a?a+":":""),b,":",c].join("");this.bseconds=c},label:function(){return menu.isLangJP()?"Œo‰ßŽžŠÔF":"Time: "},ACcheck:function(){if(this.current>this.nextACtime&&this.lastAnsCnt!=um.anscount&&!ans.inCheck){this.lastAnsCnt=um.anscount;if(!ans.autocheck()){return}this.worstACCost=Math.max(this.worstACCost,((new Date()).getTime()-this.current));this.nextACtime=this.current+(this.worstACCost<250?this.worstACCost*4+120:this.worstACCost*2+620)}},startUndoTimer:function(){this.undoWaitCount=this.undoStartCount;if(!this.TIDundo){this.TIDundo=setInterval(ee.binder(this,this.procUndo),this.undoInterval)}if(kc.inUNDO){um.undo()}else{if(kc.inREDO){um.redo()}}},stopUndoTimer:function(){kc.inUNDO=false;kc.inREDO=false;clearInterval(this.TIDundo);this.TIDundo=null},procUndo:function(){if(!kc.isCTRL||(!kc.inUNDO&&!kc.inREDO)){this.stopUndoTimer()}else{if(this.undoWaitCount>0){this.undoWaitCount--}else{if(kc.inUNDO){um.undo()}else{if(kc.inREDO){um.redo()}}}}}};Cell=function(a){this.cx;this.cy;this.px;this.py;this.ques;this.qnum;this.direc;this.qans;this.qsub;this.error;this.numobj="";this.numobj2="";this.allclear(a)};Cell.prototype={allclear:function(a){this.ques=0;this.qans=-1;this.qsub=0;this.ques=0;this.qnum=-1;if(k.puzzleid==="tilepaint"||k.puzzleid==="kakuro"){this.qnum=0}this.direc=0;if(k.puzzleid==="triplace"){this.direc=-1}this.error=0},ansclear:function(a){this.qans=-1;this.qsub=0;this.error=0},subclear:function(a){this.qsub=0;this.error=0}};Cross=function(a){this.cx;this.cy;this.px;this.py;this.ques;this.qnum;this.error;this.numobj="";this.allclear(a)};Cross.prototype={allclear:function(a){this.ques=0;this.qnum=-1;this.error=0},ansclear:function(a){this.error=0},subclear:function(a){this.error=0}};Border=function(a){this.cx;this.cy;this.px;this.py;this.ques;this.qnum;this.qans;this.qsub;this.line;this.color;this.error;this.numobj="";this.allclear(a)};Border.prototype={allclear:function(a){this.ques=0;if(k.puzzleid==="mejilink"&&a<k.qcols*(k.qrows-1)+(k.qcols-1)*k.qrows){this.ques=1}this.qnum=-1;if(k.puzzleid==="tentaisho"){this.qnum=0}this.qans=0;this.qsub=0;if(k.puzzleid==="bosanowa"){this.qsub=-1}this.line=0;this.color="";this.error=0},ansclear:function(a){this.qans=0;this.qsub=0;if(k.puzzleid==="bosanowa"){this.qsub=-1}this.line=0;this.color="";this.error=0},subclear:function(a){this.qsub=0;if(k.puzzleid==="bosanowa"){this.qsub=-1}this.error=0}};Board=function(){this.cell=[];this.cross=[];this.border=[];this.excell=[];this.cellmax=0;this.crossmax=0;this.bdmax=0;this.excellmax=0;this.bdinside=0;this.maxnum=99;this.defcell=new Cell(0);this.defcross=new Cross(0);this.defborder=new Border(0);this.enableLineNG=false;this.initBoardSize(k.qcols,k.qrows);this.setFunctions()};Board.prototype={initBoardSize:function(a,b){this.initGroup(k.CELL,this.cell,a*b);if(k.iscross){this.initGroup(k.CROSS,this.cross,(a+1)*(b+1))}if(k.isborder){this.initGroup(k.BORDER,this.border,2*a*b+(k.isoutsideborder===0?-1:1)*(a+b))}if(k.isextendcell===1){this.initGroup(k.EXCELL,this.excell,a+b+1)}else{if(k.isextendcell===2){this.initGroup(k.EXCELL,this.excell,2*a+2*b+4)}}this.initSpecial(a,b);if(!base.initProcess){tc.maxx+=(a-k.qcols)*2;tc.maxy+=(b-k.qrows)*2}k.qcols=a;k.qrows=b;this.setposAll();if(!base.initProcess){this.allclear()}},initGroup:function(c,d,b){var a=d.length;if(a>b){for(var e=a-1;e>=b;e--){this.hideNumobj(c,e);delete d[e];d.pop()}}else{if(a<b){for(var e=a;e<b;e++){d.push(this.getnewObj(c,e))}}}},initSpecial:function(){},setposAll:function(){this.setposCells();if(k.iscross){this.setposCrosses()}if(k.isborder){this.setposBorders()}if(k.isextendcell!=0){this.setposEXcells()}},setposCells:function(){var a=k.p0.x,b=k.p0.y;this.cellmax=this.cell.length;for(var d=0;d<this.cellmax;d++){var c=this.cell[d];c.cx=d%k.qcols;c.cy=mf(d/k.qcols);c.px=a+mf(c.cx*k.cwidth);c.py=b+mf(c.cy*k.cheight)}},setposCrosses:function(){var a=k.p0.x,b=k.p0.y;this.crossmax=this.cross.length;for(var d=0;d<this.crossmax;d++){var c=this.cross[d];c.cx=d%(k.qcols+1);c.cy=mf(d/(k.qcols+1));c.px=a+mf(c.cx*k.cwidth);c.py=b+mf(c.cy*k.cheight)}},setposBorders:function(){var a=k.p0.x,b=k.p0.y;this.bdinside=2*k.qcols*k.qrows-(k.qcols+k.qrows);this.bdmax=this.border.length;for(var d=0;d<this.bdmax;d++){var c=this.border[d];if(d>=0&&d<(k.qcols-1)*k.qrows){c.cx=(d%(k.qcols-1))*2+2;c.cy=mf(d/(k.qcols-1))*2+1}else{if(d>=(k.qcols-1)*k.qrows&&d<this.bdinside){c.cx=(d-(k.qcols-1)*k.qrows)%k.qcols*2+1;c.cy=mf((d-(k.qcols-1)*k.qrows)/k.qcols)*2+2}else{if(d>=this.bdinside&&d<this.bdinside+k.qcols){c.cx=(d-this.bdinside)*2+1;c.cy=0}else{if(d>=this.bdinside+k.qcols&&d<this.bdinside+2*k.qcols){c.cx=(d-this.bdinside-k.qcols)*2+1;c.cy=k.qrows*2}else{if(d>=this.bdinside+2*k.qcols&&d<this.bdinside+2*k.qcols+k.qrows){c.cx=0;c.cy=(d-this.bdinside-2*k.qcols)*2+1}else{if(d>=this.bdinside+2*k.qcols+k.qrows&&d<this.bdinside+2*(k.qcols+k.qrows)){c.cx=k.qcols*2;c.cy=(d-this.bdinside-2*k.qcols-k.qrows)*2+1}}}}}}c.px=a+mf(c.cx*k.cwidth/2);c.py=b+mf(c.cy*k.cheight/2)}},setposEXcells:function(){var a=k.p0.x,b=k.p0.y;this.excellmax=this.excell.length;for(var d=0;d<this.excellmax;d++){var c=this.excell[d];if(k.isextendcell===1){if(d<k.qcols){c.cx=d;c.cy=-1}else{if(d<k.qcols+k.qrows){c.cx=-1;c.cy=d-k.qcols}else{c.cx=-1;c.cy=-1}}}else{if(k.isextendcell===2){if(d<k.qcols){c.cx=d;c.cy=-1}else{if(d<2*k.qcols){c.cx=d-k.qcols;c.cy=k.qrows}else{if(d<2*k.qcols+k.qrows){c.cx=-1;c.cy=d-2*k.qcols}else{if(d<2*k.qcols+2*k.qrows){c.cx=k.qcols;c.cy=d-2*k.qcols-k.qrows}else{if(d<2*k.qcols+2*k.qrows+1){c.cx=-1;c.cy=-1}else{if(d<2*k.qcols+2*k.qrows+2){c.cx=k.qcols;c.cy=-1}else{if(d<2*k.qcols+2*k.qrows+3){c.cx=-1;c.cy=k.qrows}else{if(d<2*k.qcols+2*k.qrows+4){c.cx=k.qcols;c.cy=k.qrows}else{c.cx=-1;c.cy=-1}}}}}}}}}}c.px=a+c.cx*k.cwidth;c.py=b+c.cy*k.cheight}},allclear:function(){for(var a=0;a<this.cellmax;a++){this.cell[a].allclear(a)}for(var a=0;a<this.crossmax;a++){this.cross[a].allclear(a)}for(var a=0;a<this.bdmax;a++){this.border[a].allclear(a)}for(var a=0;a<this.excellmax;a++){this.excell[a].allclear(a)}},ansclear:function(){for(var a=0;a<this.cellmax;a++){this.cell[a].ansclear(a)}for(var a=0;a<this.crossmax;a++){this.cross[a].ansclear(a)}for(var a=0;a<this.bdmax;a++){this.border[a].ansclear(a)}for(var a=0;a<this.excellmax;a++){this.excell[a].ansclear(a)}},subclear:function(){for(var a=0;a<this.cellmax;a++){this.cell[a].subclear(a)}for(var a=0;a<this.crossmax;a++){this.cross[a].subclear(a)}for(var a=0;a<this.bdmax;a++){this.border[a].subclear(a)}for(var a=0;a<this.excellmax;a++){this.excell[a].subclear(a)}},errclear:function(){if(!ans.errDisp){return}for(var a=0;a<this.cellmax;a++){this.cell[a].error=0}for(var a=0;a<this.crossmax;a++){this.cross[a].error=0}for(var a=0;a<this.bdmax;a++){this.border[a].error=0}for(var a=0;a<this.excellmax;a++){this.excell[a].error=0}ans.errDisp=false;pc.paintAll()},getnewObj:function(a,b){if(a===k.CELL||a===k.EXCELL){return(new Cell(b))}else{if(a===k.CROSS){return(new Cross(b))}else{if(a===k.BORDER){return(new Border(b))}}}},isNullObj:function(a,b){if(a===k.CELL){return((this.cell[b].qans===this.defcell.qans)&&(this.cell[b].qsub===this.defcell.qsub)&&(this.cell[b].ques===this.defcell.ques)&&(this.cell[b].qnum===this.defcell.qnum)&&(this.cell[b].direc===this.defcell.direc))}else{if(a===k.CROSS){return(this.cross[b].qnum===this.defcross.qnum)}else{if(a===k.BORDER){return((this.border[b].qans===this.defborder.qans)&&(this.border[b].qsub===this.defborder.qsub)&&(this.border[b].ques===this.defborder.ques)&&(this.border[b].qnum===this.defborder.qnum)&&(this.border[b].line===this.defborder.line))}else{if(a===k.EXCELL){return((this.excell[b].qnum===this.defcell.qnum)&&(this.excell[b].direc===this.defcell.direc))}}}}return true},hideNumobj:function(a,b){if(a===k.CELL){pc.hideEL(this.cell[b].numobj);pc.hideEL(this.cell[b].numobj2)}else{if(a===k.CROSS){pc.hideEL(this.cross[b].numobj)}else{if(a===k.BORDER){pc.hideEL(this.border[b].numobj)}else{if(a===k.EXCELL){pc.hideEL(this.excell[b].numobj);pc.hideEL(this.excell[b].numobj2)}}}}},cnum:function(a,b){return(a>=0&&a<=k.qcols-1&&b>=0&&b<=k.qrows-1)?a+b*k.qcols:-1},cnum2:function(a,d,c,b){return(a>=0&&a<=c-1&&d>=0&&d<=b-1)?a+d*c:-1},xnum:function(a,b){return(a>=0&&a<=k.qcols&&b>=0&&b<=k.qrows)?a+b*(k.qcols+1):-1},xnum2:function(a,d,c,b){return(a>=0&&a<=c&&d>=0&&d<=b)?a+d*(c+1):-1},bnum:function(a,b){return this.bnum2(a,b,k.qcols,k.qrows)},bnum2:function(a,d,c,b){if(a>=1&&a<=c*2-1&&d>=1&&d<=b*2-1){if(!(a&1)&&(d&1)){return((a>>1)-1)+(d>>1)*(c-1)}else{if((a&1)&&!(d&1)){return(a>>1)+((d>>1)-1)*c+(c-1)*b}}}else{if(k.isoutsideborder==1){if(d===0&&(a&1)&&(a>=1&&a<=2*c-1)){return(c-1)*b+c*(b-1)+(a>>1)}else{if(d===2*b&&(a&1)&&(a>=1&&a<=2*c-1)){return(c-1)*b+c*(b-1)+c+(a>>1)}else{if(a===0&&(d&1)&&(d>=1&&d<=2*b-1)){return(c-1)*b+c*(b-1)+2*c+(d>>1)}else{if(a===2*c&&(d&1)&&(d>=1&&d<=2*b-1)){return(c-1)*b+c*(b-1)+2*c+b+(d>>1)}}}}}}return -1},exnum:function(a,b){return this.exnum2(a,b,k.qcols,k.qrows)},exnum2:function(a,d,c,b){if(k.isextendcell===1){if(a===-1&&d===-1){return c+b}else{if(d===-1&&a>=0&&a<c){return a}else{if(a===-1&&d>=0&&d<b){return c+d}}}}else{if(k.isextendcell===2){if(d===-1&&a>=0&&a<c){return a}else{if(d===b&&a>=0&&a<c){return c+a}else{if(a===-1&&d>=0&&d<b){return 2*c+d}else{if(a===c&&d>=0&&d<b){return 2*c+b+d}else{if(a===-1&&d===-1){return 2*c+2*b}else{if(a===c&&d===-1){return 2*c+2*b+1}else{if(a===-1&&d===b){return 2*c+2*b+2}else{if(a===c&&d===b){return 2*c+2*b+3}}}}}}}}}}return -1},getClistByPosition:function(c,e,b,d){var f=[];for(var a=c;a<=Math.min(b,k.qcols-1);a++){for(var i=e;i<=Math.min(d,k.qrows-1);i++){var h=this.cnum(a,i);if(h!==-1){f.push(h)}}}return f},up:function(a){return this.cell[a]?this.cnum(this.cell[a].cx,this.cell[a].cy-1):-1},dn:function(a){return this.cell[a]?this.cnum(this.cell[a].cx,this.cell[a].cy+1):-1},lt:function(a){return this.cell[a]?this.cnum(this.cell[a].cx-1,this.cell[a].cy):-1},rt:function(a){return this.cell[a]?this.cnum(this.cell[a].cx+1,this.cell[a].cy):-1},ub:function(a){return this.cell[a]?this.bnum(2*this.cell[a].cx+1,2*this.cell[a].cy):-1},db:function(a){return this.cell[a]?this.bnum(2*this.cell[a].cx+1,2*this.cell[a].cy+2):-1},lb:function(a){return this.cell[a]?this.bnum(2*this.cell[a].cx,2*this.cell[a].cy+1):-1},rb:function(a){return this.cell[a]?this.bnum(2*this.cell[a].cx+2,2*this.cell[a].cy+1):-1},cc1:function(a){return this.cnum((bd.border[a].cx-bd.border[a].cy%2)>>1,(bd.border[a].cy-bd.border[a].cx%2)>>1)},cc2:function(a){return this.cnum((bd.border[a].cx+bd.border[a].cy%2)>>1,(bd.border[a].cy+bd.border[a].cx%2)>>1)},crosscc1:function(a){return this.xnum((bd.border[a].cx-bd.border[a].cx%2)>>1,(bd.border[a].cy-bd.border[a].cy%2)>>1)},crosscc2:function(a){return this.xnum((bd.border[a].cx+bd.border[a].cx%2)>>1,(bd.border[a].cy+bd.border[a].cy%2)>>1)},bcntCross:function(a,c){var b=0;if(this.isBlack(this.cnum(a-1,c-1))){b++}if(this.isBlack(this.cnum(a,c-1))){b++}if(this.isBlack(this.cnum(a-1,c))){b++}if(this.isBlack(this.cnum(a,c))){b++}return b},isLPup:function(a){return({101:1,102:1,104:1,105:1}[this.QuC(a)]===1)},isLPdown:function(a){return({101:1,102:1,106:1,107:1}[this.QuC(a)]===1)},isLPleft:function(a){return({101:1,103:1,105:1,106:1}[this.QuC(a)]===1)},isLPright:function(a){return({101:1,103:1,104:1,107:1}[this.QuC(a)]===1)},isnoLPup:function(a){return({1:1,4:1,5:1,21:1,103:1,106:1,107:1}[this.QuC(a)]===1)},isnoLPdown:function(a){return({1:1,2:1,3:1,21:1,103:1,104:1,105:1}[this.QuC(a)]===1)},isnoLPleft:function(a){return({1:1,2:1,5:1,22:1,102:1,104:1,107:1}[this.QuC(a)]===1)},isnoLPright:function(a){return({1:1,3:1,4:1,22:1,102:1,105:1,106:1}[this.QuC(a)]===1)},isLPMarked:function(a){return bd.border[a].cx&1?(bd.isLPdown(bd.cc1(a))||bd.isLPup(bd.cc2(a))):(bd.isLPright(bd.cc1(a))||bd.isLPleft(bd.cc2(a)))},isLPCombined:function(a){return bd.border[a].cx&1?(bd.isLPdown(bd.cc1(a))&&bd.isLPup(bd.cc2(a))):(bd.isLPright(bd.cc1(a))&&bd.isLPleft(bd.cc2(a)))},isLineNG:function(a){return bd.border[a].cx&1?(bd.isnoLPdown(bd.cc1(a))||bd.isnoLPup(bd.cc2(a))):(bd.isnoLPright(bd.cc1(a))||bd.isnoLPleft(bd.cc2(a)))},checkLPCombined:function(b){var a;a=this.ub(b);if(a!==-1&&this.border[a].line===0&&this.isLPCombined(a)){this.sLiB(a,1)}a=this.db(b);if(a!==-1&&this.border[a].line===0&&this.isLPCombined(a)){this.sLiB(a,1)}a=this.lb(b);if(a!==-1&&this.border[a].line===0&&this.isLPCombined(a)){this.sLiB(a,1)}a=this.rb(b);if(a!==-1&&this.border[a].line===0&&this.isLPCombined(a)){this.sLiB(a,1)}},nummaxfunc:function(a){return this.maxnum},sQuC:function(b,a){um.addOpe(k.CELL,k.QUES,b,this.cell[b].ques,a);this.cell[b].ques=a},sQnC:function(c,b){if(k.dispzero===0&&b===0){return}var a=this.cell[c].qnum;um.addOpe(k.CELL,k.QNUM,c,a,b);this.cell[c].qnum=b;if(um.isenableInfo()&&(area.numberColony&&(b!==-1^area.bcell.id[c]!==-1))){area.setCell(c,(b!==-1?1:0))}},sQaC:function(c,b){var a=this.cell[c].qans;um.addOpe(k.CELL,k.QANS,c,a,b);this.cell[c].qans=b;if(um.isenableInfo()&&((area.bblock&&(b!==-1^area.bcell.id[c]!==-1))||(area.wblock&&(b===-1^area.wcell.id[c]!==-1)))){area.setCell(c,(b!==-1?1:0))}},sQsC:function(b,a){um.addOpe(k.CELL,k.QSUB,b,this.cell[b].qsub,a);this.cell[b].qsub=a},sDiC:function(b,a){um.addOpe(k.CELL,k.DIREC,b,this.cell[b].direc,a);this.cell[b].direc=a},QuC:function(a){return(a!==-1?this.cell[a].ques:-1)},QnC:function(a){return(a!==-1?this.cell[a].qnum:-1)},QaC:function(a){return(a!==-1?this.cell[a].qans:-1)},QsC:function(a){return(a!==-1?this.cell[a].qsub:-1)},DiC:function(a){return(a!==-1?this.cell[a].direc:-1)},sQnE:function(b,a){um.addOpe(k.EXCELL,k.QNUM,b,this.excell[b].qnum,a);this.excell[b].qnum=a},sDiE:function(b,a){um.addOpe(k.EXCELL,k.DIREC,b,this.excell[b].direc,a);this.excell[b].direc=a},QnE:function(a){return(a!==-1?this.excell[a].qnum:-1)},DiE:function(a){return(a!==-1?this.excell[a].direc:-1)},sQuX:function(b,a){um.addOpe(k.CROSS,k.QUES,b,this.cross[b].ques,a);this.cross[b].ques=a},sQnX:function(b,a){um.addOpe(k.CROSS,k.QNUM,b,this.cross[b].qnum,a);this.cross[b].qnum=a},QuX:function(a){return(a!==-1?this.cross[a].ques:-1)},QnX:function(a){return(a!==-1?this.cross[a].qnum:-1)},sQuB:function(c,b){var a=this.border[c].ques;um.addOpe(k.BORDER,k.QUES,c,a,b);this.border[c].ques=b;if(um.isenableInfo()&&(b>0^a>0)){area.call_setBorder(c,b,k.QUES)}},sQnB:function(b,a){um.addOpe(k.BORDER,k.QNUM,b,this.border[b].qnum,a);this.border[b].qnum=a},sQaB:function(c,b){if(this.border[c].ques!=0){return}var a=this.border[c].qans;um.addOpe(k.BORDER,k.QANS,c,a,b);this.border[c].qans=b;if(um.isenableInfo()&&(b>0^a>0)){if(k.isborderAsLine){line.setLine(c,b)}else{area.call_setBorder(c,b,k.QANS)}}},sQsB:function(b,a){um.addOpe(k.BORDER,k.QSUB,b,this.border[b].qsub,a);this.border[b].qsub=a},sLiB:function(c,b){if(this.enableLineNG&&(b==1?bd.isLineNG:bd.isLPCombined)(c)){return}var a=this.border[c].line;um.addOpe(k.BORDER,k.LINE,c,a,b);this.border[c].line=b;if(um.isenableInfo()&&(b>0^a>0)){line.setLine(c,b)}},QuB:function(a){return(a!==-1?this.border[a].ques:-1)},QnB:function(a){return(a!==-1?this.border[a].qnum:-1)},QaB:function(a){return(a!==-1?this.border[a].qans:-1)},QsB:function(a){return(a!==-1?this.border[a].qsub:-1)},LiB:function(a){return(a!==-1?this.border[a].line:-1)},sErC:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]!==-1){this.cell[c[b]].error=a}}},sErX:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]!==-1){this.cross[c[b]].error=a}}},sErB:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]!==-1){this.border[c[b]].error=a}}},sErE:function(c,a){if(!ans.isenableSetError()){return}if(!c.push){c=[c]}for(var b=0;b<c.length;b++){if(c[b]!==-1){this.excell[c[b]].error=a}}},sErBAll:function(a){if(!ans.isenableSetError()){return}for(var b=0;b<bd.bdmax;b++){this.border[b].error=a}},ErC:function(a){return(a!==-1?this.cell[a].error:0)},ErX:function(a){return(a!==-1?this.cross[a].error:0)},ErB:function(a){return(a!==-1?this.border[a].error:0)},ErE:function(a){return(a!==-1?this.excell[a].error:0)},setFunctions:function(){this.isLine=((!k.isborderAsLine)?function(a){return(a!==-1&&bd.border[a].line>0)}:function(a){return(a!==-1&&bd.border[a].qans>0)});this.setLine=((!k.isborderAsLine)?function(a){this.sLiB(a,1);this.sQsB(a,0)}:function(a){this.sQaB(a,1);this.sQsB(a,0)});this.setPeke=((!k.isborderAsLine)?function(a){this.sLiB(a,0);this.sQsB(a,2)}:function(a){this.sQaB(a,0);this.sQsB(a,2)});this.removeLine=((!k.isborderAsLine)?function(a){this.sLiB(a,0);this.sQsB(a,0)}:function(a){this.sQaB(a,0);this.sQsB(a,0)});this.isNum=((k.isAnsNumber)?function(a){return(a!==-1&&(bd.cell[a].qnum!==-1||bd.cell[a].qans!==-1))}:function(a){return(a!==-1&&bd.cell[a].qnum!==-1)});this.noNum=((k.isAnsNumber)?function(a){return(a===-1||(bd.cell[a].qnum===-1&&bd.cell[a].qans===-1))}:function(a){return(a===-1||bd.cell[a].qnum===-1)});this.isValidNum=((k.isAnsNumber)?function(a){return(a!==-1&&(bd.cell[a].qnum>=0||(bd.cell[a].qans>=0&&bd.cell[a].qnum===-1)))}:function(a){return(a!==-1&&bd.cell[a].qnum>=0)});this.sameNumber=function(b,a){return(bd.isValidNum(b)&&(bd.getNum(b)===bd.getNum(a)))};this.getNum=((k.isAnsNumber)?function(a){return(a!==-1?this.cell[a].qnum!==-1?this.cell[a].qnum:this.cell[a].qans:-1)}:function(a){return(a!==-1?this.cell[a].qnum:-1)});this.setNum=(((k.NumberIsWhite)?function(b,a){if(!k.dispzero&&a===0){return}this.sQnC(b,a);this.sQaC(b,bd.defcell.qnum)}:(k.isAnsNumber)?function(b,a){if(!k.dispzero&&a===0){return}if(k.editmode){this.sQnC(b,a);this.sQaC(b,bd.defcell.qnum)}else{if(this.cell[b].qnum===bd.defcell.qnum){this.sQaC(b,a)}}this.sQsC(b,0)}:function(b,a){if(!k.dispzero&&a===0){return}this.sQnC(b,a)}))},isBlack:function(a){return(a!==-1&&bd.cell[a].qans===1)},isWhite:function(a){return(a!==-1&&bd.cell[a].qans!==1)},setBlack:function(a){this.sQaC(a,1)},setWhite:function(a){this.sQaC(a,-1)},isBorder:function(a){return(a!==-1&&(bd.border[a].ques>0||bd.border[a].qans>0))},setBorder:function(a){if(k.editmode){this.sQuB(a,1);this.sQaB(a,0)}else{if(this.QuB(a)!==1){this.sQaB(a,1)}}},removeBorder:function(a){if(k.editmode){this.sQuB(a,0);this.sQaB(a,0)}else{if(this.QuB(a)!==1){this.sQaB(a,0)}}},setBsub:function(a){this.sQsB(a,1)},removeBsub:function(a){this.sQsB(a,0)}};Graphic=function(){this.gridcolor="black";this.Cellcolor="black";this.errcolor1="rgb(224, 0, 0)";this.errcolor2="rgb(64, 64, 255)";this.errcolor3="rgb(0, 191, 0)";this.circledcolor="white";this.MBcolor="rgb(255, 160, 127)";this.qsubcolor1="rgb(160,255,160)";this.qsubcolor2="rgb(255,255,127)";this.qsubcolor3="rgb(192,192,192)";this.fontcolor="black";this.fontAnscolor="rgb(0, 160, 0)";this.fontErrcolor="rgb(191, 0, 0)";this.BCell_fontcolor="rgb(224, 224, 224)";this.borderfontcolor="black";this.bcolor="white";this.dotcolor="black";this.errbcolor1="rgb(255, 160, 160)";this.errbcolor2="rgb(64, 255, 64)";this.icecolor="rgb(192, 224, 255)";this.TTcolor="rgb(127,255,127)";this.BorderQuescolor="black";this.BorderQanscolor="rgb(0, 191, 0)";this.BorderQsubcolor="rgb(255, 0, 255)";this.errBorderQanscolor2="rgb(160, 160, 160)";this.BBcolor="rgb(96, 96, 96)";this.linecolor="rgb(0, 160, 0)";this.pekecolor="rgb(32, 32, 255)";this.errlinecolor1="rgb(255, 0, 0)";this.errlinecolor2="rgb(160, 160, 160)";this.targetColor1="rgb(255, 64,  64)";this.targetColor3="rgb(64,  64, 255)";this.gridcolor_BLACK="black";this.gridcolor_LIGHT="rgb(127, 127, 127)";this.gridcolor_DLIGHT="rgb(160, 160, 160)";this.gridcolor_SLIGHT="rgb(191, 191, 191)";this.gridcolor_THIN="rgb(224, 224, 224)";this.bcolor_GREEN="rgb(160, 255, 160)";this.errbcolor1_DARK="rgb(255, 127, 127)";this.linecolor_LIGHT="rgb(0, 192, 0)";this.fontsizeratio=1;this.crosssize=0.4;this.circleratio=[0.4,0.34];this.lw=1;this.lm=1;this.addlw=0;this.chassisflag=true;this.zstable=false;this.textenable=false;this.lastHdeg=0;this.lastYdeg=0;this.minYdeg=0.18;this.maxYdeg=0.7;var c={className:"divnum",unselectable:"on"};this.EL_NUMOBJ=ee.addTemplate("numobj_parent","div",c,null,null);var b=false,a=false;this.setFunctions()};Graphic.prototype={onresize_func:function(){this.lw=(mf(k.cwidth/12)>=3?mf(k.cwidth/12):3);this.lm=mf((this.lw-1)/2)},already:(!k.br.IE?f_true:function(){return uuCanvas.already()}),paint:function(b,d,a,c){},paintAll:((!k.br.IE)?function(){this.paint(-1,-1,k.qcols,k.qrows)}:function(){if(this.already()){this.paint(-1,-1,k.qcols,k.qrows)}}),paintBorder:function(a){if(isNaN(a)||!bd.border[a]){return}if(bd.border[a].cx&1){this.paint((bd.border[a].cx>>1)-1,(bd.border[a].cy>>1)-1,(bd.border[a].cx>>1)+1,(bd.border[a].cy>>1))}else{this.paint((bd.border[a].cx>>1)-1,(bd.border[a].cy>>1)-1,(bd.border[a].cx>>1),(bd.border[a].cy>>1)+1)}},paintLine:function(a){if(isNaN(a)||!bd.border[a]){return}if(bd.border[a].cx&1){this.paint((bd.border[a].cx>>1),(bd.border[a].cy>>1)-1,(bd.border[a].cx>>1),(bd.border[a].cy>>1))}else{this.paint((bd.border[a].cx>>1)-1,(bd.border[a].cy>>1),(bd.border[a].cx>>1),(bd.border[a].cy>>1))}},paintCell:function(a){if(isNaN(a)||!bd.cell[a]){return}this.paint(bd.cell[a].cx,bd.cell[a].cy,bd.cell[a].cx,bd.cell[a].cy)},paintEXcell:function(a){if(isNaN(a)||!bd.excell[a]){return}this.paint(bd.excell[a].cx,bd.excell[a].cy,bd.excell[a].cx,bd.excell[a].cy)},cellinside:function(d,f,b,e){var h=[];for(var j=f;j<=e;j++){for(var a=d;a<=b;a++){var i=bd.cnum(a,j);if(i!==-1){h.push(i)}}}return h},crossinside:function(d,f,b,e){var h=[];for(var j=f;j<=e;j++){for(var a=d;a<=b;a++){var i=bd.xnum(a,j);if(i!==-1){h.push(i)}}}return h},borderinside:function(b,d,a,c){var h=[];for(var e=d;e<=c;e++){for(var f=b;f<=a;f++){if(f&1===e&1){continue}var i=bd.bnum(f,e);if(i!==-1){h.push(i)}}}return h},excellinside:function(e,h,d,f){var b=[];for(var j=h;j<=f;j++){for(var a=e;a<=d;a++){var i=bd.exnum(a,j);if(i!==-1){b.push(i)}}}return b},cellinside_cond:function(b,j,a,i,d){var l=[];for(var e=j;e<=i;e++){for(var f=b;f<=a;f++){var h=bd.cnum(f,e);if(h!==-1&&d(h)){l.push(h)}}}return l},getNewLineColor:function(){var i=0;while(1){var f=mf(Math.random()*384)-64;if(f<0){f=0}if(f>255){f=255}var e=mf(Math.random()*384)-64;if(e<0){e=0}if(e>255){e=255}var j=mf(Math.random()*384)-64;if(j<0){j=0}if(j>255){j=255}var a=Math.max(f,Math.max(e,j));var l=Math.min(f,Math.min(e,j));var c=0;var b=(a+l)*0.5/255;var d=(a===l?0:(a-l)/((b<=0.5)?(a+l):(2*255-a-l)));if(a==l){c=0}else{if(f>=e&&f>=j){c=(60*(e-j)/(a-l)+360)%360}else{if(e>=f&&e>=j){c=(120+60*(j-f)/(a-l)+360)%360}else{if(j>=e&&j>=f){c=(240+60*(f-e)/(a-l)+360)%360}}}}var h=(0.29891*f+0.58661*e+0.11448*j)/255;if((this.minYdeg<h&&h<this.maxYdeg)&&(Math.abs(this.lastYdeg-h)>0.15)&&(d<0.02||0.4<d)&&(((360+this.lastHdeg-c)%360>=45)&&((360+this.lastHdeg-c)%360<=315))){this.lastHdeg=c;this.lastYdeg=h;return"rgb("+f+","+e+","+j+")"}i++;if(i>100){return"rgb("+f+","+e+","+j+")"}}},inputPath:function(c,a){g.beginPath();g.moveTo(mf(c[0]+c[2]),mf(c[1]+c[3]));for(var b=4;b<c.length;b+=2){g.lineTo(mf(c[0]+c[b+0]),mf(c[1]+c[b+1]))}if(a){g.closePath()}},drawBlackCells:function(b,f,a,e){var l="c_fullb_";if(!k.br.IE&&this.isdrawBC&&!this.isdrawBD){b--;f--;a++;e++}var h=this.cellinside(b,f,a,e);for(var d=0;d<h.length;d++){var j=h[d];if(this.setCellColor(j)){if(this.vnop(l+j,1)){g.fillRect(bd.cell[j].px,bd.cell[j].py,k.cwidth+1,k.cheight+1)}}else{this.vhide(l+j);continue}}this.vinc();this.isdrawBC=true},setCellColor:function(b){var a=bd.cell[b].error;if(bd.cell[b].qans!==1){return false}else{if(a===0){g.fillStyle=this.Cellcolor;return true}else{if(a===1){g.fillStyle=this.errcolor1;return true}}}return false},setCellColorFunc:function(a){switch(a){case"qnum":this.setCellColor=function(d){var b=bd.cell[d].error;if(bd.cell[d].qnum===-1){return false}else{if(b===0){g.fillStyle=this.Cellcolor;return true}else{if(b===1){g.fillStyle=this.errcolor1;return true}}}return false};break;default:break}},drawBGCells:function(b,f,a,e){var l="c_full_";var h=this.cellinside(b,f,a,e);for(var d=0;d<h.length;d++){var j=h[d];if(this.setBGCellColor(j)){if(this.vnop(l+j,1)){g.fillRect(bd.cell[j].px,bd.cell[j].py,k.cwidth+1,k.cheight+1)}}else{this.vhide(l+j);continue}}this.vinc()},setBGCellColor:function(a){if(bd.cell[a].error===1){g.fillStyle=this.errbcolor1;return true}return false},setBGCellColorFunc:function(a){switch(a){case"error2":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.error===2){g.fillStyle=this.errbcolor2;return true}}return false};break;case"qans1":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.qans===1){g.fillStyle=(b.error===1?this.errcolor1:this.Cellcolor);return true}if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1&&this.bcolor!=="white"){g.fillStyle=this.bcolor;return true}}return false};break;case"qans2":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.qans===1){if(b.error===0){g.fillStyle=this.Cellcolor}else{if(b.error===1){g.fillStyle=this.errcolor1}else{if(b.error===2){g.fillStyle=this.errcolor2}}}return true}if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1&&this.bcolor!=="white"){g.fillStyle=this.bcolor;return true}}return false};break;case"qsub1":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1){g.fillStyle=this.bcolor;return true}}return false};break;case"qsub2":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1){g.fillStyle=this.qsubcolor1;return true}else{if(b.qsub===2){g.fillStyle=this.qsubcolor2;return true}}}return false};break;case"qsub3":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.qsub===1){g.fillStyle=this.qsubcolor1;return true}else{if(b.qsub===2){g.fillStyle=this.qsubcolor2;return true}else{if(b.qsub===3){g.fillStyle=this.qsubcolor3;return true}}}}return false};break;case"icebarn":this.setBGCellColor=function(d){var b=bd.cell[d];if(b.error===1){g.fillStyle=this.errbcolor1;return true}else{if(b.ques===6){g.fillStyle=this.icecolor;return true}}return false};break;default:break}},drawRDotCells:function(b,l,a,j){var d=k.cwidth*0.06;d=(d>2?d:2);var f="c_rdot_";var m=this.cellinside(b,l,a,j);for(var e=0;e<m.length;e++){var h=m[e];if(bd.cell[h].qsub===1){g.fillStyle=this.dotcolor;if(this.vnop(f+h,1)){g.beginPath();g.arc(bd.cell[h].px+k.cwidth/2,bd.cell[h].py+k.cheight/2,d,0,Math.PI*2,false);g.fill()}}else{this.vhide(f+h)}}this.vinc()},drawDotCells:function(b,l,a,j){var h=k.cwidth*0.15;var e="c_dot_";var m=this.cellinside(b,l,a,j);for(var d=0;d<m.length;d++){var f=m[d];if(bd.cell[f].qsub===1){g.fillStyle=this.dotcolor;if(this.vnop(e+f,1)){g.fillRect(bd.cell[f].px+mf(k.cwidth/2)-mf(h/2),bd.cell[f].py+mf(k.cheight/2)-mf(h/2),h,h)}}else{this.vhide(e+f)}}this.vinc()},drawNumbers:function(b,e,a,d){var f=this.cellinside(b,e,a,d);for(var c=0;c<f.length;c++){this.dispnumCell(f[c])}this.vinc()},drawArrowNumbers:function(x,d,w,b){var a=["c_ar1_","c_dt1_","c_dt2_","c_ar3_","c_dt3_","c_dt4_"];var p=mf(k.cwidth*0.7);var h=mf((k.cwidth-p)/2);var f=(mf(k.cwidth/24)>=1?mf(k.cwidth/24):1);var m=mf((f-1)/2);if(!k.br.IE&&this.isdrawBC&&!this.isdrawBD){x--;d--;w++;b++}var z=this.cellinside(x,d,w,b);for(var v=0;v<z.length;v++){var y=z[v];if(bd.cell[y].qnum!==-1&&(bd.cell[y].qnum!==-2||k.isDispHatena)){var q=px=bd.cell[y].px,l=py=bd.cell[y].py,t=bd.cell[y].direc;if(bd.cell[y].qans===1){g.fillStyle=this.BCell_fontcolor}else{if(bd.cell[y].error===1){g.fillStyle=this.fontErrcolor}else{g.fillStyle=this.fontcolor}}if(t===k.UP||t===k.DN){q+=(k.cwidth-mf(h*1.5)-m);l+=(h+1);if(this.vnop(a[0]+y,1)){g.fillRect(q,l,f,p)}q+=mf(f/2);if(t===k.UP){if(this.vnop(a[1]+y,1)){this.inputPath([q,l,0,0,-p/6,p/3,p/6,p/3],true);g.fill()}}else{this.vhide(a[1]+y)}if(t===k.DN){if(this.vnop(a[2]+y,1)){this.inputPath([q,l+p,0,0,-p/6,-p/3,p/6,-p/3],true);g.fill()}}else{this.vhide(a[2]+y)}}else{this.vhide([a[0]+y,a[1]+y,a[2]+y])}if(t===k.LT||t===k.RT){q+=(h+1);l+=(mf(h*1.5)-m);if(this.vnop(a[3]+y,1)){g.fillRect(q,l,p,f)}l+=mf(f/2);if(t===k.LT){if(this.vnop(a[4]+y,1)){this.inputPath([q,l,0,0,p/3,-p/6,p/3,p/6],true);g.fill()}}else{this.vhide(a[4]+y)}if(t===k.RT){if(this.vnop(a[5]+y,1)){this.inputPath([q+p,l,0,0,-p/3,-p/6,-p/3,p/6],true);g.fill()}}else{this.vhide(a[5]+y)}}else{this.vhide([a[3]+y,a[4]+y,a[5]+y])}if(!bd.cell[y].numobj){bd.cell[y].numobj=this.CreateDOMAndSetNop()}var j=bd.getNum(y),r=(j>=0?""+j:"?");var o=(j<10?0.8:(j<100?0.7:0.55));var u=g.fillStyle;var e=1;if(t===k.UP||t===k.DN){e=6;o*=0.85}else{if(t===k.LT||t===k.RT){e=7;o*=0.85}}this.dispnum(bd.cell[y].numobj,e,r,o,u,px,py)}else{this.vhide([a[0]+y,a[1]+y,a[2]+y,a[3]+y,a[4]+y,a[5]+y]);this.hideEL(bd.cell[y].numobj)}}this.vinc()},drawQuesHatenas:function(c,f,b,e){var h=this.cellinside(c,f,b,e);for(var d=0;d<h.length;d++){var j=bd.cell[h[d]];if(j.ques!==-2){this.hideEL(j.numobj);continue}if(!j.numobj){j.numobj=this.CreateDOMAndSetNop()}var a=(j.error===1?this.fontErrcolor:this.fontcolor);this.dispnum(j.numobj,1,"?",0.8,a,j.px,j.py)}this.vinc()},drawCrosses:function(b,l,a,j){var e=mf(k.cwidth*this.crosssize+1);var d=["x_cp1_","x_cp2_"];g.lineWidth=1;var m=this.crossinside(b,l,a,j);for(var f=0;f<m.length;f++){var h=m[f];if(bd.cross[h].qnum!==-1){g.fillStyle=(bd.cross[h].error===1?this.errcolor1:"white");if(this.vnop(d[0]+h,1)){g.beginPath();g.arc(bd.cross[h].px,bd.cross[h].py,e,0,Math.PI*2,false);g.fill()}g.strokeStyle="black";if(this.vnop(d[1]+h,0)){if(k.br.IE){g.beginPath();g.arc(bd.cross[h].px,bd.cross[h].py,e,0,Math.PI*2,false)}g.stroke()}}else{this.vhide([d[0]+h,d[1]+h])}this.dispnumCross(h)}this.vinc()},drawCrossMarks:function(b,l,a,j){var d=k.cwidth*this.crosssize;var f="x_cm_";var m=this.crossinside(b-1,l-1,a+1,j+1);for(var e=0;e<m.length;e++){var h=m[e];if(bd.cross[h].qnum===1){g.fillStyle=(bd.cross[h].error===1?this.errcolor1:this.Cellcolor);if(this.vnop(f+h,1)){g.beginPath();g.arc(bd.cross[h].px,bd.cross[h].py,d,0,Math.PI*2,false);g.fill()}}else{this.vhide(f+h)}}this.vinc()},drawBorders:function(b,e,a,d){var f=this.borderinside(b*2-2,e*2-2,a*2+2,d*2+2);for(var c=0;c<f.length;c++){var h=f[c];if(bd.border[h].qans!==1){g.fillStyle=this.BorderQuescolor}else{if(bd.border[h].error===1){g.fillStyle=this.errcolor1}else{if(bd.border[h].error===2){g.fillStyle=this.errBorderQanscolor2}else{g.fillStyle=this.BorderQanscolor}}}this.drawBorder1x(bd.border[h].cx,bd.border[h].cy,bd.isBorder(h))}this.vinc();this.isdrawBD=true},drawBordersAsLine:function(b,e,a,d){var f=this.borderinside(b*2-2,e*2-2,a*2+2,d*2+2);for(var c=0;c<f.length;c++){var h=f[c];if(bd.border[h].qans!==1){g.fillStyle=this.BorderQuescolor}else{g.fillStyle=this.getLineColor(h)}this.drawBorder1x(bd.border[h].cx,bd.border[h].cy,bd.isBorder(h))}this.vinc();this.addlw=0},drawIceBorders:function(d,j,a,h){g.fillStyle=this.Cellcolor;var c=this.borderinside(d*2-2,j*2-2,a*2+2,h*2+2);for(var e=0;e<c.length;e++){var b=c[e],m=bd.cc1(b),l=bd.cc2(b);var f=(m!==-1&&l!==-1&&(bd.cell[m].ques===6^bd.cell[l].ques===6));this.drawBorder1x(bd.border[b].cx,bd.border[b].cy,f)}this.vinc()},drawBorder1x:function(f,e,b){var a=["b_bd",f,e].join("_");if(!b){this.vhide(a);return}if(this.vnop(a,1)){var d=this.lw+this.addlw,c=this.lm;if(e&1){g.fillRect(k.p0.x+mf(f*k.cwidth/2)-c,k.p0.x+mf((e-1)*k.cheight/2)-c,d,k.cheight+d)}else{if(f&1){g.fillRect(k.p0.x+mf((f-1)*k.cwidth/2)-c,k.p0.x+mf(e*k.cheight/2)-c,k.cwidth+d,d)}}}},drawBorderQsubs:function(d,l,a,j){var e=mf(k.cwidth*0.15);var h="b_qsub1_";g.fillStyle=this.BorderQsubcolor;var c=this.borderinside(d*2-2,l*2-2,a*2+2,j*2+2);for(var f=0;f<c.length;f++){var b=c[f];if(bd.border[b].qsub===1){if(this.vnop(h+b,1)){if(bd.border[b].cx&1){g.fillRect(bd.border[b].px,bd.border[b].py-mf(k.cheight/2)+e,1,k.cheight-2*e)}else{if(bd.border[b].cy&1){g.fillRect(bd.border[b].px-mf(k.cwidth/2)+e,bd.border[b].py,k.cwidth-2*e,1)}}}}else{this.vhide(h+b)}}this.vinc()},drawBoxBorders:function(K,e,I,b,u){var l=this.lw,t=this.lm+1;var h=k.cwidth;var w=k.cheight;var A=["u","d","l","r"];g.fillStyle=this.BBcolor;var M=this.cellinside(K,e,I,b);for(var F=0;F<M.length;F++){var L=M[F],m=[];for(var C=0;C<12;C++){m[C]=["c_bb",C,L].join("_")}if(bd.cell[L].qans!==1){this.vhide(m);continue}var f=bd.cell[L].cx,d=bd.cell[L].cy,J=2*f+1,H=2*d+1;var z=bd.cell[L].px,x=bd.cell[L].py;var o=(d>0),D=(d<k.qrows-1);var j=(f>0),a=(f<k.qcols-1);var v=(!o||bd.border[bd.bnum(J,H-1)].ques===1);var E=(!D||bd.border[bd.bnum(J,H+1)].ques===1);var p=(!j||bd.border[bd.bnum(J-1,H)].ques===1);var q=(!a||bd.border[bd.bnum(J+1,H)].ques===1);var y=(!o||!j||bd.border[bd.bnum(J-2,H-1)].ques===1||bd.border[bd.bnum(J-1,H-2)].ques===1);var r=(!o||!a||bd.border[bd.bnum(J+2,H-1)].ques===1||bd.border[bd.bnum(J+1,H-2)].ques===1);var G=(!D||!j||bd.border[bd.bnum(J-2,H+1)].ques===1||bd.border[bd.bnum(J-1,H+2)].ques===1);var B=(!D||!a||bd.border[bd.bnum(J+2,H+1)].ques===1||bd.border[bd.bnum(J+1,H+2)].ques===1);if(v){if(this.vnop(m[0],1)){g.fillRect(z+t,x+t,h-l,1)}}else{this.vhide(m[0])}if(E){if(this.vnop(m[1],1)){g.fillRect(z+t,x+w-t,h-l,1)}}else{this.vhide(m[1])}if(p){if(this.vnop(m[2],1)){g.fillRect(z+t,x+t,1,w-l)}}else{this.vhide(m[2])}if(q){if(this.vnop(m[3],1)){g.fillRect(z+h-t,x+t,1,w-l)}}else{this.vhide(m[3])}if(u){if(!v&&(y||p)){if(this.vnop(m[4],1)){g.fillRect(z+t,x-t,1,l+1)}}else{this.vhide(m[4])}if(!v&&(r||q)){if(this.vnop(m[5],1)){g.fillRect(z+h-t,x-t,1,l+1)}}else{this.vhide(m[5])}if(!p&&(y||v)){if(this.vnop(m[6],1)){g.fillRect(z-t,x+t,l+1,1)}}else{this.vhide(m[6])}if(!p&&(G||E)){if(this.vnop(m[7],1)){g.fillRect(z-t,x+w-t,l+1,1)}}else{this.vhide(m[7])}}else{if(!v&&(y||p)){if(this.vnop(m[4],1)){g.fillRect(z+t,x,1,t+1)}}else{this.vhide(m[4])}if(!v&&(r||q)){if(this.vnop(m[5],1)){g.fillRect(z+h-t,x,1,t+1)}}else{this.vhide(m[5])}if(!E&&(G||p)){if(this.vnop(m[6],1)){g.fillRect(z+t,x+w-t,1,t+1)}}else{this.vhide(m[6])}if(!E&&(B||q)){if(this.vnop(m[7],1)){g.fillRect(z+h-t,x+w-t,1,t+1)}}else{this.vhide(m[7])}if(!p&&(y||v)){if(this.vnop(m[8],1)){g.fillRect(z,x+t,t+1,1)}}else{this.vhide(m[8])}if(!p&&(G||E)){if(this.vnop(m[9],1)){g.fillRect(z,x+w-t,t+1,1)}}else{this.vhide(m[9])}if(!q&&(r||v)){if(this.vnop(m[10],1)){g.fillRect(z+h-t,x+t,t+1,1)}}else{this.vhide(m[10])}if(!q&&(B||E)){if(this.vnop(m[11],1)){g.fillRect(z+h-t,x+w-t,t+1,1)}}else{this.vhide(m[11])}}}this.vinc()},drawLines:function(b,e,a,d){var f=this.borderinside(b*2-2,e*2-2,a*2+2,d*2+2);for(var c=0;c<f.length;c++){this.drawLine1(f[c],bd.isLine(f[c]))}this.vinc();this.addlw=0},drawLine1:function(e,b){var a="b_line_"+e;if(!b){this.vhide(a);return}g.fillStyle=this.getLineColor(e);if(this.vnop(a,1)){var d=this.lw+this.addlw,c=this.lm;if(bd.border[e].cx&1){g.fillRect(bd.border[e].px-c,bd.border[e].py-mf(k.cheight/2)-c,d,k.cheight+d)}else{if(bd.border[e].cy&1){g.fillRect(bd.border[e].px-mf(k.cwidth/2)-c,bd.border[e].py-c,k.cwidth+d,d)}}}},getLineColor:function(a){this.addlw=0;if(bd.border[a].error===1){this.addlw=1;return this.errlinecolor1}else{if(bd.border[a].error===2){return this.errlinecolor2}else{if(k.irowake===0||!pp.getVal("irowake")||!bd.border[a].color){return this.linecolor}}}return bd.border[a].color},drawPekes:function(d,l,a,j,h){var m=mf(k.cwidth*0.15);if(m<3){m=3}var e=["b_peke0_","b_peke1_"];g.strokeStyle=this.pekecolor;g.lineWidth=1;var c=this.borderinside(d*2-2,l*2-2,a*2+2,j*2+2);for(var f=0;f<c.length;f++){var b=c[f];if(bd.border[b].qsub!==2){this.vhide([e[0]+b,e[1]+b]);continue}g.fillStyle="white";if(h===0||h===2){if(this.vnop(e[0]+b,1)){g.fillRect(bd.border[b].px-m,bd.border[b].py-m,2*m+1,2*m+1)}}else{this.vhide(e[0]+b)}if(h===0||h===1){if(this.vnop(e[1]+b,0)){this.inputPath([bd.border[b].px,bd.border[b].py,-m+1,-m+1,0,0,-m+1,m,m,-m+1,0,0,m,m,-m+1,-m+1],false);g.stroke()}}else{this.vhide(e[1]+b)}}this.vinc()},drawTriangle:function(b,o,a,m){var d=["c_tri2_","c_tri3_","c_tri4_","c_tri5_"];if(!k.br.IE&&k.puzzleid!=="reflect"){b--;o--;a++;m++}var p=this.cellinside(b,o,a,m);for(var h=0;h<p.length;h++){var l=p[h];var j=(bd.cell[l].ques!==0?bd.cell[l].ques:bd.cell[l].qans);this.vhide([d[0]+l,d[1]+l,d[2]+l,d[3]+l]);if(j>=2&&j<=5){switch(k.puzzleid){case"reflect":g.fillStyle=((bd.cell[l].error===1||bd.cell[l].error===4)?this.errcolor1:this.Cellcolor);break;default:g.fillStyle=this.Cellcolor;break}var f=bd.cell[l].cx,e=bd.cell[l].cy;this.drawTriangle1(bd.cell[l].px,bd.cell[l].py,j,d[j-2]+l)}}this.vinc()},drawTriangle1:function(e,d,c,b){if(this.vnop(b,1)){var a=(k.puzzleid==="reflect"?1:0);switch(c){case 2:this.inputPath([e,d,a,a,a,k.cheight+1,k.cwidth+1,k.cheight+1],true);break;case 3:this.inputPath([e,d,k.cwidth+1,a,a,k.cheight+1,k.cwidth+1,k.cheight+1],true);break;case 4:this.inputPath([e,d,a,a,k.cwidth+1,a,k.cwidth+1,k.cheight+1],true);break;case 5:this.inputPath([e,d,a,a,k.cwidth+1,a,a,k.cheight+1],true);break}g.fill()}},drawMBs:function(d,l,b,j){g.strokeStyle=this.MBcolor;g.lineWidth=1;var a=k.cwidth*0.35;var e=["c_MB1_","c_MB2a_"];var m=this.cellinside(d,l,b,j);for(var f=0;f<m.length;f++){var h=m[f];if(bd.cell[h].qsub===0){this.vhide([e[0]+h,e[1]+h]);continue}switch(bd.cell[h].qsub){case 1:if(this.vnop(e[0]+h,0)){g.beginPath();g.arc(bd.cell[h].px+mf(k.cwidth/2),bd.cell[h].py+mf(k.cheight/2),a,0,Math.PI*2,false);g.stroke()}this.vhide(e[1]+h);break;case 2:if(this.vnop(e[1]+h,0)){this.inputPath([bd.cell[h].px+mf(k.cwidth/2),bd.cell[h].py+mf(k.cheight/2),-a,-a,0,0,-a,a,a,-a,0,0,a,a,-a,-a],true);g.stroke()}this.vhide(e[0]+h);break}}this.vinc()},drawQueses41_42:function(d,p,b,m){var a=mf(k.cwidth*this.circleratio[0]);var q=mf(k.cwidth*this.circleratio[1]);var j=mf(k.cwidth/2),h=mf(k.cheight/2);var e=["c_cir41a_","c_cir41b_"];var t=this.cellinside(d,p,b,m);for(var f=0;f<t.length;f++){var l=t[f],r=bd.cell[l].px+j,o=bd.cell[l].py+h;if(bd.cell[l].ques===41||bd.cell[l].ques===42){g.fillStyle=(bd.cell[l].error===1?this.errcolor1:this.Cellcolor);if(this.vnop(e[0]+l,1)){g.beginPath();g.arc(r,o,a,0,Math.PI*2,false);g.fill()}}else{this.vhide(e[0]+l)}if(bd.cell[l].ques===41){g.fillStyle=(bd.cell[l].error===1?this.errbcolor1:"white");if(this.vnop(e[1]+l,1)){g.beginPath();g.arc(r,o,q,0,Math.PI*2,false);g.fill()}}else{this.vhide(e[1]+l)}}this.vinc()},drawCircledNumbers:function(b,e,a,d){var f=this.cellinside(b-2,e-2,a+2,d+2);for(var c=0;c<f.length;c++){this.drawCircledNumber1(f[c])}this.vinc()},drawCircledNumber1:function(j){if(j===-1){return}var e=k.cwidth*this.circleratio[0];var b=k.cwidth*this.circleratio[1];var i=mf(k.cwidth/2),f=mf(k.cheight/2);var h=["c_cira_","c_cirb_"];if(bd.cell[j].qnum!=-1){var d=bd.cell[j].px+i,a=bd.cell[j].py+f;g.lineWidth=k.cwidth*0.05;g.fillStyle=(bd.cell[j].error===1?this.errbcolor1:this.circledcolor);if(this.vnop(h[1]+j,1)){g.beginPath();g.arc(d,a,b,0,Math.PI*2,false);g.fill()}g.strokeStyle=(bd.cell[j].error===1?this.errcolor1:this.Cellcolor);if(this.vnop(h[0]+j,0)){g.beginPath();g.arc(d,a,e,0,Math.PI*2,false);g.stroke()}}else{this.vhide([h[0]+j,h[1]+j])}this.dispnumCell(j)},drawLineParts:function(b,e,a,d){var f=this.cellinside(b,e,a,d);for(var c=0;c<f.length;c++){this.drawLineParts1(f[c])}this.vinc()},drawLineParts1:function(a){var b=["c_lp1_"+a,"c_lp2_"+a,"c_lp3_"+a,"c_lp4_"+a];if(i<101||i>107){this.vhide(b);return}var c=mf(k.cheight/2),h=mf(k.cwidth/2);var e=mf((this.lw+k.cheight)/2),d=mf((this.lw+k.cwidth)/2);var l=bd.cell[a].px,j=bd.cell[a].py;g.fillStyle=this.BorderQuescolor;var i=bd.cell[a].ques,f={101:15,102:3,103:12,104:9,105:5,106:6,107:10}[i];if(f&1){if(this.vnop(b[0],1)){g.fillRect(l+h-1,j,this.lw,e)}}else{this.vhide(b[0])}if(f&2){if(this.vnop(b[1],1)){g.fillRect(l+h-1,j+c-1,this.lw,e)}}else{this.vhide(b[1])}if(f&4){if(this.vnop(b[2],1)){g.fillRect(l,j+c-1,d,this.lw)}}else{this.vhide(b[2])}if(f&8){if(this.vnop(b[3],1)){g.fillRect(l+h-1,j+c-1,d,this.lw)}}else{this.vhide(b[3])}},draw51:function(b,j,a,h,l){var d=["c_full_","c_q51_"];var m=this.cellinside(b,j,a,h);for(var e=0;e<m.length;e++){var f=m[e];if(bd.cell[f].ques===51){if(l){if(bd.cell[f].error===1){g.fillStyle=this.errbcolor1;if(this.vnop(d[0]+f,1)){g.fillRect(bd.cell[f].px+1,bd.cell[f].py+1,k.cwidth-1,k.cheight-1)}}else{this.vhide(d[0]+f)}}g.strokeStyle=this.Cellcolor;if(this.vnop(d[1]+f,0)){g.lineWidth=1;this.inputPath([bd.cell[f].px,bd.cell[f].py,1,1,k.cwidth,k.cheight],true);g.stroke()}}else{if(bd.cell[f].qsub===0&&bd.cell[f].error===0){this.vhide(d[0]+f)}this.vhide(d[1]+f)}}this.vinc()},draw51EXcells:function(b,o,a,l,p){var f=this.lw;var e=["ex_full_","ex_q51_","ex_bdx_","ex_bdy_"];var d=this.excellinside(b-1,o-1,a,l);for(var h=0;h<d.length;h++){var j=d[h];var q=bd.excell[j].px,m=bd.excell[j].py;if(p){if(bd.excell[j].error===1){g.fillStyle=this.errbcolor1;if(this.vnop(e[0]+j,1)){g.fillRect(q+1,m+1,k.cwidth-1,k.cheight-1)}}else{this.vhide(e[0]+j)}}g.strokeStyle=this.Cellcolor;if(this.vnop(e[1]+j,0)){g.lineWidth=1;this.inputPath([q,m,1,1,k.cwidth,k.cheight],true);g.stroke()}g.fillStyle=this.Cellcolor;if(bd.excell[j].cy===-1&&bd.excell[j].cx<k.qcols-1){if(this.vnop(e[2]+j,1)){g.fillRect(q+k.cwidth,m,1,k.cheight)}}else{this.vhide(e[2]+j)}if(bd.excell[j].cx===-1&&bd.excell[j].cy<k.qrows-1){if(this.vnop(e[3]+j,1)){g.fillRect(q,m+k.cheight,k.cwidth,1)}}else{this.vhide(e[3]+j)}}this.vinc()},drawChassis_ex1:function(b,m,a,l,f){var d=this.lw,j=this.lm;if(b<0){b=0}if(a>k.qcols-1){a=k.qcols-1}if(m<0){m=0}if(l>k.qrows-1){l=k.qrows-1}g.fillStyle="black";if(f){if(b<1){if(this.vnop("chs1_",1)){g.fillRect(k.p0.x+b*k.cwidth-d+2,k.p0.y+m*k.cheight-d+2,d,(l-m+1)*k.cheight+d-2)}}if(m<1){if(this.vnop("chs2_",1)){g.fillRect(k.p0.x+b*k.cwidth-d+2,k.p0.y+m*k.cheight-d+2,(a-b+1)*k.cwidth+d-2,d)}}}else{if(b<1){if(this.vnop("chs1_",1)){g.fillRect(k.p0.x+b*k.cwidth,k.p0.y+m*k.cheight,1,(l-m+1)*k.cheight)}}if(m<1){if(this.vnop("chs2_",1)){g.fillRect(k.p0.x+b*k.cwidth,k.p0.y+m*k.cheight,(a-b+1)*k.cwidth,1)}}}if(l>=k.qrows-1){if(this.vnop("chs3_",1)){g.fillRect(k.p0.x+(b-1)*k.cwidth-d+1,k.p0.y+(l+1)*k.cheight,(a-b+2)*k.cwidth+2*d-1,d)}}if(a>=k.qcols-1){if(this.vnop("chs4_",1)){g.fillRect(k.p0.x+(a+1)*k.cwidth,k.p0.y+(m-1)*k.cheight-d+1,d,(l-m+2)*k.cheight+2*d-1)}}if(b<1){if(this.vnop("chs21_",1)){g.fillRect(k.p0.x+(b-1)*k.cwidth-d+1,k.p0.y+(m-1)*k.cheight-d+1,d,(l-m+2)*k.cheight+2*d-1)}}if(m<1){if(this.vnop("chs22_",1)){g.fillRect(k.p0.x+(b-1)*k.cwidth-d+1,k.p0.y+(m-1)*k.cheight-d+1,(a-b+2)*k.cwidth+2*d-1,d)}}this.vinc();if(!f){g.fillStyle=this.Cellcolor;var o=this.cellinside(b-1,m-1,a+1,l+1);for(var e=0;e<o.length;e++){var h=o[e];if(bd.cell[h].ques===51){continue}if(bd.cell[h].cx===0){this.drawBorder1x(0,2*bd.cell[h].cy+1,true)}if(bd.cell[h].cy===0){this.drawBorder1x(2*bd.cell[h].cx+1,0,true)}}this.vinc()}},drawTarget:function(b,d,a,c){if(k.editmode){this.drawTCell(b,d,a+1,c+1)}else{this.hideTCell()}},drawTCell:function(d,h,b,f){if(tc.cursolx<d*2-2||b*2+4<tc.cursolx){return}if(tc.cursoly<h*2-2||f*2+4<tc.cursoly){return}var e=k.p0.x+mf((tc.cursolx-1)*k.cwidth/2);var c=k.p0.y+mf((tc.cursoly-1)*k.cheight/2);var a=(k.cwidth<32?2:mf(k.cwidth/16));this.vdel(["tc1_","tc2_","tc3_","tc4_"]);g.fillStyle=(k.editmode?this.targetColor1:this.targetColor3);if(this.vnop("tc1_",0)){g.fillRect(e+1,c+1,k.cwidth-2,a)}if(this.vnop("tc2_",0)){g.fillRect(e+1,c+1,a,k.cheight-2)}if(this.vnop("tc3_",0)){g.fillRect(e+1,c+k.cheight-a,k.cwidth-2,a)}if(this.vnop("tc4_",0)){g.fillRect(e+k.cwidth-a,c+1,a,k.cheight-2)}this.vinc()},drawTCross:function(d,h,b,f){if(tc.cursolx<d*2-1||b*2+3<tc.cursolx){return}if(tc.cursoly<h*2-1||f*2+3<tc.cursoly){return}var e=k.p0.x+mf((tc.cursolx-1)*k.cwidth/2);var c=k.p0.y+mf((tc.cursoly-1)*k.cheight/2);var a=(k.cwidth<32?2:mf(k.cwidth/16));this.vdel(["tx1_","tx2_","tx3_","tx4_"]);g.fillStyle=(k.editmode?this.targetColor1:this.targetColor3);if(this.vnop("tx1_",0)){g.fillRect(e+1,c+1,k.cwidth-2,a)}if(this.vnop("tx2_",0)){g.fillRect(e+1,c+1,a,k.cheight-2)}if(this.vnop("tx3_",0)){g.fillRect(e+1,c+k.cheight-a,k.cwidth-2,a)}if(this.vnop("tx4_",0)){g.fillRect(e+k.cwidth-a,c+1,a,k.cheight-2)}this.vinc()},drawTBorder:function(d,i,b,h){if(tc.cursolx<d*2-1||b*2+3<tc.cursolx){return}if(tc.cursoly<i*2-1||h*2+3<tc.cursoly){return}var f=k.p0.x+mf(tc.cursolx*k.cwidth/2);var c=k.p0.y+mf(tc.cursoly*k.cheight/2);var a=(k.cwidth<24?1:mf(k.cwidth/24));var e=mf(k.cwidth*0.28);this.vdel(["tb1_","tb2_","tb3_","tb4_"]);g.fillStyle=(k.editmode?this.targetColor1:this.targetColor3);if(this.vnop("tb1_",0)){g.fillRect(f-e,c-e,e*2,1)}if(this.vnop("tb2_",0)){g.fillRect(f-e,c-e,1,e*2)}if(this.vnop("tb3_",0)){g.fillRect(f-e,c+e-a,e*2,1)}if(this.vnop("tb4_",0)){g.fillRect(f+e-a,c-e,1,e*2)}this.vinc()},hideTCell:function(){this.vhide(["tc1_","tc2_","tc3_","tc4_"])},hideTCross:function(){this.vhide(["tx1_","tx2_","tx3_","tx4_"])},hideTBorder:function(){this.vhide(["tb1_","tb2_","tb3_","tb4_"])},drawTargetTriangle:function(c,f,b,e){var a="target_triangle";this.vdel([a]);if(k.playmode){return}if(tc.cursolx<c*2||b*2+2<tc.cursolx){return}if(tc.cursoly<f*2||e*2+2<tc.cursoly){return}var i=tc.getTCC(),d=-1;if(i===-1){d=bd.exnum(tc.getTCX(),tc.getTCY())}var h=kc.detectTarget(i,d);if(h===-1){return}g.fillStyle=this.TTcolor;this.drawTriangle1(k.p0.x+tc.getTCX()*k.cwidth,k.p0.y+tc.getTCY()*k.cheight,(h===2?4:2),a);this.vinc()},drawDashLines:(((!k.br.IE)?function(c,f,a,e){if(c<1){c=1}if(a>k.qcols-2){a=k.qcols-2}if(f<1){f=1}if(e>k.qrows-2){e=k.qrows-2}g.fillStyle=this.gridcolor;for(var d=c-1;d<=a+1;d++){for(var b=(k.p0.y+(f-0.5)*k.cheight);b<(k.p0.y+(e+1.5)*k.cheight);b+=6){g.fillRect(k.p0.x+(d+0.5)*k.cwidth,b,1,3)}}for(var d=f-1;d<=e+1;d++){for(var b=(k.p0.x+(c-0.5)*k.cwidth);b<(k.p0.x+(a+1.5)*k.cwidth);b+=6){g.fillRect(b,k.p0.y+(d+0.5)*k.cheight,3,1)}}this.vinc()}:function(b,e,a,d){if(b<1){b=1}if(a>k.qcols-2){a=k.qcols-2}if(e<1){e=1}if(d>k.qrows-2){d=k.qrows-2}g.fillStyle=this.gridcolor_SLIGHT;for(var c=b-1;c<=a+1;c++){if(this.vnop("cliney_"+c,1)){g.fillRect(k.p0.x+(c+0.5)*k.cwidth,k.p0.y+(e-0.5)*k.cheight,1,(d-e+2)*k.cheight+1)}}for(var c=e-1;c<=d+1;c++){if(this.vnop("clinex_"+c,1)){g.fillRect(k.p0.x+(b-0.5)*k.cwidth,k.p0.y+(c+0.5)*k.cheight,(a-b+2)*k.cwidth+1,1)}}this.vinc()})),drawGrid:function(c,j,b,h){if(c<0){c=0}if(b>k.qcols-1){b=k.qcols-1}if(j<0){j=0}if(h>k.qrows-1){h=k.qrows-1}var l=((k.isoutsideborder===0&&this.chassisflag)?1:0);g.fillStyle=this.gridcolor;var a=(c>l?c:l),m=(b+1<k.qcols-l?b+1:k.qcols-l);var f=(j>l?j:l),e=(h+1<k.qrows-l?h+1:k.qrows-l);for(var d=a;d<=m;d++){if(this.vnop("bdy_"+d,1)){g.fillRect(k.p0.x+d*k.cwidth,k.p0.y+j*k.cheight,1,(h-j+1)*k.cheight+1)}}for(var d=f;d<=e;d++){if(this.vnop("bdx_"+d,1)){g.fillRect(k.p0.x+c*k.cwidth,k.p0.y+d*k.cheight,(b-c+1)*k.cwidth+1,1)}}this.vinc()},drawDashedGrid:(((!k.br.IE)?function(c,q,b,p){if(c<0){c=0}if(b>k.qcols-1){b=k.qcols-1}if(q<0){q=0}if(p>k.qrows-1){p=k.qrows-1}var r=((k.isoutsideborder===0&&this.chassisflag)?1:0);var l=mf(k.cwidth/10)+3;var d=(mf(k.cwidth/l)>=1?mf(k.cwidth/l):1);var h=k.cwidth/(d*2);g.fillStyle=this.gridcolor;var a=(c>r?c:r),t=(b+1<k.qcols-r?b+1:k.qcols-r);var o=(q>r?q:r),m=(p+1<k.qrows-r?p+1:k.qrows-r);for(var f=a;f<=t;f++){for(var e=(k.p0.y+q*k.cheight);e<(k.p0.y+(p+1)*k.cheight);e+=(2*h)){g.fillRect(k.p0.x+f*k.cwidth,mf(e),1,mf(h))}}for(var f=o;f<=m;f++){for(var e=(k.p0.x+c*k.cwidth);e<(k.p0.x+(b+1)*k.cwidth);e+=(2*h)){g.fillRect(mf(e),k.p0.y+f*k.cheight,mf(h),1)}}}:function(b,d,a,c){this.gridcolor=this.gridcolor_SLIGHT;this.drawGrid(b,d,a,c)})),drawChassis:function(b,d,a,c){var e=this.lw;if(b<0){b=0}if(a>k.qcols-1){a=k.qcols-1}if(d<0){d=0}if(c>k.qrows-1){c=k.qrows-1}g.fillStyle="black";if(b<1){if(this.vnop("chs1_",1)){g.fillRect(k.p0.x+b*k.cwidth-e+1,k.p0.y+d*k.cheight-e+1,e,(c-d+1)*k.cheight+2*e-1)}}if(d<1){if(this.vnop("chs2_",1)){g.fillRect(k.p0.x+b*k.cwidth-e+1,k.p0.y+d*k.cheight-e+1,(a-b+1)*k.cwidth+2*e-1,e)}}if(c>=k.qrows-1){if(this.vnop("chs3_",1)){g.fillRect(k.p0.x+b*k.cwidth-e+1,k.p0.y+(c+1)*k.cheight,(a-b+1)*k.cwidth+2*e-1,e)}}if(a>=k.qcols-1){if(this.vnop("chs4_",1)){g.fillRect(k.p0.x+(a+1)*k.cwidth,k.p0.y+d*k.cheight-e+1,e,(c-d+1)*k.cheight+2*e-1)}}this.vinc()},flushCanvas:(((!k.vml)?function(b,d,a,c){if(k.isextendcell===0&&b<=0&&d<=0&&a>=k.qcols-1&&c>=k.qrows-1){this.flushCanvasAll()}else{if(k.isextendcell===1&&b<=-1&&d<=-1&&a>=k.qcols-1&&c>=k.qrows-1){this.flushCanvasAll()}else{if(k.isextendcell===2&&b<=-1&&d<=-1&&a>=k.qcols&&c>=k.qrows){this.flushCanvasAll()}else{g.fillStyle="rgb(255, 255, 255)";g.fillRect(k.p0.x+b*k.cwidth,k.p0.y+d*k.cheight,(a-b+1)*k.cwidth,(c-d+1)*k.cheight)}}}}:function(b,d,a,c){g.zidx=1})),flushCanvasAll:(((!k.vml)?((!k.br.IE)?function(){g.fillStyle="rgb(255, 255, 255)";g.fillRect(0,0,ee(base.canvas).getWidth(),ee(base.canvas).getHeight());this.vinc()}:function(){g._clear();g.fillStyle="rgb(255, 255, 255)";g.fillRect(0,0,ee(base.canvas).getWidth(),ee(base.canvas).getHeight());this.vinc()}):function(){g.zidx=0;g.vid="bg_";g.pelements=[];g.elements=[];g._clear();g.fillStyle="rgb(255, 255, 255)";g.fillRect(0,0,ee(base.canvas).getWidth(),ee(base.canvas).getHeight());this.vinc()})),vnop:(!k.vml?f_true:function(a,b){if(g.elements[a]){var c=g.elements[a];c.color=uuColor.parse(b===1?g.fillStyle:g.strokeStyle)[0];var d=g.pelements[a];if(!this.zstable){d.style.zIndex=g.zidx}d.style.display="inline";return false}g.vid=a;return true}),vhide:(!k.vml?f_true:function(a){if(typeof a==="string"){a=[a]}for(var b=0;b<a.length;b++){if(g.elements[a[b]]){g.pelements[a[b]].style.display="none"}}}),vdel:(!k.vml?f_true:function(a){for(var b=0;b<a.length;b++){if(g.elements[a[b]]){g._elm.removeChild(g.pelements[a[b]]);g.pelements[a[b]]=null;g.elements[a[b]]=null}}}),vinc:(!k.vml?f_true:function(){g.vid="";g.zidx++}),CreateDOMAndSetNop:function(){return(!pc.textenable?ee.createEL(pc.EL_NUMOBJ,""):null)},showEL:function(a){a.style.display="inline"},hideEL:function(a){if(!!a){a.style.display="none"}},setFunctions:function(){this.isdispnumCell=(((!!k.isDispHatena)?(!!k.dispzero)?function(b){var a=bd.getNum(b);return(a>=0||a===-2)}:function(b){var a=bd.getNum(b);return(a>0||a===-2)}:(!!k.dispzero)?function(b){var a=bd.getNum(b);return(a>=0)}:function(b){var a=bd.getNum(b);return(a>0)}));this.getNumberColor=(((!!k.isAnsNumber)?function(a){if(bd.cell[a].error===1||bd.cell[a].error===4){return this.fontErrcolor}return(bd.cell[a].qnum!==-1?this.fontcolor:this.fontAnscolor)}:(!!k.BlackCell)?function(a){if(bd.cell[a].qans===1){return this.BCell_fontcolor}else{if(bd.cell[a].error===1||bd.cell[a].error===4){return this.fontErrcolor}}return this.fontcolor}:function(a){if(bd.cell[a].ques!==0){return this.BCell_fontcolor}else{if(bd.cell[a].error===1||bd.cell[a].error===4){return this.fontErrcolor}}return this.fontcolor}))},isdispnumCell:f_true,getNumberColor:function(){return this.fontcolor},dispnumCell:function(h){var e=bd.cell[h];if(!this.isdispnumCell(h)){this.hideEL(e.numobj);return}if(!e.numobj){e.numobj=this.CreateDOMAndSetNop()}var d=(!k.isDispNumUL?1:5);if(e.ques>=2&&e.ques<=5){d=e.ques}var c=bd.getNum(h);var f=(c>=0?""+c:"?");var b=0.45;if(d===1){b=(c<10?0.8:(c<100?0.7:0.55))}var a=this.getNumberColor(h);this.dispnum(e.numobj,d,f,b,a,e.px,e.py)},dispnumCross:function(d){var b=bd.cross[d];if(b.qnum<0||(b.qnum===0&&k.dispzero===0)){this.hideEL(b.numobj);return}if(!b.numobj){b.numobj=this.CreateDOMAndSetNop()}var c=""+b.qnum;var a=this.fontcolor;this.dispnum(b.numobj,101,c,0.6,a,b.px,b.py)},dispnumBorder:function(d){var b=bd.border[d];if(b.qnum<0||(b.qnum===0&&k.dispzero===0)){this.hideEL(b.numobj);return}if(!b.numobj){b.numobj=this.CreateDOMAndSetNop()}var c=""+b.qnum;var a=this.borderfontcolor;this.dispnum(b.numobj,101,c,0.45,a,b.px,b.py)},dispnum:function(a,f,l,b,c,j,i){if(!a){return}var d=k.br.IE;a.innerHTML=l;var e=mf(k.cwidth*b*this.fontsizeratio);a.style.fontSize=(""+e+"px");this.showEL(a);var m=a.clientWidth;var h=a.clientHeight;if(f===1||f===6||f===7){a.style.left=k.cv_oft.x+j+mf((k.cwidth-m)/2)+(d?4:2)-(f===6?mf(k.cwidth*0.1):0);a.style.top=k.cv_oft.y+i+mf((k.cheight-h)/2)+(d?5:1)+(f===7?mf(k.cheight*0.1):0)}else{if(f===101){a.style.left=k.cv_oft.x+j-m/2+(d?5:2);a.style.top=k.cv_oft.y+i-h/2+(d?4:1)}else{if(f==52||f==54){j--;f-=50}if(f===3||f===4){a.style.left=k.cv_oft.x+j+k.cwidth-m+(d?2:0)}else{if(f===2||f===5){a.style.left=k.cv_oft.x+j+(d?6:4)}}if(f===2||f===3){a.style.top=k.cv_oft.y+i+k.cheight-h+(d?3:-1)}else{if(f===4||f===5){a.style.top=k.cv_oft.y+i+(d?5:2)}}}}a.style.color=c},drawNumbersOn51:function(d,f,b,e){for(var a=d;a<=b;a++){for(var i=f;i<=e;i++){var h=bd.cnum(a,i);if(h!==-1){if(bd.cell[h].ques===51){this.drawNumbersOn51_1(bd.cell[h],bd.rt(h),bd.dn(h),0)}else{this.hideEL(bd.cell[h].numobj);this.hideEL(bd.cell[h].numobj2)}}else{h=bd.exnum(a,i);if(h!==-1){this.drawNumbersOn51_1(bd.excell[h],bd.excell[h].cy*k.qcols,bd.excell[h].cx,50)}}}}this.vinc()},drawNumbersOn51_1:function(j,c,l,r){var b,e,f,m,a,p,o;for(var h=0;h<2;h++){if(h===0){b=j.qnum,e=j.error,guard=j.cy,m=c,p=r+4,o="numobj"}if(h===1){b=j.direc,e=j.error,guard=j.cx,m=l,p=r+2,o="numobj2"}if(b===-1||guard===-1||m===-1||bd.cell[m].ques===51){this.hideEL(j[o])}else{if(!j[o]){j[o]=this.CreateDOMAndSetNop()}var d=(e===1?this.fontErrcolor:this.fontcolor);var q=(b>=0?""+b:"");this.dispnum(j[o],p,q,0.45,d,j.px,j.py)}}}};var MouseEvent=function(){this.inputPos;this.mouseCell;this.inputData;this.firstPos;this.btn={};this.mousereset();this.enableInputHatena=!!k.isDispHatena;this.inputQuesDirectly=false;this.docEL=document.documentElement;this.bodyEL=document.body};MouseEvent.prototype={mousereset:function(){this.inputPos=new Pos(-1,-1);this.mouseCell=-1;this.inputData=-1;this.firstPos=new Pos(-1,-1);this.btn={Left:false,Middle:false,Right:false}},e_mousedown:function(a){if(k.enableMouse){this.setButtonFlag(a);if(((kc.isSHIFT)^pp.getVal("lrcheck"))&&(this.btn.Left^this.btn.Right)){this.btn.Left=!this.btn.Left;this.btn.Right=!this.btn.Right}if(this.btn.Middle){this.modeflip()}else{if(ans.errDisp){bd.errclear()}um.newOperation(true);this.setposition(a);this.mousedown()}}ee.stopPropagation(a);ee.preventDefault(a);return false},e_mouseup:function(a){if(k.enableMouse&&!this.btn.Middle&&(this.btn.Left||this.btn.Right)){um.newOperation(false);this.setposition(a);this.mouseup();this.mousereset()}ee.stopPropagation(a);ee.preventDefault(a);return false},e_mousemove:function(a){if(!!menu.movingpop){return true}if(k.enableMouse&&!this.btn.Middle&&(this.btn.Left||this.btn.Right)){um.newOperation(false);this.setposition(a);this.mousemove()}ee.stopPropagation(a);ee.preventDefault(a);return false},e_mouseout:function(a){um.newOperation(false)},mousedown:function(){},mouseup:function(){},mousemove:function(){},setButtonFlag:(((k.br.IE)?function(a){this.btn={Left:(a.button===1),Middle:(a.button===4),Right:(a.button===2)}}:(k.br.WinWebKit)?function(a){this.btn={Left:(a.button===0),Middle:(a.button===1),Right:(a.button===2)}}:(k.br.WebKit)?function(a){this.btn={Left:(a.which===1&&!a.metaKey),Middle:false,Right:(a.which===1&&!!a.metaKey)}}:function(a){this.btn=(!!a.which?{Left:(a.which===1),Middle:(a.which===2),Right:(a.which===3)}:{Left:(a.button===0),Middle:(a.button===1),Right:(a.button===2)})})),setposition:(((k.br.WinWebKit)?function(a){this.inputPos.x=a.pageX-1-k.cv_oft.x-k.p0.x-k.IEMargin.x;this.inputPos.y=a.pageY-1-k.cv_oft.y-k.p0.y-k.IEMargin.y}:(!k.br.IE)?function(a){this.inputPos.x=a.pageX-k.cv_oft.x-k.p0.x-k.IEMargin.x;this.inputPos.y=a.pageY-k.cv_oft.y-k.p0.y-k.IEMargin.y}:function(a){this.inputPos.x=a.clientX+(this.docEL.scrollLeft||this.bodyEL.scrollLeft)-k.cv_oft.x-k.p0.x-k.IEMargin.x;this.inputPos.y=a.clientY+(this.docEL.scrollTop||this.bodyEL.scrollTop)-k.cv_oft.y-k.p0.y-k.IEMargin.y})),notInputted:function(){return !um.changeflag},modeflip:function(){if(k.EDITOR){pp.setVal("mode",(k.playmode?1:3))}},cellid:function(){var a=this.cellpos();if(this.inputPos.x%k.cwidth==0||this.inputPos.y%k.cheight==0){return -1}return bd.cnum(a.x,a.y)},crossid:function(){var a=this.crosspos(0.5);return bd.xnum(a.x>>1,a.y>>1)},cellpos:function(){return new Pos(mf(this.inputPos.x/k.cwidth),mf(this.inputPos.y/k.cheight))},crosspos:function(e){var d=e*k.cwidth;var a=mf((this.inputPos.x+d)/k.cwidth),f=mf((this.inputPos.y+d)/k.cheight);var c=(this.inputPos.x+d)%k.cwidth,b=(this.inputPos.y+d)%k.cheight;return new Pos(a*2+(c<2*d?0:1),f*2+(b<2*d?0:1))},borderid:function(f){var a=mf(this.inputPos.x/k.cwidth),h=mf(this.inputPos.y/k.cheight);var d=this.inputPos.x%k.cwidth,b=this.inputPos.y%k.cheight;if(k.isLineCross){if(!k.isborderAsLine){var e=f*k.cwidth,c=(1-f)*k.cwidth;if((d<e||c<d)&&(b<e||c<b)){return -1}}else{var e=(0.5-f)*k.cwidth,c=(0.5+f)*k.cwidth;if(e<d&&d<c&&e<b&&b<c){return -1}}}if(d<k.cwidth-b){if(d>b){return bd.bnum(2*a+1,2*h)}else{return bd.bnum(2*a,2*h+1)}}else{if(d>b){return bd.bnum(2*a+2,2*h+1)}else{return bd.bnum(2*a+1,2*h+2)}}return -1},inputcell:function(){var a=this.cellid();if(a==-1||a==this.mouseCell){return}if(this.inputData==-1){this.decIC(a)}this.mouseCell=a;if(k.NumberIsWhite==1&&bd.QnC(a)!=-1&&(this.inputData==1||(this.inputData==2&&pc.bcolor=="white"))){return}if(k.RBBlackCell==1&&this.inputData==1){if(this.firstPos.x==-1&&this.firstPos.y==-1){this.firstPos=new Pos(bd.cell[a].cx,bd.cell[a].cy)}if((this.firstPos.x+this.firstPos.y)%2!=(bd.cell[a].cx+bd.cell[a].cy)%2){return}}(this.inputData==1?bd.setBlack:bd.setWhite).apply(bd,[a]);bd.sQsC(a,(this.inputData==2?1:0));pc.paintCell(a)},decIC:function(a){if(pp.getVal("use")==1){if(this.btn.Left){this.inputData=(bd.isWhite(a)?1:0)}else{if(this.btn.Right){this.inputData=((bd.QsC(a)!=1)?2:0)}}}else{if(pp.getVal("use")==2){if(this.btn.Left){if(bd.isBlack(a)){this.inputData=2}else{if(bd.QsC(a)==1){this.inputData=0}else{this.inputData=1}}}else{if(this.btn.Right){if(bd.isBlack(a)){this.inputData=0}else{if(bd.QsC(a)==1){this.inputData=1}else{this.inputData=2}}}}}}},inputqnum:function(){var b=this.cellid();if(b===-1||b===this.mouseCell){return}if(b===tc.getTCC()){b=(k.playmode?(k.NumberWithMB?this.inputqnum3withMB(b):this.inputqnum3(b)):this.inputqnum1(b))}else{var a=tc.getTCC();tc.setTCC(b);pc.paint(bd.cell[a].cx-1,bd.cell[a].cy-1,bd.cell[a].cx,bd.cell[a].cy)}this.mouseCell=b;pc.paint(bd.cell[b].cx-1,bd.cell[b].cy-1,bd.cell[b].cx,bd.cell[b].cy)},inputqnum1:function(b){if(k.isOneNumber){b=area.getTopOfRoomByCell(b)}var a=bd.nummaxfunc(b);if(this.btn.Left){if(bd.QnC(b)===a){bd.sQnC(b,-1)}else{if(bd.QnC(b)===-1){bd.sQnC(b,(this.enableInputHatena?-2:(k.dispzero?0:1)))}else{if(bd.QnC(b)===-2){bd.sQnC(b,(k.dispzero?0:1))}else{bd.sQnC(b,bd.QnC(b)+1)}}}}else{if(this.btn.Right){if(bd.QnC(b)===-1){bd.sQnC(b,a)}else{if(bd.QnC(b)===-2){bd.sQnC(b,-1)}else{if(bd.QnC(b)===(k.dispzero?0:1)){bd.sQnC(b,(this.enableInputHatena?-2:-1))}else{bd.sQnC(b,bd.QnC(b)-1)}}}}}if(bd.QnC(b)!=-1&&k.NumberIsWhite){bd.sQaC(b,-1);if(pc.bcolor=="white"){bd.sQsC(b,0)}}if(k.isAnsNumber){bd.sQaC(b,-1);bd.sQsC(b,0)}return b},inputqnum3:function(b){if(bd.QnC(b)!==bd.defcell.qnum){return b}var a=bd.nummaxfunc(b);bd.sDiC(b,0);if(this.btn.Left){if(bd.QaC(b)===a){bd.sQaC(b,-1)}else{if(bd.QaC(b)===-1){bd.sQaC(b,(k.dispzero?0:1))}else{bd.sQaC(b,bd.QaC(b)+1)}}}else{if(this.btn.Right){if(bd.QaC(b)===-1){bd.sQaC(b,a)}else{if(bd.QaC(b)===(k.dispzero?0:1)){bd.sQaC(b,-1)}else{bd.sQaC(b,bd.QaC(b)-1)}}}}return b},inputqnum3withMB:function(b){if(bd.QnC(b)!==-1){return b}var a=bd.nummaxfunc(b);if(this.btn.Left){if(bd.QaC(b)===a){bd.sQaC(b,-1);bd.sQsC(b,1)}else{if(bd.QsC(b)===1){bd.sQaC(b,-1);bd.sQsC(b,2)}else{if(bd.QsC(b)===2){bd.sQaC(b,-1);bd.sQsC(b,0)}else{if(bd.QaC(b)===-1){bd.sQaC(b,(k.dispzero?0:1))}else{bd.sQaC(b,bd.QaC(b)+1)}}}}}else{if(this.btn.Right){if(bd.QsC(b)===1){bd.sQaC(b,a);bd.sQsC(b,0)}else{if(bd.QsC(b)===2){bd.sQaC(b,-1);bd.sQsC(b,1)}else{if(bd.QaC(b)===-1){bd.sQaC(b,-1);bd.sQsC(b,2)}else{if(bd.QaC(b)===(k.dispzero?0:1)){bd.sQaC(b,-1)}else{bd.sQaC(b,bd.QaC(b)-1)}}}}}}return b},inputQues:function(e){var d=this.cellid();if(d==-1){return}var a=false;if(d!=tc.getTCC()&&!this.inputQuesDirectly){var c=tc.getTCC();tc.setTCC(d);pc.paint(bd.cell[c].cx-1,bd.cell[c].cy-1,bd.cell[c].cx,bd.cell[c].cy);a=true}else{if(this.btn.Left){for(var b=0;b<e.length-1;b++){if(!a&&bd.QuC(d)==e[b]){bd.sQuC(d,e[b+1]);a=true}}if(!a&&bd.QuC(d)==e[e.length-1]){bd.sQuC(d,e[0]);a=true}}else{if(this.btn.Right){for(var b=e.length;b>0;b--){if(!a&&bd.QuC(d)==e[b]){bd.sQuC(d,e[b-1]);a=true}}if(!a&&bd.QuC(d)==e[0]){bd.sQuC(d,e[e.length-1]);a=true}}}}if(a){pc.paintCell(d)}},inputMB:function(){var a=this.cellid();if(a==-1){return}if(this.btn.Left){if(bd.QsC(a)==0){bd.sQsC(a,1)}else{if(bd.QsC(a)==1){bd.sQsC(a,2)}else{bd.sQsC(a,0)}}}else{if(this.btn.Right){if(bd.QsC(a)==0){bd.sQsC(a,2)}else{if(bd.QsC(a)==2){bd.sQsC(a,1)}else{bd.sQsC(a,0)}}}}pc.paintCell(a)},inputdirec:function(){var c=this.cellpos();if(c.x==this.mouseCell.x&&c.y==this.mouseCell.y){return}var a=0;var b=bd.cnum(this.mouseCell.x,this.mouseCell.y);if(b!=-1&&bd.QnC(b)!=-1){if(c.y-this.mouseCell.y==-1){a=k.UP}else{if(c.y-this.mouseCell.y==1){a=k.DN}else{if(c.x-this.mouseCell.x==-1){a=k.LT}else{if(c.x-this.mouseCell.x==1){a=k.RT}else{return}}}}bd.sDiC(b,(bd.DiC(b)!=a?a:0));pc.paintCell(b)}this.mouseCell=c},inputtile:function(){var h=this.cellid();if(h==-1||h==this.mouseCell||bd.QuC(h)==51){return}if(this.inputData==-1){this.decIC(h)}this.mouseCell=h;var b=area.getRoomID(h);for(var a=0;a<area.room[b].clist.length;a++){var f=area.room[b].clist[a];if(this.inputData==1||bd.QsC(f)!=3){(this.inputData==1?bd.setBlack:bd.setWhite).apply(bd,[f]);bd.sQsC(f,(this.inputData==2?1:0))}}var e=ans.getSizeOfClist(area.room[b].clist,f_true);pc.paint(e.x1,e.y1,e.x2,e.y2)},input51:function(){var d=this.cellpos();var c=bd.cnum(d.x,d.y);if((d.x==-1&&d.y>=-1&&d.y<=k.qrows-1)||(d.y==-1&&d.x>=-1&&d.x<=k.qcols-1)){var b=tc.getTCX(),a=tc.getTCY();tc.setTCP(new Pos(2*d.x+1,2*d.y+1));pc.paint(b-1,a-1,b,a);pc.paint(tc.getTCX()-1,tc.getTCY()-1,tc.getTCX(),tc.getTCY());return}else{if(c!=-1&&c!=tc.getTCC()){var b=tc.getTCX(),a=tc.getTCY();tc.setTCC(c);pc.paint(b-1,a-1,b,a)}else{if(c!=-1){if(this.btn.Left){if(bd.QuC(c)!=51){this.set51cell(c,true)}else{kc.chtarget("shift")}}else{if(this.btn.Right){this.set51cell(c,false)}}}else{return}}}pc.paint(bd.cell[c].cx-1,bd.cell[c].cy-1,bd.cell[c].cx+1,bd.cell[c].cy+1)},set51cell:function(b,a){if(a==true){bd.sQuC(b,51);bd.sQnC(b,0);bd.sDiC(b,0);bd.sQaC(b,-1)}else{bd.sQuC(b,0);bd.sQnC(b,0);bd.sDiC(b,0);bd.sQaC(b,-1)}},inputcross:function(){var b=this.crossid();if(b==-1||b==this.mouseCell){return}if(b==tc.getTXC()){if(this.btn.Left){if(bd.QnX(b)==4){bd.sQnX(b,-2)}else{bd.sQnX(b,bd.QnX(b)+1)}}else{if(this.btn.Right){if(bd.QnX(b)==-2){bd.sQnX(b,4)}else{bd.sQnX(b,bd.QnX(b)-1)}}}}else{var a=tc.getTXC();tc.setTXC(b);pc.paint(bd.cross[a].cx-1,bd.cross[a].cy-1,bd.cross[a].cx,bd.cross[a].cy)}this.mouseCell=b;pc.paint(bd.cross[b].cx-1,bd.cross[b].cy-1,bd.cross[b].cx,bd.cross[b].cy)},inputcrossMark:function(){var b=this.crosspos(0.24);if(b.x%2!=0||b.y%2!=0){return}if(b.x<(k.isoutsidecross==1?0:2)||b.x>(k.isoutsidecross==1?2*k.qcols:2*k.qcols-2)){return}if(b.y<(k.isoutsidecross==1?0:2)||b.y>(k.isoutsidecross==1?2*k.qrows:2*k.qrows-2)){return}var a=bd.xnum(b.x>>1,b.y>>1);um.disCombine=1;bd.sQnX(a,(bd.QnX(a)==1)?-1:1);um.disCombine=0;pc.paint(bd.cross[a].cx-1,bd.cross[a].cy-1,bd.cross[a].cx,bd.cross[a].cy)},inputborder:function(){this.inputBD(0)},inputborderans:function(){this.inputBD(1)},inputBD:function(a){var c=this.crosspos(0.35);if(c.x==this.mouseCell.x&&c.y==this.mouseCell.y){return}var b=bd.bnum(c.x,c.y);if(b==-1&&this.mouseCell.x){b=bd.bnum(this.mouseCell.x,this.mouseCell.y)}if(this.mouseCell!=-1&&b!=-1){if((c.x%2==0&&this.mouseCell.x==c.x&&Math.abs(this.mouseCell.y-c.y)==1)||(c.y%2==0&&this.mouseCell.y==c.y&&Math.abs(this.mouseCell.x-c.x)==1)){this.mouseCell=-1;if(this.inputData==-1){this.inputData=(bd.isBorder(b)?0:1)}if(!(k.playmode&&bd.QuB(b)!==0)){if(this.inputData==1){bd.setBorder(b);if(k.isborderAsLine){bd.sQsB(b,0)}}else{if(this.inputData==0){bd.removeBorder(b)}}pc.paintBorder(b)}}}this.mouseCell=c},inputLine:function(){this.inputLine1(0)},inputQsubLine:function(){this.inputLine1(1)},inputLine1:function(a){var c=this.cellpos();if(c.x==this.mouseCell.x&&c.y==this.mouseCell.y){return}var b=-1;if(c.y-this.mouseCell.y==-1){b=bd.bnum(this.mouseCell.x*2+1,this.mouseCell.y*2)}else{if(c.y-this.mouseCell.y==1){b=bd.bnum(this.mouseCell.x*2+1,this.mouseCell.y*2+2)}else{if(c.x-this.mouseCell.x==-1){b=bd.bnum(this.mouseCell.x*2,this.mouseCell.y*2+1)}else{if(c.x-this.mouseCell.x==1){b=bd.bnum(this.mouseCell.x*2+2,this.mouseCell.y*2+1)}}}}this.mouseCell=c;if(this.inputData==2||this.inputData==3){this.inputpeke2(b)}else{if(this.mouseCell!=-1&&b!=-1){if(a==0){this.inputLine2(b)}else{if(a==1){this.inputqsub2(b)}}}}},inputLine2:function(a){if(this.inputData==-1){this.inputData=(bd.isLine(a)?0:1)}if(this.inputData==1){bd.setLine(a)}else{if(this.inputData==0){bd.removeLine(a)}}pc.paintLine(a)},inputqsub2:function(a){if(this.inputData==-1){this.inputData=(bd.QsB(a)==0?1:0)}if(this.inputData==1){bd.sQsB(a,1)}else{if(this.inputData==0){bd.sQsB(a,0)}}pc.paintLine(a)},inputpeke:function(){var b=this.crosspos(0.22);var a=bd.bnum(b.x,b.y);if(a==-1||(b.x==this.mouseCell.x&&b.y==this.mouseCell.y)){return}this.mouseCell=b;this.inputpeke2(a)},inputpeke2:function(a){if(this.inputData==-1){if(bd.QsB(a)==0){this.inputData=2}else{this.inputData=3}}if(this.inputData==2){bd.setPeke(a)}else{if(this.inputData==3){bd.removeLine(a)}}pc.paintLine(a)},dispRed:function(){var a=this.cellid();this.mousereset();if(!bd.isBlack(a)||a==this.mouseCell){return}if(!k.RBBlackCell){bd.sErC(area.bcell[area.bcell.id[a]].clist,1)}else{this.db0(function(b){return(bd.isBlack(b)&&bd.ErC(b)==0)},a,1)}ans.errDisp=true;pc.paintAll()},db0:function(c,e,b){if(bd.ErC(e)!=0){return}bd.sErC([e],b);var a=bd.cell[e].cx,d=bd.cell[e].cy;if(c(bd.cnum(a-1,d-1))){this.db0(c,bd.cnum(a-1,d-1),b)}if(c(bd.cnum(a,d-1))){this.db0(c,bd.cnum(a,d-1),b)}if(c(bd.cnum(a+1,d-1))){this.db0(c,bd.cnum(a+1,d-1),b)}if(c(bd.cnum(a-1,d))){this.db0(c,bd.cnum(a-1,d),b)}if(c(bd.cnum(a+1,d))){this.db0(c,bd.cnum(a+1,d),b)}if(c(bd.cnum(a-1,d+1))){this.db0(c,bd.cnum(a-1,d+1),b)}if(c(bd.cnum(a,d+1))){this.db0(c,bd.cnum(a,d+1),b)}if(c(bd.cnum(a+1,d+1))){this.db0(c,bd.cnum(a+1,d+1),b)}return},dispRedLine:function(){var d=this.borderid(0.15);this.mousereset();if(d!=-1&&d==this.mouseCell){return}if(!bd.isLine(d)){var c=(k.isborderAsLine==0?this.cellid():this.crossid());if(c==-1||(k.isLineCross&&(line.lcntCell(c)==3||line.lcntCell(c)==4))){return}var b,a;if(k.isbordeAsLine==0){b=(c%k.qcols)*2,a=mf(c/k.qcols)*2}else{b=(c%(k.qcols+1))*2,a=mf(c/(k.qcols+1))*2}d=(function(f,e){if(bd.isLine(bd.bnum(f-1,e))){return bd.bnum(f-1,e)}else{if(bd.isLine(bd.bnum(f+1,e))){return bd.bnum(f+1,e)}else{if(bd.isLine(bd.bnum(f,e-1))){return bd.bnum(f,e-1)}else{if(bd.isLine(bd.bnum(f,e+1))){return bd.bnum(f,e+1)}}}}return -1})(b,a)}if(d==-1){return}bd.sErBAll(2);bd.sErB(line.data[line.data.id[d]].idlist,1);ans.errDisp=true;pc.paintAll()}};KeyEvent=function(){this.isCTRL;this.isALT;this.isSHIFT;this.inUNDO;this.inREDO;this.tcMoved;this.keyPressed;this.ca;this.prev;this.keyreset()};KeyEvent.prototype={keyreset:function(){this.isCTRL=false;this.isALT=false;this.isSHIFT=false;this.inUNDO=false;this.inREDO=false;this.tcMoved=false;this.keyPressed=false;this.prev=-1;this.ca="";if(this.isZ){this.isZ=false}if(this.isX){this.isX=false}},e_keydown:function(a){if(k.enableKey){um.newOperation(true);this.ca=this.getchar(a,this.getKeyCode(a));this.tcMoved=false;if(!this.isZ){bd.errclear()}if(!this.keydown_common(a)){if(this.ca){this.keyinput(this.ca)}this.keyPressed=true}if(this.tcMoved){ee.preventDefault(a);return false}}},e_keyup:function(a){if(k.enableKey){um.newOperation(false);this.ca=this.getchar(a,this.getKeyCode(a));this.keyPressed=false;if(!this.keyup_common(a)){if(this.ca){this.keyup(this.ca)}}}},e_keypress:function(a){if(k.enableKey){um.newOperation(false);this.ca=this.getcharp(a,this.getKeyCode(a));if(this.ca){this.keyinput(this.ca)}}},e_SLkeydown:function(b,c){var a={keyCode:c.platformKeyCode,shiftKey:c.shift,ctrlKey:c.ctrl,altKey:false,returnValue:false,preventDefault:f_true};return this.e_keydown(a)},e_SLkeyup:function(b,c){var a={keyCode:c.platformKeyCode,shiftKey:c.shift,ctrlKey:c.ctrl,altKey:false,returnValue:false,preventDefault:f_true};return this.e_keyup(a)},keyinput:function(a){},keyup:function(a){},getchar:function(b,a){if(b.keyCode==38){return k.KEYUP}else{if(b.keyCode==40){return k.KEYDN}else{if(b.keyCode==37){return k.KEYLT}else{if(b.keyCode==39){return k.KEYRT}else{if(48<=a&&a<=57){return(a-48).toString(36)}else{if(65<=a&&a<=90){return(a-55).toString(36)}else{if(96<=a&&a<=105){return(a-96).toString(36)}else{if(112<=a&&a<=123){return"F"+(a-111).toString(10)}else{if(a==32||a==46){return" "}else{if(a==8){return"BS"}else{if(b.shiftKey){return"shift"}else{return""}}}}}}}}}}}},getcharp:function(b,a){if(a==45){return"-"}else{return""}},getKeyCode:function(a){if(document.all){return a.keyCode}else{if(document.getElementById){return(a.keyCode)?a.keyCode:a.charCode}else{if(document.layers){return a.which}}}},keydown_common:function(b){var a=false;if(!this.isSHIFT&&b.shiftKey){this.isSHIFT=true}if(!this.isCTRL&&b.ctrlKey){this.isCTRL=true;a=true}if(!this.isALT&&b.altKey){this.isALT=true;a=true}if(this.isCTRL&&this.ca=="z"){this.inUNDO=true;a=true;tm.startUndoTimer()}if(this.isCTRL&&this.ca=="y"){this.inREDO=true;a=true;tm.startUndoTimer()}if(this.ca=="F2"&&k.EDITOR){if(k.editmode&&!this.isSHIFT){pp.setVal("mode",3);a=true}else{if(k.playmode&&this.isSHIFT){pp.setVal("mode",1);a=true}}}a=(a||debug.keydown(this.ca));return a},keyup_common:function(b){var a=false;if(this.isSHIFT&&!b.shiftKey){this.isSHIFT=false;a=true}if((this.isCTRL||this.inUNDO||this.inREDO)&&!b.ctrlKey){this.isCTRL=false;a=true;this.inUNDO=false;this.inREDO=false}if(this.isALT&&!b.altKey){this.isALT=false;a=true}if(this.inUNDO&&this.ca=="z"){this.inUNDO=false;a=true}if(this.inREDO&&this.ca=="y"){this.inREDO=false;a=true}return a},moveTCell:function(a){return this.moveTC(a,2)},moveTCross:function(a){return this.moveTC(a,2)},moveTBorder:function(a){return this.moveTC(a,1)},moveTC:function(c,a){var e=tc.cursolx,d=tc.cursoly,b=false;if(c==k.KEYUP&&d-a>=tc.miny){tc.decTCY(a);b=true}else{if(c==k.KEYDN&&d+a<=tc.maxy){tc.incTCY(a);b=true}else{if(c==k.KEYLT&&e-a>=tc.minx){tc.decTCX(a);b=true}else{if(c==k.KEYRT&&e+a<=tc.maxx){tc.incTCX(a);b=true}}}}if(b){pc.paint((e>>1)-1,(d>>1)-1,e>>1,d>>1);pc.paint((tc.cursolx>>1)-1,(tc.cursoly>>1)-1,tc.cursolx>>1,tc.cursoly>>1);this.tcMoved=true}return b},key_inputcross:function(b){var d=tc.getTXC();var a=bd.nummaxfunc(d);if("0"<=b&&b<="9"){var c=parseInt(b);if(bd.QnX(d)<=0){if(c<=a){bd.sQnX(d,c)}}else{if(bd.QnX(d)*10+c<=a){bd.sQnX(d,bd.QnX(d)*10+c)}else{if(c<=a){bd.sQnX(d,c)}}}}else{if(b=="-"){if(bd.QnX(d)!=-2){bd.sQnX(d,-2)}else{bd.sQnX(d,-1)}}else{if(b==" "){bd.sQnX(d,-1)}else{return}}}pc.paint(bd.cross[d].cx-1,bd.cross[d].cy-1,bd.cross[d].cx,bd.cross[d].cy)},key_inputqnum:function(b){var d=tc.getTCC();if(k.editmode&&k.isOneNumber){d=area.getTopOfRoomByCell(d)}var a=bd.nummaxfunc(d);if("0"<=b&&b<="9"){var c=parseInt(b);if(k.playmode&&k.puzzleid!=="snakes"){bd.sDiC(d,0)}if(bd.getNum(d)<=0||this.prev!=d){if(c<=a){bd.setNum(d,c)}}else{if(bd.getNum(d)*10+c<=a){bd.setNum(d,bd.getNum(d)*10+c)}else{if(c<=a){bd.setNum(d,c)}}}if(bd.QnC(d)!=-1&&k.NumberIsWhite){bd.sQaC(d,-1);if(pc.bcolor=="white"){bd.sQsC(d,0)}}if(k.isAnsNumber){if(k.editmode){bd.sQaC(d,-1)}bd.sQsC(d,0)}}else{if(b=="-"){if(k.editmode&&bd.QnC(d)!=-2){bd.setNum(d,-2)}else{bd.setNum(d,-1)}if(bd.QnC(d)!=-1&&k.NumberIsWhite){bd.sQaC(d,-1);if(pc.bcolor=="white"){bd.sQsC(d,0)}}if(k.isAnsNumber){bd.sQsC(d,0)}}else{if(b==" "){bd.setNum(d,-1);if(bd.QnC(d)!=-1&&k.NumberIsWhite){bd.sQaC(d,-1);if(pc.bcolor=="white"){bd.sQsC(d,0)}}if(k.isAnsNumber){bd.sQsC(d,0)}}else{return}}}this.prev=d;pc.paintCell(d)},key_inputdirec:function(b){if(!this.isSHIFT){return false}var c=tc.getTCC();if(bd.QnC(c)==-1){return false}var a=false;if(b==k.KEYUP){bd.sDiC(c,(bd.DiC(c)!=k.UP?k.UP:0));a=true}else{if(b==k.KEYDN){bd.sDiC(c,(bd.DiC(c)!=k.DN?k.DN:0));a=true}else{if(b==k.KEYLT){bd.sDiC(c,(bd.DiC(c)!=k.LT?k.LT:0));a=true}else{if(b==k.KEYRT){bd.sDiC(c,(bd.DiC(c)!=k.RT?k.RT:0));a=true}}}}if(a){pc.paint(tc.cursolx>>1,tc.cursoly>>1,tc.cursolx>>1,tc.cursoly>>1);this.tcMoved=true}return a},inputnumber51:function(b,e){if(this.chtarget(b)){return}var h=tc.getTCC(),d=-1;if(h==-1){d=bd.exnum(tc.getTCX(),tc.getTCY())}var f=this.detectTarget(h,d);if(f==-1||(h!=-1&&bd.QuC(h)==51)){if(b=="q"&&h!=-1){mv.set51cell(h,(bd.QuC(h)!=51));pc.paint(tc.getTCX()-1,tc.getTCY()-1,tc.getTCX()+1,tc.getTCY()+1);return}}if(f==-1){return}var a=e[f];if("0"<=b&&b<="9"){var c=parseInt(b);if(this.getnum51(h,d,f)<=0||this.prev!=h){if(c<=a){this.setnum51(h,d,f,c)}}else{if(this.getnum51(h,d,f)*10+c<=a){this.setnum51(h,d,f,this.getnum51(h,d,f)*10+c)}else{if(c<=a){this.setnum51(h,d,f,c)}}}}else{if(b=="-"||b==" "){this.setnum51(h,d,f,-1)}else{return}}this.prev=h;if(h!=-1){pc.paintCell(tc.getTCC())}else{pc.paint(tc.getTCX(),tc.getTCY(),tc.getTCX(),tc.getTCY())}},setnum51:function(d,a,b,c){if(d!=-1){(b==2?bd.sQnC(d,c):bd.sDiC(d,c))}else{(b==2?bd.sQnE(a,c):bd.sDiE(a,c))}},getnum51:function(c,a,b){if(c!=-1){return(b==2?bd.QnC(c):bd.DiC(c))}else{return(b==2?bd.QnE(a):bd.DiE(a))}},chtarget:function(a){if(a!="shift"){return false}if(tc.targetdir==2){tc.targetdir=4}else{tc.targetdir=2}pc.paintCell(tc.getTCC());return true},detectTarget:function(b,a){if((b==-1&&a==-1)||(b!=-1&&bd.QuC(b)!=51)){return -1}if(b==bd.cellmax-1||a==k.qcols+k.qrows){return -1}if(b!=-1){if((bd.rt(b)==-1||bd.QuC(bd.rt(b))==51)&&(bd.dn(b)==-1||bd.QuC(bd.dn(b))==51)){return -1}else{if(bd.rt(b)==-1||bd.QuC(bd.rt(b))==51){return 4}else{if(bd.dn(b)==-1||bd.QuC(bd.dn(b))==51){return 2}}}}else{if(a!=-1){if((bd.excell[a].cy==-1&&bd.QuC(bd.excell[a].cx)==51)||(bd.excell[a].cx==-1&&bd.QuC(bd.excell[a].cy*k.qcols)==51)){return -1}else{if(bd.excell[a].cy==-1){return 4}else{if(bd.excell[a].cx==-1){return 2}}}}}return tc.targetdir}};KeyPopup=function(){this.ctl={1:{el:null,enable:false,target:k.CELL},3:{el:null,enable:false,target:k.CELL}};this.tdcolor="black";this.imgCR=[1,1];this.tds=[];this.imgs=[];this.defaultdisp=false;this.tbodytmp=null,this.trtmp=null;this.ORIGINAL=99;this.EL_KPNUM=ee.addTemplate("","td",{unselectable:"on",className:"kpnum"},null,null);this.EL_KPEMPTY=ee.addTemplate("","td",{unselectable:"on"},null,null);this.EL_KPIMG=ee.addTemplate("","td",{unselectable:"on",className:"kpimgcell"},null,null);this.EL_KPIMG_DIV=ee.addTemplate("","div",{unselectable:"on",className:"kpimgdiv"},null,null);this.EL_KPIMG_IMG=ee.addTemplate("","img",{unselectable:"on",className:"kpimg",src:"./src/img/"+k.puzzleid+"_kp.gif"},null,null)};KeyPopup.prototype={kpinput:function(a){},enabled:function(){return pp.getVal("keypopup")},generate:function(b,a,d,c){if(a&&k.EDITOR){this.gentable(1,b,c)}if(d){this.gentable(3,b,c)}},gentable:function(d,a,c){this.ctl[d].enable=true;this.ctl[d].el=ee("keypopup"+d).el;this.ctl[d].el.onmouseout=ee.ebinder(this,this.hide);var b=_doc.createElement("table");b.cellSpacing="2pt";this.ctl[d].el.appendChild(b);this.tbodytmp=_doc.createElement("tbody");b.appendChild(this.tbodytmp);this.trtmp=null;if(c){c.apply(kp,[d])}else{if(a==0||a==3){this.gentable10(d,a)}else{if(a==1||a==2||a==4){this.gentable4(d,a)}}}},gentable10:function(b,a){this.inputcol("num","knum0","0","0");this.inputcol("num","knum1","1","1");this.inputcol("num","knum2","2","2");this.inputcol("num","knum3","3","3");this.insertrow();this.inputcol("num","knum4","4","4");this.inputcol("num","knum5","5","5");this.inputcol("num","knum6","6","6");this.inputcol("num","knum7","7","7");this.insertrow();this.inputcol("num","knum8","8","8");this.inputcol("num","knum9","9","9");this.inputcol("num","knum_"," "," ");if(a==0){(b==1)?this.inputcol("num","knum.","-","?"):this.inputcol("empty","knum.","","")}else{if(a==3){this.inputcol("num","knum.","-"," ")}}this.insertrow()},gentable4:function(c,b,a){this.inputcol("num","knum0","0","0");this.inputcol("num","knum1","1","1");this.inputcol("num","knum2","2","2");this.inputcol("num","knum3","3","3");this.insertrow();this.inputcol("num","knum4","4","4");this.inputcol("empty","knumx","","");this.inputcol("num","knum_"," "," ");if(b==1){(c==1)?this.inputcol("num","knum.","-","?"):this.inputcol("empty","knum.","","")}else{if(b==2){this.inputcol("num","knum.","-","¡")}else{if(b==4){this.inputcol("num","knum.","-","›")}}}this.insertrow()},inputcol:function(f,h,b,c){if(!this.trtmp){this.trtmp=_doc.createElement("tr")}var e=null;if(f==="num"){e=ee.createEL(this.EL_KPNUM,h);e.style.color=this.tdcolor;e.innerHTML=c;e.onclick=ee.ebinder(this,this.inputnumber,[b])}else{if(f==="empty"){e=ee.createEL(this.EL_KPEMPTY,"")}else{if(f==="image"){var d=ee.createEL(this.EL_KPIMG_IMG,""+h+"_i");var a=ee.createEL(this.EL_KPIMG_DIV,"");a.appendChild(d);e=ee.createEL(this.EL_KPIMG,h);e.onclick=ee.ebinder(this,this.inputnumber,[b]);e.appendChild(a);this.imgs.push({el:d,cx:c[0],cy:c[1]})}}}if(e){this.tds.push(e);this.trtmp.appendChild(e)}},insertrow:function(){if(this.trtmp){this.tbodytmp.appendChild(this.trtmp);this.trtmp=null}},display:function(){var b=pp.getVal("mode");if(this.ctl[b].el&&this.ctl[b].enable&&pp.getVal("keypopup")&&mv.btn.Left){this.ctl[b].el.style.left=k.cv_oft.x+mv.inputPos.x-3+k.IEMargin.x;this.ctl[b].el.style.top=k.cv_oft.y+mv.inputPos.y-3+k.IEMargin.y;this.ctl[b].el.style.zIndex=100;if(this.ctl[b].target==k.CELL){var a=tc.getTCC();var c=mv.cellid();if(c==-1){return}tc.setTCC(c);pc.paint(bd.cell[c].cx-1,bd.cell[c].cy-1,bd.cell[c].cx,bd.cell[c].cy);pc.paint(bd.cell[a].cx-1,bd.cell[a].cy-1,bd.cell[a].cx,bd.cell[a].cy)}else{if(this.ctl[b].target==k.CROSS){var a=tc.getTXC();var c=mv.crossid();if(c==-1){return}tc.setTXC(c);pc.paint(bd.cross[c].cx-1,bd.cross[c].cy-1,bd.cross[c].cx,bd.cross[c].cy);pc.paint(bd.cross[a].cx-1,bd.cross[a].cy-1,bd.cross[a].cx,bd.cross[a].cy)}}this.ctl[b].el.style.display="inline"}},inputnumber:function(b,a){this.kpinput(a);this.ctl[pp.getVal("mode")].el.style.display="none"},hide:function(a){var b=pp.getVal("mode");if(!!this.ctl[b].el&&!menu.insideOf(this.ctl[b].el,a)){this.ctl[b].el.style.display="none"}},resize:function(){var d=function(e,f){e.style.width=""+mf(f*0.9)+"px";e.style.height=""+mf(f*0.9)+"px";e.style.fontSize=""+mf(f*0.7)+"px"};var c=function(e,f){e.el.style.width=""+(f*kp.imgCR[0])+"px";e.el.style.height=""+(f*kp.imgCR[1])+"px";e.el.style.clip="rect("+(f*e.cy+1)+"px,"+(f*(e.cx+1))+"px,"+(f*(e.cy+1))+"px,"+(f*e.cx+1)+"px)";e.el.style.top="-"+(e.cy*f+1)+"px";e.el.style.left="-"+(e.cx*f+1)+"px"};if(k.def_csize>=24){for(var b=0,a=this.tds.length;b<a;b++){d(this.tds[b],k.def_csize)}for(var b=0,a=this.imgs.length;b<a;b++){c(this.imgs[b],mf(k.def_csize*0.9))}}else{for(var b=0,a=this.tds.length;b<a;b++){d(this.tds[b],22)}for(var b=0,a=this.imgs.length;b<a;b++){c(this.imgs[b],18)}}}};TCell=function(){this.cursolx=1;this.cursoly=1;this.minx=(k.isextendcell!=0?-1:1);this.miny=(k.isextendcell!=0?-1:1);this.maxx=(k.isextendcell==2?2*k.qcols+1:2*k.qcols-1);this.maxy=(k.isextendcell==2?2*k.qrows+1:2*k.qrows-1)};TCell.prototype={Adjust:function(){if(this.cursolx<this.minx){this.tborderx=this.minx}if(this.cursoly<this.miny){this.tbordery=this.miny}if(this.cursolx>this.maxx){this.tborderx=this.maxx}if(this.cursoly>this.maxy){this.tbordery=this.maxy}},setAlign:function(){},incTCX:function(a){this.cursolx+=a},incTCY:function(a){this.cursoly+=a},decTCX:function(a){this.cursolx-=a},decTCY:function(a){this.cursoly-=a},getTCP:function(){return new Pos(this.cursolx,this.cursoly)},setTCP:function(a){if(a.x<this.minx||this.maxx<a.x||a.y<this.miny||this.maxy<a.y){return}this.cursolx=a.x;this.cursoly=a.y},getTCC:function(){return bd.cnum(this.cursolx>>1,this.cursoly>>1)},setTCC:function(a){if(a<0||bd.cellmax<=a){return}this.cursolx=bd.cell[a].cx*2+1;this.cursoly=bd.cell[a].cy*2+1},getTXC:function(){return bd.xnum(this.cursolx>>1,this.cursoly>>1)},setTXC:function(a){if(!k.iscross||a<0||bd.crossmax<=a){return}this.cursolx=bd.cross[a].cx*2;this.cursoly=bd.cross[a].cy*2},getTBC:function(){return bd.bnum(this.cursolx,this.cursoly)},setTBC:function(a){if(!k.isborder||a<0||bd.bdmax<=a){return}this.cursolx=bd.border[a].cx*2;this.cursoly=bd.border[a].cy}};Encode=function(){this.uri={};this.uri.type;this.uri.qdata;this.uri.pflag;this.uri.cols;this.uri.rows;this.uri.bstr;this.pidKanpen="";this.pidforURL="";this.outpflag="";this.outsize="";this.outbstr="";this.PZPRV3=0;this.PZPRV3E=3;this.PAPRAPP=1;this.KANPEN=2;this.KANPENP=5;this.HEYAAPP=4};Encode.prototype={init:function(){this.uri.type=this.PZPRV3;this.uri.qdata="";this.uri.pflag="";this.uri.cols=0;this.uri.rows=0;this.uri.bstr="";this.outpflag="";this.outsize="";this.outbstr=""},first_parseURI:function(c){if(c.length<=0){return""}this.init();var d="PLAYER";if(c=="?test"){d="TEST";c="country"}else{if(c.match(/^\?m\+/)){d="EDITOR";c=c.substr(3)}else{if(c.match(/_test/)){d="TEST";c=c.substr(1).replace(/_test/,"")}else{if(c.match(/_edit/)){d="EDITOR";c=c.substr(1).replace(/_edit/,"")}else{if(!c.match(/\//)){d="EDITER";c=c.substr(1)}else{d="PLAYER";c=c.substr(1)}}}}}switch(d){case"PLAYER":k.EDITOR=false;k.editmode=false;break;case"EDITOR":k.EDITOR=true;k.editmode=true;break;case"TEST":k.EDITOR=true;k.editmode=false;k.scriptcheck=true;break}k.PLAYER=!k.EDITOR;k.playmode=!k.editmode;k.autocheck=k.playmode;var a=c.indexOf("/");if(a>=0){this.parseURI_pzpr(c.substr(a+1));if(!!this.uri.cols){k.qcols=this.uri.cols}if(!!this.uri.rows){k.qrows=this.uri.rows}c=c.substr(0,a)}var b=c;switch(b){case"yajilin":this.pidforURL="yajilin";b="yajirin";break;case"akari":this.pidforURL="akari";b="lightup";break;case"bijutsukan":this.pidforURL="akari";b="lightup";break;case"slitherlink":this.pidforURL=b="slither";break;case"numberlink":this.pidforURL=b="numlin";break;case"hakyukoka":this.pidforURL=b="ripple";break;case"masyu":this.pidforURL=b="mashu";break;default:this.pidforURL=b}k.puzzleid=b},parseURI:function(a){this.init();if(k.br.Opera){a=a.replace(/(\r|\n)/g,"")}if(a.match(/www\.kanpen\.net/)||a.match(/www\.geocities(\.co)?\.jp\/pencil_applet/)){if(a.indexOf("?heyawake=")>=0){this.parseURI_heyaapp(a.substr(a.indexOf("?heyawake=")+10))}else{if(a.indexOf("?pzpr=")>=0){this.parseURI_pzpr(a.substr(a.indexOf("?pzpr=")+6))}else{this.parseURI_kanpen(a.substr(a.indexOf("?problem=")+9))}}}else{if(a.match(/www\.geocities(\.co)?\.jp\/heyawake/)){this.parseURI_heyaapp(a.substr(a.indexOf("?problem=")+9))}else{if(a.match(/\/(sa|sc)\/pzpr\/v3/)){this.parseURI_pzpr(a.substr(a.indexOf("?")));this.uri.type=this.PZPRAPP}else{this.parseURI_pzpr(a.substr(a.indexOf("/",a.indexOf("?"))+1))}}}},parseURI_pzpr:function(a){this.uri.type=this.PZPRV3;this.uri.qdata=a;var b=a.split("/");if(!isNaN(parseInt(b[0]))){b.unshift("")}this.uri.pflag=b.shift();this.uri.cols=parseInt(b.shift());this.uri.rows=parseInt(b.shift());this.uri.bstr=b.join("/")},parseURI_kanpen:function(a){this.uri.type=this.KANPEN;this.uri.qdata=a;var b=a.split("/");if(k.puzzleid=="sudoku"){this.uri.rows=this.uri.cols=parseInt(b.shift())}else{this.uri.rows=parseInt(b.shift());this.uri.cols=parseInt(b.shift());if(k.puzzleid=="kakuro"){this.uri.rows--;this.uri.cols--}}this.uri.bstr=b.join("/")},parseURI_heyaapp:function(a){this.uri.type=this.HEYAAPP;this.uri.qdata=a;var c=a.split("/");var b=c.shift().split("x");this.uri.cols=parseInt(b[0]);this.uri.rows=parseInt(b[1]);this.uri.bstr=c.join("/")},checkpflag:function(a){return(this.uri.pflag.indexOf(a)>=0)},pzlinput:function(){if(this.uri.cols&&this.uri.rows){bd.initBoardSize(this.uri.cols,this.uri.rows)}if(this.uri.bstr){um.disableRecord();um.disableInfo();switch(this.uri.type){case this.PZPRV3:case this.PZPRAPP:case this.PZPRV3E:this.outbstr=this.uri.bstr;this.pzlimport(this.uri.type);break;case this.KANPEN:fio.lineseek=0;fio.dataarray=this.uri.bstr.replace(/_/g," ").split("/");this.decodeKanpen();break;case this.HEYAAPP:this.decodeHeyaApp();break}um.enableRecord();um.enableInfo();bd.ansclear();base.resetInfo(true);base.resize_canvas_onload()}},pzloutput:function(b){if(b===this.KANPEN&&k.puzzleid=="lits"){b=this.KANPENP}var c="",a="",d=false;this.outpflag="";this.outsize="";this.outbstr="";switch(b){case this.PZPRV3:case this.PZPRV3E:this.pzlexport(this.PZPRV3);a=(!this.outsize?[k.qcols,k.qrows].join("/"):this.outsize);d=(!!this.outpflag);break;case this.PZPRAPP:case this.KANPENP:this.pzlexport(this.PZPRAPP);a=(!this.outsize?[k.qcols,k.qrows].join("/"):this.outsize);d=true;break;case this.KANPEN:fio.datastr="";this.encodeKanpen();this.outbstr=fio.datastr.replace(/ /g,"_");a=(!this.outsize?[k.qrows,k.qcols].join("/"):this.outsize);break;case this.HEYAAPP:this.encodeHeyaApp();a=[k.qcols,k.qrows].join("x");break;default:return""}if(d){c=[this.outpflag,a,this.outbstr].join("/")}else{c=[a,this.outbstr].join("/")}return this.getURLBase(b)+c},getURLBase:function(a){var b={};b[this.PZPRV3]="http://indi.s58.xrea.com/pzpr/v3/p.html?%PID%/";b[this.PZPRV3E]="http://indi.s58.xrea.com/pzpr/v3/p.html?%PID%_edit/";b[this.PZPRAPP]="http://indi.s58.xrea.com/%PID%/sa/q.html?";b[this.KANPEN]="http://www.kanpen.net/%KID%.html?problem=";b[this.KANPENP]="http://www.kanpen.net/%KID%.html?pzpr=";b[this.HEYAAPP]="http://www.geocities.co.jp/heyawake/?problem=";return b[a].replace("%PID%",this.pidforURL).replace("%KID%",this.pidKanpen)},pzlimport:function(b,a){},pzlexport:function(a){},decodeKanpen:function(){},encodeKanpen:function(){},decodeHeyaApp:function(a){},encodeHeyaApp:function(){},decode4Cell:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","4")){bd.sQnC(e,parseInt(a,16));e++}else{if(this.include(a,"5","9")){bd.sQnC(e,parseInt(a,16)-5);e+=2}else{if(this.include(a,"a","e")){bd.sQnC(e,parseInt(a,16)-10);e+=3}else{if(this.include(a,"g","z")){e+=(parseInt(a,36)-15)}else{if(a=="."){bd.sQnC(e,-2);e++}}}}}if(e>=bd.cellmax){break}}this.outbstr=b.substr(d+1)},encode4Cell:function(){var d=0,a="";for(var c=0;c<bd.cellmax;c++){var b="";if(bd.QnC(c)>=0){if(c<bd.cellmax-1&&(bd.QnC(c+1)>=0||bd.QnC(c+1)==-2)){b=""+bd.QnC(c).toString(16)}else{if(c<bd.cellmax-2&&(bd.QnC(c+2)>=0||bd.QnC(c+2)==-2)){b=""+(5+bd.QnC(c)).toString(16);c++}else{b=""+(10+bd.QnC(c)).toString(16);c+=2}}}else{if(bd.QnC(c)==-2){b="."}else{b=" ";d++}}if(d==0){a+=b}else{if(b!=" "){a+=((d+15).toString(36)+b);d=0}else{if(d==20){a+="z";d=0}}}}if(d>0){a+=((d+15).toString(36))}this.outbstr+=a},decode4Cross:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","4")){bd.sQnX(e,parseInt(a,16));e++}else{if(this.include(a,"5","9")){bd.sQnX(e,parseInt(a,16)-5);e+=2}else{if(this.include(a,"a","e")){bd.sQnX(e,parseInt(a,16)-10);e+=3}else{if(this.include(a,"g","z")){e+=(parseInt(a,36)-15)}else{if(a=="."){bd.sQnX(e,-2);e++}}}}}if(e>=bd.crossmax){break}}this.outbstr=b.substr(d+1)},encode4Cross:function(){var d=0,a="";for(var c=0;c<bd.crossmax;c++){var b="";if(bd.QnX(c)>=0){if(c<bd.crossmax-1&&(bd.QnX(c+1)>=0||bd.QnX(c+1)==-2)){b=""+bd.QnX(c).toString(16)}else{if(c<bd.crossmax-2&&(bd.QnX(c+2)>=0||bd.QnX(c+2)==-2)){b=""+(5+bd.QnX(c)).toString(16);c++}else{b=""+(10+bd.QnX(c)).toString(16);c+=2}}}else{if(bd.QnX(c)==-2){b="."}else{b=" ";d++}}if(d==0){a+=b}else{if(b!=" "){a+=((d+15).toString(36)+b);d=0}else{if(d==20){a+="z";d=0}}}}if(d>0){a+=((d+15).toString(36))}this.outbstr+=a},decodeNumber10:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","9")){bd.sQnC(e,parseInt(b.substr(d,1),10));e++}else{if(this.include(a,"a","z")){e+=(parseInt(a,36)-9)}else{if(a=="."){bd.sQnC(e,-2);e++}else{e++}}}if(e>bd.cellmax){break}}this.outbstr=b.substr(d)},encodeNumber10:function(){var a="",c=0;for(var b=0;b<bd.cellmax;b++){pstr="";var d=bd.QnC(b);if(d==-2){pstr="."}else{if(d>=0&&d<10){pstr=d.toString(10)}else{c++}}if(c==0){a+=pstr}else{if(pstr||c==26){a+=((9+c).toString(36)+pstr);c=0}}}if(c>0){a+=(9+c).toString(36)}this.outbstr+=a},decodeNumber16:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(this.include(a,"0","9")||this.include(a,"a","f")){bd.sQnC(e,parseInt(b.substr(d,1),16));e++}else{if(a=="."){bd.sQnC(e,-2);e++}else{if(a=="-"){bd.sQnC(e,parseInt(b.substr(d+1,2),16));e++;d+=2}else{if(a=="+"){bd.sQnC(e,parseInt(b.substr(d+1,3),16));e++;d+=3}else{if(a=="="){bd.sQnC(e,parseInt(b.substr(d+1,3),16)+4096);e++;d+=3}else{if(a=="%"){bd.sQnC(e,parseInt(b.substr(d+1,3),16)+8192);e++;d+=3}else{if(a>="g"&&a<="z"){e+=(parseInt(a,36)-15)}else{e++}}}}}}}if(e>bd.cellmax){break}}this.outbstr=b.substr(d)},encodeNumber16:function(){var c=0,a="";for(var b=0;b<bd.cellmax;b++){pstr="";var d=bd.QnC(b);if(d==-2){pstr="."}else{if(d>=0&&d<16){pstr=d.toString(16)}else{if(d>=16&&d<256){pstr="-"+d.toString(16)}else{if(d>=256&&d<4096){pstr="+"+d.toString(16)}else{if(d>=4096&&d<8192){pstr="="+(d-4096).toString(16)}else{if(d>=8192){pstr="%"+(d-8192).toString(16)}else{c++}}}}}}if(c==0){a+=pstr}else{if(pstr||c==20){a+=((15+c).toString(36)+pstr);c=0}}}if(c>0){a+=(15+c).toString(36)}this.outbstr+=a},decodeRoomNumber16:function(){area.resetRarea();var d=1,c=0,b=this.outbstr;for(c=0;c<b.length;c++){var a=b.charAt(c);if(this.include(a,"0","9")||this.include(a,"a","f")){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c,1),16));d++}else{if(a=="-"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,2),16));d++;c+=2}else{if(a=="+"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16));d++;c+=3}else{if(a=="="){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16)+4096);d++;c+=3}else{if(a=="%"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16)+8192);d++;c+=3}else{if(a=="*"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16)+12240);d++;c+=4}else{if(a=="$"){bd.sQnC(area.getTopOfRoom(d),parseInt(b.substr(c+1,3),16)+77776);d++;c+=5}else{if(a>="g"&&a<="z"){d+=(parseInt(a,36)-15)}else{d++}}}}}}}}if(d>area.room.max){break}}this.outbstr=b.substr(c)},encodeRoomNumber16:function(){area.resetRarea();var d=0,a="";for(var c=1;c<=area.room.max;c++){var b="";var e=bd.QnC(area.getTopOfRoom(c));if(e>=0&&e<16){b=e.toString(16)}else{if(e>=16&&e<256){b="-"+e.toString(16)}else{if(e>=256&&e<4096){b="+"+e.toString(16)}else{if(e>=4096&&e<8192){b="="+(e-4096).toString(16)}else{if(e>=8192&&e<12240){b="%"+(e-8192).toString(16)}else{if(e>=12240&&e<77776){b="*"+(e-12240).toString(16)}else{if(e>=77776){b="$"+(e-77776).toString(16)}else{d++}}}}}}}if(d==0){a+=b}else{if(b||d==20){a+=((15+d).toString(36)+b);d=0}}}if(d>0){a+=(15+d).toString(36)}this.outbstr+=a},decodeArrowNumber16:function(){var e=0,d=0,b=this.outbstr;for(d=0;d<b.length;d++){var a=b.charAt(d);if(a=="0"){if(b.charAt(d+1)=="."){bd.sQnC(e,-2);e++;d++}else{bd.sQnC(e,parseInt(b.substr(d+1,1),16));e++;d++}}else{if(a=="5"){bd.sQnC(e,parseInt(b.substr(d+1,2),16));e++;d+=2}else{if(this.include(a,"1","4")){bd.sDiC(e,parseInt(a,16));if(b.charAt(d+1)!="."){bd.sQnC(e,parseInt(b.substr(d+1,1),16))}else{bd.sQnC(e,-2)}e++;d++}else{if(this.include(a,"6","9")){bd.sDiC(e,parseInt(a,16)-5);bd.sQnC(e,parseInt(b.substr(d+1,2),16));e++;d+=2}else{if(a>="a"&&a<="z"){e+=(parseInt(a,36)-9)}else{e++}}}}}if(e>bd.cellmax){break}}this.outbstr=b.substr(d)},encodeArrowNumber16:function(){var a="",d=0;for(var e=0;e<bd.cellmax;e++){var b="";if(bd.QnC(e)!=-1){if(bd.QnC(e)==-2){b=((bd.DiC(e)==0?0:bd.DiC(e))+".")}else{if(bd.QnC(e)<16){b=((bd.DiC(e)==0?0:bd.DiC(e))+bd.QnC(e).toString(16))}else{if(bd.QnC(e)<256){b=((bd.DiC(e)==0?5:bd.DiC(e)+5)+bd.QnC(e).toString(16))}}}}else{b=" ";d++}if(d==0){a+=b}else{if(b!=" "){a+=((d+9).toString(36)+b);d=0}else{if(d==26){a+="z";d=0}}}}if(d>0){a+=(d+9).toString(36)}this.outbstr+=a},decodeBorder:function(){var f,e,c=this.outbstr;if(c){f=Math.min(mf(((k.qcols-1)*k.qrows+4)/5),c.length);e=Math.min(mf((k.qcols*(k.qrows-1)+4)/5)+f,c.length)}else{f=0;e=0}for(var d=0;d<f;d++){var b=parseInt(c.charAt(d),32);for(var a=0;a<5;a++){if(d*5+a<(k.qcols-1)*k.qrows){bd.sQuB(d*5+a,(b&Math.pow(2,4-a)?1:0))}}}var h=(k.qcols-1)*k.qrows;for(var d=0;d<e-f;d++){var b=parseInt(c.charAt(d+f),32);for(var a=0;a<5;a++){if(d*5+a<k.qcols*(k.qrows-1)){bd.sQuB(d*5+a+h,(b&Math.pow(2,4-a)?1:0))}}}area.resetRarea();this.outbstr=c.substr(e)},encodeBorder:function(){var b,d;var a="";b=0;d=0;for(var c=0;c<(k.qcols-1)*k.qrows;c++){if(bd.QuB(c)==1){d+=Math.pow(2,4-b)}b++;if(b==5){a+=d.toString(32);b=0;d=0}}if(b>0){a+=d.toString(32)}b=0;d=0;for(var c=(k.qcols-1)*k.qrows;c<bd.bdinside;c++){if(bd.QuB(c)==1){d+=Math.pow(2,4-b)}b++;if(b==5){a+=d.toString(32);b=0;d=0}}if(b>0){a+=d.toString(32)}this.outbstr+=a},decodeCrossMark:function(){var f=-1,d=0,c=this.outbstr;for(d=0;d<c.length;d++){var b=c.charAt(d);if(this.include(b,"0","9")||this.include(b,"a","z")){f+=(parseInt(b,36)+1);var a=(k.isoutsidecross==1?f%(k.qcols+1):f%(k.qcols-1)+1);var e=(k.isoutsidecross==1?mf(f/(k.qcols+1)):mf(f/(k.qcols-1))+1);if(e>=k.qrows+(k.isoutsidecross==1?1:0)){d++;break}bd.sQnX(bd.xnum(a,e),1)}else{if(b=="."){f+=36}else{f++}}if(f>=(k.isoutsidecross==1?(k.qcols+1)*(k.qrows+1):(k.qcols-1)*(k.qrows-1))-1){d++;break}}this.outbstr=c.substr(d)},encodeCrossMark:function(){var b="",e=0;for(var d=0;d<(k.isoutsidecross==1?(k.qcols+1)*(k.qrows+1):(k.qcols-1)*(k.qrows-1));d++){var c="";var a=(k.isoutsidecross==1?d%(k.qcols+1):d%(k.qcols-1)+1);var f=(k.isoutsidecross==1?mf(d/(k.qcols+1)):mf(d/(k.qcols-1))+1);if(bd.QnX(bd.xnum(a,f))==1){c="."}else{c=" ";e++}if(c!=" "){b+=e.toString(36);e=0}else{if(e==36){b+=".";e=0}}}if(e>0){b+=e.toString(36)}this.outbstr+=b},decodeCircle41_42:function(){var c=this.outbstr;var e=c?Math.min(mf((k.qcols*k.qrows+2)/3),c.length):0;for(var d=0;d<e;d++){var b=parseInt(c.charAt(d),27);for(var a=0;a<3;a++){if(d*3+a<k.qcols*k.qrows){if(mf(b/Math.pow(3,2-a))%3==1){bd.sQuC(d*3+a,41)}else{if(mf(b/Math.pow(3,2-a))%3==2){bd.sQuC(d*3+a,42)}}}}}this.outbstr=c.substr(e)},encodeCircle41_42:function(){var a="",b=0,d=0;for(var c=0;c<bd.cellmax;c++){if(bd.QuC(c)==41){d+=(Math.pow(3,2-b))}else{if(bd.QuC(c)==42){d+=(2*Math.pow(3,2-b))}}b++;if(b==3){a+=d.toString(27);b=0;d=0}}if(b>0){a+=d.toString(27)}this.outbstr+=a},decodecross_old:function(){var a=this.outbstr;for(var c=0;c<Math.min(a.length,bd.crossmax);c++){if(a.charAt(c)=="0"){bd.sQnX(c,0)}else{if(a.charAt(c)=="1"){bd.sQnX(c,1)}else{if(a.charAt(c)=="2"){bd.sQnX(c,2)}else{if(a.charAt(c)=="3"){bd.sQnX(c,3)}else{if(a.charAt(c)=="4"){bd.sQnX(c,4)}else{bd.sQnX(c,-1)}}}}}}for(var b=a.length;b<bd.crossmax;b++){bd.sQnX(b,-1)}this.outbstr=a.substr(c)},include:function(b,c,a){if(c<=b&&b<=a){return true}return false}};FileIO=function(){this.filever=0;this.lineseek=0;this.dataarray=[];this.datastr="";this.urlstr="";this.PZPR=1;this.PBOX=2;this.dbm=new DataBaseManager()};FileIO.prototype={filedecode:function(c){this.filever=0;this.lineseek=0;this.dataarray=c.split("/");var b=this.PZPR;if(this.readLine().match(/pzprv3\.?(\d+)?/)){if(RegExp.$1){this.filever=parseInt(RegExp.$1)}if(this.readLine()!=k.puzzleid){alert(base.getPuzzleName()+"‚Ìƒtƒ@ƒCƒ‹‚Å‚Í‚ ‚è‚Ü‚¹‚ñB");return}b=this.PZPR}else{this.lineseek=0;b=this.PBOX}var d,a;if(k.puzzleid!=="sudoku"){d=parseInt(this.readLine(),10);a=parseInt(this.readLine(),10);if(b===2&&k.puzzleid==="kakuro"){d--;a--}}else{d=a=parseInt(this.readLine(),10)}if(d<=0||a<=0){return}bd.initBoardSize(a,d);um.disableRecord();um.disableInfo();if(b===1){this.decodeData()}else{if(b===2){this.kanpenOpen()}}um.enableRecord();um.enableInfo();this.dataarray=null;base.resetInfo(true);base.resize_canvas()},fileencode:function(b){this.filever=0;this.sizestr="";this.datastr="";this.urlstr="";if(b===this.PZPR){this.encodeData()}else{if(b===this.PBOX){this.kanpenSave()}}if(!this.sizestr){this.sizestr=[k.qrows,k.qcols].join("/")}this.datastr=[this.sizestr,this.datastr].join("/");if(b===1){var c=(this.filever===0?"pzprv3":("pzprv3."+this.filever));this.datastr=[c,k.puzzleid,this.datastr].join("/")}var a=this.datastr;if(b===1){this.urlstr=enc.pzloutput((!k.isKanpenExist||k.puzzleid==="lits")?enc.PZPRV3:enc.KANPEN)}return a},readLine:function(){this.lineseek++;return this.dataarray[this.lineseek-1]},readLines:function(a){this.lineseek+=a;return this.dataarray.slice(this.lineseek-a,this.lineseek)},getItemList:function(f){var d=[];var j=this.readLines(f);for(var a=0;a<j.length;a++){var e=j[a].split(" ");var b=[];for(var h=0;h<e.length;h++){if(e[h]!=""){b.push(e[h])}}d=d.concat(b)}return d},decodeObj:function(f,d,a,c){var e=this.getItemList(a);for(var b=0;b<e.length;b++){f(c(b%d,mf(b/d)),e[b])}},decodeCell:function(a){this.decodeObj(a,k.qcols,k.qrows,function(b,c){return bd.cnum(b,c)})},decodeCross:function(a){this.decodeObj(a,k.qcols+1,k.qrows+1,function(b,c){return bd.xnum(b,c)})},decodeBorder:function(a){this.decodeObj(a,k.qcols-1,k.qrows,function(b,c){return bd.bnum(2*b+2,2*c+1)});this.decodeObj(a,k.qcols,k.qrows-1,function(b,c){return bd.bnum(2*b+1,2*c+2)})},decodeBorder2:function(a){this.decodeObj(a,k.qcols+1,k.qrows,function(b,c){return bd.bnum(2*b,2*c+1)});this.decodeObj(a,k.qcols,k.qrows+1,function(b,c){return bd.bnum(2*b+1,2*c)})},encodeObj:function(e,d,b,c){for(var f=0;f<b;f++){for(var a=0;a<d;a++){this.datastr+=e(c(a,f))}this.datastr+="/"}},encodeCell:function(a){this.encodeObj(a,k.qcols,k.qrows,function(b,c){return bd.cnum(b,c)})},encodeCross:function(a){this.encodeObj(a,k.qcols+1,k.qrows+1,function(b,c){return bd.xnum(b,c)})},encodeBorder:function(a){this.encodeObj(a,k.qcols-1,k.qrows,function(b,c){return bd.bnum(2*b+2,2*c+1)});this.encodeObj(a,k.qcols,k.qrows-1,function(b,c){return bd.bnum(2*b+1,2*c+2)})},encodeBorder2:function(a){this.encodeObj(a,k.qcols+1,k.qrows,function(b,c){return bd.bnum(2*b,2*c+1)});this.encodeObj(a,k.qcols,k.qrows+1,function(b,c){return bd.bnum(2*b+1,2*c)})},decodeCellQues41_42:function(){this.decodeCell(function(b,a){if(a==="-"){bd.sQnC(b,-2)}else{if(a==="1"){bd.sQuC(b,41)}else{if(a==="2"){bd.sQuC(b,42)}}}})},encodeCellQues41_42:function(){this.encodeCell(function(a){if(bd.QuC(a)===41){return"1 "}else{if(bd.QuC(a)===42){return"2 "}else{if(bd.QnC(a)===-2){return"- "}else{return". "}}}})},decodeCellQnum:function(){this.decodeCell(function(b,a){if(a==="-"){bd.sQnC(b,-2)}else{if(a!=="."){bd.sQnC(b,parseInt(a))}}})},encodeCellQnum:function(){this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.QnC(a)===-2){return"- "}else{return". "}}})},decodeCellQnumb:function(){this.decodeCell(function(b,a){if(a==="5"){bd.sQnC(b,-2)}else{if(a!=="."){bd.sQnC(b,parseInt(a))}}})},encodeCellQnumb:function(){this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.QnC(a)===-2){return"5 "}else{return". "}}})},decodeCellQnumAns:function(){this.decodeCell(function(b,a){if(a==="#"){bd.setBlack(b)}else{if(a==="+"){bd.sQsC(b,1)}else{if(a==="-"){bd.sQnC(b,-2)}else{if(a!=="."){bd.sQnC(b,parseInt(a))}}}}})},encodeCellQnumAns:function(){this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.QnC(a)===-2){return"- "}else{if(bd.isBlack(a)){return"# "}else{if(bd.QsC(a)===1){return"+ "}else{return". "}}}}})},decodeCellDirecQnum:function(){this.decodeCell(function(d,a){if(a!=="."){var b=a.split(",");bd.sDiC(d,(b[0]!=="0"?parseInt(b[0]):0));bd.sQnC(d,(b[1]!=="-"?parseInt(b[1]):-2))}})},encodeCellDirecQnum:function(){this.encodeCell(function(d){if(bd.QnC(d)!==-1){var b=(bd.DiC(d)!==0?(bd.DiC(d)).toString():"0");var a=(bd.QnC(d)!==-2?(bd.QnC(d)).toString():"-");return""+b+","+a+" "}else{return". "}})},decodeCellAns:function(){this.decodeCell(function(b,a){if(a==="#"){bd.setBlack(b)}else{if(a==="+"){bd.sQsC(b,1)}}})},encodeCellAns:function(){this.encodeCell(function(a){if(bd.isBlack(a)){return"# "}else{if(bd.QsC(a)===1){return"+ "}else{return". "}}})},decodeCellQanssub:function(){this.decodeCell(function(b,a){if(a==="+"){bd.sQsC(b,1)}else{if(a==="-"){bd.sQsC(b,2)}else{if(a==="="){bd.sQsC(b,3)}else{if(a==="%"){bd.sQsC(b,4)}else{if(a!=="."){bd.sQaC(b,parseInt(a))}}}}}})},encodeCellQanssub:function(){this.encodeCell(function(a){if(bd.QaC(a)!==-1){return(bd.QaC(a).toString()+" ")}else{if(bd.QsC(a)===1){return"+ "}else{if(bd.QsC(a)===2){return"- "}else{if(bd.QsC(a)===3){return"= "}else{if(bd.QsC(a)===4){return"% "}else{return". "}}}}}})},decodeCellQsub:function(){this.decodeCell(function(b,a){if(a!="0"){bd.sQsC(b,parseInt(a))}})},encodeCellQsub:function(){this.encodeCell(function(a){if(bd.QsC(a)>0){return(bd.QsC(a).toString()+" ")}else{return"0 "}})},decodeCrossNum:function(){this.decodeCross(function(b,a){if(a==="-"){bd.sQnX(b,-2)}else{if(a!=="."){bd.sQnX(b,parseInt(a))}}})},encodeCrossNum:function(){this.encodeCross(function(a){if(bd.QnX(a)>=0){return(bd.QnX(a).toString()+" ")}else{if(bd.QnX(a)===-2){return"- "}else{return". "}}})},decodeBorderQues:function(){this.decodeBorder(function(b,a){if(a==="1"){bd.sQuB(b,1)}})},encodeBorderQues:function(){this.encodeBorder(function(a){if(bd.QuB(a)===1){return"1 "}else{return"0 "}})},decodeBorderLine:function(){var a=bd.isLineNG;bd.isLineNG=function(b){return false};this.decodeBorder(function(d,b){if(b==="-1"){bd.sQsB(d,2)}else{if(b!=="0"){bd.sLiB(d,parseInt(b))}}});bd.isLineNG=a},encodeBorderLine:function(){this.encodeBorder(function(a){if(bd.LiB(a)>0){return""+bd.LiB(a)+" "}else{if(bd.QsB(a)===2){return"-1 "}else{return"0 "}}})},decodeBorderAns:function(){this.decodeBorder(function(b,a){if(a==="1"){bd.sQaB(b,1)}else{if(a==="2"){bd.sQaB(b,1);bd.sQsB(b,1)}else{if(a==="-1"){bd.sQsB(b,1)}}}})},encodeBorderAns:function(){this.encodeBorder(function(a){if(bd.QaB(a)===1&&bd.QsB(a)===1){return"2 "}else{if(bd.QaB(a)===1){return"1 "}else{if(bd.QsB(a)===1){return"-1 "}else{return"0 "}}}})},decodeBorderAns2:function(){this.decodeBorder2(function(b,a){if(a==="1"){bd.sQaB(b,1)}else{if(a==="2"){bd.sQsB(b,1)}else{if(a==="3"){bd.sQaB(b,1);bd.sQsB(b,1)}else{if(a==="-1"){bd.sQsB(b,2)}}}}})},encodeBorderAns2:function(){this.encodeBorder2(function(a){if(bd.QaB(a)===1&&bd.QsB(a)===1){return"3 "}else{if(bd.QsB(a)===1){return"2 "}else{if(bd.QaB(a)===1){return"1 "}else{if(bd.QsB(a)===2){return"-1 "}else{return"0 "}}}}})},decodeAreaRoom:function(){this.decodeAreaRoom_com(true)},encodeAreaRoom:function(){this.encodeAreaRoom_com(true)},decodeAnsAreaRoom:function(){this.decodeAreaRoom_com(false)},encodeAnsAreaRoom:function(){this.encodeAreaRoom_com(false)},decodeAreaRoom_com:function(a){this.readLine();this.rdata2Border(a,this.getItemList(k.qrows));area.resetRarea()},encodeAreaRoom_com:function(a){var d=area.getRoomInfo();this.datastr+=(d.max+"/");for(var b=0;b<bd.cellmax;b++){this.datastr+=(""+(d.id[b]-1)+" ");if((b+1)%k.qcols==0){this.datastr+="/"}}},rdata2Border:function(e,d){var c=(e?bd.sQuB:bd.sQaB);for(var f=0;f<bd.bdmax;f++){var b=bd.cc1(f),a=bd.cc2(f);c.apply(bd,[f,(b!=-1&&a!=-1&&d[b]!=d[a]?1:0)])}},decodeCellQnum51:function(){var e=this.getItemList(k.qrows+1);for(var b=0;b<e.length;b++){var a=b%(k.qcols+1)-1,h=mf(b/(k.qcols+1))-1;if(e[b]!="."){if(h===-1){bd.sDiE(bd.exnum(a,h),parseInt(e[b]))}else{if(a===-1){bd.sQnE(bd.exnum(a,h),parseInt(e[b]))}else{var d=e[b].split(",");var f=bd.cnum(a,h);mv.set51cell(f,true);bd.sQnC(f,d[0]);bd.sDiC(f,d[1])}}}}},encodeCellQnum51:function(){var b="";for(var e=-1;e<k.qrows;e++){for(var a=-1;a<k.qcols;a++){if(a===-1&&e==-1){b+="0 "}else{if(e===-1){b+=(""+bd.DiE(bd.exnum(a,e)).toString()+" ")}else{if(a===-1){b+=(""+bd.QnE(bd.exnum(a,e)).toString()+" ")}else{var d=bd.cnum(a,e);if(bd.QuC(d)===51){b+=(""+bd.QnC(d).toString()+","+bd.DiC(d).toString()+" ")}else{b+=". "}}}}}b+="/"}this.datastr+=b},decodeCellQnum_kanpen:function(){this.decodeCell(function(b,a){if(a!="."){bd.sQnC(b,parseInt(a))}})},encodeCellQnum_kanpen:function(){this.encodeCell(function(a){return(bd.QnC(a)>=0)?(bd.QnC(a).toString()+" "):". "})},decodeCellQans_kanpen:function(){this.decodeCell(function(b,a){if(a!="."&&a!="0"){bd.sQaC(b,parseInt(a))}})},encodeCellQans_kanpen:function(){this.encodeCell(function(a){if(bd.QnC(a)!=-1){return". "}else{if(bd.QaC(a)==-1){return"0 "}else{return""+bd.QaC(a).toString()+" "}}})},decodeCellQnumAns_kanpen:function(){this.decodeCell(function(b,a){if(a=="#"){bd.setBlack(b)}else{if(a=="+"){bd.sQsC(b,1)}else{if(a!="."){bd.sQnC(b,parseInt(a))}}}})},encodeCellQnumAns_kanpen:function(){this.encodeCell(function(a){if(bd.QnC(a)>=0){return(bd.QnC(a).toString()+" ")}else{if(bd.isBlack(a)){return"# "}else{if(bd.QsC(a)==1){return"+ "}else{return". "}}}})},decodeSquareRoom:function(){this.decodeSquareRoom_com(true)},encodeSquareRoom:function(){this.encodeSquareRoom_com(true)},decodeAnsSquareRoom:function(){this.decodeSquareRoom_com(false)},encodeAnsSquareRoom:function(){this.encodeSquareRoom_com(false)},decodeSquareRoom_com:function(f){var j=parseInt(this.readLine());var b=this.readLines(j);var e=[];for(var c=0;c<b.length;c++){if(b[c]==""){break}var a=b[c].split(" ");for(var h=0;h<4;h++){if(!isNaN(a[h])){a[h]=parseInt(a[h])}}var d={y1:a[0],x1:a[1],y2:a[2],x2:a[3]};if(f&&a[4]!=""){bd.sQnC(bd.cnum(d.x1,d.y1),parseInt(a[4],10))}this.setRdataRect(e,c,d)}this.rdata2Border(f,e);area.resetRarea()},setRdataRect:function(d,b,c){for(var a=c.x1;a<=c.x2;a++){for(var e=c.y1;e<=c.y2;e++){d[bd.cnum(a,e)]=b}}},encodeSquareRoom_com:function(c){var f=area.getRoomInfo();this.datastr+=(f.max+"/");for(var e=1;e<=f.max;e++){var b=ans.getSizeOfClist(f.room[e].idlist,f_true);var a=(c?bd.QnC(area.getTopOfRoom(e)):-1);this.datastr+=(""+b.y1+" "+b.x1+" "+b.y2+" "+b.x2+" "+(a>=0?""+a:"")+"/")}}};DataBaseManager=function(){this.dbh=null;this.DBaccept=0;this.DBsid=-1;this.DBlist=[];this.keys=["id","col","row","hard","pdata","time","comment"];this.selectDBtype()};DataBaseManager.prototype={selectDBtype:function(){if(!!window.localStorage){if(!k.br.Gecko||!!location.hostname){this.DBaccept|=8}}if(!!window.openDatabase){try{var a=openDatabase("pzprv3_manage","1.0");if(!!a){this.DBaccept|=2}}catch(b){}}try{if((window.google&&google.gears)||(k.br.Gecko&&(typeof GearsFactory!="undefined"))||(k.br.IE&&!!window.ActiveXObject&&(!!(new ActiveXObject("Gears.Factory"))))||(k.br.WebKit&&navigator.mimeTypes["application/x-googlegears"])){this.DBaccept|=1}}catch(b){}},requireGears:function(){return !!(this.DBaccept&1)},openDialog:function(){this.openHandler();this.update()},openHandler:function(){var b=0;if(this.DBaccept&8){b=4}else{if(this.DBaccept&4){b=3}else{if(this.DBaccept&2){b=2}else{if(this.DBaccept&1){b=1}}}}switch(b){case 1:case 2:this.dbh=new DataBaseHandler_SQL((b===2));break;case 4:this.dbh=new DataBaseHandler_LS();break;default:return}this.dbh.importDBlist(this);var a={idlist:"ID‡",newsave:"•Û‘¶‚ªV‚µ‚¢‡",oldsave:"•Û‘¶‚ªŒÃ‚¢‡",size:"ƒTƒCƒY/“ïˆÕ“x‡"};var c="";for(s in a){c+=('<option value="'+s+'">'+a[s]+"</option>")}document.database.sorts.innerHTML=c},closeDialog:function(){this.DBlist=[]},clickHandler:function(a){switch(ee.getSrcElement(a).name){case"sorts":this.displayDataTableList();case"datalist":this.selectDataTable();break;case"tableup":this.upDataTable_M();break;case"tabledn":this.downDataTable_M();break;case"open":this.openDataTable_M();break;case"save":this.saveDataTable_M();break;case"comedit":this.editComment_M();break;case"difedit":this.editDifficult_M();break;case"del":this.deleteDataTable_M();break}},getDataID:function(){if(document.database.datalist.value!="new"&&document.database.datalist.value!=""){for(var a=0;a<this.DBlist.length;a++){if(this.DBlist[a].id==document.database.datalist.value){return a}}}return -1},update:function(){this.dbh.updateManageData(this);this.displayDataTableList();this.selectDataTable()},displayDataTableList:function(){switch(document.database.sorts.value){case"idlist":this.DBlist=this.DBlist.sort(function(h,f){return(h.id-f.id)});break;case"newsave":this.DBlist=this.DBlist.sort(function(h,f){return(f.time-h.time||h.id-f.id)});break;case"oldsave":this.DBlist=this.DBlist.sort(function(h,f){return(h.time-f.time||h.id-f.id)});break;case"size":this.DBlist=this.DBlist.sort(function(h,f){return(h.col-f.col||h.row-f.row||h.hard-f.hard||h.id-f.id)});break}var c="";for(var b=0;b<this.DBlist.length;b++){var e=this.DBlist[b];if(!e){continue}var d=' value="'+e.id+'"';var a=(this.DBsid==e.id?" selected":"");c+=("<option"+d+a+">"+this.getRowString(e)+"</option>\n")}c+=('<option value="new"'+(this.DBsid==-1?" selected":"")+">&nbsp;&lt;V‚µ‚­•Û‘¶‚·‚é&gt;</option>\n");document.database.datalist.innerHTML=c},getRowString:function(c){var b=[{ja:"|",en:"-"},{ja:"‚ç‚­‚ç‚­",en:"Easy"},{ja:"‚¨‚Ä‚²‚ë",en:"Normal"},{ja:"‚½‚¢‚Ö‚ñ",en:"Hard"},{ja:"ƒAƒ[ƒ“",en:"Expert"}];var a="";a+=((c.id<10?"&nbsp;":"")+c.id+" :&nbsp;");a+=(this.dateString(c.time*1000)+" &nbsp;");a+=(""+c.col+"~"+c.row+" &nbsp;");if(!!c.hard||c.hard=="0"){a+=(b[c.hard][menu.language])}return a},dateString:function(c){var b=function(e){return(e<10?"0":"")+e};var d=" ";var a=new Date();a.setTime(c);d+=(b(a.getFullYear()%100)+"/"+b(a.getMonth()+1)+"/"+b(a.getDate())+" ");d+=(b(a.getHours())+":"+b(a.getMinutes()));return d},selectDataTable:function(){var a=this.getDataID();if(a>=0){document.database.comtext.value=""+this.DBlist[a].comment;this.DBsid=parseInt(this.DBlist[a].id)}else{document.database.comtext.value="";this.DBsid=-1}document.database.tableup.disabled=(document.database.sorts.value!=="idlist"||this.DBsid===-1||this.DBsid===1);document.database.tabledn.disabled=(document.database.sorts.value!=="idlist"||this.DBsid===-1||this.DBsid===this.DBlist.length);document.database.comedit.disabled=(this.DBsid===-1);document.database.difedit.disabled=(this.DBsid===-1);document.database.open.disabled=(this.DBsid===-1);document.database.del.disabled=(this.DBsid===-1)},upDataTable_M:function(){var a=this.getDataID();if(a===-1||a===0){return}this.convertDataTable_M(a,a-1)},downDataTable_M:function(){var a=this.getDataID();if(a===-1||a===this.DBlist.length-1){return}this.convertDataTable_M(a,a+1)},convertDataTable_M:function(a,b){this.DBsid=this.DBlist[b].id;var d={};for(var e=1;e<7;e++){d[this.keys[e]]=this.DBlist[a][this.keys[e]]}for(var e=1;e<7;e++){this.DBlist[a][this.keys[e]]=this.DBlist[b][this.keys[e]]}for(var e=1;e<7;e++){this.DBlist[b][this.keys[e]]=d[this.keys[e]]}this.dbh.convertDataTableID(this,a,b);this.update()},openDataTable_M:function(){var a=this.getDataID();if(a===-1){return}if(!confirm("‚±‚Ìƒf[ƒ^‚ð“Ç‚Ýž‚Ý‚Ü‚·‚©H (Œ»Ý‚Ì”Õ–Ê‚Í”jŠü‚³‚ê‚Ü‚·)")){return}this.dbh.openDataTable(this,a)},saveDataTable_M:function(){var c=this.getDataID(),a=false;if(c===-1){c=this.DBlist.length;a=true;this.DBlist[c]={};var b=prompt("ƒRƒƒ“ƒg‚ª‚ ‚éê‡‚Í“ü—Í‚µ‚Ä‚­‚¾‚³‚¢B","");this.DBlist[c].comment=(!!b?b:"");this.DBlist[c].hard=0;this.DBlist[c].id=c+1;this.DBsid=this.DBlist[c].id}else{if(!confirm("‚±‚Ìƒf[ƒ^‚Éã‘‚«‚µ‚Ü‚·‚©H")){return}}this.DBlist[c].col=k.qcols;this.DBlist[c].row=k.qrows;this.DBlist[c].time=mf((new Date()).getTime()/1000);this.dbh.saveDataTable(this,c);this.update()},editComment_M:function(){var b=this.getDataID();if(b===-1){return}var a=prompt("‚±‚Ì–â‘è‚É‘Î‚·‚éƒRƒƒ“ƒg‚ð“ü—Í‚µ‚Ä‚­‚¾‚³‚¢B",this.DBlist[b].comment);if(a==null){return}this.DBlist[b].comment=a;this.dbh.updateComment(this,b);this.update()},editDifficult_M:function(){var b=this.getDataID();if(b===-1){return}var a=prompt("‚±‚Ì–â‘è‚Ì“ïˆÕ“x‚ðÝ’è‚µ‚Ä‚­‚¾‚³‚¢B\n[0:‚È‚µ 1:‚ç‚­‚ç‚­ 2:‚¨‚Ä‚²‚ë 3:‚½‚¢‚Ö‚ñ 4:ƒAƒ[ƒ“]",this.DBlist[b].hard);if(a==null){return}this.DBlist[b].hard=((a=="1"||a=="2"||a=="3"||a=="4")?a:0);this.dbh.updateDifficult(this,b);this.update()},deleteDataTable_M:function(){var f=this.getDataID();if(f===-1){return}if(!confirm("‚±‚Ìƒf[ƒ^‚ðŠ®‘S‚Éíœ‚µ‚Ü‚·‚©H")){return}var b=this.DBlist[f].id,a=this.DBlist.length;for(var d=b-1;d<a-1;d++){for(var e=1;e<7;e++){this.DBlist[d][this.keys[e]]=this.DBlist[d+1][this.keys[e]]}}this.DBlist.pop();this.dbh.deleteDataTable(this,b,a);this.update()}};DataBaseHandler_LS=function(){this.pheader="pzprv3_"+k.puzzleid+":puzdata";this.keys=fio.dbm.keys;this.initialize()};DataBaseHandler_LS.prototype={initialize:function(){this.createManageDataTable();this.createDataBase()},importDBlist:function(a){a.DBlist=[];var b=0;while(1){b++;var d={};for(var e=0;e<7;e++){d[this.keys[e]]=localStorage[this.pheader+"!"+b+"!"+this.keys[e]]}if(d.id==null){break}d.pdata="";a.DBlist.push(d)}},createManageDataTable:function(){localStorage.pzprv3_manage="DataBase";localStorage["pzprv3_manage:manage"]="Table"},updateManageData:function(a){var b="pzprv3_manage:manage!"+k.puzzleid;localStorage[b+"!count"]=a.DBlist.length;localStorage[b+"!time"]=mf((new Date()).getTime()/1000)},createDataBase:function(){localStorage["pzprv3_"+k.puzzleid]="DataBase";localStorage["pzprv3_"+k.puzzleid+":puzdata"]="Table"},convertDataTableID:function(i,a,b){var e=i.DBlist[a].id,j=i.DBlist[b].id;var h=this.pheader+"!"+e,d=this.pheader+"!"+j,l={};for(var f=1;f<7;f++){localStorage[h+"!"+this.keys[f]]=i.DBlist[a][this.keys[f]]}for(var f=1;f<7;f++){localStorage[d+"!"+this.keys[f]]=i.DBlist[b][this.keys[f]]}},openDataTable:function(a,c){var b=localStorage[this.pheader+"!"+a.DBlist[c].id+"!pdata"];fio.filedecode(b)},saveDataTable:function(a,e){var b=a.DBlist[e];for(var d=0;d<7;d++){localStorage[this.pheader+"!"+b.id+"!"+this.keys[d]]=(d!==4?b[this.keys[d]]:fio.fileencode(1))}},updateComment:function(a,c){var b=a.DBlist[c];localStorage[this.pheader+"!"+b.id+"!comment"]=b.comment},updateDifficult:function(a,c){var b=a.DBlist[c];localStorage[this.pheader+"!"+b.id+"!hard"]=b.hard},deleteDataTable:function(e,b,a){for(var d=parseInt(b);d<a;d++){var h=[this.pheader+"!"+(d+1),this.pheader+"!"+d];for(var j=1;j<7;j++){localStorage[h[1]+"!"+this.keys[j]]=localStorage[h[0]+"!"+this.keys[j]]}}var f=this.pheader+"!"+a;for(var j=0;j<7;j++){localStorage.removeItem(f+"!"+this.keys[j])}}};DataBaseHandler_SQL=function(a){this.db=null;this.dbmgr=null;this.isSQLDB=a;this.initialize()};DataBaseHandler_SQL.prototype={initialize:function(){var b=new DataBaseObject_SQL(this.isSQLDB);var a=new DataBaseObject_SQL(this.isSQLDB);this.dbmgr=b.openDatabase("pzprv3_manage","1.0");this.db=a.openDatabase("pzprv3_"+k.puzzleid,"1.0");this.createManageDataTable();this.createDataBase()},importDBlist:function(a){a.DBlist=[];this.db.transaction(function(b){b.executeSql("SELECT * FROM pzldata",[],function(d,e){var f=0,j=a.keys;for(var h=0;h<e.rows.length;h++){a.DBlist[f]={};for(var l=0;l<7;l++){a.DBlist[f][j[l]]=e.rows.item(h)[j[l]]}a.DBlist[f].pdata="";f++}})},function(){},function(){fio.dbm.update()})},createManageDataTable:function(){this.dbmgr.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS manage (puzzleid primary key,version,count,lastupdate)",[])})},updateManageData:function(a){var b=a.DBlist.length;var c=mf((new Date()).getTime()/1000);this.dbmgr.transaction(function(d){d.executeSql("INSERT OR REPLACE INTO manage VALUES(?,?,?,?)",[k.puzzleid,"1.0",b,c])})},createDataBase:function(){this.db.transaction(function(a){a.executeSql("CREATE TABLE IF NOT EXISTS pzldata (id int primary key,col,row,hard,pdata,time,comment)",[])})},convertDataTableID:function(c,a,d){var b=c.DBlist[a].id,e=c.DBlist[d].id;this.db.transaction(function(f){f.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[0,b]);f.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[b,e]);f.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[e,0])})},openDataTable:function(a,b){this.db.transaction(function(c){c.executeSql("SELECT * FROM pzldata WHERE ID==?",[a.DBlist[b].id],function(d,e){fio.filedecode(e.rows.item(0)["pdata"])})})},saveDataTable:function(a,c){var b=a.DBlist[c];this.db.transaction(function(d){d.executeSql("INSERT INTO pzldata VALUES(?,?,?,?,?,?,?)",[b.id,b.col,b.row,b.hard,fio.fileencode(1),b.time,b.comment])})},updateComment:function(a,c){var b=a.DBlist[c];this.db.transaction(function(d){d.executeSql("UPDATE pzldata SET comment=? WHERE ID==?",[b.comment,b.id])})},updateDifficult:function(a,c){var b=a.DBlist[c];this.db.transaction(function(d){d.executeSql("UPDATE pzldata SET hard=? WHERE ID==?",[b.hard,b.id])})},deleteDataTable:function(c,b,a){this.db.transaction(function(d){d.executeSql("DELETE FROM pzldata WHERE ID==?",[b]);for(var e=parseInt(b);e<a;e++){d.executeSql("UPDATE pzldata SET id=? WHERE ID==?",[e,e+1])}})}};DataBaseObject_SQL=function(a){this.name="";this.version=0;this.isSQLDB=a;this.object=null};DataBaseObject_SQL.prototype={openDatabase:function(b,a){this.name=b;this.version=a;if(this.isSQLDB){this.object=openDatabase(this.name,this.version)}else{this.object=google.gears.factory.create("beta.database",this.version)}return this},transaction:function(c,b,a){if(typeof b=="undefined"){b=f_true}if(typeof a=="undefined"){a=f_true}if(this.isSQLDB){this.object.transaction(c,b,a)}else{this.object.open(this.name);c(this);this.object.close();a()}},executeSql:function(f,e,j){var h=this.object.execute(f,e);if(typeof j!="undefined"){var a=0,m={};m.rowarray=[];while(h.isValidRow()){var l={};for(var c=0,d=h.fieldCount();c<d;c++){l[c]=l[h.fieldName(c)]=h.field(c)}m.rowarray[a]=l;h.next();a++}h.close();m.length=a;m.item=function(i){return this.rowarray[i]};var b={rows:m};j(this,b)}}};AnsCheck=function(){this.performAsLine=false;this.errDisp=false;this.setError=true;this.inCheck=false;this.inAutoCheck=false;this.alstr={jp:"",en:""}};AnsCheck.prototype={check:function(){this.inCheck=true;this.alstr={jp:"",en:""};kc.keyreset();mv.mousereset();if(!this.checkAns()){alert((menu.isLangJP()||!this.alstr.en)?this.alstr.jp:this.alstr.en);this.errDisp=true;pc.paintAll();this.inCheck=false;return false}alert(menu.isLangJP()?"³‰ð‚Å‚·I":"Complete!");this.inCheck=false;return true},checkAns:function(){},setAlert:function(b,a){this.alstr.jp=b;this.alstr.en=a},autocheck:function(){if(!k.autocheck||k.editmode||this.inCheck){return}var a=false;this.inCheck=this.inAutoCheck=true;this.disableSetError();if(this.autocheck1st()&&this.checkAns()&&this.inCheck){mv.mousereset();alert(menu.isLangJP()?"³‰ð‚Å‚·I":"Complete!");a=true;pp.setVal("autocheck",false)}this.enableSetError();this.inCheck=this.inAutoCheck=false;return a},autocheck1st:function(){if(this.check1st){return this.check1st()}else{if((k.isCenterLine&&!ans.checkLcntCell(1))||(k.isborderAsLine&&!ans.checkLcntCross(1,0))){return false}}return true},disableSetError:function(){this.setError=false},enableSetError:function(){this.setError=true},isenableSetError:function(){return this.setError},checkdir4Cell:function(c,b){if(c<0||c>=bd.cellmax){return 0}var a=0;if(bd.up(c)!=-1&&b(bd.up(c))){a++}if(bd.dn(c)!=-1&&b(bd.dn(c))){a++}if(bd.lt(c)!=-1&&b(bd.lt(c))){a++}if(bd.rt(c)!=-1&&b(bd.rt(c))){a++}return a},setErrLareaByCell:function(a,d,b){this.setErrLareaById(a,a.id[d],b)},setErrLareaById:function(e,h,d){var a=[];for(var b=0;b<bd.bdmax;b++){if(!bd.isLine(b)){continue}var j=bd.cc1(b),i=bd.cc2(b);if(j!=-1&&i!=-1&&e.id[j]==h&&e.id[j]==e.id[i]){a.push(b)}}bd.sErB(a,d);var l=[];for(var f=0;f<bd.cellmax;f++){if(e.id[f]==h&&bd.QnC(f)!=-1){l.push(f)}}bd.sErC(l,4)},checkAllCell:function(b){var a=true;for(var d=0;d<bd.cellmax;d++){if(b(d)){if(this.inAutoCheck){return false}bd.sErC([d],1);a=false}}return a},checkOneArea:function(a){if(a.max>1){if(this.performAsLine){bd.sErBAll(2);this.setErrLareaByCell(a,1,1)}if(!this.performAsLine||k.puzzleid=="firefly"){bd.sErC(a.room[1].idlist,1)}return false}return true},check2x2Block:function(b){var a=true;for(var d=0;d<bd.cellmax;d++){if(bd.cell[d].cx<k.qcols-1&&bd.cell[d].cy<k.qrows-1){if(b(d)&&b(d+1)&&b(d+k.qcols)&&b(d+k.qcols+1)){if(this.inAutoCheck){return false}bd.sErC([d,d+1,d+k.qcols,d+k.qcols+1],1);a=false}}}return a},checkSideCell:function(b){var a=true;for(var d=0;d<bd.cellmax;d++){if(bd.cell[d].cx<k.qcols-1&&b(d,d+1)){if(this.inAutoCheck){return false}bd.sErC([d,d+1],1);a=false}if(bd.cell[d].cy<k.qrows-1&&b(d,d+k.qcols)){if(this.inAutoCheck){return false}bd.sErC([d,d+k.qcols],1);a=false}}return a},checkQnumCross:function(a){for(var b=0;b<bd.crossmax;b++){if(bd.QnX(b)<0){continue}if(!a(bd.QnX(b),bd.bcntCross(bd.cross[b].cx,bd.cross[b].cy))){bd.sErX([b],1);return false}}return true},checkOneLoop:function(){var a=line.getLineInfo();if(a.max>1){bd.sErBAll(2);bd.sErB(a.room[1].idlist,1);return false}return true},checkLcntCell:function(b){var a=true;if(line.ltotal[b]==0){return true}for(var d=0;d<bd.cellmax;d++){if(line.lcnt[d]==b){if(this.inAutoCheck){return false}if(!this.performAsLine){bd.sErC([d],1)}else{if(a){bd.sErBAll(2)}this.setCellLineError(d,true)}a=false}}return a},isLineStraight:function(a){if(bd.isLine(bd.ub(a))&&bd.isLine(bd.db(a))){return true}else{if(bd.isLine(bd.lb(a))&&bd.isLine(bd.rb(a))){return true}}return false},setCellLineError:function(b,a){if(a){bd.sErC([b],1)}bd.sErB([bd.ub(b),bd.db(b),bd.lb(b),bd.rb(b)],1)},checkdir4Border:function(){var a=true;for(var b=0;b<bd.cellmax;b++){if(bd.QnC(b)>=0&&this.checkdir4Border1(b)!=bd.QnC(b)){if(this.inAutoCheck){return false}bd.sErC([b],1);a=false}}return a},checkdir4Border1:function(d){if(d<0||d>=bd.cellmax){return 0}var b=0;var a=bd.cell[d].cx;var c=bd.cell[d].cy;if((k.isoutsideborder==0&&c==0)||bd.isBorder(bd.bnum(a*2+1,c*2))){b++}if((k.isoutsideborder==0&&c==k.qrows-1)||bd.isBorder(bd.bnum(a*2+1,c*2+2))){b++}if((k.isoutsideborder==0&&a==0)||bd.isBorder(bd.bnum(a*2,c*2+1))){b++}if((k.isoutsideborder==0&&a==k.qcols-1)||bd.isBorder(bd.bnum(a*2+2,c*2+1))){b++}return b},checkenableLineParts:function(d){var a=true;var c=function(e){return((bd.ub(e)!=-1&&bd.isLine(bd.ub(e))&&bd.isnoLPup(e))||(bd.db(e)!=-1&&bd.isLine(bd.db(e))&&bd.isnoLPdown(e))||(bd.lb(e)!=-1&&bd.isLine(bd.lb(e))&&bd.isnoLPleft(e))||(bd.rb(e)!=-1&&bd.isLine(bd.rb(e))&&bd.isnoLPright(e)))};for(var b=0;b<bd.cellmax;b++){if(c(b)){if(this.inAutoCheck){return false}bd.sErC([b],1);a=false}}return a},checkAllArea:function(e,b,c){var a=true;for(var i=1;i<=e.max;i++){var f=this.getSizeOfClist(e.room[i].idlist,b);var h=bd.QnC(k.isOneNumber?area.getTopOfRoomByCell(e.room[i].idlist[0]):this.getQnumCellOfClist(e.room[i].idlist));if(!c(f.x2-f.x1+1,f.y2-f.y1+1,f.cnt,h)){if(this.inAutoCheck){return false}if(this.performAsLine){if(a){bd.sErBAll(2)}this.setErrLareaById(e,i,1)}else{bd.sErC(e.room[i].idlist,(k.puzzleid!="tateyoko"?1:4))}a=false}}return a},checkDisconnectLine:function(a){return this.checkAllArea(a,bd.isNum,function(c,d,b,e){return(e!=-1||b>0)})},checkNumberAndSize:function(a){return this.checkAllArea(a,f_true,function(c,d,b,e){return(e<=0||e==b)})},checkNoNumber:function(a){return this.checkAllArea(a,bd.isNum,function(c,d,b,e){return(b!=0)})},checkDoubleNumber:function(a){return this.checkAllArea(a,bd.isNum,function(c,d,b,e){return(b<2)})},checkTripleNumber:function(a){return this.checkAllArea(a,bd.isNum,function(c,d,b,e){return(b<3)})},checkBlackCellCount:function(a){return this.checkAllArea(a,bd.isBlack,function(c,d,b,e){return(e<0||e==b)})},checkBlackCellInArea:function(b,a){return this.checkAllArea(b,bd.isBlack,function(d,e,c,f){return a(c)})},checkAreaRect:function(a){return this.checkAllArea(a,f_true,function(c,d,b,e){return(c*d==b)})},checkLinesInArea:function(b,a){return this.checkAllArea(b,function(d){return line.lcnt[d]>0},a)},checkNoObjectInRoom:function(b,a){return this.checkAllArea(b,function(d){return a(d)!=-1},function(d,e,c,f){return(c!=0)})},getQnumCellOfClist:function(c){for(var b=0,a=c.length;b<a;b++){if(bd.QnC(c[b])!=-1){return c[b]}}return -1},getSizeOfClist:function(c,b){var e={x1:k.qcols,x2:-1,y1:k.qrows,y2:-1,cnt:0};for(var a=0;a<c.length;a++){if(e.x1>bd.cell[c[a]].cx){e.x1=bd.cell[c[a]].cx}if(e.x2<bd.cell[c[a]].cx){e.x2=bd.cell[c[a]].cx}if(e.y1>bd.cell[c[a]].cy){e.y1=bd.cell[c[a]].cy}if(e.y2<bd.cell[c[a]].cy){e.y2=bd.cell[c[a]].cy}if(b(c[a])){e.cnt++}}return e},checkSideAreaSize:function(i,m){var j=[];for(var a=1;a<=i.max-1;a++){j[a]=[];for(var q=a+1;q<=i.max;q++){j[a][q]=0}}for(var d=0;d<bd.bdmax;d++){if(!bd.isBorder(d)){continue}var p=bd.cc1(d),o=bd.cc2(d);if(p==-1||o==-1){continue}var h=i.id[p],f=i.id[o];try{if(h<f){j[h][f]++}if(h>f){j[f][h]++}}catch(l){alert([h,f]);throw 0}}for(var a=1;a<=i.max-1;a++){for(var q=a+1;q<=i.max;q++){if(j[a][q]==0){continue}var c=m(i,a),b=m(i,q);if(c>0&&b>0&&c==b){bd.sErC(i.room[a].idlist,1);bd.sErC(i.room[q].idlist,1);return false}}}return true},checkSideAreaCell:function(f,d,a){for(var e=0;e<bd.bdmax;e++){if(!bd.isBorder(e)){continue}var c=bd.cc1(e),b=bd.cc2(e);if(c!=-1&&b!=-1&&d(c,b)){if(!a){bd.sErC([c,b],1)}else{bd.sErC(area.room[area.room.id[c]].clist,1);bd.sErC(area.room[area.room.id[b]].clist,1)}return false}}return true},checkSeqBlocksInRoom:function(){var a=true;for(var e=1;e<=area.room.max;e++){var b={max:0,id:[]};for(var d=0;d<bd.cellmax;d++){b.id[d]=((area.room.id[d]==e&&bd.isBlack(d))?0:-1)}for(var d=0;d<k.qcols*k.qrows;d++){if(b.id[d]!=0){continue}b.max++;b[b.max]={clist:[]};area.sc0(d,b)}if(b.max>1){if(this.inAutoCheck){return false}bd.sErC(area.room[e].clist,1);a=false}}return a},checkSameObjectInRoom:function(l,e){var a=true;var f=[];for(var b=1;b<=l.max;b++){f[b]=-1}for(var j=0;j<bd.cellmax;j++){if(l.id[j]==-1||e(j)==-1){continue}if(f[l.id[j]]==-1&&e(j)!=-1){f[l.id[j]]=e(j)}else{if(f[l.id[j]]!=e(j)){if(this.inAutoCheck){return false}if(this.performAsLine){bd.sErBAll(2);this.setErrLareaByCell(l,j,1)}else{bd.sErC(l.room[l.id[j]].idlist,1)}if(k.puzzleid=="kaero"){for(var h=0;h<bd.cellmax;h++){if(l.id[j]==l.id[h]&&this.getBeforeCell(h)!=-1&&l.id[j]!=l.id[this.getBeforeCell(h)]){bd.sErC([this.getBeforeCell(h)],4)}}}a=false}}}return a},checkObjectRoom:function(m,e){var h=[];var f=0;for(var l=0;l<bd.cellmax;l++){if(f<e(l)){f=e(l)}}for(var a=0;a<=f;a++){h[a]=-1}for(var l=0;l<bd.cellmax;l++){if(e(l)==-1){continue}if(h[e(l)]==-1){h[e(l)]=m.id[l]}else{if(h[e(l)]!=m.id[l]){var b=[];for(var j=0;j<bd.cellmax;j++){if(k.puzzleid=="kaero"){if(e(l)==bd.QnC(j)){b.push(j)}}else{if(m.id[l]==m.id[j]||h[e(l)]==m.id[j]){b.push(j)}}}bd.sErC(b,1);return false}}}return true},checkRowsCols:function(d,f){var b=true;for(var e=0;e<k.qrows;e++){var c=bd.getClistByPosition(0,e,k.qcols-1,e);if(!d.apply(this,[c,f])){if(this.inAutoCheck){return false}b=false}}for(var a=1;a<k.qcols;a++){var c=bd.getClistByPosition(a,0,a,k.qrows-1);if(!d.apply(this,[c,f])){if(this.inAutoCheck){return false}b=false}}return b},checkRowsColsPartly:function(f,a,i,j){var m=true;for(var b=0;b<k.qrows;b++){var c=0;while(c<k.qcols){for(var e=c;e<k.qcols;e++){if(i.apply(this,[bd.cnum(e,b)])){break}}var l=bd.getClistByPosition(c,b,e-1,b);var h=(k.isextendcell!=1?0:(c==0?bd.QnE(bd.exnum(-1,b)):bd.QnC(bd.cnum(c-1,b))));if(!f.apply(this,[h,l,a])){if(!j||this.inAutoCheck){return false}m=false}c=e+1}}for(var c=0;c<k.qcols;c++){var b=0;while(b<k.qrows){for(var d=b;d<k.qrows;d++){if(i.apply(this,[bd.cnum(c,d)])){break}}var l=bd.getClistByPosition(c,b,c,d-1);var h=(k.isextendcell!=1?0:(b==0?bd.DiE(bd.exnum(c,-1)):bd.DiC(bd.cnum(c,b-1))));if(!f.apply(this,[h,l,a])){if(!j||this.inAutoCheck){return false}m=false}b=d+1}}return m},checkDifferentNumberInRoom:function(d,c){var a=true;for(var b=1;b<=d.max;b++){if(!this.isDifferentNumberInClist(d.room[b].idlist,c)){if(this.inAutoCheck){return false}bd.sErC(d.room[b].idlist,1);a=false}}return a},isDifferentNumberInClist:function(l,e){var m=true,h=[],f=[],a=(!!k.dispzero?1:0);for(var b=a,j=bd.nummaxfunc(l[0]);b<=j;b++){h[b]=0}for(var c=0;c<l.length;c++){f[l[c]]=e.apply(bd,[l[c]])}for(var c=0;c<l.length;c++){if(f[l[c]]>=a){h[f[l[c]]]++}}for(var c=0;c<l.length;c++){if(f[l[c]]>=a&&h[f[l[c]]]>=2){bd.sErC([l[c]],1);m=false}}return m},checkLcntCross:function(f,e){var b=true;for(var c=0;c<(k.qcols+1)*(k.qrows+1);c++){var a=c%(k.qcols+1),h=mf(c/(k.qcols+1));if(k.isoutsidecross==0&&k.isborderAsLine==0&&(a==0||h==0||a==k.qcols||h==k.qrows)){continue}var d=(!k.isborderAsLine?area.lcnt[c]:line.lcnt[c]);if(d==f&&(e==0||(e==1&&bd.QnX(bd.xnum(a,h))==1)||(e==2&&bd.QnX(bd.xnum(a,h))!=1))){if(this.inAutoCheck){return false}if(b){bd.sErBAll(2)}this.setCrossBorderError(a,h);b=false}}return b},setCrossBorderError:function(a,b){if(k.iscross){bd.sErX([bd.xnum(a,b)],1)}bd.sErB([bd.bnum(a*2,b*2-1),bd.bnum(a*2,b*2+1),bd.bnum(a*2-1,b*2),bd.bnum(a*2+1,b*2)],1)}};Operation=function(d,c,e,a,b){this.obj=d;this.property=c;this.id=e;this.old=a;this.num=b;this.chain=um.chainflag};UndoManager=function(){this.ope=[];this.current=0;this.disrec=0;this.disinfo=0;this.chainflag=0;this.disCombine=0;this.anscount=0;this.changeflag=false;this.undoExec=false;this.redoExec=false;this.reqReset=false;this.range={x1:k.qcols+1,y1:k.qrows+1,x2:-2,y2:-2}};UndoManager.prototype={disableRecord:function(){this.disrec++},enableRecord:function(){if(this.disrec>0){this.disrec--}},isenableRecord:function(){return(this.disrec==0)},disableInfo:function(){this.disinfo++},enableInfo:function(){if(this.disinfo>0){this.disinfo--}},isenableInfo:function(){return(this.disinfo==0)},enb_btn:function(){ee("btnundo").el.disabled=((!this.ope.length||this.current==0)?"true":"");ee("btnredo").el.disabled=((!this.ope.length||this.current==this.ope.length)?"true":"")},allerase:function(){for(var a=this.ope.length-1;a>=0;a--){this.ope.pop()}this.current=0;this.anscount=0;this.enb_btn()},newOperation:function(a){this.chainflag=0;if(a){this.changeflag=false}},addOpe:function(f,e,h,a,b){if(!this.isenableRecord()){return}else{if(a==b){return}}var d=this.ope.length-1;if(this.current<this.ope.length){for(var c=this.ope.length-1;c>=this.current;c--){this.ope.pop()}d=-1}if(d>=0&&this.ope[d].obj==f&&this.ope[d].property==e&&this.ope[d].id==h&&this.ope[d].num==a&&this.disCombine==0&&((f==k.CELL&&(e==k.QNUM||(e==k.QANS&&k.isAnsNumber)))||f==k.CROSS)){this.ope[d].num=b}else{this.ope.push(new Operation(f,e,h,a,b));this.current++;if(this.chainflag==0){this.chainflag=1}}if(e!=k.QSUB){this.anscount++}this.changeflag=true;this.enb_btn()},addObj:function(c,e){var a,d;if(c==k.CELL){a=new Cell();d=bd.cell[e]}else{if(c==k.CROSS){a=new Cross();d=bd.cross[e]}else{if(c==k.BORDER){a=new Border();d=bd.border[e]}else{if(c==k.EXCELL){a=new Cell();d=bd.excell[e]}}}}for(var b in d){a[b]=d[b]}this.addOpe(c,c,e,a,null)},undo:function(){if(this.current==0){return}this.undoExec=true;this.range={x1:k.qcols+1,y1:k.qrows+1,x2:-2,y2:-2};this.disableRecord();while(this.current>0){var a=this.ope[this.current-1];this.exec(a,a.old);if(a.property!=k.QSUB){this.anscount--}this.current--;if(!this.ope[this.current].chain){break}}this.postproc();this.undoExec=false;if(this.current==0){kc.inUNDO=false}},redo:function(){if(this.current==this.ope.length){return}this.redoExec=true;this.range={x1:k.qcols+1,y1:k.qrows+1,x2:-2,y2:-2};this.disableRecord();while(this.current<this.ope.length){var a=this.ope[this.current];this.exec(a,a.num);if(a.property!=k.QSUB){this.anscount++}this.current++;if(this.current<this.ope.length&&!this.ope[this.current].chain){break}}this.postproc();this.redoExec=false;if(this.ope.length==0){kc.inREDO=false}},postproc:function(){if(this.reqReset){this.reqReset=false;bd.setposAll();base.resetInfo(false);base.resize_canvas()}else{pc.paint(this.range.x1,this.range.y1,this.range.x2,this.range.y2)}this.enableRecord();this.enableInfo();this.enb_btn()},exec:function(c,b){var a=c.property;if(c.obj==k.CELL){if(a==k.QUES){bd.sQuC(c.id,b)}else{if(a==k.QNUM){bd.sQnC(c.id,b)}else{if(a==k.DIREC){bd.sDiC(c.id,b)}else{if(a==k.QANS){bd.sQaC(c.id,b)}else{if(a==k.QSUB){bd.sQsC(c.id,b)}else{if(a==k.CELL&&!!b){bd.cell[c.id]=b}}}}}}this.paintStack(bd.cell[c.id].cx,bd.cell[c.id].cy,bd.cell[c.id].cx,bd.cell[c.id].cy)}else{if(c.obj==k.EXCELL){if(a==k.QNUM){bd.sQnE(c.id,b)}else{if(a==k.DIREC){bd.sDiE(c.id,b)}else{if(a==k.EXCELL&&!!b){bd.excell[c.id]=b}}}}else{if(c.obj==k.CROSS){if(a==k.QUES){bd.sQuX(c.id,b)}else{if(a==k.QNUM){bd.sQnX(c.id,b)}else{if(a==k.CROSS&&!!b){bd.cross[c.id]=b}}}this.paintStack(bd.cross[c.id].cx-1,bd.cross[c.id].cy-1,bd.cross[c.id].cx,bd.cross[c.id].cy)}else{if(c.obj==k.BORDER){if(a==k.QUES){bd.sQuB(c.id,b)}else{if(a==k.QNUM){bd.sQnB(c.id,b)}else{if(a==k.QANS){bd.sQaB(c.id,b)}else{if(a==k.QSUB){bd.sQsB(c.id,b)}else{if(a==k.LINE){bd.sLiB(c.id,b)}else{if(a==k.BORDER&&!!b){bd.border[c.id]=b}}}}}}this.paintBorder(c.id)}else{if(c.obj==k.BOARD){this.disableInfo();if(a=="expandup"){if(b==1){menu.ex.expand(k.UP)}else{menu.ex.reduce(k.UP)}}else{if(a=="expanddn"){if(b==1){menu.ex.expand(k.DN)}else{menu.ex.reduce(k.DN)}}else{if(a=="expandlt"){if(b==1){menu.ex.expand(k.LT)}else{menu.ex.reduce(k.LT)}}else{if(a=="expandrt"){if(b==1){menu.ex.expand(k.RT)}else{menu.ex.reduce(k.RT)}}else{if(a=="reduceup"){if(b==1){menu.ex.reduce(k.UP)}else{menu.ex.expand(k.UP)}}else{if(a=="reducedn"){if(b==1){menu.ex.reduce(k.DN)}else{menu.ex.expand(k.DN)}}else{if(a=="reducelt"){if(b==1){menu.ex.reduce(k.LT)}else{menu.ex.expand(k.LT)}}else{if(a=="reducert"){if(b==1){menu.ex.reduce(k.RT)}else{menu.ex.expand(k.RT)}}else{if(a=="flipy"){menu.ex.turnflip(1,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1})}else{if(a=="flipx"){menu.ex.turnflip(2,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1})}else{if(a=="turnr"){menu.ex.turnflip((b==1?3:4),{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1})}else{if(a=="turnl"){menu.ex.turnflip((b==1?4:3),{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1})}}}}}}}}}}}}this.range={x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1};this.reqReset=true}}}}}},paintBorder:function(a){if(isNaN(a)||!bd.border[a]){return}if(bd.border[a].cx%2==1){this.paintStack((bd.border[a].cx>>1)-1,(bd.border[a].cy>>1)-1,(bd.border[a].cx>>1)+1,(bd.border[a].cy>>1))}else{this.paintStack((bd.border[a].cx>>1)-1,(bd.border[a].cy>>1)-1,(bd.border[a].cx>>1),(bd.border[a].cy>>1)+1)}},paintStack:function(b,d,a,c){if(this.range.x1>b){this.range.x1=b}if(this.range.y1>d){this.range.y1=d}if(this.range.x2<a){this.range.x2=a}if(this.range.y2<c){this.range.y2=c}}};Caption=function(){this.menu="";this.label=""};MenuData=function(b,a){this.caption={ja:b,en:a};this.smenus=[]};Menu=function(){this.dispfloat=[];this.floatpanel=[];this.pop="";this.movingpop="";this.offset=new Pos(0,0);this.btnstack=[];this.labelstack=[];this.ex=new MenuExec();this.ex.init();this.language="ja";this.ispencilbox=(k.isKanpenExist&&(k.puzzleid!=="nanro"&&k.puzzleid!=="ayeheya"&&k.puzzleid!=="kurochute"&&k.puzzleid!=="goishi"));var d={mouseover:ee.ebinder(this,this.menuhover),mouseout:ee.ebinder(this,this.menuout)};this.EL_MENU=ee.addTemplate("menupanel","div",{className:"menu"},{marginRight:"4pt"},d);var a={mouseout:ee.ebinder(this,this.floatmenuout)};this.EL_FLOAT=ee.addTemplate("float_parent","div",{className:"floatmenu"},{zIndex:101,backgroundColor:base.floatbgcolor},a);var c={mouseover:ee.ebinder(this,this.submenuhover),mouseout:ee.ebinder(this,this.submenuout),click:ee.ebinder(this,this.submenuclick)};var b={mouseover:ee.ebinder(this,this.submenuhover),mouseout:ee.ebinder(this,this.submenuout)};this.EL_SMENU=ee.addTemplate("","div",{className:"smenu"},null,c);this.EL_SPARENT=ee.addTemplate("","div",{className:"smenu"},null,b);this.EL_SELECT=ee.addTemplate("","div",{className:"smenu"},{fontWeight:"900",fontSize:"10pt"},b);this.EL_SEPARATE=ee.addTemplate("","div",{className:"smenusep",innerHTML:"&nbsp;"},null,null);this.EL_CHECK=ee.addTemplate("","div",{className:"smenu"},{paddingLeft:"6pt",fontSize:"10pt"},c);this.EL_LABEL=ee.addTemplate("","span",null,{color:"white"},null);this.EL_CHILD=this.EL_CHECK;this.EL_DIVPACK=ee.addTemplate("","div",null,null,null);this.EL_SPAN=ee.addTemplate("","span",{unselectable:"on"},null,null);this.EL_CHECKBOX=ee.addTemplate("","input",{type:"checkbox",check:""},null,{click:ee.ebinder(this,this.checkclick)});this.EL_SELCHILD=ee.addTemplate("","div",{className:"flag",unselectable:"on"},null,{click:ee.ebinder(this,this.selectclick)});this.EL_BUTTON=ee.addTemplate("","input",{type:"button"},null,null);this.EL_UBUTTON=ee.addTemplate("btnarea","input",{type:"button"},null,null)};Menu.prototype={menuinit:function(){this.menuarea();this.managearea();this.poparea();this.displayAll()},menureset:function(){this.dispfloat=[];this.floatpanel=[];this.pop="";this.btnstack=[];this.labelstack=[];this.managestack=[];this.popclose();this.menuclear();this.floatmenuclose(0);ee("float_parent").el.innerHTML="";if(!!ee("btncolor2")){ee("btncolor2").remove()}ee("btnarea").removeNextAll(ee("btnclear2").el);ee("urlbuttonarea").el.innerHTML="";ee("menupanel").el.innerHTML="";ee("usepanel").el.innerHTML="";ee("checkpanel").el.innerHTML="";pp.reset()},addButtons:function(b,c,d,a){if(!!c){b.onclick=c}ee(b).unselectable();this.btnstack.push({el:b,str:{ja:d,en:a}})},addLabels:function(b,c,a){this.labelstack.push({el:b,str:{ja:c,en:a}})},displayAll:function(){for(var b in pp.flags){this.setdisplay(b)}for(var b=0,a=this.btnstack.length;b<a;b++){if(!this.btnstack[b].el){continue}this.btnstack[b].el.value=this.btnstack[b].str[menu.language]}for(var b=0,a=this.labelstack.length;b<a;b++){if(!this.labelstack[b].el){continue}this.labelstack[b].el.innerHTML=this.labelstack[b].str[menu.language]}},setdisplay:function(j){switch(pp.type(j)){case pp.MENU:var c=ee("ms_"+j);if(!!c){c.el.innerHTML="["+pp.getMenuStr(j)+"]"}break;case pp.SMENU:case pp.LABEL:case pp.SPARENT:var d=ee("ms_"+j);if(!!d){d.el.innerHTML=pp.getMenuStr(j)}break;case pp.SELECT:var d=ee("ms_"+j),m=ee("cl_"+j);if(!!d){d.el.innerHTML="&nbsp;"+pp.getMenuStr(j)}if(!!m){m.el.innerHTML=pp.getLabel(j)}for(var f=0,h=pp.flags[j].child.length;f<h;f++){this.setdisplay(""+j+"_"+pp.flags[j].child[f])}break;case pp.CHILD:var d=ee("ms_"+j),e=ee("up_"+j);var a=(pp.getVal(j)==pp.getVal(pp.flags[j].parent));var o=pp.getMenuStr(j);if(!!d){d.el.innerHTML=(a?"+":"&nbsp;")+o}if(!!e){e.el.innerHTML=o;e.el.className=(a?"childsel":"child")}break;case pp.CHECK:var d=ee("ms_"+j),b=ee("ck_"+j),m=ee("cl_"+j);var l=pp.getVal(j);if(!!d){d.el.innerHTML=(l?"+":"&nbsp;")+pp.getMenuStr(j)}if(!!b){b.el.checked=l}if(!!m){m.el.innerHTML=pp.getLabel(j)}break}},menuarea:function(){var h=ee.binder(pp,pp.addMenu),c=ee.binder(pp,pp.addSParent),d=ee.binder(pp,pp.addSmenu),b=ee.binder(pp,pp.addSelect),l=ee.binder(pp,pp.addCheck),a=ee.binder(pp,pp.addCaption),i=ee.binder(pp,pp.addChild),f=ee.binder(pp,pp.addSeparator),j=ee.binder(pp,pp.addFlagOnly),e=ee.binder(pp,pp.setLabel);h("file","ƒtƒ@ƒCƒ‹","File");d("newboard","file","V‹Kì¬","New Board");d("urlinput","file","URL“ü—Í","Import from URL");d("urloutput","file","URLo—Í","Export URL");f("sep_file","file");d("fileopen","file","ƒtƒ@ƒCƒ‹‚ðŠJ‚­","Open the file");c("filesavep","file","ƒtƒ@ƒCƒ‹•Û‘¶ ->","Save the file as ... ->");if(fio.dbm.DBaccept>0){d("database","file","ˆêŽž•Û‘¶/–ß‚·","Temporary Stack")}d("filesave","filesavep","‚Ï‚¸‚Õ‚êv3Œ`Ž®","Puz-Pre v3 format");if(this.ispencilbox){d("filesave2","filesavep","pencilboxŒ`Ž®","Pencilbox format")}h("edit","•ÒW","Edit");d("adjust","edit","”Õ–Ê‚Ì’²®","Adjust the Board");d("turn","edit","”½“]E‰ñ“]","Filp/Turn the Board");h("disp","•\Ž¦","Display");b("size","disp",k.widthmode,[0,1,2,3,4],"•\Ž¦ƒTƒCƒY","Cell Size");f("sep_disp1","disp");if(!!k.irowake){l("irowake","disp",(k.irowake==2?true:false),"ü‚ÌF•ª‚¯","Color coding");e("irowake","ü‚ÌF•ª‚¯‚ð‚·‚é","Color each lines");f("sep_disp2","disp")}d("repaint","disp","”Õ–Ê‚ÌÄ•`‰æ","Repaint whole board");d("manarea","disp","ŠÇ——Ìˆæ‚ð‰B‚·","Hide Management Area");d("dispsize","size","ƒTƒCƒYŽw’è","Cell Size");a("cap_dispmode","size","•\Ž¦ƒ‚[ƒh","Display mode");i("size_0","size","ƒTƒCƒY ‹É¬","Ex Small");i("size_1","size","ƒTƒCƒY ¬","Small");i("size_2","size","ƒTƒCƒY •W€","Normal");i("size_3","size","ƒTƒCƒY ‘å","Large");i("size_4","size","ƒTƒCƒY “Á‘å","Ex Large");h("setting","Ý’è","Setting");if(k.EDITOR){b("mode","setting",(k.editmode?1:3),[1,3],"ƒ‚[ƒh","mode");e("mode","ƒ‚[ƒh","mode")}else{j("mode",3)}puz.menufix();l("autocheck","setting",k.autocheck,"³“šŽ©“®”»’è","Auto Answer Check");l("lrcheck","setting",false,"ƒ}ƒEƒX¶‰E”½“]","Mouse button inversion");e("lrcheck","ƒ}ƒEƒX‚Ì¶‰Eƒ{ƒ^ƒ“‚ð”½“]‚·‚é","Invert button of the mouse");if(kp.ctl[1].enable||kp.ctl[3].enable){l("keypopup","setting",kp.defaultdisp,"ƒpƒlƒ‹“ü—Í","Panel inputting");e("keypopup","”ŽšE‹L†‚ðƒpƒlƒ‹‚Å“ü—Í‚·‚é","Input numbers by panel")}b("language","setting",0,[0,1],"Œ¾Œê","Language");i("mode_1","mode","–â‘èì¬ƒ‚[ƒh","Edit mode");i("mode_3","mode","‰ñ“šƒ‚[ƒh","Answer mode");i("language_0","language","“ú–{Œê","“ú–{Œê");i("language_1","language","English","English");h("other","‚»‚Ì‘¼","Others");d("credit","other","‚Ï‚¸‚Õ‚êv3‚É‚Â‚¢‚Ä","About PUZ-PRE v3");f("sep_other","other");c("link","other","ƒŠƒ“ƒN","Link");d("jumpv3","link","‚Ï‚¸‚Õ‚êv3‚Ìƒy[ƒW‚Ö","Jump to PUZ-PRE v3 page");d("jumptop","link","˜A‘±”­”j•ÛŠÇŒÉTOP‚Ö","Jump to indi.s58.xrea.com");d("jumpblog","link","‚Í‚Á‚Ï“ú‹L(blog)‚Ö","Jump to my blog");this.createAllFloat()},addUseToFlags:function(){pp.addSelect("use","setting",1,[1,2],"‘€ì•û–@","Input Type");pp.setLabel("use","‘€ì•û–@","Input Type");pp.addChild("use_1","use","¶‰Eƒ{ƒ^ƒ“","LR Button");pp.addChild("use_2","use","1ƒ{ƒ^ƒ“","One Button")},addRedLineToFlags:function(){pp.addCheck("dispred","setting",false,"Œq‚ª‚èƒ`ƒFƒbƒN","Continuous Check");pp.setLabel("dispred","ü‚Ì‚Â‚È‚ª‚è‚ðƒ`ƒFƒbƒN‚·‚é","Check countinuous lines")},addRedBlockToFlags:function(){pp.addCheck("dispred","setting",false,"Œq‚ª‚èƒ`ƒFƒbƒN","Continuous Check");pp.setLabel("dispred","•ƒ}ƒX‚Ì‚Â‚È‚ª‚è‚ðƒ`ƒFƒbƒN‚·‚é","Check countinuous black cells")},addRedBlockRBToFlags:function(){pp.addCheck("dispred","setting",false,"Œq‚ª‚èƒ`ƒFƒbƒN","Continuous Check");pp.setLabel("dispred","ƒiƒiƒ•ƒ}ƒX‚Ì‚Â‚È‚ª‚è‚ðƒ`ƒFƒbƒN‚·‚é","Check countinuous black cells with its corner")},createAllFloat:function(){for(var j=0;j<pp.flaglist.length;j++){var b=pp.flaglist[j];if(!pp.flags[b]){continue}var a="ms_"+b;switch(pp.type(b)){case pp.MENU:smenu=ee.createEL(this.EL_MENU,a);continue;break;case pp.SEPARATE:smenu=ee.createEL(this.EL_SEPARATE,a);break;case pp.LABEL:smenu=ee.createEL(this.EL_LABEL,a);break;case pp.SELECT:smenu=ee.createEL(this.EL_SELECT,a);break;case pp.SMENU:smenu=ee.createEL(this.EL_SMENU,a);break;case pp.CHECK:smenu=ee.createEL(this.EL_CHECK,a);break;case pp.CHILD:smenu=ee.createEL(this.EL_CHILD,a);break;case pp.SPARENT:var d=(pp.getMenuStr(b).indexOf("->")>=0);smenu=ee.createEL((d?this.EL_SPARENT:this.EL_SELECT),a);break;default:continue;break}var f=pp.flags[b].parent;if(!this.floatpanel[f]){this.floatpanel[f]=ee.createEL(this.EL_FLOAT,"float_"+f)}this.floatpanel[f].appendChild(smenu)}var c=ee("float_setting").el,h=c.firstChild.style.fontWeight;for(var j=1,l=c.childNodes.length;j<l;j++){var e=c.childNodes[j];if(h!=e.style.fontWeight){ee(ee.createEL(this.EL_SEPARATE,"")).insertBefore(e);j++;l++}h=e.style.fontWeight}if(k.PLAYER){ee("ms_newboard").el.className="smenunull";ee("ms_urloutput").el.className="smenunull";ee("ms_adjust").el.className="smenunull"}ee("ms_jumpv3").el.style.fontSize="10pt";ee("ms_jumpv3").el.style.paddingLeft="8pt";ee("ms_jumptop").el.style.fontSize="10pt";ee("ms_jumptop").el.style.paddingLeft="8pt";ee("ms_jumpblog").el.style.fontSize="10pt";ee("ms_jumpblog").el.style.paddingLeft="8pt"},menuhover:function(b){if(!!this.movingpop){return true}var a=ee.getSrcElement(b).id.substr(3);this.floatmenuopen(b,a,0);ee("menupanel").replaceChildrenClass("menusel","menu");ee.getSrcElement(b).className="menusel"},menuout:function(a){if(!this.insideOfMenu(a)){this.menuclear();this.floatmenuclose(0)}},menuclear:function(){ee("menupanel").replaceChildrenClass("menusel","menu")},submenuhover:function(b){var a=ee.getSrcElement(b).id.substr(3);if(ee.getSrcElement(b).className==="smenu"){ee.getSrcElement(b).className="smenusel"}if(pp.flags[a]&&(pp.type(a)===pp.SELECT||pp.type(a)===pp.SPARENT)){this.floatmenuopen(b,a,this.dispfloat.length)}},submenuout:function(b){var a=ee.getSrcElement(b).id.substr(3);if(ee.getSrcElement(b).className==="smenusel"){ee.getSrcElement(b).className="smenu"}if(pp.flags[a]&&(pp.type(a)===pp.SELECT||pp.type(a)===pp.SPARENT)){this.floatmenuout(b)}},submenuclick:function(b){var a=ee.getSrcElement(b).id.substr(3);if(ee.getSrcElement(b).className==="smenunull"){return}this.menuclear();this.floatmenuclose(0);switch(pp.type(a)){case pp.SMENU:this.popopen(b,a);break;case pp.CHILD:pp.setVal(pp.flags[a].parent,pp.getVal(a));break;case pp.CHECK:pp.setVal(a,!pp.getVal(a));break}},floatmenuopen:function(d,b,f){if(f===0){this.menuclear()}this.floatmenuclose(f);if(f>0&&!this.dispfloat[f-1]){return}var c=ee(ee.getSrcElement(d).id).getRect();var a=this.floatpanel[b];if(f==0){a.style.left=c.left-3+k.IEMargin.x;a.style.top=c.bottom+(k.br.IE?-2:1)}else{a.style.left=c.right-2;a.style.top=c.top+(k.br.IE?-5:-2)}a.style.zIndex=101+f;a.style.display="inline";this.dispfloat.push(a)},floatmenuclose:function(c){for(var b=this.dispfloat.length-1;b>=c;b--){if(b!==0){var a="ms_"+this.dispfloat[b].id.substr(6);ee(a).el.className="smenu"}this.dispfloat[b].style.display="none";this.dispfloat.pop()}},floatmenuout:function(b){for(var a=this.dispfloat.length-1;a>=0;a--){if(this.insideOf(this.dispfloat[a],b)){this.floatmenuclose(a+1);return}}this.menuclear();this.floatmenuclose(0)},insideOf:function(c,f){var b=ee.pageX(f);var a=ee.pageY(f);var d=ee(c.id).getRect();return(b>=d.left&&b<=d.right&&a>=d.top&&a<=d.bottom)},insideOfMenu:function(d){var b=ee.pageX(d);var a=ee.pageY(d);var c=ee("ms_file").getRect(),f=ee("ms_other").getRect();return(b>=c.left&&b<=f.right&&a>=c.top)},managearea:function(){for(var f=0;f<pp.flaglist.length;f++){var e=pp.flaglist[f];if(!pp.flags[e]||!pp.getLabel(e)){continue}var a=ee(ee.createEL(this.EL_DIVPACK,"div_"+e));switch(pp.type(e)){case pp.SELECT:a.appendEL(ee.createEL(this.EL_SPAN,"cl_"+e));a.appendHTML("&nbsp;|&nbsp;");for(var c=0;c<pp.flags[e].child.length;c++){var b=pp.flags[e].child[c];a.appendEL(ee.createEL(this.EL_SELCHILD,["up",e,b].join("_")));a.appendHTML("&nbsp;")}a.appendBR();ee("usepanel").appendEL(a.el);break;case pp.CHECK:a.appendEL(ee.createEL(this.EL_CHECKBOX,"ck_"+e));a.appendHTML("&nbsp;");a.appendEL(ee.createEL(this.EL_SPAN,"cl_"+e));a.appendBR();ee("checkpanel").appendEL(a.el);break}}if(k.irowake){var d=ee.createEL(this.EL_BUTTON,"ck_btn_irowake");this.addButtons(d,ee.binder(menu.ex,menu.ex.irowakeRemake),"F•ª‚¯‚µ‚È‚¨‚·","Change the color of Line");ee("ck_btn_irowake").insertAfter(ee("cl_irowake").el);var d=ee("checkpanel").el.removeChild(ee("div_irowake").el);ee("checkpanel").el.appendChild(d)}ee("translation").unselectable().el.onclick=ee.binder(this,this.translate);this.addLabels(ee("translation").el,"English","“ú–{Œê");ee("expression").el.innerHTML=base.expression.ja;if(k.EDITOR){ee("timerpanel").el.style.display="none";ee("separator2").el.style.display="none"}if(!!ee("ck_keypopup")){pp.funcs.keypopup()}ee.createEL(this.EL_UBUTTON,"btncheck");ee("btnarea").appendHTML("&nbsp;");ee.createEL(this.EL_UBUTTON,"btnundo");ee.createEL(this.EL_UBUTTON,"btnredo");ee("btnarea").appendHTML("&nbsp;");ee.createEL(this.EL_UBUTTON,"btnclear");ee.createEL(this.EL_UBUTTON,"btnclear2");this.addButtons(ee("btncheck").el,ee.binder(ans,ans.check),"ƒ`ƒFƒbƒN","Check");this.addButtons(ee("btnundo").el,ee.binder(um,um.undo),"–ß","<-");this.addButtons(ee("btnredo").el,ee.binder(um,um.redo),"i","->");this.addButtons(ee("btnclear").el,ee.binder(menu.ex,menu.ex.ACconfirm),"‰ñ“šÁ‹Ž","Erase Answer");this.addButtons(ee("btnclear2").el,ee.binder(menu.ex,menu.ex.ASconfirm),"•â•Á‹Ž","Erase Auxiliary Marks");if(k.irowake!=0){var d=ee.createEL(this.EL_BUTTON,"btncolor2");this.addButtons(d,ee.binder(menu.ex,menu.ex.irowakeRemake),"F•ª‚¯‚µ‚È‚¨‚·","Change the color of Line");ee("btncolor2").insertAfter(ee("btnclear2").el).el.style.display="none"}},checkclick:function(c){var b=ee.getSrcElement(c);var a=b.id.substr(3);pp.setVal(a,b.checked)},selectclick:function(b){var a=ee.getSrcElement(b).id.split("_");pp.setVal(a[1],a[2])},poparea:function(){var pop=ee("popup_parent").el.firstChild;while(!!pop){var _el=pop.firstChild;while(!!_el){if(_el.className==="titlebar"){this.titlebarfunc(_el);break}_el=_el.nextSibling}pop=pop.nextSibling}this.titlebarfunc(ee("credit3_1").el);document.onmousemove=ee.ebinder(this,this.titlebarmove);document.onmouseup=ee.ebinder(this,this.titlebarup);var btn=ee.binder(this,this.addButtons);var lab=ee.binder(this,this.addLabels);var close=ee.ebinder(this,this.popclose);var func=null;func=ee.ebinder(this.ex,this.ex.newboard);lab(ee("bar1_1").el,"”Õ–Ê‚ÌV‹Kì¬","Createing New Board");lab(ee("pop1_1_cap0").el,"”Õ–Ê‚ðV‹Kì¬‚µ‚Ü‚·B","Create New Board.");if(k.puzzleid!=="sudoku"&&k.puzzleid!=="tawa"){lab(ee("pop1_1_cap1").el,"‚æ‚±","Cols");lab(ee("pop1_1_cap2").el,"‚½‚Ä","Rows")}btn(document.newboard.newboard,func,"V‹Kì¬","Create");btn(document.newboard.cancel,close,"ƒLƒƒƒ“ƒZƒ‹","Cancel");func=ee.ebinder(this.ex,this.ex.urlinput);lab(ee("bar1_2").el,"URL“ü—Í","Import from URL");lab(ee("pop1_2_cap0").el,"URL‚©‚ç–â‘è‚ð“Ç‚Ýž‚Ý‚Ü‚·B","Import a question from URL.");btn(document.urlinput.urlinput,func,"“Ç‚Ýž‚Þ","Import");btn(document.urlinput.cancel,close,"ƒLƒƒƒ“ƒZƒ‹","Cancel");func=ee.ebinder(this.ex,this.ex.urloutput);lab(ee("bar1_3").el,"URLo—Í","Export URL");var btt=function(name,strJP,strEN,eval){if(eval===false){return}var el=ee.createEL(menu.EL_BUTTON,"");el.name=name;ee("urlbuttonarea").appendEL(el).appendBR();btn(el,func,strJP,strEN)};btt("pzprv3","‚Ï‚¸‚Õ‚êv3‚ÌURL‚ðo—Í‚·‚é","Output PUZ-PRE v3 URL",true);btt("pzprapplet","‚Ï‚¸‚Õ‚ê(ƒAƒvƒŒƒbƒg)‚ÌURL‚ðo—Í‚·‚é","Output PUZ-PRE(JavaApplet) URL",!k.ispzprv3ONLY);btt("kanpen","ƒJƒ“ƒyƒ“‚ÌURL‚ðo—Í‚·‚é","Output Kanpen URL",!!k.isKanpenExist);btt("heyaapp","‚Ö‚â‚í‚¯ƒAƒvƒŒƒbƒg‚ÌURL‚ðo—Í‚·‚é","Output Heyawake-Applet URL",(k.puzzleid==="heyawake"));btt("pzprv3edit","‚Ï‚¸‚Õ‚êv3‚ÌÄ•ÒW—pURL‚ðo—Í‚·‚é","Output PUZ-PRE v3 Re-Edit URL",true);ee("urlbuttonarea").appendBR();func=ee.ebinder(this.ex,this.ex.openurl);btn(document.urloutput.openurl,func,"‚±‚ÌURL‚ðŠJ‚­","Open this URL on another window/tab");btn(document.urloutput.close,close,"•Â‚¶‚é","Close");func=ee.ebinder(this.ex,this.ex.fileopen);lab(ee("bar1_4").el,"ƒtƒ@ƒCƒ‹‚ðŠJ‚­","Open file");lab(ee("pop1_4_cap0").el,"ƒtƒ@ƒCƒ‹‘I‘ð","Choose file");document.fileform.filebox.onchange=func;btn(document.fileform.close,close,"•Â‚¶‚é","Close");func=ee.ebinder(fio.dbm,fio.dbm.clickHandler);lab(ee("bar1_8").el,"ˆêŽž•Û‘¶/–ß‚·","Temporary Stack");document.database.sorts.onchange=func;document.database.datalist.onchange=func;document.database.tableup.onclick=func;document.database.tabledn.onclick=func;btn(document.database.open,func,"ƒf[ƒ^‚ð“Ç‚Ýž‚Þ","Load");btn(document.database.save,func,"”Õ–Ê‚ð•Û‘¶","Save");lab(ee("pop1_8_com").el,"ƒRƒƒ“ƒg:","Comment:");btn(document.database.comedit,func,"ƒRƒƒ“ƒg‚ð•ÒW‚·‚é","Edit Comment");btn(document.database.difedit,func,"“ïˆÕ“x‚ðÝ’è‚·‚é","Set difficulty");btn(document.database.del,func,"íœ","Delete");btn(document.database.close,close,"•Â‚¶‚é","Close");func=ee.ebinder(this.ex,this.ex.popupadjust);lab(ee("bar2_1").el,"”Õ–Ê‚Ì’²®","Adjust the board");lab(ee("pop2_1_cap0").el,"”Õ–Ê‚Ì’²®‚ðs‚¢‚Ü‚·B","Adjust the board.");lab(ee("pop2_1_cap1").el,"Šg‘å","Expand");btn(document.adjust.expandup,func,"ã","UP");btn(document.adjust.expanddn,func,"‰º","Down");btn(document.adjust.expandlt,func,"¶","Left");btn(document.adjust.expandrt,func,"‰E","Right");lab(ee("pop2_1_cap2").el,"k¬","Reduce");btn(document.adjust.reduceup,func,"ã","UP");btn(document.adjust.reducedn,func,"‰º","Down");btn(document.adjust.reducelt,func,"¶","Left");btn(document.adjust.reducert,func,"‰E","Right");btn(document.adjust.close,close,"•Â‚¶‚é","Close");lab(ee("bar2_2").el,"”½“]E‰ñ“]","Flip/Turn the board");lab(ee("pop2_2_cap0").el,"”Õ–Ê‚Ì‰ñ“]E”½“]‚ðs‚¢‚Ü‚·B","Flip/Turn the board.");btn(document.flip.turnl,func,"¶90‹‰ñ“]","Turn left by 90 degree");btn(document.flip.turnr,func,"‰E90‹‰ñ“]","Turn right by 90 degree");btn(document.flip.flipy,func,"ã‰º”½“]","Flip upside down");btn(document.flip.flipx,func,"¶‰E”½“]","Flip leftside right");btn(document.flip.close,close,"•Â‚¶‚é","Close");lab(ee("bar3_1").el,"credit","credit");lab(ee("credit3_1").el,"‚Ï‚¸‚Õ‚êv3 "+pzprversion+"<br>\n<br>\n‚Ï‚¸‚Õ‚êv3‚Í ‚Í‚Á‚Ï/˜A‘±”­”j‚ªì¬‚µ‚Ä‚¢‚Ü‚·B<br>\nƒ‰ƒCƒuƒ‰ƒŠ‚Æ‚µ‚ÄuuCanvas1.0, Google Gears‚ðŽg—p‚µ‚Ä‚¢‚Ü‚·B<br>\n<br>\n","PUZ-PRE v3 "+pzprversion+"<br>\n<br>\nPUZ-PRE v3 id made by happa.<br>\nThis script use uuCanvas1.0 and Google Gears as libraries.&nbsp;<br>\n<br>\n");btn(document.credit.close,close,"•Â‚¶‚é","OK");func=ee.ebinder(this,this.ex.dispsize);lab(ee("bar4_1").el,"•\Ž¦ƒTƒCƒY‚Ì•ÏX","Change size");lab(ee("pop4_1_cap0").el,"•\Ž¦ƒTƒCƒY‚ð•ÏX‚µ‚Ü‚·B","Change the display size.");lab(ee("pop4_1_cap1").el,"•\Ž¦ƒTƒCƒY","Display size");btn(document.dispsize.dispsize,func,"•ÏX‚·‚é","Change");btn(document.dispsize.cancel,close,"ƒLƒƒƒ“ƒZƒ‹","Cancel");debug.poptest_func()},popopen:function(c,b){this.popclose();if(pp.funcs[b]){pp.funcs[b]()}if(this.pop){var a=this.pop.el;a.style.left=ee.pageX(c)-8+k.IEMargin.x;a.style.top=ee.pageY(c)-8+k.IEMargin.y;a.style.display="inline"}},popclose:function(){if(this.pop){if(this.pop.el.id=="pop1_8"){fio.dbm.closeDialog()}this.pop.el.style.display="none";this.pop="";this.menuclear();this.movingpop="";k.enableKey=true}},titlebarfunc:function(a){a.onmousedown=ee.ebinder(this,this.titlebardown);ee(a).unselectable().el},titlebardown:function(b){var a=ee.getSrcElement(b).parentNode;this.movingpop=a;this.offset.x=ee.pageX(b)-parseInt(a.style.left);this.offset.y=ee.pageY(b)-parseInt(a.style.top)},titlebarup:function(b){var a=this.movingpop;if(!!a){this.movingpop=""}},titlebarmove:function(b){var a=this.movingpop;if(!!a){a.style.left=ee.pageX(b)-this.offset.x;a.style.top=ee.pageY(b)-this.offset.y}},isLangJP:function(){return this.language=="ja"},isLangEN:function(){return this.language=="en"},setLang:function(a){(a=="ja")?this.setLangJP():this.setLangEN()},translate:function(){(this.isLangJP())?this.setLangEN():this.setLangJP()},setLangJP:function(){this.setLangStr("ja")},setLangEN:function(){this.setLangStr("en")},setLangStr:function(a){this.language=a;document.title=base.gettitle();ee("title2").el.innerHTML=base.gettitle();ee("expression").el.innerHTML=base.expression[this.language];this.displayAll();this.ex.dispmanstr();base.resize_canvas()}};SSData=function(){this.id="";this.type=0;this.val=1;this.parent=1;this.child=[];this.str={ja:new Caption(),en:new Caption()}};Properties=function(){this.flags=[];this.flaglist=[];this.MENU=6;this.SPARENT=7;this.SMENU=0;this.SELECT=1;this.CHECK=2;this.LABEL=3;this.CHILD=4;this.SEPARATE=5};Properties.prototype={reset:function(){this.flags=[];this.flaglist=[]},addMenu:function(b,c,a){this.addFlags(b,"",this.MENU,0,c,a)},addSParent:function(c,b,d,a){this.addFlags(c,b,this.SPARENT,0,d,a)},addSmenu:function(c,b,d,a){this.addFlags(c,b,this.SMENU,0,d,a)},addCaption:function(c,b,d,a){this.addFlags(c,b,this.LABEL,0,d,a)},addSeparator:function(b,a){this.addFlags(b,a,this.SEPARATE,0,"","")},addCheck:function(c,b,e,d,a){this.addFlags(c,b,this.CHECK,e,d,a)},addSelect:function(c,b,e,f,d,a){this.addFlags(c,b,this.SELECT,e,d,a);this.flags[c].child=f},addChild:function(c,b,e,a){var d=c.split("_");this.addFlags(c,d[0],this.CHILD,d[1],e,a)},addFlagOnly:function(a,b){this.addFlags(a,"","",b,"","")},addFlags:function(d,c,b,f,e,a){this.flags[d]=new SSData();this.flags[d].id=d;this.flags[d].type=b;this.flags[d].val=f;this.flags[d].parent=c;this.flags[d].str.ja.menu=e;this.flags[d].str.en.menu=a;this.flaglist.push(d)},setLabel:function(b,c,a){if(!this.flags[b]){return}this.flags[b].str.ja.label=c;this.flags[b].str.en.label=a},getMenuStr:function(a){return this.flags[a].str[menu.language].menu},getLabel:function(a){return this.flags[a].str[menu.language].label},type:function(a){return this.flags[a].type},istype:function(b,a){return(this.flags[b].type===a)},getVal:function(a){return this.flags[a]?this.flags[a].val:0},setVal:function(a,b){if(!this.flags[a]){return}else{if(this.flags[a].type===this.CHECK||this.flags[a].type===this.SELECT){this.flags[a].val=b;menu.setdisplay(a);if(this.funcs[a]){this.funcs[a](b)}}}},funcs:{urlinput:function(){menu.pop=ee("pop1_2")},urloutput:function(){menu.pop=ee("pop1_3");document.urloutput.ta.value=""},fileopen:function(){menu.pop=ee("pop1_4")},filesave:function(){menu.ex.filesave(1)},filesave2:function(){if(fio.kanpenSave){menu.ex.filesave(fio.PBOX)}},database:function(){menu.pop=ee("pop1_8");fio.dbm.openDialog()},adjust:function(){menu.pop=ee("pop2_1")},turn:function(){menu.pop=ee("pop2_2")},credit:function(){menu.pop=ee("pop3_1")},jumpv3:function(){window.open("./","","")},jumptop:function(){window.open("../../","","")},jumpblog:function(){window.open("http://d.hatena.ne.jp/sunanekoroom/","","")},irowake:function(){pc.paintAll()},manarea:function(){menu.ex.dispman()},autocheck:function(a){k.autocheck=!k.autocheck},mode:function(a){menu.ex.modechange(a)},size:function(a){k.widthmode=a;base.resize_canvas()},repaint:function(a){base.resize_canvas()},use:function(a){k.use=a},language:function(a){menu.setLang({0:"ja",1:"en"}[a])},newboard:function(){menu.pop=ee("pop1_1");if(k.puzzleid!="sudoku"){document.newboard.col.value=k.qcols;document.newboard.row.value=k.qrows}k.enableKey=false},dispsize:function(){menu.pop=ee("pop4_1");document.dispsize.cs.value=k.def_csize;k.enableKey=false},keypopup:function(){var a=kp.ctl[pp.flags.mode.val].enable;ee("ck_keypopup").el.disabled=(a?"":"true");ee("cl_keypopup").el.style.color=(a?"black":"silver")}}};var debug={extend:function(a){for(var b in a){this[b]=a[b]}},poptest_func:function(){menu.titlebarfunc(ee("bartest").el);document.testform.t1.onclick=ee.binder(this,this.perfeval);document.testform.t2.onclick=ee.binder(this,this.painteval);document.testform.t3.onclick=ee.binder(this,this.resizeeval);document.testform.perfload.onclick=ee.binder(this,this.loadperf);document.testform.filesave.onclick=ee.binder(this,this.filesave);document.testform.pbfilesave.onclick=ee.binder(this,this.filesave_pencilbox);document.testform.fileopen.onclick=ee.binder(this,this.fileopen);document.testform.database.onclick=ee.binder(this,this.dispdatabase);document.testform.erasetext.onclick=ee.binder(this,this.erasetext);document.testform.close.onclick=function(a){ee("poptest").el.style.display="none"};document.testform.testarea.style.fontSize="10pt";document.testform.starttest.style.display="none";document.testform.perfload.style.display=(k.puzzleid!=="country"?"none":"inline");document.testform.pbfilesave.style.display=(!menu.ispencilbox?"none":"inline");document.testform.database.style.display=(!fio.DBaccept<8?"none":"inline");if(k.scriptcheck){debug.testonly_func()}},disppoptest:function(){var a=ee("poptest").el.style;a.display="inline";a.left="40px";a.top="80px"},keydown:function(a){if(kc.isCTRL&&a=="F8"){this.disppoptest();kc.tcMoved=true;return true}return false},filesave:function(){this.setTA(fio.fileencode(fio.PZPR).replace(/\//g,"\n"));this.addTA("");this.addTA(fio.urlstr)},filesave_pencilbox:function(){this.setTA(fio.fileencode(fio.PBOX).replace(/\//g,"\n"))},fileopen:function(){var a=this.getTA().split("\n");fio.filedecode(a.join("/"))},erasetext:function(){this.setTA("");if(k.scriptcheck){ee("testdiv").el.innerHTML=""}},perfeval:function(){this.timeeval("³“š”»’è‘ª’è",ee.binder(ans,ans.checkAns))},painteval:function(){this.timeeval("•`‰æŽžŠÔ‘ª’è",ee.binder(pc,pc.paintAll))},resizeeval:function(){this.timeeval("resize•`‰æ‘ª’è",ee.binder(base,base.resize_canvas))},timeeval:function(e,c){this.addTA(e);var b=0,a=(new Date()).getTime();while((new Date()).getTime()-a<3000){b++;c()}var d=(new Date()).getTime()-a;this.addTA("‘ª’èƒf[ƒ^ "+d+"ms / "+b+"‰ñ\n•½‹ÏŽžŠÔ   "+(d/b)+"ms")},dispdatabase:function(){var c="";for(var b=0;b<localStorage.length;b++){var a=localStorage.key(b);c+=(""+a+" "+localStorage[a]+"\n")}this.setTA(c)},loadperf:function(){fio.filedecode("pzprv3/country/10/18/44/0 0 1 1 1 2 2 2 3 4 4 4 5 5 6 6 7 8 /0 9 1 10 10 10 11 2 3 4 12 4 4 5 6 13 13 8 /0 9 1 1 10 10 11 2 3 12 12 12 4 5 14 13 13 15 /0 9 9 9 10 16 16 16 16 17 12 18 4 5 14 13 15 15 /19 19 19 20 20 20 21 17 17 17 22 18 18 14 14 23 23 24 /19 25 25 26 26 21 21 17 22 22 22 18 27 27 27 24 24 24 /28 28 29 26 30 31 21 32 22 33 33 33 33 34 35 35 35 36 /28 29 29 26 30 31 32 32 32 37 38 39 34 34 40 40 35 36 /41 29 29 42 30 31 31 32 31 37 38 39 34 34 34 40 35 36 /41 43 42 42 30 30 31 31 31 37 38 38 38 40 40 40 36 36 /3 . 6 . . 4 . . 2 . . . . . . . . 1 /. . . 5 . . . . . . . . . . . . . . /. . . . . . . . . 1 . . . . . . . . /. . . . . . . . . . . . . . . . . . /3 . . 2 . . . 4 . . . . . . . . . . /. . . 3 . . . . 4 . . . 2 . . . . . /. . . . 3 6 . . . 4 . . . . . . . . /. 5 . . . . . . . 2 . . 3 . . . . . /. . . . . . . . . . . . . . . . . . /. . . . . . . . . . . . . . . . 5 . /0 0 1 1 0 0 1 0 0 1 1 0 0 0 1 1 0 /1 0 0 0 1 0 0 0 1 0 0 1 0 0 0 0 1 /0 0 1 0 1 0 0 1 0 0 0 0 0 0 0 0 0 /0 1 1 0 0 0 1 0 0 1 1 0 1 0 0 0 1 /1 1 0 0 1 0 0 1 1 0 0 0 0 1 0 1 0 /0 1 0 1 0 1 0 0 1 1 1 0 1 0 0 1 1 /1 0 1 0 0 0 0 1 0 1 1 1 0 0 1 1 0 /0 1 0 0 0 0 1 0 0 0 0 1 1 0 1 0 0 /0 1 1 0 1 1 0 0 1 0 1 0 0 0 0 0 0 /1 1 1 0 0 0 1 1 0 0 1 1 1 1 1 0 1 /0 0 1 0 1 0 1 1 0 1 0 1 0 0 1 0 1 0 /1 1 1 0 0 1 1 1 1 0 0 0 1 0 1 0 0 1 /1 1 0 1 1 0 1 0 0 0 0 0 1 0 1 0 0 1 /1 0 0 0 1 0 0 1 0 1 0 1 0 1 1 0 1 0 /0 0 1 0 0 1 0 0 0 0 0 1 0 0 0 1 0 0 /0 1 0 1 1 0 1 0 1 0 0 0 1 1 0 0 0 1 /1 0 1 0 1 0 1 1 0 1 0 0 0 1 1 0 1 1 /1 1 0 0 1 0 0 0 0 1 0 1 0 0 0 1 1 1 /1 0 0 1 0 0 1 0 1 0 1 0 0 0 0 1 1 1 /2 2 1 1 1 2 0 0 2 0 1 0 0 0 0 0 0 2 /1 1 1 2 1 1 0 0 0 1 2 1 0 0 1 2 0 0 /1 0 1 1 1 1 0 0 1 2 2 2 1 0 1 2 2 0 /1 0 0 1 1 2 1 0 2 1 1 1 1 0 1 2 1 0 /1 1 0 2 1 1 2 0 0 0 2 1 2 1 1 1 0 2 /2 1 0 1 1 1 0 2 0 0 0 0 1 1 2 1 0 0 /1 0 1 1 1 2 1 1 0 0 0 0 0 0 1 0 0 0 /0 1 1 2 1 2 1 1 2 1 2 0 1 0 1 0 0 0 /0 1 1 0 1 1 1 2 0 1 0 1 2 2 2 1 0 0 /0 0 0 1 2 2 1 1 0 2 0 0 1 0 1 0 0 0 /");pp.setVal("mode",3);pp.setVal("irowake",true)},getTA:function(){return document.testform.testarea.value},setTA:function(a){document.testform.testarea.value=a},addTA:function(a){document.testform.testarea.value+=(a+"\n")}};MenuExec=function(){this.displaymanage=true;this.qnumw;this.qnumh;this.qnums;this.reader;this.enableReadText=false};MenuExec.prototype={init:function(){if(typeof FileReader=="undefined"){this.reader=null;if(typeof FileList!="undefined"&&typeof File.prototype.getAsText!="undefined"){this.enableGetText=true}}else{this.reader=new FileReader();this.reader.onload=ee.ebinder(this,function(a){this.fileonload(ee.getSrcElement(a).result)})}},modechange:function(a){k.editmode=(a==1);k.playmode=(a==3);kc.prev=-1;ans.errDisp=true;bd.errclear();if(kp.ctl[1].enable||kp.ctl[3].enable){pp.funcs.keypopup()}tc.setAlign();pc.paintAll()},newboard:function(b){if(menu.pop){var a,c;if(k.puzzleid!=="sudoku"){a=mf(parseInt(document.newboard.col.value));c=mf(parseInt(document.newboard.row.value))}else{if(document.newboard.size[0].checked){a=c=9}else{if(document.newboard.size[1].checked){a=c=16}else{if(document.newboard.size[2].checked){a=c=25}else{if(document.newboard.size[3].checked){a=c=4}}}}}if(a>0&&c>0){bd.initBoardSize(a,c)}menu.popclose();base.resetInfo(true);base.resize_canvas()}},urlinput:function(a){if(menu.pop){enc.parseURI(document.urlinput.ta.value);enc.pzlinput();tm.reset();menu.popclose()}},urloutput:function(a){if(menu.pop){switch(ee.getSrcElement(a).name){case"pzprv3":document.urloutput.ta.value=enc.pzloutput(enc.PZPRV3);break;case"pzprapplet":document.urloutput.ta.value=enc.pzloutput(enc.PAPRAPP);break;case"kanpen":document.urloutput.ta.value=enc.pzloutput(enc.KANPEN);break;case"pzprv3edit":document.urloutput.ta.value=enc.pzloutput(enc.PZPRV3E);break;case"heyaapp":document.urloutput.ta.value=enc.pzloutput(enc.HEYAAPP);break}}},openurl:function(b){if(menu.pop){if(document.urloutput.ta.value!==""){var a=window.open(document.urloutput.ta.value,"","")}}},fileopen:function(c){if(menu.pop){menu.popclose()}var b=document.fileform.filebox;if(!!this.reader||this.enableGetText){var a=b.files[0];if(!a){return}if(!!this.reader){this.reader.readAsText(a)}else{this.fileonload(a.getAsText(""))}}else{if(!b.value){return}document.fileform.submit()}document.fileform.reset();tm.reset()},fileonload:function(c){var d=c.split(/[\t\r\n]+/);var a="";for(var b=0;b<d.length;b++){if(d[b].match(/^http\:\/\//)){break}a+=(d[b]+"/")}fio.filedecode(a);document.fileform.reset();tm.reset()},filesave:function(a){var d=prompt("•Û‘¶‚·‚éƒtƒ@ƒCƒ‹–¼‚ð“ü—Í‚µ‚Ä‰º‚³‚¢B",k.puzzleid+".txt");if(!d){return}var c=["\\","/",":","*","?",'"',"<",">","|"];for(var b=0;b<c.length;b++){if(d.indexOf(c[b])!=-1){alert("ƒtƒ@ƒCƒ‹–¼‚Æ‚µ‚ÄŽg—p‚Å‚«‚È‚¢•¶Žš‚ªŠÜ‚Ü‚ê‚Ä‚¢‚Ü‚·B");return}}document.fileform2.filename.value=d;if(navigator.platform.indexOf("Win")!==-1){document.fileform2.platform.value="Win"}else{if(navigator.platform.indexOf("Mac")!==-1){document.fileform2.platform.value="Mac"}else{document.fileform2.platform.value="Others"}}document.fileform2.ques.value=fio.fileencode(a);document.fileform2.urlstr.value=fio.urlstr;document.fileform2.submit()},dispsize:function(b){if(menu.pop){var a=parseInt(document.dispsize.cs.value);if(a>0){k.def_psize=mf(a*(k.def_psize/k.def_csize));if(k.def_psize===0){k.def_psize=1}k.def_csize=mf(a)}menu.popclose();base.resize_canvas()}},irowakeRemake:function(){if(!pp.getVal("irowake")){return}for(var b=1;b<=line.data.max;b++){var c=line.data[b].idlist;if(c.length>0){var a=pc.getNewLineColor();for(n=0;n<c.length;n++){bd.border[c[n]].color=a}}}pc.paint(0,0,k.qcols-1,k.qrows-1)},dispman:function(c){var d=["expression","usepanel","checkpanel"];var a=k.EDITOR?["separator1"]:["separator1","separator2"];if(this.displaymanage){for(var b=0;b<d.length;b++){ee(d[b]).el.style.display="none"}for(var b=0;b<a.length;b++){ee(a[b]).el.style.display="none"}if(k.irowake!=0&&pp.getVal("irowake")){ee("btncolor2").el.style.display="inline"}ee("menuboard").el.style.paddingBottom="0pt"}else{for(var b=0;b<d.length;b++){ee(d[b]).el.style.display="block"}for(var b=0;b<a.length;b++){ee(a[b]).el.style.display="block"}if(k.irowake!=0&&pp.getVal("irowake")){ee("btncolor2").el.style.display="none"}ee("menuboard").el.style.paddingBottom="8pt"}this.displaymanage=!this.displaymanage;this.dispmanstr();base.resize_canvas_only();bd.setposAll();if(g.vml){pc.flushCanvasAll()}pc.paintAll()},dispmanstr:function(){if(!this.displaymanage){ee("ms_manarea").el.innerHTML=menu.isLangJP()?"ŠÇ——Ìˆæ‚ð•\Ž¦":"Show management area"}else{ee("ms_manarea").el.innerHTML=menu.isLangJP()?"ŠÇ——Ìˆæ‚ð‰B‚·":"Hide management area"}},popupadjust:function(b){if(menu.pop){um.newOperation(true);var a=ee.getSrcElement(b).name;if(a.indexOf("reduce")===0){if(a==="reduceup"||a==="reducedn"){if(k.qrows<=1){return}}else{if(a==="reducelt"||a==="reducert"){if(k.qcols<=1&&(k.puzzleid!=="tawa"||bd.lap!==3)){return}}}}um.disableInfo();switch(a){case"expandup":this.expand(k.UP);break;case"expanddn":this.expand(k.DN);break;case"expandlt":this.expand(k.LT);break;case"expandrt":this.expand(k.RT);break;case"reduceup":this.reduce(k.UP);break;case"reducedn":this.reduce(k.DN);break;case"reducelt":this.reduce(k.LT);break;case"reducert":this.reduce(k.RT);break;case"turnl":this.turnflip(4,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});break;case"turnr":this.turnflip(3,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});break;case"flipy":this.turnflip(1,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});break;case"flipx":this.turnflip(2,{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});break}um.enableInfo();um.addOpe(k.BOARD,a,0,0,1);if(!um.undoExec){base.resetInfo(false)}base.resize_canvas()}},expand:function(b){this.adjustSpecial(5,b);this.adjustGeneral(5,"",{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});var d;if(b===k.UP||b===k.DN){d=k.qcols;k.qrows++;tc.maxy+=2}else{if(b===k.LT||b===k.RT){d=k.qrows;k.qcols++;tc.maxx+=2}}var c;c=function(e){return(menu.ex.distObj(b,k.CELL,e)===0)};this.expandGroup(k.CELL,bd.cell,d,c);if(k.iscross){var a=k.isoutsidecross?0:1;c=function(e){return(menu.ex.distObj(b,k.CROSS,e)===a)};this.expandGroup(k.CROSS,bd.cross,d+1,c)}if(k.isborder){bd.bdinside=2*k.qcols*k.qrows-(k.qcols+k.qrows);c=function(f){var e=menu.ex.distObj(b,k.BORDER,f);return(e===1||e===2)};this.expandGroup(k.BORDER,bd.border,2*d+(k.isoutsideborder===0?-1:1),c);if(k.isborderAsLine===0){this.expandborder(b)}else{this.expandborderAsLine(b)}}if(k.isextendcell!==0){c=function(e){return(menu.ex.distObj(b,k.EXCELL,e)===0)};this.expandGroup(k.EXCELL,bd.excell,k.isextendcell,c)}bd.setposAll();this.adjustSpecial2(5,b)},expandGroup:function(d,f,e,c){for(var a=f.length,b=a;b<a+e;b++){f.push(bd.getnewObj(d,b))}this.setposObj(d);for(var b=f.length-1;b>=0;b--){if(c(b)){f[b]=bd.getnewObj(d,b);e--}else{if(e>0){f[b]=f[b-e]}}}},reduce:function(c){this.adjustSpecial(6,c);this.adjustGeneral(6,"",{x1:0,y1:0,x2:k.qcols-1,y2:k.qrows-1});var d,e;this.qnums=[];d=function(f){return(menu.ex.distObj(c,k.CELL,f)===0)};e=this.reduceGroup(k.CELL,bd.cell,d);if(k.iscross){var a=k.isoutsidecross?0:1;d=function(f){return(menu.ex.distObj(c,k.CROSS,f)===a)};e=this.reduceGroup(k.CROSS,bd.cross,d)}if(k.isborder){if(k.isborderAsLine===1){this.reduceborderAsLine(c)}if(c===k.UP||c===k.DN){bd.bdinside=2*k.qcols*(k.qrows-1)-(k.qcols+k.qrows-1)}else{if(c===k.LT||c===k.RT){bd.bdinside=2*(k.qcols-1)*k.qrows-(k.qcols+k.qrows-1)}}d=function(h){var f=menu.ex.distObj(c,k.BORDER,h);return(f===1||f===2)};e=this.reduceGroup(k.BORDER,bd.border,d)}if(k.isextendcell!==0){d=function(f){return(menu.ex.distObj(c,k.EXCELL,f)===0)};e=this.reduceGroup(k.EXCELL,bd.excell,d)}if(c===k.UP||c===k.DN){k.qrows--;tc.maxy-=2}else{if(c===k.LT||c===k.RT){k.qcols--;tc.maxx-=2}}bd.setposAll();if(k.isOneNumber){area.resetArea();for(var b=0;b<this.qnums.length;b++){bd.sQnC(area.getTopOfRoom(this.qnums[b].areaid),this.qnums[b].val)}}this.adjustSpecial2(6,c)},reduceGroup:function(c,e,a){var d=0;for(var b=0;b<e.length;b++){if(a(b)){bd.hideNumobj(c,b);if(!bd.isNullObj(c,b)){um.addObj(c,b)}d++;if(c===k.CELL&&k.isOneNumber){if(bd.QnC(b)!==-1){this.qnums.push({areaid:area.getRoomID(b),val:bd.QnC(b)})}}}else{if(d>0){e[b-d]=e[b]}}}for(var b=0;b<d;b++){e.pop()}return d},turnflip:function(e,h){h.xx=(h.x1+h.x2);h.yy=(h.y1+h.y2);this.adjustSpecial(e,"");this.adjustGeneral(e,"",h);if(e===3||e===4){var b=k.qcols;k.qcols=k.qrows;k.qrows=b;b=tc.maxx;tc.maxx=tc.maxy;tc.maxy=b;bd.setposAll()}var f;if(e===1){f=function(c,l){return bd.cnum(bd.cell[l].cx,c.yy-bd.cell[l].cy)}}else{if(e===2){f=function(c,l){return bd.cnum(c.xx-bd.cell[l].cx,bd.cell[l].cy)}}else{if(e===3){f=function(c,l){return bd.cnum2(bd.cell[l].cy,c.yy-bd.cell[l].cx,k.qrows,k.qcols)}}else{if(e===4){f=function(c,l){return bd.cnum2(c.xx-bd.cell[l].cy,bd.cell[l].cx,k.qrows,k.qcols)}}}}}this.turnflipGroup(h,bd.cell,k.qcols*k.qrows,f);if(k.iscross){if(e===1){f=function(c,l){return bd.xnum(bd.cross[l].cx,(c.yy+1)-bd.cross[l].cy)}}else{if(e===2){f=function(c,l){return bd.xnum((c.xx+1)-bd.cross[l].cx,bd.cross[l].cy)}}else{if(e===3){f=function(c,l){return bd.xnum2(bd.cross[l].cy,(c.yy+1)-bd.cross[l].cx,k.qrows,k.qcols)}}else{if(e===4){f=function(c,l){return bd.xnum2((c.xx+1)-bd.cross[l].cy,bd.cross[l].cx,k.qrows,k.qcols)}}}}}this.turnflipGroup(h,bd.cross,(k.qcols+1)*(k.qrows+1),f)}if(k.isborder){if(e===1){f=function(c,l){return bd.bnum(bd.border[l].cx,(c.yy+1)*2-bd.border[l].cy)}}else{if(e===2){f=function(c,l){return bd.bnum((c.xx+1)*2-bd.border[l].cx,bd.border[l].cy)}}else{if(e===3){f=function(c,l){return bd.bnum2(bd.border[l].cy,(c.yy+1)*2-bd.border[l].cx,k.qrows,k.qcols)}}else{if(e===4){f=function(c,l){return bd.bnum2((c.xx+1)*2-bd.border[l].cy,bd.border[l].cx,k.qrows,k.qcols)}}}}}this.turnflipGroup(h,bd.border,bd.bdinside+(k.isoutsideborder===0?0:2*(k.qcols+k.qrows)),f)}if(k.isextendcell===2){if(e===1){f=function(c,l){return bd.exnum(bd.excell[l].cx,c.yy-bd.excell[l].cy)}}else{if(e===2){f=function(c,l){return bd.exnum(c.xx-bd.excell[l].cx,bd.excell[l].cy)}}else{if(e===3){f=function(c,l){return bd.exnum2(bd.excell[l].cy,c.yy-bd.excell[l].cx,k.qrows,k.qcols)}}else{if(e===4){f=function(c,l){return bd.exnum2(c.xx-bd.excell[l].cy,bd.excell[l].cx,k.qrows,k.qcols)}}}}}this.turnflipGroup(h,bd.excell,2*(k.qcols+k.qrows)+4,f)}else{if(k.isextendcell===1&&(e===1||e===2)){if(e===1){for(var j=h.y1;j<h.yy/2;j++){var i=bd.excell[bd.exnum(-1,j)];bd.excell[bd.exnum(-1,j)]=bd.excell[bd.exnum(-1,h.yy-j)];bd.excell[bd.exnum(-1,h.yy-j)]=i}}else{if(e===2){for(var a=h.x1;a<h.xx/2;a++){var i=bd.excell[bd.exnum(a,-1)];bd.excell[bd.exnum(a,-1)]=bd.excell[bd.exnum(h.xx-a,-1)];bd.excell[bd.exnum(h.xx-a,-1)]=i}}}}}bd.setposAll();this.adjustSpecial2(e,"")},turnflipGroup:function(l,m,o,c){var b=[];for(var e=0;e<o;e++){b[e]=1}for(var a=0;a<o;a++){if(b[a]===0){continue}var f=m[a],j=a;while(b[j]!==0){b[j]=0;var h=c(l,j);if(b[h]!==0){m[j]=m[h];j=h}else{m[j]=f}}}},expandborder:function(b){if(um.undoExec){return}bd.setposBorders();for(var a=0;a<bd.bdmax;a++){if(this.distObj(b,k.BORDER,a)!==1){continue}var c=this.innerBorder(b,a);bd.border[a].ques=bd.border[c].ques;bd.border[a].qans=bd.border[c].qans}},expandborderAsLine:function(b){bd.setposBorders();for(var a=0;a<bd.bdmax;a++){if(this.distObj(b,k.BORDER,a)!==2){continue}var c=this.outerBorder(b,a);this.copyData(a,c);bd.border[c].allclear(c)}},reduceborderAsLine:function(b){for(var a=0;a<bd.bdmax;a++){if(this.distObj(b,k.BORDER,a)!==0){continue}var c=this.innerBorder(b,a);this.copyData(a,c)}},copyData:function(b,a){bd.border[b].qans=bd.border[a].qans;bd.border[b].qsub=bd.border[a].qsub;bd.border[b].ques=bd.border[a].ques;bd.border[b].color=bd.border[a].color},innerBorder:function(a,d){var c=bd.border[d].cx,b=bd.border[d].cy;if(a===k.UP){return bd.bnum(c,b+2)}else{if(a===k.DN){return bd.bnum(c,b-2)}else{if(a===k.LT){return bd.bnum(c+2,b)}else{if(a===k.RT){return bd.bnum(c-2,b)}}}}return -1},outerBorder:function(a,d){var c=bd.border[d].cx,b=bd.border[d].cy;if(a===k.UP){return bd.bnum(c,b-2)}else{if(a===k.DN){return bd.bnum(c,b+2)}else{if(a===k.LT){return bd.bnum(c-2,b)}else{if(a===k.RT){return bd.bnum(c+2,b)}}}}return -1},setposObj:function(a){if(a===k.CELL){bd.setposCells()}else{if(a===k.CROSS){bd.setposCrosses()}else{if(a===k.BORDER){bd.setposBorders()}else{if(a===k.EXCELL){bd.setposEXcells()}}}}},distObj:function(a,b,c){if(b===k.CELL){if(a===k.UP){return bd.cell[c].cy}else{if(a===k.DN){return(k.qrows-1)-bd.cell[c].cy}else{if(a===k.LT){return bd.cell[c].cx}else{if(a===k.RT){return(k.qcols-1)-bd.cell[c].cx}}}}}else{if(b===k.CROSS){if(a===k.UP){return bd.cross[c].cy}else{if(a===k.DN){return k.qrows-bd.cross[c].cy}else{if(a===k.LT){return bd.cross[c].cx}else{if(a===k.RT){return k.qcols-bd.cross[c].cx}}}}}else{if(b===k.BORDER){if(a===k.UP){return bd.border[c].cy}else{if(a===k.DN){return 2*k.qrows-bd.border[c].cy}else{if(a===k.LT){return bd.border[c].cx}else{if(a===k.RT){return 2*k.qcols-bd.border[c].cx}}}}}else{if(b===k.EXCELL){if(a===k.UP){return bd.excell[c].cy}else{if(a===k.DN){return(k.qrows-1)-bd.excell[c].cy}else{if(a===k.LT){return bd.excell[c].cx}else{if(a===k.RT){return(k.qcols-1)-bd.excell[c].cx}}}}}}}}return -1},adjustGeneral:function(e,b,h){um.disableRecord();for(var j=h.y1;j<=h.y2;j++){for(var a=h.x1;a<=h.x2;a++){var i=bd.cnum(a,j);switch(e){case 1:if(true){var f=({2:5,3:4,4:3,5:2,104:107,105:106,106:105,107:104})[bd.QuC(i)];if(!isNaN(f)){bd.sQuC(i,f)}}if(k.isextendcell!==1){var f=({1:2,2:1})[bd.DiC(i)];if(!isNaN(f)){bd.sDiC(i,f)}}break;case 2:if(true){var f=({2:3,3:2,4:5,5:4,104:105,105:104,106:107,107:106})[bd.QuC(i)];if(!isNaN(f)){bd.sQuC(i,f)}}if(k.isextendcell!==1){var f=({3:4,4:3})[bd.DiC(i)];if(!isNaN(f)){bd.sDiC(i,f)}}break;case 3:if(true){var f={2:5,3:2,4:3,5:4,21:22,22:21,102:103,103:102,104:107,105:104,106:105,107:106}[bd.QuC(i)];if(!isNaN(f)){bd.sQuC(i,f)}}if(k.isextendcell!==1){var f={1:4,2:3,3:1,4:2}[bd.DiC(i)];if(!isNaN(f)){bd.sDiC(i,f)}}break;case 4:if(true){var f={2:3,3:4,4:5,5:2,21:22,22:21,102:103,103:102,104:105,105:106,106:107,107:104}[bd.QuC(i)];if(!isNaN(f)){bd.sQuC(i,f)}}if(k.isextendcell!==1){var f={1:3,2:4,3:2,4:1}[bd.DiC(i)];if(!isNaN(f)){bd.sDiC(i,f)}}break;case 5:break;case 6:break}}}um.enableRecord()},adjustQues51_1:function(c,b){this.qnumw=[];this.qnumh=[];for(var d=0;d<=k.qrows-1;d++){this.qnumw[d]=[bd.QnE(bd.exnum(-1,d))];for(var a=0;a<=k.qcols-1;a++){if(bd.QuC(bd.cnum(a,d))===51){this.qnumw[d].push(bd.QnC(bd.cnum(a,d)))}}}for(var a=0;a<=k.qcols-1;a++){this.qnumh[a]=[bd.DiE(bd.exnum(a,-1))];for(var d=0;d<=k.qrows-1;d++){if(bd.QuC(bd.cnum(a,d))===51){this.qnumh[a].push(bd.DiC(bd.cnum(a,d)))}}}},adjustQues51_2:function(d,c){um.disableRecord();var b;switch(d){case 1:for(var a=0;a<=k.qcols-1;a++){b=1;this.qnumh[a]=this.qnumh[a].reverse();bd.sDiE(bd.exnum(a,-1),this.qnumh[a][0]);for(var e=0;e<=k.qrows-1;e++){if(bd.QuC(bd.cnum(a,e))===51){bd.sDiC(bd.cnum(a,e),this.qnumh[a][b]);b++}}}break;case 2:for(var e=0;e<=k.qrows-1;e++){b=1;this.qnumw[e]=this.qnumw[e].reverse();bd.sQnE(bd.exnum(-1,e),this.qnumw[e][0]);for(var a=0;a<=k.qcols-1;a++){if(bd.QuC(bd.cnum(a,e))===51){bd.sQnC(bd.cnum(a,e),this.qnumw[e][b]);b++}}}break;case 3:for(var e=0;e<=k.qrows-1;e++){b=1;this.qnumh[e]=this.qnumh[e].reverse();bd.sQnE(bd.exnum(-1,e),this.qnumh[e][0]);for(var a=0;a<=k.qcols-1;a++){if(bd.QuC(bd.cnum(a,e))===51){bd.sQnC(bd.cnum(a,e),this.qnumh[e][b]);b++}}}for(var a=0;a<=k.qcols-1;a++){b=1;bd.sDiE(bd.exnum(a,-1),this.qnumw[k.qcols-1-a][0]);for(var e=0;e<=k.qrows-1;e++){if(bd.QuC(bd.cnum(a,e))===51){bd.sDiC(bd.cnum(a,e),this.qnumw[k.qcols-1-a][b]);b++}}}break;case 4:for(var e=0;e<=k.qrows-1;e++){b=1;bd.sQnE(bd.exnum(-1,e),this.qnumh[k.qrows-1-e][0]);for(var a=0;a<=k.qcols-1;a++){if(bd.QuC(bd.cnum(a,e))===51){bd.sQnC(bd.cnum(a,e),this.qnumh[k.qrows-1-e][b]);b++}}}for(var a=0;a<=k.qcols-1;a++){b=1;this.qnumw[a]=this.qnumw[a].reverse();bd.sDiE(bd.exnum(a,-1),this.qnumw[a][0]);for(var e=0;e<=k.qrows-1;e++){if(bd.QuC(bd.cnum(a,e))===51){bd.sDiC(bd.cnum(a,e),this.qnumw[a][b]);b++}}}break}um.enableRecord()},adjustSpecial:function(b,a){},adjustSpecial2:function(b,a){},ACconfirm:function(){if(confirm(menu.isLangJP()?"‰ñ“š‚ðÁ‹Ž‚µ‚Ü‚·‚©H":"Do you want to erase the Answer?")){um.newOperation(true);for(var a=0;a<bd.cellmax;a++){if(bd.cell[a].qans!==bd.defcell.qans){um.addOpe(k.CELL,k.QANS,a,bd.cell[a].qans,bd.defcell.qans)}if(bd.cell[a].qsub!==bd.defcell.qsub){um.addOpe(k.CELL,k.QSUB,a,bd.cell[a].qsub,bd.defcell.qsub)}}if(k.isborder){for(var a=0;a<bd.bdmax;a++){if(bd.border[a].qans!==bd.defborder.qans){um.addOpe(k.BORDER,k.QANS,a,bd.border[a].qans,bd.defborder.qans)}if(bd.border[a].line!==bd.defborder.line){um.addOpe(k.BORDER,k.LINE,a,bd.border[a].line,bd.defborder.line)}if(bd.border[a].qsub!==bd.defborder.qsub){um.addOpe(k.BORDER,k.QSUB,a,bd.border[a].qsub,bd.defborder.qsub)}}}if(!g.vml){pc.flushCanvasAll()}bd.ansclear();base.resetInfo(false);pc.paintAll()}},ASconfirm:function(){if(confirm(menu.isLangJP()?"•â•‹L†‚ðÁ‹Ž‚µ‚Ü‚·‚©H":"Do you want to erase the auxiliary marks?")){um.newOperation(true);for(var a=0;a<bd.cellmax;a++){if(bd.cell[a].qsub!==bd.defcell.qsub){um.addOpe(k.CELL,k.QSUB,a,bd.cell[a].qsub,bd.defcell.qsub)}}if(k.isborder){for(var a=0;a<bd.bdmax;a++){if(bd.border[a].qsub!==bd.defborder.qsub){um.addOpe(k.BORDER,k.QSUB,a,bd.border[a].qsub,bd.defborder.qsub)}}}if(!g.vml){pc.flushCanvasAll()}bd.subclear();pc.paintAll()}}};AreaInfo=function(){this.max=0;this.id=[];this.room=[]};LineManager=function(){this.lcnt=[];this.ltotal=[];this.disableLine=(!k.isCenterLine&&!k.isborderAsLine);this.data={};this.typeA="A";this.typeB="B";this.typeC="C";this.saved=0;this.init()};LineManager.prototype={init:function(){if(this.disableLine){return}if(k.isCenterLine){for(var d=0;d<bd.cellmax;d++){this.lcnt[d]=0}this.ltotal=[(k.qcols*k.qrows),0,0,0,0]}else{for(var d=0,a=(k.qcols+1)*(k.qrows+1);d<a;d++){this.lcnt[d]=0}this.ltotal=[((k.qcols+1)*(k.qrows+1)),0,0,0,0]}this.data={max:0,id:[]};for(var b=0;b<bd.bdmax;b++){this.data.id[b]=-1}},resetLcnts:function(){if(this.disableLine){return}this.init();for(var e=0;e<bd.bdmax;e++){this.data.id[e]=(bd.isLine(e)?0:-1);if(bd.isLine(e)){this.data.id[e]=0;var b,a;if(k.isCenterLine){b=bd.cc1(e),a=bd.cc2(e)}else{b=bd.crosscc1(e),a=bd.crosscc2(e)}if(b!=-1){this.ltotal[this.lcnt[b]]--;this.lcnt[b]++;this.ltotal[this.lcnt[b]]++}if(a!=-1){this.ltotal[this.lcnt[a]]--;this.lcnt[a]++;this.ltotal[this.lcnt[a]]++}}}for(var e=0;e<bd.bdmax;e++){if(this.data.id[e]!=0){continue}var d=bd.border[e].cx,c=bd.border[e].cy;this.data.max++;this.data[this.data.max]={idlist:[]};if(k.isCenterLine^(d%2==0)){this.lc0(d,c+1,1,this.data.max);this.lc0(d,c,2,this.data.max)}else{this.lc0(d+1,c,3,this.data.max);this.lc0(d,c,4,this.data.max)}}},lcntCell:function(a){return(a!=-1?this.lcnt[a]:0)},gettype:function(c,b,a){if(!k.isLineCross){return((this.lcnt[c]===(0+a))?this.typeA:this.typeB)}else{if(c===-1||this.lcnt[c]===(0+a)||(this.lcnt[c]===(2+a)&&this.isTpos(c,b))){return this.typeA}else{if(this.lcnt[c]===(1+a)||this.lcnt[c]===(3+a)){return this.typeB}}return this.typeC}},isTpos:function(b,a){if(k.isCenterLine){return !bd.isLine(bd.bnum(4*bd.cell[b].cx+2-bd.border[a].cx,4*bd.cell[b].cy+2-bd.border[a].cy))}else{return !bd.isLine(bd.bnum(4*(b%(k.qcols+1))-bd.border[a].cx,4*mf(b/(k.qcols+1))-bd.border[a].cy))}},branch:function(b,a){if(!k.isLineCross){return(this.lcntCell((k.isCenterLine?bd.cnum:bd.xnum)(b>>1,a>>1))>=3)}return false},terminate:function(b,a){return false},setLine:function(b,c){if(this.disableLine){return}c=(c>0?1:0);var m,l;if(k.isCenterLine){m=bd.cc1(b),l=bd.cc2(b)}else{m=bd.crosscc1(b),l=bd.crosscc2(b)}if(c>0){if(m!=-1){this.ltotal[this.lcnt[m]]--;this.lcnt[m]++;this.ltotal[this.lcnt[m]]++}if(l!=-1){this.ltotal[this.lcnt[l]]--;this.lcnt[l]++;this.ltotal[this.lcnt[l]]++}}else{if(m!=-1){this.ltotal[this.lcnt[m]]--;this.lcnt[m]--;this.ltotal[this.lcnt[m]]++}if(l!=-1){this.ltotal[this.lcnt[l]]--;this.lcnt[l]--;this.ltotal[this.lcnt[l]]++}}var h=this.gettype(m,b,c),e=this.gettype(l,b,c);if(c>0){if(h===this.typeA&&e===this.typeA){this.data.max++;this.data[this.data.max]={idlist:[b]};this.data.id[b]=this.data.max;bd.border[b].color=pc.getNewLineColor()}else{if((h===this.typeA&&e===this.typeB)||(h===this.typeB&&e===this.typeA)){var j=(this.getbid(b,1))[0];this.data[this.data.id[j]].idlist.push(b);this.data.id[b]=this.data.id[j];bd.border[b].color=bd.border[j].color}else{if(!k.isLineCross||(h===this.typeB&&e===this.typeB)){this.addLineInfo(b)}else{this.remakeLineInfo(b,1)}}}}else{if(h===this.typeA&&e===this.typeA){this.data[this.data.id[b]]={idlist:[]};this.data.id[b]=-1;bd.border[b].color=""}else{if((h===this.typeA&&e===this.typeB)||(h===this.typeB&&e===this.typeA)){var d=this.data.id[b],a=this.data[d].idlist;for(var f=0;f<a.length;f++){if(a[f]===b){a.splice(f,1);break}}this.data.id[b]=-1;bd.border[b].color=""}else{this.remakeLineInfo(b,0);bd.border[b].color=""}}}},addLineInfo:function(a){var e=this.data.id;var j=this.getbid(a,1);var p=[e[j[0]],-1];for(var h=0;h<j.length;h++){if(p[0]!=e[j[h]]){p[1]=e[j[h]];break}}var o=bd.border[j[0]].color;if(p[1]!=-1){var f=p[0],b=p[1];if(this.data[p[0]].idlist.length<this.data[p[1]].idlist.length){f=p[1];b=p[0];o=bd.border[j[1]].color}var l=this.data[f].idlist;var c=this.data[b].idlist;for(var d=0,m=c.length;d<m;d++){l.push(c[d]);e[c[d]]=f}this.data[b].idlist=[];l.push(a);e[a]=f;for(var h=0,m=l.length;h<m;h++){bd.border[l[h]].color=o}this.repaintLine(l)}else{this.data[p[0]].idlist.push(a);e[a]=p[0];bd.border[a].color=o}},remakeLineInfo:function(b,d){var e=this.data.id;var o=this.getbid(b,d);var h=e[o[0]];var j=bd.border[o[0]].color;for(var m=0,p=o.length;m<p;m++){var q=e[o[m]];if(q<=0){continue}var a=this.data[q].idlist;if(this.data[h].idlist.length<a.length){h=q;j=bd.border[o[m]].color}for(var c=0,l=a.length;c<l;c++){e[a[c]]=0}this.data[q]={idlist:[]}}e[b]=(d>0?0:-1);if(d===1){o.unshift(b)}var f=this.data.max;for(var m=0,p=o.length;m<p;m++){if(e[o[m]]!=0){continue}var u=bd.border[o[m]].cx,t=bd.border[o[m]].cy;this.data.max++;this.data[this.data.max]={idlist:[]};if(k.isCenterLine^(u%2===0)){this.lc0(u,t+1,1,this.data.max);this.lc0(u,t,2,this.data.max)}else{this.lc0(u+1,t,3,this.data.max);this.lc0(u,t,4,this.data.max)}}h=f+1;if(this.data.max>h||k.isLineCross){for(var m=f+2;m<=this.data.max;m++){if(this.data[h].idlist.length<this.data[m].idlist.length){h=m}}for(var m=f+1;m<=this.data.max;m++){var r=(m===h?j:pc.getNewLineColor());var a=this.data[m].idlist;for(var c=0,p=a.length;c<p;c++){bd.border[a[c]].color=r}this.repaintLine(a)}}else{bd.border[b].color=(d==0?j:"")}},repaintLine:(((!k.vml)?function(c){if(!pp.getVal("irowake")){return}if(k.isCenterLine){for(var b=0,a=c.length;b<a;b++){pc.drawLine1(c[b],true);this.repaintParts(c[b])}}else{for(var b=0,a=c.length;b<a;b++){var d=c[b];if(bd.border[d].qans!==1){g.fillStyle=pc.BorderQuescolor}else{g.fillStyle=pc.getLineColor(d)}pc.drawBorder1x(bd.border[d].cx,bd.border[d].cy,true);this.repaintParts(d)}}}:function(c){if(!pp.getVal("irowake")){return}pc.zstable=true;if(k.isCenterLine){for(var b=0,a=c.length;b<a;b++){pc.drawLine1(c[b],true)}}else{for(var b=0,a=c.length;b<a;b++){pc.drawBorder1x(bd.border[c[b]].cx,bd.border[c[b]].cy,true)}}pc.zstable=false})),repaintParts:function(a){},getbid:function(a,b){var d=[];var f=bd.border[a].cx,e=bd.border[a].cy;var m=((k.isCenterLine^(f%2===0))?2:0),l=(2-m);var c;if(!k.isLineCross){c=bd.bnum(f-l,e-m);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f-1,e-1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+m-1,e+l-1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+l,e+m);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+1,e+1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f-m+1,e-l+1);if(bd.isLine(c)){d.push(c)}}else{var j=bd.cc1(a),h=bd.cc2(a);if(!k.isCenterLine){j=bd.crosscc1(a);h=bd.crosscc2(a)}if(j!==-1){if(this.lcnt[j]===(1+b)||(this.lcnt[j]===(2+b)&&!this.isTpos(j,a))){c=bd.bnum(f-l,e-m);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f-1,e-1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+m-1,e+l-1);if(bd.isLine(c)){d.push(c)}}else{if(this.lcnt[j]>=(3+b)){c=bd.bnum(f-l,e-m);if(bd.isLine(c)){d.push(c)}}}}if(h!==-1){if(this.lcnt[h]===(1+b)||(this.lcnt[h]===(2+b)&&!this.isTpos(h,a))){c=bd.bnum(f+l,e+m);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f+1,e+1);if(bd.isLine(c)){d.push(c)}c=bd.bnum(f-m+1,e-l+1);if(bd.isLine(c)){d.push(c)}}else{if(this.lcnt[h]>=(3+b)){c=bd.bnum(f+l,e+m);if(bd.isLine(c)){d.push(c)}}}}}return d},lc0:function(d,c,b,a){while(1){switch(b){case 1:c--;break;case 2:c++;break;case 3:d--;break;case 4:d++;break}if((d+c)%2===0){if(this.branch(d,c)){if(bd.isLine(bd.bnum(d,c-1))){this.lc0(d,c,1,a)}if(bd.isLine(bd.bnum(d,c+1))){this.lc0(d,c,2,a)}if(bd.isLine(bd.bnum(d-1,c))){this.lc0(d,c,3,a)}if(bd.isLine(bd.bnum(d+1,c))){this.lc0(d,c,4,a)}break}else{if(this.lcntCell((k.isCenterLine?bd.cnum:bd.xnum)(d>>1,c>>1))<=2){if(b!=1&&bd.isLine(bd.bnum(d,c+1))){b=2}else{if(b!=2&&bd.isLine(bd.bnum(d,c-1))){b=1}else{if(b!=3&&bd.isLine(bd.bnum(d+1,c))){b=4}else{if(b!=4&&bd.isLine(bd.bnum(d-1,c))){b=3}}}}}else{if(this.terminate(d,c)){break}}}}else{var e=bd.bnum(d,c);if(this.data.id[e]!=0){break}this.data.id[e]=a;this.data[a].idlist.push(e)}}},getLineInfo:function(){var b=new AreaInfo();for(var c=0;c<bd.bdmax;c++){b.id[c]=(bd.isLine(c)?0:-1)}for(var c=0;c<bd.bdmax;c++){if(b.id[c]!=0){continue}b.max++;b.room[b.max]={idlist:this.data[this.data.id[c]].idlist};for(var a=0;a<b.room[b.max].idlist.length;a++){b.id[b.room[b.max].idlist[a]]=b.max}}return b},getLareaInfo:function(){var a=new AreaInfo();for(var b=0;b<bd.cellmax;b++){a.id[b]=(this.lcnt[b]>0?0:-1)}for(var b=0;b<bd.cellmax;b++){if(a.id[b]!=0){continue}a.max++;a.room[a.max]={idlist:[]};this.sr0(a,b,a.max)}return a},sr0:function(c,a,b){c.id[a]=b;c.room[b].idlist.push(a);if(bd.isLine(bd.ub(a))&&c.id[bd.up(a)]===0){this.sr0(c,bd.up(a),b)}if(bd.isLine(bd.db(a))&&c.id[bd.dn(a)]===0){this.sr0(c,bd.dn(a),b)}if(bd.isLine(bd.lb(a))&&c.id[bd.lt(a)]===0){this.sr0(c,bd.lt(a),b)}if(bd.isLine(bd.rb(a))&&c.id[bd.rt(a)]===0){this.sr0(c,bd.rt(a),b)}}};AreaManager=function(){this.lcnt=[];this.room={};this.bcell={};this.wcell={};this.disroom=(!k.isborder||!!k.area.disroom);this.bblock=(!!k.area.bcell||!!k.area.number);this.wblock=!!k.area.wcell;this.numberColony=!!k.area.number;this.init()};AreaManager.prototype={init:function(){this.initRarea();this.initBarea();this.initWarea()},resetArea:function(){if(k.isborder&&!k.isborderAsLine){this.resetRarea()}if(this.bblock){this.resetBarea()}if(this.wblock){this.resetWarea()}},initRarea:function(){this.room={max:1,id:[],1:{top:0,clist:[]}};for(var h=0;h<bd.cellmax;h++){this.room.id[h]=1;this.room[1].clist[h]=h}this.lcnt=[];for(var h=0;h<(k.qcols+1)*(k.qrows+1);h++){this.lcnt[h]=0;if(k.isoutsideborder===0){var e=h%(k.qcols+1),d=mf(h/(k.qcols+1));if(e===0||e===k.qcols||d===0||d===k.qrows){this.lcnt[h]=2}}}if(this.disroom){return}for(var f=0;f<bd.bdmax;f++){if(bd.isBorder(f)){var b=bd.crosscc1(f),a=bd.crosscc2(f);if(b!==-1){this.lcnt[b]++}if(a!==-1){this.lcnt[a]++}}}},resetRarea:function(){if(this.disroom){return}this.initRarea();this.room.max=0;for(var j=0;j<bd.cellmax;j++){this.room.id[j]=0}for(var j=0;j<bd.cellmax;j++){if(this.room.id[j]!=0){continue}this.room.max++;this.room[this.room.max]={top:-1,clist:[]};this.sr0(j,this.room,bd.isBorder)}if(k.isOneNumber){for(var d=1;d<=this.room.max;d++){this.setTopOfRoom(d);var f=-1,e=this.room[d].clist;for(var b=0,a=e.length;b<a;b++){var h=e[b];if(this.room.id[h]===d&&bd.cell[h].qnum!==-1){if(f===-1){f=bd.cell[h].qnum}if(this.getTopOfRoom(d)!==h){bd.sQnC(h,-1)}}}if(f!==-1&&bd.QnC(this.getTopOfRoom(d))===-1){bd.sQnC(this.getTopOfRoom(d),f)}}}},lcntCross:function(a){return this.lcnt[a]},getRoomID:function(a){return this.room.id[a]},getTopOfRoomByCell:function(a){return this.room[this.room.id[a]].top},getTopOfRoom:function(a){return this.room[a].top},getCntOfRoomByCell:function(a){return this.room[this.room.id[a]].clist.length},call_setBorder:function(c,b,a){this.setBorder(c,b)},setBorder:function(f,y){if(this.disroom){return}y=(y>0?1:0);var d,c,b=bd.crosscc1(f),a=bd.crosscc2(f);var u=this.room,x=u.id;if(y>0){this.lcnt[b]++;this.lcnt[a]++;if(this.lcnt[b]===1||this.lcnt[a]===1){return}d=bd.cc1(f);c=bd.cc2(f);if(d===-1||c===-1||x[d]!==x[c]){return}var e=x[d];u.max++;u[u.max]={top:-1,clist:[]};this.sr0(c,u,bd.isBorder);if(x[d]===u.max){for(var l=0,m=u[u.max].clist.length;l<m;l++){x[u[u.max].clist[l]]=e}u.max--;return}var w=u[e].clist.concat();u[e].clist=[];u[u.max].clist=[];for(var l=0,m=w.length;l<m;l++){u[x[w[l]]].clist.push(w[l])}if(k.isOneNumber){if(x[u[e].top]===e){this.setTopOfRoom(u.max)}else{u[u.max].top=u[e].top;this.setTopOfRoom(e)}}}else{this.lcnt[b]--;this.lcnt[a]--;if(this.lcnt[b]===0||this.lcnt[a]===0){return}d=bd.cc1(f);c=bd.cc2(f);if(d===-1||c===-1||x[d]===x[c]){return}if(k.isOneNumber){var v,p;var r=u[x[d]].top,o=u[x[c]].top;var t=bd.cell[r].cx,q=bd.cell[o].cx;if(t>q||(t===q&&r>o)){v=r;p=o}else{v=o;p=r}if(bd.QnC(v)!==-1){if(bd.QnC(p)===-1){bd.sQnC(p,bd.QnC(v));pc.paintCell(p)}bd.sQnC(v,-1);pc.paintCell(v)}}var j=x[d],h=x[c],w=u[h].clist;for(var l=0;l<w.length;l++){x[w[l]]=j;u[j].clist.push(w[l])}u[h]={top:-1,clist:[]}}},setTopOfRoom:function(d){var h=-1,b=k.qcols,f=k.qrows;var e=this.room[d].clist;for(var c=0;c<e.length;c++){var a=bd.cell[e[c]];if(a.cx>b||(a.cx==b&&a.cy>=f)){continue}h=e[c];b=a.cx;f=a.cy}this.room[d].top=h},sr0:function(e,d,b){d.id[e]=d.max;d[d.max].clist.push(e);var a;a=bd.up(e);if(a!==-1&&d.id[a]!==d.max&&!b(bd.ub(e))){this.sr0(a,d,b)}a=bd.dn(e);if(a!==-1&&d.id[a]!==d.max&&!b(bd.db(e))){this.sr0(a,d,b)}a=bd.lt(e);if(a!==-1&&d.id[a]!==d.max&&!b(bd.lb(e))){this.sr0(a,d,b)}a=bd.rt(e);if(a!==-1&&d.id[a]!==d.max&&!b(bd.rb(e))){this.sr0(a,d,b)}},initBarea:function(){this.bcell={max:0,id:[]};for(var a=0;a<bd.cellmax;a++){this.bcell.id[a]=-1}},resetBarea:function(){this.initBarea();if(!this.numberColony){for(var a=0;a<bd.cellmax;a++){this.bcell.id[a]=(bd.isBlack(a)?0:-1)}}else{for(var a=0;a<bd.cellmax;a++){this.bcell.id[a]=(bd.isNum(a)?0:-1)}}for(var a=0;a<bd.cellmax;a++){if(this.bcell.id[a]!=0){continue}this.bcell.max++;this.bcell[this.bcell.max]={clist:[]};this.sc0(a,this.bcell)}},initWarea:function(){this.wcell={max:1,id:[],1:{clist:[]}};for(var a=0;a<bd.cellmax;a++){this.wcell.id[a]=1;this.wcell[1].clist[a]=a}},resetWarea:function(){this.initWarea();this.wcell.max=0;for(var a=0;a<bd.cellmax;a++){this.wcell.id[a]=(bd.isWhite(a)?0:-1)}for(var a=0;a<bd.cellmax;a++){if(this.wcell.id[a]!=0){continue}this.wcell.max++;this.wcell[this.wcell.max]={clist:[]};this.sc0(a,this.wcell)}},setCell:function(b,a){if(a>0){if(this.bblock){this.setBWCell(b,1,this.bcell)}if(this.wblock){this.setBWCell(b,0,this.wcell)}}else{if(this.bblock){this.setBWCell(b,0,this.bcell)}if(this.wblock){this.setBWCell(b,1,this.wcell)}}},setBWCell:function(d,b,h){var o=[],c=h.id,f;f=bd.up(d);if(f!==-1&&c[f]!==-1){o.push(f)}f=bd.dn(d);if(f!==-1&&c[f]!==-1){o.push(f)}f=bd.lt(d);if(f!==-1&&c[f]!==-1){o.push(f)}f=bd.rt(d);if(f!==-1&&c[f]!==-1){o.push(f)}if(b>0){if(o.length===0){h.max++;h[h.max]={clist:[d]};c[d]=h.max}else{if(o.length===1){h[c[o[0]]].clist.push(d);c[d]=c[o[0]]}else{var l=c[o[0]];for(var j=1;j<o.length;j++){if(h[l].clist.length<h[c[o[j]]].clist.length){l=c[o[j]]}}for(var j=0;j<o.length;j++){if(c[o[j]]===l){continue}var p=h[c[o[j]]].clist;for(var a=0,m=p.length;a<m;a++){c[p[a]]=l;h[l].clist.push(p[a])}p=[]}c[d]=l;h[l].clist.push(d)}}}else{if(o.length===0){h[c[d]].clist=[];c[d]=-1}else{if(o.length===1){var e=c[d],p=h[e].clist;for(var j=0;j<p.length;j++){if(p[j]===d){p.splice(j,1);break}}c[d]=-1}else{var e=c[d],p=h[e].clist;for(var j=0;j<p.length;j++){c[p[j]]=0}h[e].clist=[];c[d]=-1;for(var j=0;j<o.length;j++){if(c[o[j]]!==0){continue}h.max++;h[h.max]={clist:[]};this.sc0(o[j],h)}}}}},sc0:function(d,b){b.id[d]=b.max;b[b.max].clist.push(d);var a;a=bd.up(d);if(a!==-1&&b.id[a]===0){this.sc0(a,b)}a=bd.dn(d);if(a!==-1&&b.id[a]===0){this.sc0(a,b)}a=bd.lt(d);if(a!==-1&&b.id[a]===0){this.sc0(a,b)}a=bd.rt(d);if(a!==-1&&b.id[a]===0){this.sc0(a,b)}},getRoomInfo:function(){return this.getAreaInfo(this.room)},getBCellInfo:function(){return this.getAreaInfo(this.bcell)},getWCellInfo:function(){return this.getAreaInfo(this.wcell)},getNumberInfo:function(){return this.getAreaInfo(this.bcell)},getAreaInfo:function(f){var e=new AreaInfo();for(var h=0;h<bd.cellmax;h++){e.id[h]=(f.id[h]>0?0:-1)}for(var h=0;h<bd.cellmax;h++){if(e.id[h]!=0){continue}e.max++;var d=f[f.id[h]].clist;e.room[e.max]={idlist:d};for(var b=0,a=d.length;b<a;b++){e.id[d[b]]=e.max}}return e}};PBase=function(){this.floatbgcolor="black";this.proto=0;this.expression={ja:"",en:""};this.puzzlename={ja:"",en:""};this.canvas=null;this.numparent=null;this.resizetimer=null;this.initProcess=true};PBase.prototype={preload_func:function(){enc=new Encode();enc.first_parseURI(location.search);if(!k.puzzleid){location.href="./"}if(!k.scriptcheck){document.writeln('<script type="text/javascript" src="src/'+k.puzzleid+'.js"><\/script>')}else{document.writeln('<script type="text/javascript" src="src/for_test.js"><\/script>');document.writeln('<script type="text/javascript" src="src/puzzles.js"><\/script>')}fio=new FileIO();if(fio.dbm.requireGears()){document.writeln('<script type="text/javascript" src="src/gears_init.js"><\/script>')}window.onload=ee.ebinder(this,this.onload_func);window.onresize=ee.ebinder(this,this.onresize_func)},onload_func:function(){this.initCanvas();this.initObjects();this.setEvents(true);if(document.domain=="indi.s58.xrea.com"&&k.PLAYER){this.accesslog()}tm=new Timer();this.initProcess=false},initCanvas:function(){this.canvas=ee("puzzle_canvas").unselectable().el;this.numparent=ee("numobj_parent").el;g=this.canvas.getContext("2d")},initObjects:function(){this.proto=0;puz=new Puzzles[k.puzzleid]();puz.setting();if(this.proto){puz.protoChange()}bd=new Board();mv=new MouseEvent();kc=new KeyEvent();kp=new KeyPopup();pc=new Graphic();tc=new TCell();ans=new AnsCheck();um=new UndoManager();area=new AreaManager();line=new LineManager();menu=new Menu();pp=new Properties();this.doc_design();enc.pzlinput();if(!enc.uri.bstr){this.resize_canvas_onload()}if(!!puz.finalfix){puz.finalfix()}},setEvents:function(a){this.canvas.onmousedown=ee.ebinder(mv,mv.e_mousedown);this.canvas.onmousemove=ee.ebinder(mv,mv.e_mousemove);this.canvas.onmouseup=ee.ebinder(mv,mv.e_mouseup);this.canvas.oncontextmenu=function(){return false};this.numparent.onmousedown=ee.ebinder(mv,mv.e_mousedown);this.numparent.onmousemove=ee.ebinder(mv,mv.e_mousemove);this.numparent.onmouseup=ee.ebinder(mv,mv.e_mouseup);this.numparent.oncontextmenu=function(){return false};if(a){document.onkeydown=ee.ebinder(kc,kc.e_keydown);document.onkeyup=ee.ebinder(kc,kc.e_keyup);document.onkeypress=ee.ebinder(kc,kc.e_keypress);if(!!menu.ex.reader){var b=function(c){menu.ex.reader.readAsText(c.dataTransfer.files[0]);c.preventDefault();c.stopPropagation()};window.addEventListener("dragover",function(c){c.preventDefault()},true);window.addEventListener("drop",b,true)}}},initSilverlight:function(a){a.AddEventListener("KeyDown",ee.ebinder(kc,kc.e_SLkeydown));a.AddEventListener("KeyUp",ee.ebinder(kc,kc.e_SLkeyup))},doc_design:function(){this.resize_canvas_only();_doc.title=this.gettitle();ee("title2").el.innerHTML=this.gettitle();_doc.body.style.backgroundImage="url(../../"+k.puzzleid+"/bg.gif)";if(k.br.IE){ee("title2").el.style.marginTop="24px";ee("separator1").el.style.margin="0pt";ee("separator2").el.style.margin="0pt"}this.postfix();menu.menuinit();um.enb_btn();ee("btnclear").el.disabled=false;ee("btnclear2").el.disabled=false},postfix:function(){puz.input_init();puz.graphic_init();puz.encode_init();puz.answer_init()},gettitle:function(){if(k.EDITOR){return""+this.getPuzzleName()+(menu.isLangJP()?" ƒGƒfƒBƒ^ - ‚Ï‚¸‚Õ‚êv3":" editor - PUZ-PRE v3")}else{return""+this.getPuzzleName()+(menu.isLangJP()?" player - ‚Ï‚¸‚Õ‚êv3":" player - PUZ-PRE v3")}},getPuzzleName:function(){return(menu.isLangJP()||!this.puzzlename.en)?this.puzzlename.ja:this.puzzlename.en},setTitle:function(b,a){this.puzzlename.ja=b;this.puzzlename.en=a},setExpression:function(b,a){this.expression.ja=b;this.expression.en=a},setFloatbgcolor:function(a){this.floatbgcolor=a},resize_canvas_only:function(){var e=ee.windowWidth()-6;var j=k.qcols+(2*k.def_psize/k.def_csize)+k.isextendcell;var l=k.qrows+(2*k.def_psize/k.def_csize)+k.isextendcell;var a={0:(19/36),1:0.75,2:1,3:1.5,4:3}[k.widthmode];var f={base:a,limit:0.4},h={base:0.8,limit:0.96},m=[];m[0]=(e*h.base)/(k.def_csize*f.base);m[1]=(e*h.limit)/(k.def_csize*f.limit);var d=e*h.base-4;if(j<m[0]){d=e*h.base-4;k.cwidth=k.cheight=mf(k.def_csize*f.base)}else{if(j<m[1]){var b=h.base+(h.limit-h.base)*((k.qcols-m[0])/(m[1]-m[0]));d=e*b-4;k.cwidth=k.cheight=mf(d/j)}else{d=e*h.limit-4;k.cwidth=k.cheight=mf(k.def_csize*f.limit)}}ee("main").el.style.width=""+mf(d)+"px";this.canvas.width=mf((j-k.isextendcell)*k.cwidth);this.canvas.height=mf((l-k.isextendcell)*k.cheight);if(g.vml){var c=this.canvas.firstChild;c.style.width=""+this.canvas.clientWidth+"px";c.style.height=""+this.canvas.clientHeight+"px"}k.p0.x=k.p0.y=mf(k.def_psize*(k.cwidth/k.def_csize));if(k.isextendcell==1){k.p0.x+=mf(k.cwidth*0.45);k.p0.y+=mf(k.cheight*0.45)}var i=ee("puzzle_canvas").getRect();k.cv_oft.x=i.left;k.cv_oft.y=i.top;kp.resize();bd.setposAll();pc.onresize_func()},resize_canvas:function(){this.resize_canvas_only();pc.flushCanvasAll();pc.paintAll()},resize_canvas_onload:function(){if(pc.already()){this.resize_canvas()}else{uuCanvas.ready(ee.binder(this,this.resize_canvas))}},onresize_func:function(){if(this.resizetimer){clearTimeout(this.resizetimer)}this.resizetimer=setTimeout(ee.binder(this,this.resize_canvas),250)},resetInfo:function(a){if(a){um.allerase()}tc.Adjust();area.resetArea();line.resetLcnts()},accesslog:function(){var b=document.referrer;b=b.replace(/\?/g,"%3f");b=b.replace(/\&/g,"%26");b=b.replace(/\=/g,"%3d");b=b.replace(/\//g,"%2f");var a=false;if(typeof ActiveXObject!="undefined"){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){a=false}}if(!a&&typeof XMLHttpRequest!="undefined"){a=new XMLHttpRequest()}if(a){a.open("GET",["./record.cgi","?pid=",k.puzzleid,"&pzldata=",enc.uri.qdata,"&referer=",b].join(""));a.onreadystatechange=function(){};a.send(null)}}};base=new PBase();base.preload_func();