/*! @license pzpr.js v3.4.0 (c) 2009-2014 sabo2, MIT license
 *   https://bitbucket.org/sabo2/pzprv3 */
pzpr.createCustoms("nawabari",{MouseEvent:{mouseinput:function(){this.owner.playmode?(this.mousestart||this.mousemove)&&(this.btn.Left&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.owner.editmode&&this.mousestart&&this.inputqnum()}},KeyEvent:{enablemake:!0},"KeyEvent@fourcells,fivecells":{keyinput:function(a){"w"==a?this.key_inputvalid(a):this.key_inputqnum(a)},key_inputvalid:function(a){if("w"==a){var b=this.cursor.getTCC();b.isnull||(b.setQues(7!==b.getQues()?7:0),b.setNum(-1),b.drawaround())}}},Cell:{getdir4BorderCount:function(){for(var a=0,b=this.getdir4cblist(),c=0;c<b.length;c++){var d=b[c][0],e=b[c][1];(d.isnull||d.isEmpty()||e.isBorder())&&a++}return a}},"Cell@nawabari":{maxnum:4,minnum:0},"Cell@fourcells":{maxnum:3},"Cell@fivecells":{maxnum:3,minnum:0},"Border@fourcells,fivecells":{isGrid:function(){return this.sidecell[0].isValid()&&this.sidecell[1].isValid()},isBorder:function(){return this.qans>0||this.isQuesBorder()},isQuesBorder:function(){return!!(this.sidecell[0].isEmpty()^this.sidecell[1].isEmpty())}},"Board@nawabari":{hasborder:1},"Board@fourcells,fivecells":{hasborder:2,initBoardSize:function(a,b){this.Common.prototype.initBoardSize.call(this,a,b);var c=a*b%("fivecells"===this.owner.pid?5:4);c>=1&&(this.getc(this.minbx+1,this.minby+1).ques=7),c>=2&&(this.getc(this.maxbx-1,this.minby+1).ques=7),c>=3&&(this.getc(this.minbx+1,this.maxby-1).ques=7),c>=4&&(this.getc(this.maxbx-1,this.maxby-1).ques=7)}},AreaRoomManager:{enabled:!0},Graphic:{initialize:function(){this.Common.prototype.initialize.call(this),this.gridcolor=this.gridcolor_DLIGHT,"nawabari"===this.owner.pid&&this.setBorderColorFunc("qans")},paint:function(){this.drawBGCells(),"nawabari"===this.owner.pid?(this.drawDashedGrid(),this.drawBorders()):(this.drawValidDashedGrid(),this.drawQansBorders(),this.drawQuesBorders()),this.drawNumbers(),this.drawBorderQsubs(),"nawabari"===this.owner.pid&&this.drawChassis(),this.drawTarget()}},"Graphic@fourcells,fivecells":{getQansBorderColor:function(a){if(1===a.qans){var b=a.error;return 1===b?this.errcolor1:-1===b?this.errborderbgcolor:this.borderQanscolor}return null},getQuesBorderColor:function(a){return a.isQuesBorder()?this.cellcolor:null},drawValidDashedGrid:function(){for(var a=this.vinc("grid_waritai","crispEdges"),b=this.cw/10+3,c=Math.max(this.cw/b,1),d=this.cw/(2*c),e=(.2*this.cw,"b_grid_wari_"),f=this.range.borders,g=0;g<f.length;g++){var h=f[g];if(h.isGrid()){var i=h.bx*this.bw,j=h.by*this.bh;this.vnop(e+h.id,this.NONE)&&(a.lineWidth=1,a.strokeStyle=this.gridcolor,h.isVert()?a.strokeDashedLine(i+.5,j-this.bh,i+.5,j+this.bh,[d]):a.strokeDashedLine(i-this.bw,j+.5,i+this.bw,j+.5,[d]))}else this.vhide(e+h.id)}}},Encode:{decodePzpr:function(){this.decodeFivecells()},encodePzpr:function(){this.encodeFivecells()},decodeFivecells:function(){var a=0,b=0,c=this.outbstr,d=this.owner.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(e.ques=0,"7"==f?e.ques=7:"."==f?e.qnum=-2:this.include(f,"0","9")?e.qnum=parseInt(f,10):this.include(f,"a","z")&&(a+=parseInt(f,36)-10),a++,a>d.cellmax)break}this.outbstr=c.substr(b)},encodeFivecells:function(){for(var a="",b=0,c=this.owner.board,d=0;d<c.cellmax;d++){var e="",f=c.cell[d].qnum,g=c.cell[d].ques;7===g?e="7":-2===f?e=".":-1!==f?e=f.toString(10):b++,0==b?a+=e:(e||26==b)&&(a+=(9+b).toString(36)+e,b=0)}b>0&&(a+=(9+b).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){a.ques=0,"*"===b?a.ques=7:"-"===b?a.qnum=-2:"."!==b&&(a.qnum=parseInt(b))}),this.decodeBorderAns()},encodeData:function(){"fourcells"===this.owner.pid&&(this.filever=1),this.encodeCell(function(a){return 7===a.ques?"* ":-2===a.qnum?"- ":a.qnum>=0?a.qnum.toString()+" ":". "}),this.encodeBorderAns()}},AnsCheck:{checkAns:function(){var a=this.owner,b=a.board,c=a.pid,d=b.getRoomInfo();return"nawabari"!==c||this.checkAreaRect(d)?"nawabari"!==c||this.checkNoNumber(d)?"nawabari"!==c||this.checkDoubleNumber(d)?"fourcells"!==c||this.checkOverFourCells(d)?"fivecells"!==c||this.checkOverFiveCells(d)?this.checkdir4BorderAns()?this.checkBorderCount(1,0)?"fourcells"!==c||this.checkLessFourCells(d)?"fivecells"!==c||this.checkLessFiveCells(d)?null:"bkSizeGt5":"bkSizeGt4":"bdDeadEnd":"nmBorderNe":"bkSizeLt5":"bkSizeLt4":"bkNumGe2":"bkNoNum":"bkNotRect"},checkOverFourCells:function(a){return this.checkAllArea(a,function(a,b,c){return c>=4})},checkLessFourCells:function(a){return this.checkAllArea(a,function(a,b,c){return 4>=c})},checkOverFiveCells:function(a){return this.checkAllArea(a,function(a,b,c){return c>=5})},checkLessFiveCells:function(a){return this.checkAllArea(a,function(a,b,c){return 5>=c})},checkdir4BorderAns:function(){for(var a=!0,b=this.owner.board,c=0;c<b.cellmax;c++){var d=b.cell[c];if(d.isValidNum()&&d.getdir4BorderCount()!=d.getQnum()){if(this.checkOnly)return!1;d.seterr(1),a=!1}}return a}},FailCode:{bkNoNum:["数字の入っていない部屋があります。","A room has no numbers."],bkNumGe2:["1つの部屋に2つ以上の数字が入っています。","A room has plural numbers."],bkSizeLt4:["サイズが4マスより小さいブロックがあります。","The size of block is smaller than four."],bkSizeLt5:["サイズが5マスより小さいブロックがあります。","The size of block is smaller than five."],bkSizeGt4:["サイズが4マスより大きいブロックがあります。","The size of block is larger than four."],bkSizeGt5:["サイズが5マスより大きいブロックがあります。","The size of block is larger than five."]}});